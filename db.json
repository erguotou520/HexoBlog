{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":0},{"_id":"source/images/favicon.png","path":"images/favicon.png","modified":0,"renderable":0},{"_id":"source/images/avatar.png","path":"images/avatar.png","modified":0,"renderable":0},{"_id":"source/images/cloud/dokku.png","path":"images/cloud/dokku.png","modified":0,"renderable":0},{"_id":"source/images/devops/traefik-devops.jpg","path":"images/devops/traefik-devops.jpg","modified":0,"renderable":0},{"_id":"source/images/devops/traefik-drone-devops.png","path":"images/devops/traefik-drone-devops.png","modified":0,"renderable":0},{"_id":"source/images/devops/whoami.png","path":"images/devops/whoami.png","modified":0,"renderable":0},{"_id":"source/images/electron/logo.png","path":"images/electron/logo.png","modified":0,"renderable":0},{"_id":"source/images/electron/ssr.png","path":"images/electron/ssr.png","modified":0,"renderable":0},{"_id":"source/images/ghost/disqus.png","path":"images/ghost/disqus.png","modified":0,"renderable":0},{"_id":"source/images/ghost/ghost-image-format-error.png","path":"images/ghost/ghost-image-format-error.png","modified":0,"renderable":0},{"_id":"source/images/ghost/ghost-logo.png","path":"images/ghost/ghost-logo.png","modified":0,"renderable":0},{"_id":"source/images/ghost/swiftype-create-engine.png","path":"images/ghost/swiftype-create-engine.png","modified":0,"renderable":0},{"_id":"source/images/git/gogs-ssh.png","path":"images/git/gogs-ssh.png","modified":0,"renderable":0},{"_id":"source/images/others/adb-devices.png","path":"images/others/adb-devices.png","modified":0,"renderable":0},{"_id":"source/images/others/atom.png","path":"images/others/atom.png","modified":0,"renderable":0},{"_id":"source/images/others/chrome-inspect.png","path":"images/others/chrome-inspect.png","modified":0,"renderable":0},{"_id":"source/images/others/clover-mac.png","path":"images/others/clover-mac.png","modified":0,"renderable":0},{"_id":"source/images/others/mac-install.jpg","path":"images/others/mac-install.jpg","modified":0,"renderable":0},{"_id":"source/images/server/firebase.png","path":"images/server/firebase.png","modified":0,"renderable":0},{"_id":"source/images/server/nginx.png","path":"images/server/nginx.png","modified":0,"renderable":0},{"_id":"source/images/wechat/mina.png","path":"images/wechat/mina.png","modified":0,"renderable":0},{"_id":"themes/icarus/source/css/back-to-top.css","path":"css/back-to-top.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/css/insight.css","path":"css/insight.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/progressbar.css","path":"css/progressbar.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/search.css","path":"css/search.css","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/icarus/source/images/avatar.png","path":"images/avatar.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/images/favicon.png","path":"images/favicon.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/images/favicon.svg","path":"images/favicon.svg","modified":0,"renderable":1},{"_id":"themes/icarus/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/icarus/source/images/thumbnail.svg","path":"images/thumbnail.svg","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/animation.js","path":"js/animation.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/back-to-top.js","path":"js/back-to-top.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/clipboard.js","path":"js/clipboard.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/gallery.js","path":"js/gallery.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"source/images/ci/flow.png","path":"images/ci/flow.png","modified":0,"renderable":0},{"_id":"source/images/devops/traefik-devops-final.png","path":"images/devops/traefik-devops-final.png","modified":0,"renderable":0},{"_id":"source/images/devops/traefik-devops1.png","path":"images/devops/traefik-devops1.png","modified":0,"renderable":0},{"_id":"source/images/devops/traefik-only-whoami.png","path":"images/devops/traefik-only-whoami.png","modified":0,"renderable":0},{"_id":"source/images/git/git.png","path":"images/git/git.png","modified":0,"renderable":0},{"_id":"source/images/js/cookie.png","path":"images/js/cookie.png","modified":0,"renderable":0},{"_id":"source/images/others/custom-theme-tool.png","path":"images/others/custom-theme-tool.png","modified":0,"renderable":0},{"_id":"source/images/others/debug.png","path":"images/others/debug.png","modified":0,"renderable":0},{"_id":"source/images/others/safari-develop.png","path":"images/others/safari-develop.png","modified":0,"renderable":0},{"_id":"source/images/others/safari-devices.png","path":"images/others/safari-devices.png","modified":0,"renderable":0},{"_id":"source/images/others/test.png","path":"images/others/test.png","modified":0,"renderable":0},{"_id":"source/images/server/openssh.gif","path":"images/server/openssh.gif","modified":0,"renderable":0},{"_id":"source/images/ghost/postman.png","path":"images/ghost/postman.png","modified":0,"renderable":0},{"_id":"source/images/ghost/qiniu-new-block.png","path":"images/ghost/qiniu-new-block.png","modified":0,"renderable":0},{"_id":"source/images/linux/raspberry.png","path":"images/linux/raspberry.png","modified":0,"renderable":0},{"_id":"source/images/linux/vsftpd_logo.png","path":"images/linux/vsftpd_logo.png","modified":0,"renderable":0},{"_id":"source/images/rancher/logo.png","path":"images/rancher/logo.png","modified":0,"renderable":0},{"_id":"source/images/ghost/disqus-code-selection.png","path":"images/ghost/disqus-code-selection.png","modified":0,"renderable":0},{"_id":"source/images/ghost/disqus-profile.png","path":"images/ghost/disqus-profile.png","modified":0,"renderable":0},{"_id":"source/images/ghost/ghost-navigation.png","path":"images/ghost/ghost-navigation.png","modified":0,"renderable":0},{"_id":"source/images/ghost/openshift-source-code.png","path":"images/ghost/openshift-source-code.png","modified":0,"renderable":0},{"_id":"source/images/ghost/qiniu-link.png","path":"images/ghost/qiniu-link.png","modified":0,"renderable":0},{"_id":"source/images/ghost/qiniu-upload.png","path":"images/ghost/qiniu-upload.png","modified":0,"renderable":0},{"_id":"source/images/ghost/ghost-title-date.png","path":"images/ghost/ghost-title-date.png","modified":0,"renderable":0},{"_id":"source/images/ghost/duoshuo.png","path":"images/ghost/duoshuo.png","modified":0,"renderable":0},{"_id":"source/images/ghost/ghost-china.png","path":"images/ghost/ghost-china.png","modified":0,"renderable":0},{"_id":"source/images/others/inspect-debug.png","path":"images/others/inspect-debug.png","modified":0,"renderable":0},{"_id":"source/images/others/20141226-1.jpg","path":"images/others/20141226-1.jpg","modified":0,"renderable":0},{"_id":"source/images/windows/win10.png","path":"images/windows/win10.png","modified":0,"renderable":0},{"_id":"source/images/ghost/ghost-tag.png","path":"images/ghost/ghost-tag.png","modified":0,"renderable":0},{"_id":"source/images/vps/bandwagonhost.png","path":"images/vps/bandwagonhost.png","modified":0,"renderable":0}],"Cache":[{"_id":"themes/icarus/.gitignore","hash":"35572c0f161a751b9f30ae3a9935ac045dba5220","modified":1554520133322},{"_id":"themes/icarus/LICENSE","hash":"41f72cd544612bc4589c924c776422b800a4eff7","modified":1553608024921},{"_id":"themes/icarus/README.md","hash":"4409383fbd7422800049d6597e9b26aa8db66b66","modified":1553608024921},{"_id":"themes/icarus/_config.yml","hash":"dad0b3cf89572dae60b8868b0bfde8f7ee620edd","modified":1582388434849},{"_id":"themes/icarus/package.json","hash":"4167e65682af257bdf8531a05730e6c42339996d","modified":1553608024952},{"_id":"source/_drafts/interview.md","hash":"bebfa94a8636df3d2626b7d2e3529e821ad1f709","modified":1473344768000},{"_id":"source/_posts/atom-frontend-plugins.md","hash":"841e760a0ee5c93badc6805cf5e37ab7155920da","modified":1553608024870},{"_id":"source/_posts/attachment-in-ghost.md","hash":"c6611f6535841bf5182a63d8e0b5183dba09b9fb","modified":1553608024870},{"_id":"source/_posts/black-mac-os.md","hash":"f075c76bdb2d2636befc02759ff2bef32086b0d5","modified":1581958267543},{"_id":"source/_posts/category-in-ghost.md","hash":"fa49e6171cee80734f33ee99e13424dbe1bf86f1","modified":1553608024871},{"_id":"source/_posts/centos7-update-openssh.md","hash":"5da3e714e60495dd1937eff3983fa5f2265120e0","modified":1581958238903},{"_id":"source/_posts/ci.md","hash":"e7f041540058b397b4b7d3b34ecf7a17ad4dbbd4","modified":1553608024872},{"_id":"source/_posts/comment-in-ghost.md","hash":"6d90e0688d67d37d7830a7f24d84eeac874a8a3b","modified":1553608024872},{"_id":"source/_posts/cookie-tidy.md","hash":"ccc45aa98d295e880b4a172626c897aaaf92136b","modified":1553608024873},{"_id":"source/_posts/debug-pad.md","hash":"59ca55948785e925dafdf8737bcb1337673a3333","modified":1553608024874},{"_id":"source/_posts/develop-electron-ssr.md","hash":"dfeeb3f39b0d3faa6a034f757e8be42a89a54079","modified":1553608024875},{"_id":"source/_posts/dokku_ci_cd.md","hash":"d31542c0039eb13a12031705f708c496476815bc","modified":1581958238905},{"_id":"source/_posts/electron-app-summary.md","hash":"7aaff6b13efb24cbeafc459ba6b84d31ffecd3d0","modified":1553608024876},{"_id":"source/_posts/ghost-api.md","hash":"81e29eac43acca1bdad0f6a3393135921b1f235d","modified":1553608024877},{"_id":"source/_posts/ghost-code-1.md","hash":"5d86314af84c7646a0a46fa86ff0329abd55964a","modified":1553608024877},{"_id":"source/_posts/ghost-list.md","hash":"2c7e950c1ca763a54b74ff74194708dc8b13e595","modified":1472374330000},{"_id":"source/_posts/ghost-on-banwagong.md","hash":"1745e448ba7122d2f92fd08acce2c8e31b0e3b28","modified":1553608024877},{"_id":"source/_posts/ghost-on-openshift.md","hash":"0e58f7d265c88e4f0616092a52ebfdb1ec7bf0e4","modified":1553608024878},{"_id":"source/_posts/ghost-on-raspberry.md","hash":"fc0e98547ff115273679673002091cee83b5aeda","modified":1553608024878},{"_id":"source/_posts/ghost-swiftype-guide.md","hash":"3db41e760900769187fd3cd2168423c08eba1aad","modified":1553608024878},{"_id":"source/_posts/git-branch-management-strategy.md","hash":"31129c1f9b65373de8a2410aecdce3b1071a38c7","modified":1553608024879},{"_id":"source/_posts/git-migration.md","hash":"451ccfaae1b9d3fad297d20355cbe1f527404d9e","modified":1553608024879},{"_id":"source/_posts/hexo-on-firebase.md","hash":"ffaf2779d63cf5bd646069e846a4ef91c8f8782b","modified":1553608024879},{"_id":"source/_posts/new-windows-develop-env.md","hash":"6552468b4de4edbbbfcc80f7f71861b3dc833a48","modified":1553608024880},{"_id":"source/_posts/nginx-tomcat-iis.md","hash":"24b1add6f2918278e640633da78b155eaaf1e096","modified":1553608024880},{"_id":"source/_posts/nodejs-share.md","hash":"f4ad80face736c7f3f03af514b6fa3b09eea5c39","modified":1553608024881},{"_id":"source/_posts/play-video-while-downloading.md","hash":"5ba29251e8f1fd66a52ee48c962fb0d2bf0c1714","modified":1553608024881},{"_id":"source/_posts/ppt-online.md","hash":"cc7e48ac27b2074aeb48145a6b35179f82061e2b","modified":1553608024882},{"_id":"source/_posts/pretty-webfont.md","hash":"a3d10db7c2d9f9470eb86fd448e5a038c151f476","modified":1472374330000},{"_id":"source/_posts/rancher-k8s.md","hash":"2fed15078e7dcf3c6b1f83ec08c60b5b60437472","modified":1553608024882},{"_id":"source/_posts/raspberry-pi-samba.md","hash":"9e2137bd3c7678db28018849fc07c1dcd670ed90","modified":1553608024883},{"_id":"source/_posts/road-to-frontend.md","hash":"53dff4dab25b42aa55c161d2154788a50ded940f","modified":1553608024884},{"_id":"source/_posts/some-remark.md","hash":"8abc515c77e9ca99b6587c2c08e2bd5837360649","modified":1472374330000},{"_id":"source/_posts/ssh-via-public-key.md","hash":"bc0ef3441678722cf047dfa9e5609356c0f83a5e","modified":1553608024884},{"_id":"source/_posts/svn-git-transfer.md","hash":"f7aa4e73baf92bd2dfb20ee49e5cd0724cf7afd3","modified":1553608024884},{"_id":"source/_posts/traefik-devops.md","hash":"d7454e65c722e75553a132ad238fee5cffc70c8e","modified":1581958463058},{"_id":"source/_posts/vsftpd-config.md","hash":"36d27db06a846f1e618bf1f0878708a5284b59c6","modified":1553608024885},{"_id":"source/_posts/wechat-mina-note.md","hash":"13ef93d5a1e8ddfb27ddb0594cb1989e09a42873","modified":1582388288968},{"_id":"source/about/index.md","hash":"2847759c65295fdc47685cc32e10ae30b2f022ae","modified":1499697184000},{"_id":"source/categories/index.md","hash":"55bee2cb88da438a2e8b1f29b1d7e954c07a9e60","modified":1499697184000},{"_id":"source/images/.DS_Store","hash":"cc115f1f7e4a6efdf4c90fc10a324af8d83f1bda","modified":1582387699675},{"_id":"source/images/avatar.jpg","hash":"9945dcd383f0e0f88c37218cc21efc176decbb43","modified":1582388411005},{"_id":"source/images/favicon.png","hash":"0490dfbcbfce6f149de2079109f4cde830aa5936","modified":1553608024887},{"_id":"source/tags/index.md","hash":"e999413d6392c34156b5c6e9273f9069f9e6d92d","modified":1499697184000},{"_id":"themes/icarus/languages/en.yml","hash":"b69c91878f30937f50438ff64dffd3f6bf91bcf5","modified":1553608024932},{"_id":"themes/icarus/languages/es.yml","hash":"8827823e5b2ce967566854c9bfebc7c69098b4ac","modified":1553608024932},{"_id":"themes/icarus/languages/fr.yml","hash":"0017f93a5d491a9c0e55911cdc35316762c5a94e","modified":1553608024932},{"_id":"themes/icarus/languages/id.yml","hash":"92d2d19a62a17b6e99f82a014309bbf6c13c9ae8","modified":1553608024933},{"_id":"themes/icarus/languages/ja.yml","hash":"6eed7771de2353d71b720c6e605cceb3f230b12e","modified":1553608024933},{"_id":"themes/icarus/languages/ko.yml","hash":"06d2bb8b66f68f780218e0ba7edffe1e57fac268","modified":1553608024933},{"_id":"themes/icarus/languages/pt-BR.yml","hash":"bcf5bc81ca855d26bbc3b3bfabc7d84429e74b85","modified":1553608024934},{"_id":"themes/icarus/languages/ru.yml","hash":"ba8b4f7d77eb1d1e28aa1f9107bd0bbbdc4cba99","modified":1553608024934},{"_id":"themes/icarus/languages/tr.yml","hash":"eff1c0b3d5c4b328f6dd74a195ff378c898f4d29","modified":1553608024934},{"_id":"themes/icarus/languages/zh-CN.yml","hash":"804f6a1edee49bb6a5ecb8e9d14d3e93eaca37c0","modified":1553608024934},{"_id":"themes/icarus/languages/zh-TW.yml","hash":"79fab0bff625634fb6bb6cadf9c547bd36226dcf","modified":1553608024935},{"_id":"themes/icarus/layout/archive.ejs","hash":"64a81f4c6ca9517169413408d076371e8e09c63a","modified":1553608024935},{"_id":"themes/icarus/layout/categories.ejs","hash":"29d304f2b95a04fbc5e7529f9bdce9648e3545ef","modified":1553608024936},{"_id":"themes/icarus/layout/category.ejs","hash":"bda344da0e6c03899f53abc20ae2a2efab5ab243","modified":1553608024936},{"_id":"themes/icarus/layout/index.ejs","hash":"71120f41d019bf2866a5556747e5e671c8147f85","modified":1553608024942},{"_id":"themes/icarus/layout/layout.ejs","hash":"da63c914247eba116ea5263bfc27a69e96f859b6","modified":1553608024942},{"_id":"themes/icarus/layout/page.ejs","hash":"50170783bac99946ae8af483920568de9b2d9801","modified":1553608024943},{"_id":"themes/icarus/layout/post.ejs","hash":"50170783bac99946ae8af483920568de9b2d9801","modified":1553608024946},{"_id":"themes/icarus/layout/tag.ejs","hash":"1feac7aa842882757a479b8ad427f6a72fce70c4","modified":1553608024949},{"_id":"themes/icarus/layout/tags.ejs","hash":"0c527c6b72386f11c18e8aa5249be8c601e69906","modified":1553608024949},{"_id":"themes/icarus/scripts/index.js","hash":"9203e2ba1f821d945edf20fc277f3c58d22bfd00","modified":1553608024952},{"_id":"themes/icarus/source/.DS_Store","hash":"3897abd4c1d41a9aff1913a4df44eafdb5626354","modified":1582016163371},{"_id":"source/images/avatar.png","hash":"67dd91cd2fa1164090b346a6d4144de8ca02f0d1","modified":1553608024885},{"_id":"source/images/cloud/dokku.png","hash":"b62463658180f210613f019651ab4c6ed57b6b43","modified":1553608024886},{"_id":"source/images/devops/traefik-devops.jpg","hash":"dba6106c2fec5c6def92a5bf4d0e1d4fec4e5c31","modified":1581835600080},{"_id":"source/images/devops/traefik-drone-devops.png","hash":"4babfe98eca056306912161ade66d4daeae78f5f","modified":1581956511832},{"_id":"source/images/devops/whoami.png","hash":"36cfb52175b15a4604b91b18ab16b4502d362f5b","modified":1581946667824},{"_id":"source/images/electron/logo.png","hash":"bafc582d5b6345fab772b6dbb23700593afd8d9c","modified":1553608024886},{"_id":"source/images/electron/ssr.png","hash":"4ad061485d54dd3e34813fbe66b9910e30bc9337","modified":1553608024887},{"_id":"source/images/ghost/disqus.png","hash":"35a3313ee02d003668ee7916b9a47618c3fd9b43","modified":1472374330000},{"_id":"source/images/ghost/ghost-image-format-error.png","hash":"8cb87a0a95d81756b9b61a061d5163b82f72fdbc","modified":1472374330000},{"_id":"source/images/ghost/ghost-logo.png","hash":"cda35a0a794f583a9c1a1fe0ce323b1afeda2e4f","modified":1553608024909},{"_id":"source/images/ghost/swiftype-create-engine.png","hash":"1d1325c3a335c2c23287f7bd5a207752c6e46fa9","modified":1472374330000},{"_id":"source/images/git/gogs-ssh.png","hash":"bf7370877d1a05e83f70a2328f6201ecb94d9512","modified":1472374330000},{"_id":"source/images/others/adb-devices.png","hash":"d65db5fd01f776c653bf18f0b6a64be92dbc4ad0","modified":1473344738000},{"_id":"source/images/others/atom.png","hash":"d719e4c5bb95234c69ec706e420deb097e59b577","modified":1553608024912},{"_id":"source/images/others/chrome-inspect.png","hash":"61421ec4cdba4ece697f5f608850245f865ddb09","modified":1473344738000},{"_id":"source/images/others/clover-mac.png","hash":"5da6efd544b9d9c9304cf693781797a5373777ed","modified":1557848723638},{"_id":"source/images/others/mac-install.jpg","hash":"a7a82a7a9089fce71ccb7d5183f9a7feaa089326","modified":1557846808000},{"_id":"source/images/server/firebase.png","hash":"0ab7a5f5d44db0e3e99f20dc42f4c642a1304554","modified":1553608024917},{"_id":"source/images/server/nginx.png","hash":"41cce8a251b05b06f9ee3d3427f342bed0fbedc2","modified":1553608024918},{"_id":"source/images/wechat/mina.png","hash":"328b4b2e8115525c1ee5cb9f4c487528fdc5474d","modified":1582388280435},{"_id":"themes/icarus/includes/common/ConfigGenerator.js","hash":"451397efc7808787419fa3eb6b043c0bd8bbdf30","modified":1553608024922},{"_id":"themes/icarus/includes/common/ConfigValidator.js","hash":"cd3cd12bc042b401825fd7bfd9a6434c8b14e092","modified":1553608024922},{"_id":"themes/icarus/includes/common/utils.js","hash":"c0aeaeb57a42bcc71a92da2249762f91abd83ffe","modified":1553608024922},{"_id":"themes/icarus/includes/filters/highlight.js","hash":"19a4dcd2dee7388544b57e473cfb0fc9eea9623e","modified":1553608024923},{"_id":"themes/icarus/includes/generators/categories.js","hash":"7cb370ac53a05d6b1b9203579716c0ca83d35c36","modified":1553608024923},{"_id":"themes/icarus/includes/generators/category.js","hash":"313e170e55d74526c4e1be7181ef7a21439147c9","modified":1553608024924},{"_id":"themes/icarus/includes/generators/insight.js","hash":"c4b981443927b87cc14a3a583029e13f819d6d71","modified":1553608024924},{"_id":"themes/icarus/includes/generators/tags.js","hash":"8195322c208706427a1cf56361669dca4d86f6f1","modified":1553608024924},{"_id":"themes/icarus/includes/helpers/cdn.js","hash":"7d34ea6400cb3611c374c135304abcb65ef291b7","modified":1553608024925},{"_id":"themes/icarus/includes/helpers/config.js","hash":"173e02987e7a7d5df1e686f6ee4edd8cf494bdd3","modified":1553608024925},{"_id":"themes/icarus/includes/helpers/layout.js","hash":"afdf5e9704cfc087526b4a0403fe7eb04f22190e","modified":1553608024925},{"_id":"themes/icarus/includes/helpers/override.js","hash":"726cf99612fd060753d9da08db2776aec1802e20","modified":1553608024926},{"_id":"themes/icarus/includes/helpers/page.js","hash":"25aeed6449ca381661cec528fe96bbb993026ca9","modified":1553608024926},{"_id":"themes/icarus/includes/helpers/site.js","hash":"f154ddb0dac79fd28ced2b518f8052b42555d0c9","modified":1553608024926},{"_id":"themes/icarus/includes/specs/article.spec.js","hash":"a805c1a6f03ccb07d73512aef40d38541ddbb0eb","modified":1553608024927},{"_id":"themes/icarus/includes/specs/comment.spec.js","hash":"02af67eb87482028b223299b20a129756b1c122b","modified":1553608024927},{"_id":"themes/icarus/includes/specs/config.spec.js","hash":"7a9bac384a73cf9f39173fdb2dfc2813784d8891","modified":1553608024927},{"_id":"themes/icarus/includes/specs/donate.spec.js","hash":"639b405c9e5dac04c2dc168c2754e50a5c13d197","modified":1553608024927},{"_id":"themes/icarus/includes/specs/footer.spec.js","hash":"49fabe9c03f3124f0253fa1ee3e69328373ad117","modified":1553608024928},{"_id":"themes/icarus/includes/specs/icon_link.spec.js","hash":"f2a83ac5ccb74fc6f3dfbd25430e142297d8491c","modified":1553608024928},{"_id":"themes/icarus/includes/specs/meta.spec.js","hash":"70abe77d3664176ec977316522014ce7e0aa439d","modified":1553608024928},{"_id":"themes/icarus/includes/specs/navbar.spec.js","hash":"67ebd05fb378439a094a7906f4ea04fbedd8c1b5","modified":1553608024929},{"_id":"themes/icarus/includes/specs/plugins.spec.js","hash":"3db2046311dd0392aed0ba2d81b51a081131f1de","modified":1553608024929},{"_id":"themes/icarus/includes/specs/providers.spec.js","hash":"e29473155a35f391fbc53349bdc256cb7600855e","modified":1553608024929},{"_id":"themes/icarus/includes/specs/search.spec.js","hash":"d981ad203a2002c35d710d33e304f9e99f31cab0","modified":1553608024929},{"_id":"themes/icarus/includes/specs/share.spec.js","hash":"6c04cccec13a656189ab2d917d69d059027d0343","modified":1553608024930},{"_id":"themes/icarus/includes/specs/sidebar.spec.js","hash":"bd500be763486918894e731ce14bc9c4047fb76d","modified":1553608024930},{"_id":"themes/icarus/includes/specs/widgets.spec.js","hash":"eeeaae3ed079033788b19e172cd1f83c5ca8bc4f","modified":1553608024930},{"_id":"themes/icarus/includes/tasks/check_config.js","hash":"ce7626d643737c90dee6b75435ccdec26b89dacf","modified":1553608024931},{"_id":"themes/icarus/includes/tasks/check_deps.js","hash":"8f40e4d49500ceebbc220d7e8f57b83d527329d6","modified":1581959323690},{"_id":"themes/icarus/includes/tasks/welcome.js","hash":"00d1ef8c9609552b82e9a5140b838a9057c59508","modified":1553608024931},{"_id":"themes/icarus/layout/comment/changyan.ejs","hash":"9ccc7ec354b968e60bdcfcd1dba451d38de61f12","modified":1553608024936},{"_id":"themes/icarus/layout/comment/disqus.ejs","hash":"b5fff46e453d58baa20028a47fd85923494bb85c","modified":1553608024937},{"_id":"themes/icarus/layout/comment/facebook.ejs","hash":"b38ea86a1cae48f671501af74d7f109f63fb3d72","modified":1553608024937},{"_id":"themes/icarus/layout/comment/gitalk.ejs","hash":"ef01396e64ab4f6e62155f0b357bcd903138d611","modified":1553608024937},{"_id":"themes/icarus/layout/comment/gitment.ejs","hash":"033fb890dc1de71f7d3b97061d0d75f4564bd09a","modified":1553608024938},{"_id":"themes/icarus/layout/comment/isso.ejs","hash":"cc6a43bd24be764086f88ad7c5c97ff04df87e0b","modified":1553608024938},{"_id":"themes/icarus/layout/comment/livere.ejs","hash":"12ff9a345f6bba2f732f592e39508c2afde89b00","modified":1553608024938},{"_id":"themes/icarus/layout/comment/valine.ejs","hash":"a29cf2e69f66a37ddcec8343c60af1e676dcb77d","modified":1553608024938},{"_id":"themes/icarus/layout/common/article.ejs","hash":"8af2176cc3fe6a5fc9fcf727c4e3fbc5afec9269","modified":1553608024939},{"_id":"themes/icarus/layout/common/footer.ejs","hash":"9e57d97a52ad358b5f38cf87a3fda356d2094b6d","modified":1553608024939},{"_id":"themes/icarus/layout/common/head.ejs","hash":"bd72ffd5942bb2fd18319d551bbaa59647e33f3c","modified":1553608024939},{"_id":"themes/icarus/layout/common/navbar.ejs","hash":"5082ea45df0f79f955143177287d92bcf3832fcf","modified":1553608024940},{"_id":"themes/icarus/layout/common/paginator.ejs","hash":"7837d80b27f166161b3deeffb571680025c7d723","modified":1553608024940},{"_id":"themes/icarus/layout/common/scripts.ejs","hash":"5414d6bfbf88efa7e72ccf7e44a79d0378ddeb77","modified":1553608024940},{"_id":"themes/icarus/layout/common/widget.ejs","hash":"5417af9f208d2fb5aaeb96031caa261e9683557c","modified":1553608024941},{"_id":"themes/icarus/layout/donate/alipay.ejs","hash":"3290058879973e403a05472a0fe2ac0219d5b961","modified":1553608024941},{"_id":"themes/icarus/layout/donate/patreon.ejs","hash":"8e52a9c28ffaf4b0b786a20977b848c5f60f2274","modified":1553608024941},{"_id":"themes/icarus/layout/donate/paypal.ejs","hash":"3975dee39f9378975b9c10f37d118ad7cb6f5bf6","modified":1553608024942},{"_id":"themes/icarus/layout/donate/wechat.ejs","hash":"051b873e1fc28c1d7c2d6443991b6a2f43813e6b","modified":1553608024942},{"_id":"themes/icarus/layout/plugin/animejs.ejs","hash":"198062ef863c96aa4d6a8225d575afcb60dfb1d1","modified":1553608024943},{"_id":"themes/icarus/layout/plugin/back-to-top.ejs","hash":"79d1118a3d3ebc521ffce452b986b504f0e7d6b7","modified":1553608024943},{"_id":"themes/icarus/layout/plugin/baidu-analytics.ejs","hash":"eb66e313ad43ec4424b2d75bae94e5c8a7568428","modified":1553608024944},{"_id":"themes/icarus/layout/plugin/busuanzi.ejs","hash":"205dedf8f97e328bb3182dc8daebd2e2b2204aca","modified":1553608024944},{"_id":"themes/icarus/layout/plugin/clipboard.ejs","hash":"8662ed9c211f3993b93eedcf5e41c2a1ddbede57","modified":1553608024944},{"_id":"themes/icarus/layout/plugin/gallery.ejs","hash":"ad68fafd923747d6b7c1b5873d00989d1639678c","modified":1553608024945},{"_id":"themes/icarus/layout/plugin/google-analytics.ejs","hash":"282cecb28ac458b71b56cf429c72ffac0f820199","modified":1553608024945},{"_id":"themes/icarus/layout/plugin/hotjar.ejs","hash":"2b97737d802984750a7b4461fcf68818a57a2439","modified":1553608024945},{"_id":"themes/icarus/layout/plugin/mathjax.ejs","hash":"667aabb6b9cb4d707b37975af794d4a3c66b5264","modified":1553608024945},{"_id":"themes/icarus/layout/plugin/outdated-browser.ejs","hash":"fe051093893c64c8575bcc67dc1c146d409e8e80","modified":1553608024946},{"_id":"themes/icarus/layout/plugin/progressbar.ejs","hash":"e594ed6705bccbef27f49d84b6153f6443efbecd","modified":1553608024946},{"_id":"themes/icarus/layout/search/baidu.ejs","hash":"850aa91778100d693a52b10eaa8586c8e3215ee6","modified":1553608024947},{"_id":"themes/icarus/layout/search/google-cse.ejs","hash":"4b881a99325a6a0cebf97ac53e09d8fc67f87d29","modified":1553608024947},{"_id":"themes/icarus/layout/search/insight.ejs","hash":"9a27db2a007582ceee7ca4b1eebddbd456893568","modified":1553608024947},{"_id":"themes/icarus/layout/share/addthis.ejs","hash":"f1c5f337333009d5f00dfbac4864a16ef8f9cb8d","modified":1553608024948},{"_id":"themes/icarus/layout/share/addtoany.ejs","hash":"04cb247d8c83ca7c5b52f3b11bb3ac155b1bc3ab","modified":1553608024948},{"_id":"themes/icarus/layout/share/bdshare.ejs","hash":"f14c8084b7ee16a091f0bd2ae9039e3bfff7e7b7","modified":1553608024948},{"_id":"themes/icarus/layout/share/sharejs.ejs","hash":"65d08316cc479910ea4f526cd1c299d0104daf7f","modified":1553608024949},{"_id":"themes/icarus/layout/share/sharethis.ejs","hash":"4f2c40f790f3be0a4e79db04f02ea41ba2f4d4c0","modified":1553608024949},{"_id":"themes/icarus/layout/widget/archive.ejs","hash":"eb738a2ac2935ce7a542964d90088613b281dd15","modified":1553608024950},{"_id":"themes/icarus/layout/widget/category.ejs","hash":"c2a9f2211a21a168c54b0563cdfd58bd25fa39fe","modified":1553608024950},{"_id":"themes/icarus/layout/widget/links.ejs","hash":"2b707fd65c94b00d8b4c6755fbc6c19709f3d49a","modified":1553608024950},{"_id":"themes/icarus/layout/widget/profile.ejs","hash":"04ef01227b140b74c0396196dd7a1996f3cccf95","modified":1553608024950},{"_id":"themes/icarus/layout/widget/recent_posts.ejs","hash":"2166f3190e47bf4746775b5d16654564a88c2041","modified":1553608024951},{"_id":"themes/icarus/layout/widget/tag.ejs","hash":"8c5b8020ca776cc3ebbc7b723915f3173efc28d4","modified":1553608024951},{"_id":"themes/icarus/layout/widget/tagcloud.ejs","hash":"d32e7c56e8e2074da16d9141f9a597841d28d07d","modified":1553608024951},{"_id":"themes/icarus/layout/widget/toc.ejs","hash":"bdc6f22602cdabe7c740f1818e0681ff8508fb64","modified":1553608024952},{"_id":"themes/icarus/source/css/back-to-top.css","hash":"5805bee2445e997d64dfe526b08b5fe0bce357eb","modified":1553608024953},{"_id":"themes/icarus/source/css/insight.css","hash":"13d00ca02aca6d0ffd5ba7fee174e8ad7cece202","modified":1582390873537},{"_id":"themes/icarus/source/css/progressbar.css","hash":"cb189ca56a4ecb43f6bf037da9d688c51ab364b3","modified":1582390873538},{"_id":"themes/icarus/source/css/search.css","hash":"963661e51e7af29ad40a8c01535c53b5bf94a756","modified":1582390873537},{"_id":"themes/icarus/source/css/style.styl","hash":"c08c78b4958137aefc1ff4623b580ab424119cdc","modified":1582391006450},{"_id":"themes/icarus/source/images/avatar.png","hash":"0d8236dcca871735500e9d06bbdbe0853ed6775b","modified":1553608024954},{"_id":"themes/icarus/source/images/favicon.png","hash":"7091b0c8feba52554f9db95079278fd145bee9db","modified":1582390699976},{"_id":"themes/icarus/source/images/favicon.svg","hash":"16fd847265845063a16596761cddb32926073dd2","modified":1553608024955},{"_id":"themes/icarus/source/images/logo.svg","hash":"fad38ed23dc05d17df635cbfe6341cad834288d8","modified":1582390750003},{"_id":"themes/icarus/source/images/thumbnail.svg","hash":"b9c58ff09ed415e6cf08b42b35faa2bc000d5059","modified":1553608024955},{"_id":"themes/icarus/source/js/animation.js","hash":"d744581909d2d092a584be07c39f9d3f0d009ec7","modified":1553608024955},{"_id":"themes/icarus/source/js/back-to-top.js","hash":"b1dcf30577cefe833dc6151757c0a05ea5b5a643","modified":1553608024956},{"_id":"themes/icarus/source/js/clipboard.js","hash":"6fdd602268727744b6b2c8ad79d684aab3cffda5","modified":1553608024956},{"_id":"themes/icarus/source/js/gallery.js","hash":"88b23abfc3b519413be54533ed0f39e0c68fcdd1","modified":1553608024956},{"_id":"themes/icarus/source/js/insight.js","hash":"8ba56fd5e4232a05ccef5f8b733c7ecca0814633","modified":1553608024957},{"_id":"themes/icarus/source/js/main.js","hash":"3357a1798a994afad0a849a679ca2ed6e0ce2424","modified":1553608024957},{"_id":"source/images/ci/flow.png","hash":"0f4a50c1b16417e73b87c6b3da222aeaf09d857b","modified":1487847003000},{"_id":"source/images/devops/traefik-devops-final.png","hash":"12008fb103bf49afbda60d20c41f637bf2067f3a","modified":1581946619572},{"_id":"source/images/devops/traefik-devops1.png","hash":"79034832bf8f800eced5b04abb73dfcabd090681","modified":1581946651025},{"_id":"source/images/devops/traefik-only-whoami.png","hash":"395882257fb4741fc71bc6aa2499b0a67702b3ce","modified":1581946659029},{"_id":"source/images/git/git.png","hash":"c2d50ce9207ccead7e0b326979e739ff2203c4ce","modified":1472374330000},{"_id":"source/images/js/cookie.png","hash":"3be1ec7c6173b84f8f982af25f9314f7b8864dec","modified":1553608024910},{"_id":"source/images/others/custom-theme-tool.png","hash":"6f123026fb318f9e6923d5c5b5e1951a35e78af8","modified":1553608024913},{"_id":"source/images/others/debug.png","hash":"64ea2d078f84f38422774313b49f6bb1a945659e","modified":1553608024915},{"_id":"source/images/others/safari-develop.png","hash":"0cbe7cae812dd76cde1a5a55d950d7c228e4ac51","modified":1473344738000},{"_id":"source/images/others/safari-devices.png","hash":"cb6ac6391690370b4c39d6623e6cd9b3f671ca57","modified":1473344738000},{"_id":"source/images/others/test.png","hash":"fe221defb59371f0730ba9501c26471cf0aff628","modified":1472374330000},{"_id":"source/images/server/openssh.gif","hash":"390b1ccf85fca411298ea6e7ff3c64c33c20b990","modified":1581958238910},{"_id":"source/images/ghost/postman.png","hash":"edc6d9f4445d5f07ac83faa209a6ad15498cfc3c","modified":1472374330000},{"_id":"source/images/ghost/qiniu-new-block.png","hash":"50a40c96b6619cb2f5ae451e8eabf5ac4e1529fc","modified":1472374330000},{"_id":"source/images/linux/raspberry.png","hash":"d44f41b9c8cfb3bf173d7e84e407644522d6b734","modified":1553608024911},{"_id":"source/images/linux/vsftpd_logo.png","hash":"12621cf17e9299cbeed536e301be1205a273664f","modified":1472374330000},{"_id":"source/images/rancher/logo.png","hash":"52e6d5556a9719aa83506b386121ba76550a2838","modified":1553608024917},{"_id":"source/images/ghost/disqus-code-selection.png","hash":"c92a6656c83eb1990a6f8a6242bcfcce58f85245","modified":1472374330000},{"_id":"source/images/ghost/disqus-profile.png","hash":"a74daf6fa0f9ed70fda589df9004e10c3947d481","modified":1472374330000},{"_id":"source/images/ghost/ghost-navigation.png","hash":"7f5114f203d0f5bcc063772545d789a9e1733620","modified":1472374330000},{"_id":"source/images/ghost/openshift-source-code.png","hash":"158598a5568a43a7b63c6198ea1bafdfbf75c9d4","modified":1472374330000},{"_id":"source/images/ghost/qiniu-link.png","hash":"aaeaa83d5f8e610c87d63eda13d8882a68bfd905","modified":1472374330000},{"_id":"source/images/ghost/qiniu-upload.png","hash":"c8cbe916a6cbec2fcbf17166b528477efb962c50","modified":1472374330000},{"_id":"source/images/ghost/ghost-title-date.png","hash":"37e421276e828c7f036ba73af6495556389776a5","modified":1472374330000},{"_id":"source/images/ghost/duoshuo.png","hash":"ba6bda57a590b958c13f03acf566f9aaf709df86","modified":1472374330000},{"_id":"source/images/ghost/ghost-china.png","hash":"4d1c82edcd6c1be70a57a35d2d506a668a206b75","modified":1472374330000},{"_id":"source/images/others/inspect-debug.png","hash":"614316843e6e4abc8ae532445e2dde48abec46cc","modified":1473344738000},{"_id":"source/images/others/20141226-1.jpg","hash":"3e31edd15067c3bec80eae7adf71a42fd38c0ec4","modified":1472374330000},{"_id":"source/images/windows/win10.png","hash":"9a87831d9d7eb6e9d5436281c6dcb9fb869fb15d","modified":1553608024920},{"_id":"source/images/ghost/ghost-tag.png","hash":"1a9a7f7655107ca1154d9111a523465c9df52315","modified":1472374330000},{"_id":"source/images/vps/bandwagonhost.png","hash":"ab1e064c9b6fd8a84774f636a96b602afd1f97cd","modified":1472374330000}],"Category":[],"Data":[],"Page":[{"title":"About","layout":"page","_content":"\n","source":"about/index.md","raw":"title: \"About\"\nlayout: \"page\"\n---\n\n","date":"2017-07-10T14:33:04.000Z","updated":"2017-07-10T14:33:04.000Z","path":"about/index.html","comments":1,"_id":"ck6xuowzp0001tof9vjwqv3ks","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Categories","layout":"categories","_content":"","source":"categories/index.md","raw":"title: \"Categories\"\nlayout: \"categories\"\n---\n","date":"2017-07-10T14:33:04.000Z","updated":"2017-07-10T14:33:04.000Z","path":"categories/index.html","comments":1,"_id":"ck6xuowzs0003tof9ylo1ph6z","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Tags","layout":"tags","_content":"","source":"tags/index.md","raw":"title: \"Tags\"\nlayout: \"tags\"\n---\n","date":"2017-07-10T14:33:04.000Z","updated":"2017-07-10T14:33:04.000Z","path":"tags/index.html","comments":1,"_id":"ck6xuowzt0005tof9t2fd5s2t","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"layout":"false","_content":"1、如何使用自动化构建工具的都做了什么内容，代码校验与单元测试，jshint配置了哪些。\n2、http相关知识get post有什么区别，https 如何加密解密、fillder如何抓取 https的包的。\n3、vue 与 angular 的区别，vue 如何做数据渲染处理的，如何实现声明周期。\n4、js基础 闭包 作用域 原型链 数组都有哪些方法。\n5、有个对象 object 为下面样式，object 的节点可能无线延伸\n   {\n\ta:b,\n\tb:{\n\t\ta:a,\n\t\tb:b\n\t},\n\tc:c\n   }\n   将该对象输出成下面的字符串：\n   \"\n   {\n\ta:a,\n\tb.a:a,\n        b.b:b,\n        c:c\n   }\n   \"\n6、babel 在使用是有什么问题，都有哪些坑。\n7、使用sftp 自动上传服务器，实现自动发布，如果网络断了怎么办，如何来处理。\n8、说一下你是怎么设计负责的订单模块的。\n\n1、在浏览器中打开一个网站都会发生什么事情，说的越详细越好，两台计算机之间是如何通信的。\n2、http代码代表什么意思，302 301 304 等等。\n3、js跨域都有哪些方案并说出优缺点。\n4、vue 的component组建是如何使用的与父级之间怎么传递参数。\n5、grunt gulp fis webpack 有什么区别，分别适用场景。\n6、cmd与amd规范中的 export 与 es6的 export 有什么区别。\n7、一个数组求第N大。\n8、promise 写出一个红绿灯的题。\n9、订单模块如何来设计说一下设计思路。\n10、cookie与loaclstorage、sessionstorage有什么区别。\n11、js引擎编译工作方式。\n","source":"_drafts/interview.md","raw":"---\nlayout: false\n---\n1、如何使用自动化构建工具的都做了什么内容，代码校验与单元测试，jshint配置了哪些。\n2、http相关知识get post有什么区别，https 如何加密解密、fillder如何抓取 https的包的。\n3、vue 与 angular 的区别，vue 如何做数据渲染处理的，如何实现声明周期。\n4、js基础 闭包 作用域 原型链 数组都有哪些方法。\n5、有个对象 object 为下面样式，object 的节点可能无线延伸\n   {\n\ta:b,\n\tb:{\n\t\ta:a,\n\t\tb:b\n\t},\n\tc:c\n   }\n   将该对象输出成下面的字符串：\n   \"\n   {\n\ta:a,\n\tb.a:a,\n        b.b:b,\n        c:c\n   }\n   \"\n6、babel 在使用是有什么问题，都有哪些坑。\n7、使用sftp 自动上传服务器，实现自动发布，如果网络断了怎么办，如何来处理。\n8、说一下你是怎么设计负责的订单模块的。\n\n1、在浏览器中打开一个网站都会发生什么事情，说的越详细越好，两台计算机之间是如何通信的。\n2、http代码代表什么意思，302 301 304 等等。\n3、js跨域都有哪些方案并说出优缺点。\n4、vue 的component组建是如何使用的与父级之间怎么传递参数。\n5、grunt gulp fis webpack 有什么区别，分别适用场景。\n6、cmd与amd规范中的 export 与 es6的 export 有什么区别。\n7、一个数组求第N大。\n8、promise 写出一个红绿灯的题。\n9、订单模块如何来设计说一下设计思路。\n10、cookie与loaclstorage、sessionstorage有什么区别。\n11、js引擎编译工作方式。\n","slug":"interview","published":0,"date":"2016-09-08T14:26:08.000Z","updated":"2016-09-08T14:26:08.000Z","title":"","comments":1,"photos":[],"link":"","_id":"ck6xuowzd0000tof9gytw6yr7","content":"<p>1、如何使用自动化构建工具的都做了什么内容，代码校验与单元测试，jshint配置了哪些。<br>\n2、http相关知识get post有什么区别，https 如何加密解密、fillder如何抓取 https的包的。<br>\n3、vue 与 angular 的区别，vue 如何做数据渲染处理的，如何实现声明周期。<br>\n4、js基础 闭包 作用域 原型链 数组都有哪些方法。<br>\n5、有个对象 object 为下面样式，object 的节点可能无线延伸<br>\n{<br>\na:b,<br>\nb:{<br>\na:a,<br>\nb:b<br>\n},<br>\nc:c<br>\n}<br>\n将该对象输出成下面的字符串：<br>\n&quot;<br>\n{<br>\na:a,<br>\nb.a:a,<br>\nb.b:b,<br>\nc:c<br>\n}<br>\n&quot;<br>\n6、babel 在使用是有什么问题，都有哪些坑。<br>\n7、使用sftp 自动上传服务器，实现自动发布，如果网络断了怎么办，如何来处理。<br>\n8、说一下你是怎么设计负责的订单模块的。</p>\n<p>1、在浏览器中打开一个网站都会发生什么事情，说的越详细越好，两台计算机之间是如何通信的。<br>\n2、http代码代表什么意思，302 301 304 等等。<br>\n3、js跨域都有哪些方案并说出优缺点。<br>\n4、vue 的component组建是如何使用的与父级之间怎么传递参数。<br>\n5、grunt gulp fis webpack 有什么区别，分别适用场景。<br>\n6、cmd与amd规范中的 export 与 es6的 export 有什么区别。<br>\n7、一个数组求第N大。<br>\n8、promise 写出一个红绿灯的题。<br>\n9、订单模块如何来设计说一下设计思路。<br>\n10、cookie与loaclstorage、sessionstorage有什么区别。<br>\n11、js引擎编译工作方式。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>1、如何使用自动化构建工具的都做了什么内容，代码校验与单元测试，jshint配置了哪些。<br>\n2、http相关知识get post有什么区别，https 如何加密解密、fillder如何抓取 https的包的。<br>\n3、vue 与 angular 的区别，vue 如何做数据渲染处理的，如何实现声明周期。<br>\n4、js基础 闭包 作用域 原型链 数组都有哪些方法。<br>\n5、有个对象 object 为下面样式，object 的节点可能无线延伸<br>\n{<br>\na:b,<br>\nb:{<br>\na:a,<br>\nb:b<br>\n},<br>\nc:c<br>\n}<br>\n将该对象输出成下面的字符串：<br>\n&quot;<br>\n{<br>\na:a,<br>\nb.a:a,<br>\nb.b:b,<br>\nc:c<br>\n}<br>\n&quot;<br>\n6、babel 在使用是有什么问题，都有哪些坑。<br>\n7、使用sftp 自动上传服务器，实现自动发布，如果网络断了怎么办，如何来处理。<br>\n8、说一下你是怎么设计负责的订单模块的。</p>\n<p>1、在浏览器中打开一个网站都会发生什么事情，说的越详细越好，两台计算机之间是如何通信的。<br>\n2、http代码代表什么意思，302 301 304 等等。<br>\n3、js跨域都有哪些方案并说出优缺点。<br>\n4、vue 的component组建是如何使用的与父级之间怎么传递参数。<br>\n5、grunt gulp fis webpack 有什么区别，分别适用场景。<br>\n6、cmd与amd规范中的 export 与 es6的 export 有什么区别。<br>\n7、一个数组求第N大。<br>\n8、promise 写出一个红绿灯的题。<br>\n9、订单模块如何来设计说一下设计思路。<br>\n10、cookie与loaclstorage、sessionstorage有什么区别。<br>\n11、js引擎编译工作方式。</p>\n"},{"title":"Atom前端开发配置","s":"atom-frontend-plugins","date":"2016-05-22T10:05:18.000Z","thumbnail":"/images/others/atom.png","_content":"## Atom开发插件集合\n*2017-03-21更新，去除不常用的插件*\n*2017-08-31更新，添加highlight-selected插件*\n```bash\napm list\nCommunity Packages (28) /Users/erguotou/.atom/packages\n├── Stylus@3.1.0\n├── atom-beautify@0.29.17\n├── atom-material-ui@1.3.9\n├── autoclose-html@0.23.0\n├── busy-signal@1.3.0\n├── docblockr@0.9.3\n├── editorconfig@2.2.2\n├── emmet@2.4.3\n├── file-icons@2.0.17\n├── highlight-selected@0.13.1\n├── intentions@1.1.2\n├── language-gitignore@0.3.0\n├── language-vue@0.21.2\n├── linter@2.1.0\n├── linter-eslint@8.1.4\n├── linter-htmlhint@1.3.2\n├── linter-ui-default@1.2.1\n├── local-history@4.0.1\n├── minimap@4.26.8\n├── minimap-highlight-selected@4.5.0\n└── pigments@0.39.1\n\n└── (empty)\n```\n<!-- more -->\n\n```bash\napm install Stylus atom-beautify atom-material-ui autoclose-html busy-signal docblockr editorconfig emmet file-icons highlight-selected intentions language-gitignore language-vue linter linter-ui-default linter-eslint linter-htmlhint local-history minimap minimap-highlight-selected pigments\n```\n\n## UI配置\n安装的是`atom-material-ui`主题，在mac上很多地方行高很高，需要修改其配置文件\n","source":"_posts/atom-frontend-plugins.md","raw":"---\ntitle: Atom前端开发配置\ns: atom-frontend-plugins\ndate: 2016-05-22 18:05:18\nthumbnail: /images/others/atom.png\ntags:\n  - Atom\n  - Atom-plugin\n---\n## Atom开发插件集合\n*2017-03-21更新，去除不常用的插件*\n*2017-08-31更新，添加highlight-selected插件*\n```bash\napm list\nCommunity Packages (28) /Users/erguotou/.atom/packages\n├── Stylus@3.1.0\n├── atom-beautify@0.29.17\n├── atom-material-ui@1.3.9\n├── autoclose-html@0.23.0\n├── busy-signal@1.3.0\n├── docblockr@0.9.3\n├── editorconfig@2.2.2\n├── emmet@2.4.3\n├── file-icons@2.0.17\n├── highlight-selected@0.13.1\n├── intentions@1.1.2\n├── language-gitignore@0.3.0\n├── language-vue@0.21.2\n├── linter@2.1.0\n├── linter-eslint@8.1.4\n├── linter-htmlhint@1.3.2\n├── linter-ui-default@1.2.1\n├── local-history@4.0.1\n├── minimap@4.26.8\n├── minimap-highlight-selected@4.5.0\n└── pigments@0.39.1\n\n└── (empty)\n```\n<!-- more -->\n\n```bash\napm install Stylus atom-beautify atom-material-ui autoclose-html busy-signal docblockr editorconfig emmet file-icons highlight-selected intentions language-gitignore language-vue linter linter-ui-default linter-eslint linter-htmlhint local-history minimap minimap-highlight-selected pigments\n```\n\n## UI配置\n安装的是`atom-material-ui`主题，在mac上很多地方行高很高，需要修改其配置文件\n","slug":"atom-frontend-plugins","published":1,"updated":"2019-03-26T13:47:04.870Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuowzq0002tof9wuorbmgc","content":"<h2 id=\"Atom开发插件集合\"><a class=\"header-anchor\" href=\"#Atom开发插件集合\">¶</a>Atom开发插件集合</h2>\n<p><em>2017-03-21更新，去除不常用的插件</em><br>\n<em>2017-08-31更新，添加highlight-selected插件</em></p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apm list</span><br><span class=\"line\">Community Packages (28) /Users/erguotou/.atom/packages</span><br><span class=\"line\">├── Stylus@3.1.0</span><br><span class=\"line\">├── atom-beautify@0.29.17</span><br><span class=\"line\">├── atom-material-ui@1.3.9</span><br><span class=\"line\">├── autoclose-html@0.23.0</span><br><span class=\"line\">├── busy-signal@1.3.0</span><br><span class=\"line\">├── docblockr@0.9.3</span><br><span class=\"line\">├── editorconfig@2.2.2</span><br><span class=\"line\">├── emmet@2.4.3</span><br><span class=\"line\">├── file-icons@2.0.17</span><br><span class=\"line\">├── highlight-selected@0.13.1</span><br><span class=\"line\">├── intentions@1.1.2</span><br><span class=\"line\">├── language-gitignore@0.3.0</span><br><span class=\"line\">├── language-vue@0.21.2</span><br><span class=\"line\">├── linter@2.1.0</span><br><span class=\"line\">├── linter-eslint@8.1.4</span><br><span class=\"line\">├── linter-htmlhint@1.3.2</span><br><span class=\"line\">├── linter-ui-default@1.2.1</span><br><span class=\"line\">├── <span class=\"hljs-built_in\">local</span>-history@4.0.1</span><br><span class=\"line\">├── minimap@4.26.8</span><br><span class=\"line\">├── minimap-highlight-selected@4.5.0</span><br><span class=\"line\">└── pigments@0.39.1</span><br><span class=\"line\"></span><br><span class=\"line\">└── (empty)</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apm install Stylus atom-beautify atom-material-ui autoclose-html busy-signal docblockr editorconfig emmet file-icons highlight-selected intentions language-gitignore language-vue linter linter-ui-default linter-eslint linter-htmlhint <span class=\"hljs-built_in\">local</span>-history minimap minimap-highlight-selected pigments</span><br></pre></td></tr></table></figure>\n<h2 id=\"UI配置\"><a class=\"header-anchor\" href=\"#UI配置\">¶</a>UI配置</h2>\n<p>安装的是<code>atom-material-ui</code>主题，在mac上很多地方行高很高，需要修改其配置文件</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Atom开发插件集合\"><a class=\"header-anchor\" href=\"#Atom开发插件集合\">¶</a>Atom开发插件集合</h2>\n<p><em>2017-03-21更新，去除不常用的插件</em><br>\n<em>2017-08-31更新，添加highlight-selected插件</em></p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apm list</span><br><span class=\"line\">Community Packages (28) /Users/erguotou/.atom/packages</span><br><span class=\"line\">├── Stylus@3.1.0</span><br><span class=\"line\">├── atom-beautify@0.29.17</span><br><span class=\"line\">├── atom-material-ui@1.3.9</span><br><span class=\"line\">├── autoclose-html@0.23.0</span><br><span class=\"line\">├── busy-signal@1.3.0</span><br><span class=\"line\">├── docblockr@0.9.3</span><br><span class=\"line\">├── editorconfig@2.2.2</span><br><span class=\"line\">├── emmet@2.4.3</span><br><span class=\"line\">├── file-icons@2.0.17</span><br><span class=\"line\">├── highlight-selected@0.13.1</span><br><span class=\"line\">├── intentions@1.1.2</span><br><span class=\"line\">├── language-gitignore@0.3.0</span><br><span class=\"line\">├── language-vue@0.21.2</span><br><span class=\"line\">├── linter@2.1.0</span><br><span class=\"line\">├── linter-eslint@8.1.4</span><br><span class=\"line\">├── linter-htmlhint@1.3.2</span><br><span class=\"line\">├── linter-ui-default@1.2.1</span><br><span class=\"line\">├── <span class=\"hljs-built_in\">local</span>-history@4.0.1</span><br><span class=\"line\">├── minimap@4.26.8</span><br><span class=\"line\">├── minimap-highlight-selected@4.5.0</span><br><span class=\"line\">└── pigments@0.39.1</span><br><span class=\"line\"></span><br><span class=\"line\">└── (empty)</span><br></pre></td></tr></table></figure>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apm install Stylus atom-beautify atom-material-ui autoclose-html busy-signal docblockr editorconfig emmet file-icons highlight-selected intentions language-gitignore language-vue linter linter-ui-default linter-eslint linter-htmlhint <span class=\"built_in\">local</span>-history minimap minimap-highlight-selected pigments</span><br></pre></td></tr></table></figure>\n<h2 id=\"UI配置\"><a class=\"header-anchor\" href=\"#UI配置\">¶</a>UI配置</h2>\n<p>安装的是<code>atom-material-ui</code>主题，在mac上很多地方行高很高，需要修改其配置文件</p>"},{"title":"在Ghost中使用附件","s":"attachment-in-ghost","date":"2015-07-20T15:30:00.000Z","_content":"有不少人问过ghost能不能上传附件的问题，当然大家可能都知道Ghost可以上传图片，使用`![]()`可以插入一个图片。然后有人就尝试在选择图片时上传一个普通文件，可惜这样系统会报错。\n  ![Ghost image format error](/images/ghost/ghost-image-format-error.png)\n　　这是因为ghost后台做了限制，当然，你可以改代码去掉这个限制，不过上传后的图片在image目录里，这与设计之初的本意不符。Ghost本就是一个极简的，专注于写作的博客系统，使用的是markdown来写作，因此也没有做上传附件这个功能。不过如果真的要在文章中使用附件怎么办呢？\n<!-- more -->\n　　其实很简单，附件也不过只是个网络资源，你只需要将资源的url引用下就可以了。一种是自己用apache建一个静态文件服务器，比如我这个<a href=\"http://media.erguotou.me/\" target=\"_blank\">我的简单媒体工具</a>。一种是使用云存储，然后获得文件的下载地址，比如使用<a href=\"http://www.qiniu.com/\" target=\"_blank\">七牛云存储</a>。\n　　这里以使用七牛为例，首先建一个静态目录的空间\n![Ghost image format error](/images/ghost/qiniu-new-block.png)，关于空间的设置不做介绍，点击“空间管理”再点击“上传”，建议添加一个前缀，完成附件的上传。![七牛上传](storage/blog_images/qiniu-upload.png)这时候在列表页面点击刚上传的文件，在右侧就可以获取到文件的外链。![Qiniu link](storage/blog_images/qiniu-link.png)\n　　通过上面2种方法得到了文件的外链后，只需要在博客中需要插入附件的地方插入`[your title](刚获取到的外链地址)`或者使用a标签`<a href=\"刚获取到的外链地址\" target=\"_blank\">链接显示的文字</a>`插入。a标签与markdown的语法相比，可以实现打开的页面是一个新的标签而不是覆盖当前的页面。最后，如果觉得默认的附件样式很丑，可以通过css来完善一下。下面附上我使用的附件。\n[自己服务器上的](http://media.erguotou.me/files/VID_20150705_180232.mp4)\n[七牛云存储的](http://7xkip3.dl1.z0.glb.clouddn.com/@/files/魔方原理及其应用.pdf)\n<style type=\"text/css\">\n.attachments {\n\tlist-style: none;\n\tpadding: 1em;\n\tbackground: #FFFE90;\n\tborder: 1px solid #E4E4E4;\n}\n.attachments li:before {\n    content: '';\n    display: inline-block;\n    width: 18px;\n    height: 18px;\n    background-size: 100% 100%;\n    margin-right: 8px;\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n}\n.attachments li a {\n\tfont-size:16px;\n    color:#666;\n}\n.attachments li a:hover{\n\tfont-size:16px;\n    color:#F60;\n}\n</style>\n<ul class=\"attachments\">\n\t<li><a href=\"https://nodejs.org/dist/v0.12.7/node-v0.12.7.pkg\" target=\"_blank\">Nodejs v0.12.7 Mac OS Universal</a></li>\n    <li><a href=\"http://download.jetbrains.com/webstorm/WebStorm-10.0.4.dmg\" target=\"_blank\">Webstorm 10.0.4 Mac OS</a></li>\n    <li><a href=\"http://d.bootcss.com/bootstrap-3.3.5-dist.zip\" target=\"_blank\">BoosStrap 3</a></li>\n</ul>\n","source":"_posts/attachment-in-ghost.md","raw":"---\ntitle: 在Ghost中使用附件\ns: attachment-in-ghost\ndate: 2015-07-20 23:30:00\ntags:\n  - Ghost\n---\n有不少人问过ghost能不能上传附件的问题，当然大家可能都知道Ghost可以上传图片，使用`![]()`可以插入一个图片。然后有人就尝试在选择图片时上传一个普通文件，可惜这样系统会报错。\n  ![Ghost image format error](/images/ghost/ghost-image-format-error.png)\n　　这是因为ghost后台做了限制，当然，你可以改代码去掉这个限制，不过上传后的图片在image目录里，这与设计之初的本意不符。Ghost本就是一个极简的，专注于写作的博客系统，使用的是markdown来写作，因此也没有做上传附件这个功能。不过如果真的要在文章中使用附件怎么办呢？\n<!-- more -->\n　　其实很简单，附件也不过只是个网络资源，你只需要将资源的url引用下就可以了。一种是自己用apache建一个静态文件服务器，比如我这个<a href=\"http://media.erguotou.me/\" target=\"_blank\">我的简单媒体工具</a>。一种是使用云存储，然后获得文件的下载地址，比如使用<a href=\"http://www.qiniu.com/\" target=\"_blank\">七牛云存储</a>。\n　　这里以使用七牛为例，首先建一个静态目录的空间\n![Ghost image format error](/images/ghost/qiniu-new-block.png)，关于空间的设置不做介绍，点击“空间管理”再点击“上传”，建议添加一个前缀，完成附件的上传。![七牛上传](storage/blog_images/qiniu-upload.png)这时候在列表页面点击刚上传的文件，在右侧就可以获取到文件的外链。![Qiniu link](storage/blog_images/qiniu-link.png)\n　　通过上面2种方法得到了文件的外链后，只需要在博客中需要插入附件的地方插入`[your title](刚获取到的外链地址)`或者使用a标签`<a href=\"刚获取到的外链地址\" target=\"_blank\">链接显示的文字</a>`插入。a标签与markdown的语法相比，可以实现打开的页面是一个新的标签而不是覆盖当前的页面。最后，如果觉得默认的附件样式很丑，可以通过css来完善一下。下面附上我使用的附件。\n[自己服务器上的](http://media.erguotou.me/files/VID_20150705_180232.mp4)\n[七牛云存储的](http://7xkip3.dl1.z0.glb.clouddn.com/@/files/魔方原理及其应用.pdf)\n<style type=\"text/css\">\n.attachments {\n\tlist-style: none;\n\tpadding: 1em;\n\tbackground: #FFFE90;\n\tborder: 1px solid #E4E4E4;\n}\n.attachments li:before {\n    content: '';\n    display: inline-block;\n    width: 18px;\n    height: 18px;\n    background-size: 100% 100%;\n    margin-right: 8px;\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n}\n.attachments li a {\n\tfont-size:16px;\n    color:#666;\n}\n.attachments li a:hover{\n\tfont-size:16px;\n    color:#F60;\n}\n</style>\n<ul class=\"attachments\">\n\t<li><a href=\"https://nodejs.org/dist/v0.12.7/node-v0.12.7.pkg\" target=\"_blank\">Nodejs v0.12.7 Mac OS Universal</a></li>\n    <li><a href=\"http://download.jetbrains.com/webstorm/WebStorm-10.0.4.dmg\" target=\"_blank\">Webstorm 10.0.4 Mac OS</a></li>\n    <li><a href=\"http://d.bootcss.com/bootstrap-3.3.5-dist.zip\" target=\"_blank\">BoosStrap 3</a></li>\n</ul>\n","slug":"attachment-in-ghost","published":1,"updated":"2019-03-26T13:47:04.870Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuowzt0004tof9jfuhebpy","content":"<p>有不少人问过ghost能不能上传附件的问题，当然大家可能都知道Ghost可以上传图片，使用<code>![]()</code>可以插入一个图片。然后有人就尝试在选择图片时上传一个普通文件，可惜这样系统会报错。<br>\n<img src=\"/images/ghost/ghost-image-format-error.png\" alt=\"Ghost image format error\"><br>\n　　这是因为ghost后台做了限制，当然，你可以改代码去掉这个限制，不过上传后的图片在image目录里，这与设计之初的本意不符。Ghost本就是一个极简的，专注于写作的博客系统，使用的是markdown来写作，因此也没有做上传附件这个功能。不过如果真的要在文章中使用附件怎么办呢？</p>\n<a id=\"more\"></a>\n<p>其实很简单，附件也不过只是个网络资源，你只需要将资源的url引用下就可以了。一种是自己用apache建一个静态文件服务器，比如我这个<a href=\"http://media.erguotou.me/\" target=\"_blank\">我的简单媒体工具</a>。一种是使用云存储，然后获得文件的下载地址，比如使用<a href=\"http://www.qiniu.com/\" target=\"_blank\">七牛云存储</a>。<br>\n　　这里以使用七牛为例，首先建一个静态目录的空间<br>\n<img src=\"/images/ghost/qiniu-new-block.png\" alt=\"Ghost image format error\">，关于空间的设置不做介绍，点击“空间管理”再点击“上传”，建议添加一个前缀，完成附件的上传。<img src=\"storage/blog_images/qiniu-upload.png\" alt=\"七牛上传\">这时候在列表页面点击刚上传的文件，在右侧就可以获取到文件的外链。<img src=\"storage/blog_images/qiniu-link.png\" alt=\"Qiniu link\"><br>\n　　通过上面2种方法得到了文件的外链后，只需要在博客中需要插入附件的地方插入<code>[your title](刚获取到的外链地址)</code>或者使用a标签<code>&lt;a href=&quot;刚获取到的外链地址&quot; target=&quot;_blank&quot;&gt;链接显示的文字&lt;/a&gt;</code>插入。a标签与markdown的语法相比，可以实现打开的页面是一个新的标签而不是覆盖当前的页面。最后，如果觉得默认的附件样式很丑，可以通过css来完善一下。下面附上我使用的附件。<br>\n<a href=\"http://media.erguotou.me/files/VID_20150705_180232.mp4\">自己服务器上的</a><br>\n<a href=\"http://7xkip3.dl1.z0.glb.clouddn.com/@/files/%E9%AD%94%E6%96%B9%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8.pdf\">七牛云存储的</a></p>\n<style type=\"text/css\">\n.attachments {\n\tlist-style: none;\n\tpadding: 1em;\n\tbackground: #FFFE90;\n\tborder: 1px solid #E4E4E4;\n}\n.attachments li:before {\n    content: '';\n    display: inline-block;\n    width: 18px;\n    height: 18px;\n    background-size: 100% 100%;\n    margin-right: 8px;\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n}\n.attachments li a {\n\tfont-size:16px;\n    color:#666;\n}\n.attachments li a:hover{\n\tfont-size:16px;\n    color:#F60;\n}\n</style>\n<ul class=\"attachments\">\n\t<li><a href=\"https://nodejs.org/dist/v0.12.7/node-v0.12.7.pkg\" target=\"_blank\">Nodejs v0.12.7 Mac OS Universal</a></li>\n    <li><a href=\"http://download.jetbrains.com/webstorm/WebStorm-10.0.4.dmg\" target=\"_blank\">Webstorm 10.0.4 Mac OS</a></li>\n    <li><a href=\"http://d.bootcss.com/bootstrap-3.3.5-dist.zip\" target=\"_blank\">BoosStrap 3</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>有不少人问过ghost能不能上传附件的问题，当然大家可能都知道Ghost可以上传图片，使用<code>![]()</code>可以插入一个图片。然后有人就尝试在选择图片时上传一个普通文件，可惜这样系统会报错。<br>\n<img src=\"/images/ghost/ghost-image-format-error.png\" alt=\"Ghost image format error\"><br>\n　　这是因为ghost后台做了限制，当然，你可以改代码去掉这个限制，不过上传后的图片在image目录里，这与设计之初的本意不符。Ghost本就是一个极简的，专注于写作的博客系统，使用的是markdown来写作，因此也没有做上传附件这个功能。不过如果真的要在文章中使用附件怎么办呢？</p>","more":"<p>其实很简单，附件也不过只是个网络资源，你只需要将资源的url引用下就可以了。一种是自己用apache建一个静态文件服务器，比如我这个<a href=\"http://media.erguotou.me/\" target=\"_blank\">我的简单媒体工具</a>。一种是使用云存储，然后获得文件的下载地址，比如使用<a href=\"http://www.qiniu.com/\" target=\"_blank\">七牛云存储</a>。<br>\n　　这里以使用七牛为例，首先建一个静态目录的空间<br>\n<img src=\"/images/ghost/qiniu-new-block.png\" alt=\"Ghost image format error\">，关于空间的设置不做介绍，点击“空间管理”再点击“上传”，建议添加一个前缀，完成附件的上传。<img src=\"storage/blog_images/qiniu-upload.png\" alt=\"七牛上传\">这时候在列表页面点击刚上传的文件，在右侧就可以获取到文件的外链。<img src=\"storage/blog_images/qiniu-link.png\" alt=\"Qiniu link\"><br>\n　　通过上面2种方法得到了文件的外链后，只需要在博客中需要插入附件的地方插入<code>[your title](刚获取到的外链地址)</code>或者使用a标签<code>&lt;a href=&quot;刚获取到的外链地址&quot; target=&quot;_blank&quot;&gt;链接显示的文字&lt;/a&gt;</code>插入。a标签与markdown的语法相比，可以实现打开的页面是一个新的标签而不是覆盖当前的页面。最后，如果觉得默认的附件样式很丑，可以通过css来完善一下。下面附上我使用的附件。<br>\n<a href=\"http://media.erguotou.me/files/VID_20150705_180232.mp4\">自己服务器上的</a><br>\n<a href=\"http://7xkip3.dl1.z0.glb.clouddn.com/@/files/%E9%AD%94%E6%96%B9%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8.pdf\">七牛云存储的</a></p>\n<style type=\"text/css\">\n.attachments {\n\tlist-style: none;\n\tpadding: 1em;\n\tbackground: #FFFE90;\n\tborder: 1px solid #E4E4E4;\n}\n.attachments li:before {\n    content: '';\n    display: inline-block;\n    width: 18px;\n    height: 18px;\n    background-size: 100% 100%;\n    margin-right: 8px;\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n}\n.attachments li a {\n\tfont-size:16px;\n    color:#666;\n}\n.attachments li a:hover{\n\tfont-size:16px;\n    color:#F60;\n}\n</style>\n<ul class=\"attachments\">\n\t<li><a href=\"https://nodejs.org/dist/v0.12.7/node-v0.12.7.pkg\" target=\"_blank\">Nodejs v0.12.7 Mac OS Universal</a></li>\n    <li><a href=\"http://download.jetbrains.com/webstorm/WebStorm-10.0.4.dmg\" target=\"_blank\">Webstorm 10.0.4 Mac OS</a></li>\n    <li><a href=\"http://d.bootcss.com/bootstrap-3.3.5-dist.zip\" target=\"_blank\">BoosStrap 3</a></li>\n</ul>"},{"title":"黑苹果安装记录","s":"black-mac-os","date":"2019-05-14T15:10:00.000Z","thumbnail":"/images/others/mac-install.jpg","_content":"因工作原因换台电脑，作为开发人员，肯定是优先Mac的，其次是Linux系，但Linux系系统在软件工具生态上还有些不足，而Mac无疑是最佳选择。虽然黑苹果可能会遇到一些意外事故，但是也挡不住我对它的喜爱，哈哈。\n\n以下介绍基本都是参照[https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast](https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast)得来，有能力的还是去`tonymacx86`好好研究一番。\n<!-- more -->\n\n## 安装前准备\n\n### 硬件准备\n\n黑苹果安装中最大的问题就是驱动问题，所以最好是安装[tonymacx86](https://www.tonymacx86.com/buyersguide/building-a-customac-hackintosh-the-ultimate-buyers-guide/)上推荐的配置去购买，但是我的机器已经是准备好的了，就跳过这一步，但是要通过搜索确认下自己的硬件安装黑苹果没有太大问题。我的主要配置如下：\n- Intel I5 8400\n- MSI B310M\n- 集成显卡 Intel UHD 630\n\n另外你最好有一台白苹果，没有的话用Windows应该也可以，不过我更倾向于白苹果制作引导盘的方式。\n\n除此意外你还需要准备一个8G以上（最好16G）的U盘用来做安装盘。\n\n### 软件准备\n\n首先你需要注册一个[tonymacx86](https://www.tonymacx86.com/)的账号，因为我们需要的工具以及教程基本上都是在这里找到的。\n\n然后在下载Mac的系统安装文件，根据自己情况选择不同的方案。这里以`macOS High Sierra 10.13.6`版本为例（最新的Mojave版本感觉有不少问题，我的白苹果一直都没有升级），白苹果前往[https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&mt=12](https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&mt=12)下载。Windows系统可以通过下载集成`clover`的系统镜像配合`TransMac`工具制作启动盘进行安装，因为这个方式没有做过测试，所以不做过多介绍，各位可以自行搜索尝试，成功之后的操作应该都是一样的。\n\n另外还需要在`tonymacx86`下载好`MultiBeast`和`UniBeast`工具，注意配合自己下载的系统版本。\n\n这里需要将白苹果的系统语言改为英语，这是`UniBeast`的强制性要求，改完后重启。\n## 安装流程\n\n1. 制作启动盘。插上U盘，在白苹果的磁盘工具中擦除U盘，格式选择Mac扩展（日志）。然后打开`UniBeast`按照流程进行启动盘制作，这里引导方式选择`UEFI`模式（一般新的电脑都是支持的）。制作完成后将`MultiBeast`应用拖到U盘中以备后用。\n2. 修改主板设置。让要安装黑苹果的电脑重启进入BIOS，关闭CPU的`VT-D`功能，关闭`CFG-Lock`，关闭主板的安全启动模式（Secure Boot Mode），关闭IO串口(IO Serial Port)，打开`XHCI`，硬盘调整为`AHCI`模式（一般新电脑都改成这种模式）。以上说的这些都是有则改之，无则跳过。然后修改U盘为第一启动盘，保存重启就可以进入`Clover`启动界面了。\n3. 准备安装。在`Clover`界面选择安装macOS系统，然后就等待安装吧，安装过程中可能会多次重启，重启后在`Clover`界面选择`High Sierra`来进行下一步安装。如果过程中出现什么错误（我就出现了叉号禁止符，并在之后一直无法进行下一步安装），那么在`Clover`界面选择启动参数设置（下面第2个还是第3个的）并追加` -v`参数并重新进行之前操作，这样就可以将日志打印出来，找到你出错的那一行的关键信息进行搜索并找到解决方案。我出现的问题是通过在启动参数后追加`-f UseKernelCache=No`来解决了，有时可能还需要不断的重启或者更改U盘插的USB位置来修复，也是奇葩。\n![](/images/others/clover-mac.png)\n\n4. 系统安装。第一次安装时需要将整个盘都擦除，同样是macOS扩展（日志）格式，安装完成后就是一些系统的初始化配置了，之后就进入我们的黑苹果系统了。\n\n## 后续操作\n1. 使用`MultiBeast`安装各种驱动。将`MultiBeast`从U盘拖到应用程序中并启动，按照自己电脑硬件选择合适的驱动文件（鬼知道我应该勾选哪些驱动，除了个别是明确的，其它驱动都是看着最像或者凭感觉选的）并完成安装，之后重启电脑，这是基本上就可以拔掉U盘（这个启动盘后期还可以作为我们系统的修复引导工具）。\n2. 配置基本环境并安装工具。作为开发，我们还是要给我们的电脑安装些基础和必备的东西\n  - Homebrew 这个在安装时可能很慢，所以需要提前找好梯子\n    ```sh\n    /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n    ```\n  - nvm NodeJs版本管理\n    ```sh\n    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash\n    ```\n  - Git\n    ```sh\n    brew install git\n    ```\n  - Xcode 一些命令行工具需要\n  - Docker VSCode iTerm2 Alfred等\n\n## 总结\n安装黑苹果不难，但需要新手花点时间学习研究，遇到问题通过日志搜索，多逛逛`tonymacx86`。\n","source":"_posts/black-mac-os.md","raw":"---\ntitle: 黑苹果安装记录\ns: black-mac-os\ndate: 2019-05-14 23:10:00\nthumbnail: /images/others/mac-install.jpg\ntags:\n  - os\n  - mac\n---\n因工作原因换台电脑，作为开发人员，肯定是优先Mac的，其次是Linux系，但Linux系系统在软件工具生态上还有些不足，而Mac无疑是最佳选择。虽然黑苹果可能会遇到一些意外事故，但是也挡不住我对它的喜爱，哈哈。\n\n以下介绍基本都是参照[https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast](https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast)得来，有能力的还是去`tonymacx86`好好研究一番。\n<!-- more -->\n\n## 安装前准备\n\n### 硬件准备\n\n黑苹果安装中最大的问题就是驱动问题，所以最好是安装[tonymacx86](https://www.tonymacx86.com/buyersguide/building-a-customac-hackintosh-the-ultimate-buyers-guide/)上推荐的配置去购买，但是我的机器已经是准备好的了，就跳过这一步，但是要通过搜索确认下自己的硬件安装黑苹果没有太大问题。我的主要配置如下：\n- Intel I5 8400\n- MSI B310M\n- 集成显卡 Intel UHD 630\n\n另外你最好有一台白苹果，没有的话用Windows应该也可以，不过我更倾向于白苹果制作引导盘的方式。\n\n除此意外你还需要准备一个8G以上（最好16G）的U盘用来做安装盘。\n\n### 软件准备\n\n首先你需要注册一个[tonymacx86](https://www.tonymacx86.com/)的账号，因为我们需要的工具以及教程基本上都是在这里找到的。\n\n然后在下载Mac的系统安装文件，根据自己情况选择不同的方案。这里以`macOS High Sierra 10.13.6`版本为例（最新的Mojave版本感觉有不少问题，我的白苹果一直都没有升级），白苹果前往[https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&mt=12](https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&mt=12)下载。Windows系统可以通过下载集成`clover`的系统镜像配合`TransMac`工具制作启动盘进行安装，因为这个方式没有做过测试，所以不做过多介绍，各位可以自行搜索尝试，成功之后的操作应该都是一样的。\n\n另外还需要在`tonymacx86`下载好`MultiBeast`和`UniBeast`工具，注意配合自己下载的系统版本。\n\n这里需要将白苹果的系统语言改为英语，这是`UniBeast`的强制性要求，改完后重启。\n## 安装流程\n\n1. 制作启动盘。插上U盘，在白苹果的磁盘工具中擦除U盘，格式选择Mac扩展（日志）。然后打开`UniBeast`按照流程进行启动盘制作，这里引导方式选择`UEFI`模式（一般新的电脑都是支持的）。制作完成后将`MultiBeast`应用拖到U盘中以备后用。\n2. 修改主板设置。让要安装黑苹果的电脑重启进入BIOS，关闭CPU的`VT-D`功能，关闭`CFG-Lock`，关闭主板的安全启动模式（Secure Boot Mode），关闭IO串口(IO Serial Port)，打开`XHCI`，硬盘调整为`AHCI`模式（一般新电脑都改成这种模式）。以上说的这些都是有则改之，无则跳过。然后修改U盘为第一启动盘，保存重启就可以进入`Clover`启动界面了。\n3. 准备安装。在`Clover`界面选择安装macOS系统，然后就等待安装吧，安装过程中可能会多次重启，重启后在`Clover`界面选择`High Sierra`来进行下一步安装。如果过程中出现什么错误（我就出现了叉号禁止符，并在之后一直无法进行下一步安装），那么在`Clover`界面选择启动参数设置（下面第2个还是第3个的）并追加` -v`参数并重新进行之前操作，这样就可以将日志打印出来，找到你出错的那一行的关键信息进行搜索并找到解决方案。我出现的问题是通过在启动参数后追加`-f UseKernelCache=No`来解决了，有时可能还需要不断的重启或者更改U盘插的USB位置来修复，也是奇葩。\n![](/images/others/clover-mac.png)\n\n4. 系统安装。第一次安装时需要将整个盘都擦除，同样是macOS扩展（日志）格式，安装完成后就是一些系统的初始化配置了，之后就进入我们的黑苹果系统了。\n\n## 后续操作\n1. 使用`MultiBeast`安装各种驱动。将`MultiBeast`从U盘拖到应用程序中并启动，按照自己电脑硬件选择合适的驱动文件（鬼知道我应该勾选哪些驱动，除了个别是明确的，其它驱动都是看着最像或者凭感觉选的）并完成安装，之后重启电脑，这是基本上就可以拔掉U盘（这个启动盘后期还可以作为我们系统的修复引导工具）。\n2. 配置基本环境并安装工具。作为开发，我们还是要给我们的电脑安装些基础和必备的东西\n  - Homebrew 这个在安装时可能很慢，所以需要提前找好梯子\n    ```sh\n    /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n    ```\n  - nvm NodeJs版本管理\n    ```sh\n    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash\n    ```\n  - Git\n    ```sh\n    brew install git\n    ```\n  - Xcode 一些命令行工具需要\n  - Docker VSCode iTerm2 Alfred等\n\n## 总结\n安装黑苹果不难，但需要新手花点时间学习研究，遇到问题通过日志搜索，多逛逛`tonymacx86`。\n","slug":"black-mac-os","published":1,"updated":"2020-02-17T16:51:07.543Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuowzy0007tof95edg86gi","content":"<p>因工作原因换台电脑，作为开发人员，肯定是优先Mac的，其次是Linux系，但Linux系系统在软件工具生态上还有些不足，而Mac无疑是最佳选择。虽然黑苹果可能会遇到一些意外事故，但是也挡不住我对它的喜爱，哈哈。</p>\n<p>以下介绍基本都是参照<a href=\"https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast\">https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast</a>得来，有能力的还是去<code>tonymacx86</code>好好研究一番。</p>\n<a id=\"more\"></a>\n<h2 id=\"安装前准备\"><a class=\"header-anchor\" href=\"#安装前准备\">¶</a>安装前准备</h2>\n<h3 id=\"硬件准备\"><a class=\"header-anchor\" href=\"#硬件准备\">¶</a>硬件准备</h3>\n<p>黑苹果安装中最大的问题就是驱动问题，所以最好是安装<a href=\"https://www.tonymacx86.com/buyersguide/building-a-customac-hackintosh-the-ultimate-buyers-guide/\">tonymacx86</a>上推荐的配置去购买，但是我的机器已经是准备好的了，就跳过这一步，但是要通过搜索确认下自己的硬件安装黑苹果没有太大问题。我的主要配置如下：</p>\n<ul>\n<li>Intel I5 8400</li>\n<li>MSI B310M</li>\n<li>集成显卡 Intel UHD 630</li>\n</ul>\n<p>另外你最好有一台白苹果，没有的话用Windows应该也可以，不过我更倾向于白苹果制作引导盘的方式。</p>\n<p>除此意外你还需要准备一个8G以上（最好16G）的U盘用来做安装盘。</p>\n<h3 id=\"软件准备\"><a class=\"header-anchor\" href=\"#软件准备\">¶</a>软件准备</h3>\n<p>首先你需要注册一个<a href=\"https://www.tonymacx86.com/\">tonymacx86</a>的账号，因为我们需要的工具以及教程基本上都是在这里找到的。</p>\n<p>然后在下载Mac的系统安装文件，根据自己情况选择不同的方案。这里以<code>macOS High Sierra 10.13.6</code>版本为例（最新的Mojave版本感觉有不少问题，我的白苹果一直都没有升级），白苹果前往<a href=\"https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&amp;mt=12\">https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&amp;mt=12</a>下载。Windows系统可以通过下载集成<code>clover</code>的系统镜像配合<code>TransMac</code>工具制作启动盘进行安装，因为这个方式没有做过测试，所以不做过多介绍，各位可以自行搜索尝试，成功之后的操作应该都是一样的。</p>\n<p>另外还需要在<code>tonymacx86</code>下载好<code>MultiBeast</code>和<code>UniBeast</code>工具，注意配合自己下载的系统版本。</p>\n<p>这里需要将白苹果的系统语言改为英语，这是<code>UniBeast</code>的强制性要求，改完后重启。</p>\n<h2 id=\"安装流程\"><a class=\"header-anchor\" href=\"#安装流程\">¶</a>安装流程</h2>\n<ol>\n<li>\n<p>制作启动盘。插上U盘，在白苹果的磁盘工具中擦除U盘，格式选择Mac扩展（日志）。然后打开<code>UniBeast</code>按照流程进行启动盘制作，这里引导方式选择<code>UEFI</code>模式（一般新的电脑都是支持的）。制作完成后将<code>MultiBeast</code>应用拖到U盘中以备后用。</p>\n</li>\n<li>\n<p>修改主板设置。让要安装黑苹果的电脑重启进入BIOS，关闭CPU的<code>VT-D</code>功能，关闭<code>CFG-Lock</code>，关闭主板的安全启动模式（Secure Boot Mode），关闭IO串口(IO Serial Port)，打开<code>XHCI</code>，硬盘调整为<code>AHCI</code>模式（一般新电脑都改成这种模式）。以上说的这些都是有则改之，无则跳过。然后修改U盘为第一启动盘，保存重启就可以进入<code>Clover</code>启动界面了。</p>\n</li>\n<li>\n<p>准备安装。在<code>Clover</code>界面选择安装macOS系统，然后就等待安装吧，安装过程中可能会多次重启，重启后在<code>Clover</code>界面选择<code>High Sierra</code>来进行下一步安装。如果过程中出现什么错误（我就出现了叉号禁止符，并在之后一直无法进行下一步安装），那么在<code>Clover</code>界面选择启动参数设置（下面第2个还是第3个的）并追加<code> -v</code>参数并重新进行之前操作，这样就可以将日志打印出来，找到你出错的那一行的关键信息进行搜索并找到解决方案。我出现的问题是通过在启动参数后追加<code>-f UseKernelCache=No</code>来解决了，有时可能还需要不断的重启或者更改U盘插的USB位置来修复，也是奇葩。<br>\n<img src=\"/images/others/clover-mac.png\" alt></p>\n</li>\n<li>\n<p>系统安装。第一次安装时需要将整个盘都擦除，同样是macOS扩展（日志）格式，安装完成后就是一些系统的初始化配置了，之后就进入我们的黑苹果系统了。</p>\n</li>\n</ol>\n<h2 id=\"后续操作\"><a class=\"header-anchor\" href=\"#后续操作\">¶</a>后续操作</h2>\n<ol>\n<li>使用<code>MultiBeast</code>安装各种驱动。将<code>MultiBeast</code>从U盘拖到应用程序中并启动，按照自己电脑硬件选择合适的驱动文件（鬼知道我应该勾选哪些驱动，除了个别是明确的，其它驱动都是看着最像或者凭感觉选的）并完成安装，之后重启电脑，这是基本上就可以拔掉U盘（这个启动盘后期还可以作为我们系统的修复引导工具）。</li>\n<li>配置基本环境并安装工具。作为开发，我们还是要给我们的电脑安装些基础和必备的东西</li>\n</ol>\n<ul>\n<li>\n<p>Homebrew 这个在安装时可能很慢，所以需要提前找好梯子</p>\n<figure class=\"highlight sh hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/ruby -e <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>nvm NodeJs版本管理</p>\n<figure class=\"highlight sh hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Git</p>\n<figure class=\"highlight sh hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install git</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Xcode 一些命令行工具需要</p>\n</li>\n<li>\n<p>Docker VSCode iTerm2 Alfred等</p>\n</li>\n</ul>\n<h2 id=\"总结\"><a class=\"header-anchor\" href=\"#总结\">¶</a>总结</h2>\n<p>安装黑苹果不难，但需要新手花点时间学习研究，遇到问题通过日志搜索，多逛逛<code>tonymacx86</code>。</p>\n","site":{"data":{}},"excerpt":"<p>因工作原因换台电脑，作为开发人员，肯定是优先Mac的，其次是Linux系，但Linux系系统在软件工具生态上还有些不足，而Mac无疑是最佳选择。虽然黑苹果可能会遇到一些意外事故，但是也挡不住我对它的喜爱，哈哈。</p>\n<p>以下介绍基本都是参照<a href=\"https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast\">https://www.tonymacx86.com/threads/unibeast-install-macos-mojave-on-any-supported-intel-based-pc.259381/#create_unibeast</a>得来，有能力的还是去<code>tonymacx86</code>好好研究一番。</p>","more":"<h2 id=\"安装前准备\"><a class=\"header-anchor\" href=\"#安装前准备\">¶</a>安装前准备</h2>\n<h3 id=\"硬件准备\"><a class=\"header-anchor\" href=\"#硬件准备\">¶</a>硬件准备</h3>\n<p>黑苹果安装中最大的问题就是驱动问题，所以最好是安装<a href=\"https://www.tonymacx86.com/buyersguide/building-a-customac-hackintosh-the-ultimate-buyers-guide/\">tonymacx86</a>上推荐的配置去购买，但是我的机器已经是准备好的了，就跳过这一步，但是要通过搜索确认下自己的硬件安装黑苹果没有太大问题。我的主要配置如下：</p>\n<ul>\n<li>Intel I5 8400</li>\n<li>MSI B310M</li>\n<li>集成显卡 Intel UHD 630</li>\n</ul>\n<p>另外你最好有一台白苹果，没有的话用Windows应该也可以，不过我更倾向于白苹果制作引导盘的方式。</p>\n<p>除此意外你还需要准备一个8G以上（最好16G）的U盘用来做安装盘。</p>\n<h3 id=\"软件准备\"><a class=\"header-anchor\" href=\"#软件准备\">¶</a>软件准备</h3>\n<p>首先你需要注册一个<a href=\"https://www.tonymacx86.com/\">tonymacx86</a>的账号，因为我们需要的工具以及教程基本上都是在这里找到的。</p>\n<p>然后在下载Mac的系统安装文件，根据自己情况选择不同的方案。这里以<code>macOS High Sierra 10.13.6</code>版本为例（最新的Mojave版本感觉有不少问题，我的白苹果一直都没有升级），白苹果前往<a href=\"https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&amp;mt=12\">https://itunes.apple.com/cn/app/macos-high-sierra/id1246284741?ls=1&amp;mt=12</a>下载。Windows系统可以通过下载集成<code>clover</code>的系统镜像配合<code>TransMac</code>工具制作启动盘进行安装，因为这个方式没有做过测试，所以不做过多介绍，各位可以自行搜索尝试，成功之后的操作应该都是一样的。</p>\n<p>另外还需要在<code>tonymacx86</code>下载好<code>MultiBeast</code>和<code>UniBeast</code>工具，注意配合自己下载的系统版本。</p>\n<p>这里需要将白苹果的系统语言改为英语，这是<code>UniBeast</code>的强制性要求，改完后重启。</p>\n<h2 id=\"安装流程\"><a class=\"header-anchor\" href=\"#安装流程\">¶</a>安装流程</h2>\n<ol>\n<li>\n<p>制作启动盘。插上U盘，在白苹果的磁盘工具中擦除U盘，格式选择Mac扩展（日志）。然后打开<code>UniBeast</code>按照流程进行启动盘制作，这里引导方式选择<code>UEFI</code>模式（一般新的电脑都是支持的）。制作完成后将<code>MultiBeast</code>应用拖到U盘中以备后用。</p>\n</li>\n<li>\n<p>修改主板设置。让要安装黑苹果的电脑重启进入BIOS，关闭CPU的<code>VT-D</code>功能，关闭<code>CFG-Lock</code>，关闭主板的安全启动模式（Secure Boot Mode），关闭IO串口(IO Serial Port)，打开<code>XHCI</code>，硬盘调整为<code>AHCI</code>模式（一般新电脑都改成这种模式）。以上说的这些都是有则改之，无则跳过。然后修改U盘为第一启动盘，保存重启就可以进入<code>Clover</code>启动界面了。</p>\n</li>\n<li>\n<p>准备安装。在<code>Clover</code>界面选择安装macOS系统，然后就等待安装吧，安装过程中可能会多次重启，重启后在<code>Clover</code>界面选择<code>High Sierra</code>来进行下一步安装。如果过程中出现什么错误（我就出现了叉号禁止符，并在之后一直无法进行下一步安装），那么在<code>Clover</code>界面选择启动参数设置（下面第2个还是第3个的）并追加<code> -v</code>参数并重新进行之前操作，这样就可以将日志打印出来，找到你出错的那一行的关键信息进行搜索并找到解决方案。我出现的问题是通过在启动参数后追加<code>-f UseKernelCache=No</code>来解决了，有时可能还需要不断的重启或者更改U盘插的USB位置来修复，也是奇葩。<br>\n<img src=\"/images/others/clover-mac.png\" alt=\"\"></p>\n</li>\n<li>\n<p>系统安装。第一次安装时需要将整个盘都擦除，同样是macOS扩展（日志）格式，安装完成后就是一些系统的初始化配置了，之后就进入我们的黑苹果系统了。</p>\n</li>\n</ol>\n<h2 id=\"后续操作\"><a class=\"header-anchor\" href=\"#后续操作\">¶</a>后续操作</h2>\n<ol>\n<li>使用<code>MultiBeast</code>安装各种驱动。将<code>MultiBeast</code>从U盘拖到应用程序中并启动，按照自己电脑硬件选择合适的驱动文件（鬼知道我应该勾选哪些驱动，除了个别是明确的，其它驱动都是看着最像或者凭感觉选的）并完成安装，之后重启电脑，这是基本上就可以拔掉U盘（这个启动盘后期还可以作为我们系统的修复引导工具）。</li>\n<li>配置基本环境并安装工具。作为开发，我们还是要给我们的电脑安装些基础和必备的东西</li>\n</ol>\n<ul>\n<li>\n<p>Homebrew 这个在安装时可能很慢，所以需要提前找好梯子</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/ruby -e <span class=\"string\">\"<span class=\"variable\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>nvm NodeJs版本管理</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Git</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install git</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Xcode 一些命令行工具需要</p>\n</li>\n<li>\n<p>Docker VSCode iTerm2 Alfred等</p>\n</li>\n</ul>\n<h2 id=\"总结\"><a class=\"header-anchor\" href=\"#总结\">¶</a>总结</h2>\n<p>安装黑苹果不难，但需要新手花点时间学习研究，遇到问题通过日志搜索，多逛逛<code>tonymacx86</code>。</p>"},{"title":"在Ghost中使用分类","s":"category-in-ghost","date":"2015-07-21T15:25:00.000Z","_content":"有不少刚接触Ghost博客的朋友都会问：Ghost如何做分类？如何按分类来浏览博客？其实Ghost没有分类这个概念，不像其它的博客系统，在发表文章时要选择分类，Ghost只有标签(Tag)。而我们正是要利用这个标签来变相地实现分类浏览。\n　　首先说下Ghost添加标签的地方，还是有些人是不知道的。在如图位置输入标签，标签和标签之间以英文逗号隔开，会自动提示之前的标签：![Ghost tag](/images/ghost/ghost-tag.png)\n　　Ghost中的标签是没有限制的，给了我们很多自由，但如果要做分类，我们还是需要遵守一定规则为好，比如之前有篇文章有个标签`test`，那么你下一篇文章如果还要使用这个标签，在标签输入处输入`t`，Ghost会自动提示出之前的`test`分类，选择即可。这样我们就有2篇文章有相同的标签`test`了，这时候我们可以通过`http://your.blog.site/tag/test`来访问这个分类下的所有文章。\n　　OK，现在我们已经完成了一半了，还有个问题是如何在我们的首页中显示分类信息呢？这里有几种方法，我们一一介绍。\n<!-- more -->\n\n1. 第一种也是最简单最粗暴的方法，修改首页模板，在需要的位置添加一个到刚才的标签链接的a标签即可，该方法不做过多介绍，会网页基础的应该都会。\n2. 使用Ghost新的helper`navigation`，这个需要你现在后台的设置里面加入相应的标签的链接即可。如图![Ghost navigation](/images/ghost/ghost-navigation.png)之后在模板中使用`navigation`来显示导航，关于该helper的使用，可以参考[我翻译的文档](https://github.com/ghostchina/docs/blob/master/navigation.md)。我们的[GhostChina](http://www.ghostchina.com/)网站的导航就是使用了该方法，只不过它的导航链接都不是标签的，这里只是举例说明。\n3. 使用中文版中特有的标签`tag_cloud`，关于该标签的使用[请查看](http://www.ghostchina.com/output-tag-cloud/)。另外[GhostChina](http://www.ghostchina.com/)网站也使用了该标签云。![Ghost china](/images/ghost/ghost-china.png)\n\n这里简单地介绍了如何在Ghost中添加分类浏览，那么有人要问了，Ghost可以按日期来浏览文章么？其实Ghost可以在发表文章时选择在文章的链接上加上日期的，![Ghost title date](/images/ghost/ghost-title-date.png)但是要实现按日期浏览文章暂时是没有的，起码我没有看到过，不过这个可以通过添加标签的方式来实现，期待高手出现。\n","source":"_posts/category-in-ghost.md","raw":"---\ntitle: 在Ghost中使用分类\ns: category-in-ghost\ndate: 2015-07-21 23:25:00\ntags:\n  - Ghost\n---\n有不少刚接触Ghost博客的朋友都会问：Ghost如何做分类？如何按分类来浏览博客？其实Ghost没有分类这个概念，不像其它的博客系统，在发表文章时要选择分类，Ghost只有标签(Tag)。而我们正是要利用这个标签来变相地实现分类浏览。\n　　首先说下Ghost添加标签的地方，还是有些人是不知道的。在如图位置输入标签，标签和标签之间以英文逗号隔开，会自动提示之前的标签：![Ghost tag](/images/ghost/ghost-tag.png)\n　　Ghost中的标签是没有限制的，给了我们很多自由，但如果要做分类，我们还是需要遵守一定规则为好，比如之前有篇文章有个标签`test`，那么你下一篇文章如果还要使用这个标签，在标签输入处输入`t`，Ghost会自动提示出之前的`test`分类，选择即可。这样我们就有2篇文章有相同的标签`test`了，这时候我们可以通过`http://your.blog.site/tag/test`来访问这个分类下的所有文章。\n　　OK，现在我们已经完成了一半了，还有个问题是如何在我们的首页中显示分类信息呢？这里有几种方法，我们一一介绍。\n<!-- more -->\n\n1. 第一种也是最简单最粗暴的方法，修改首页模板，在需要的位置添加一个到刚才的标签链接的a标签即可，该方法不做过多介绍，会网页基础的应该都会。\n2. 使用Ghost新的helper`navigation`，这个需要你现在后台的设置里面加入相应的标签的链接即可。如图![Ghost navigation](/images/ghost/ghost-navigation.png)之后在模板中使用`navigation`来显示导航，关于该helper的使用，可以参考[我翻译的文档](https://github.com/ghostchina/docs/blob/master/navigation.md)。我们的[GhostChina](http://www.ghostchina.com/)网站的导航就是使用了该方法，只不过它的导航链接都不是标签的，这里只是举例说明。\n3. 使用中文版中特有的标签`tag_cloud`，关于该标签的使用[请查看](http://www.ghostchina.com/output-tag-cloud/)。另外[GhostChina](http://www.ghostchina.com/)网站也使用了该标签云。![Ghost china](/images/ghost/ghost-china.png)\n\n这里简单地介绍了如何在Ghost中添加分类浏览，那么有人要问了，Ghost可以按日期来浏览文章么？其实Ghost可以在发表文章时选择在文章的链接上加上日期的，![Ghost title date](/images/ghost/ghost-title-date.png)但是要实现按日期浏览文章暂时是没有的，起码我没有看到过，不过这个可以通过添加标签的方式来实现，期待高手出现。\n","slug":"category-in-ghost","published":1,"updated":"2019-03-26T13:47:04.871Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox000008tof9wvse6cx7","content":"<p>有不少刚接触Ghost博客的朋友都会问：Ghost如何做分类？如何按分类来浏览博客？其实Ghost没有分类这个概念，不像其它的博客系统，在发表文章时要选择分类，Ghost只有标签(Tag)。而我们正是要利用这个标签来变相地实现分类浏览。<br>\n　　首先说下Ghost添加标签的地方，还是有些人是不知道的。在如图位置输入标签，标签和标签之间以英文逗号隔开，会自动提示之前的标签：<img src=\"/images/ghost/ghost-tag.png\" alt=\"Ghost tag\"><br>\n　　Ghost中的标签是没有限制的，给了我们很多自由，但如果要做分类，我们还是需要遵守一定规则为好，比如之前有篇文章有个标签<code>test</code>，那么你下一篇文章如果还要使用这个标签，在标签输入处输入<code>t</code>，Ghost会自动提示出之前的<code>test</code>分类，选择即可。这样我们就有2篇文章有相同的标签<code>test</code>了，这时候我们可以通过<code>http://your.blog.site/tag/test</code>来访问这个分类下的所有文章。<br>\n　　OK，现在我们已经完成了一半了，还有个问题是如何在我们的首页中显示分类信息呢？这里有几种方法，我们一一介绍。</p>\n<a id=\"more\"></a>\n<ol>\n<li>第一种也是最简单最粗暴的方法，修改首页模板，在需要的位置添加一个到刚才的标签链接的a标签即可，该方法不做过多介绍，会网页基础的应该都会。</li>\n<li>使用Ghost新的helper<code>navigation</code>，这个需要你现在后台的设置里面加入相应的标签的链接即可。如图<img src=\"/images/ghost/ghost-navigation.png\" alt=\"Ghost navigation\">之后在模板中使用<code>navigation</code>来显示导航，关于该helper的使用，可以参考<a href=\"https://github.com/ghostchina/docs/blob/master/navigation.md\">我翻译的文档</a>。我们的<a href=\"http://www.ghostchina.com/\">GhostChina</a>网站的导航就是使用了该方法，只不过它的导航链接都不是标签的，这里只是举例说明。</li>\n<li>使用中文版中特有的标签<code>tag_cloud</code>，关于该标签的使用<a href=\"http://www.ghostchina.com/output-tag-cloud/\">请查看</a>。另外<a href=\"http://www.ghostchina.com/\">GhostChina</a>网站也使用了该标签云。<img src=\"/images/ghost/ghost-china.png\" alt=\"Ghost china\"></li>\n</ol>\n<p>这里简单地介绍了如何在Ghost中添加分类浏览，那么有人要问了，Ghost可以按日期来浏览文章么？其实Ghost可以在发表文章时选择在文章的链接上加上日期的，<img src=\"/images/ghost/ghost-title-date.png\" alt=\"Ghost title date\">但是要实现按日期浏览文章暂时是没有的，起码我没有看到过，不过这个可以通过添加标签的方式来实现，期待高手出现。</p>\n","site":{"data":{}},"excerpt":"<p>有不少刚接触Ghost博客的朋友都会问：Ghost如何做分类？如何按分类来浏览博客？其实Ghost没有分类这个概念，不像其它的博客系统，在发表文章时要选择分类，Ghost只有标签(Tag)。而我们正是要利用这个标签来变相地实现分类浏览。<br>\n　　首先说下Ghost添加标签的地方，还是有些人是不知道的。在如图位置输入标签，标签和标签之间以英文逗号隔开，会自动提示之前的标签：<img src=\"/images/ghost/ghost-tag.png\" alt=\"Ghost tag\"><br>\n　　Ghost中的标签是没有限制的，给了我们很多自由，但如果要做分类，我们还是需要遵守一定规则为好，比如之前有篇文章有个标签<code>test</code>，那么你下一篇文章如果还要使用这个标签，在标签输入处输入<code>t</code>，Ghost会自动提示出之前的<code>test</code>分类，选择即可。这样我们就有2篇文章有相同的标签<code>test</code>了，这时候我们可以通过<code>http://your.blog.site/tag/test</code>来访问这个分类下的所有文章。<br>\n　　OK，现在我们已经完成了一半了，还有个问题是如何在我们的首页中显示分类信息呢？这里有几种方法，我们一一介绍。</p>","more":"<ol>\n<li>第一种也是最简单最粗暴的方法，修改首页模板，在需要的位置添加一个到刚才的标签链接的a标签即可，该方法不做过多介绍，会网页基础的应该都会。</li>\n<li>使用Ghost新的helper<code>navigation</code>，这个需要你现在后台的设置里面加入相应的标签的链接即可。如图<img src=\"/images/ghost/ghost-navigation.png\" alt=\"Ghost navigation\">之后在模板中使用<code>navigation</code>来显示导航，关于该helper的使用，可以参考<a href=\"https://github.com/ghostchina/docs/blob/master/navigation.md\">我翻译的文档</a>。我们的<a href=\"http://www.ghostchina.com/\">GhostChina</a>网站的导航就是使用了该方法，只不过它的导航链接都不是标签的，这里只是举例说明。</li>\n<li>使用中文版中特有的标签<code>tag_cloud</code>，关于该标签的使用<a href=\"http://www.ghostchina.com/output-tag-cloud/\">请查看</a>。另外<a href=\"http://www.ghostchina.com/\">GhostChina</a>网站也使用了该标签云。<img src=\"/images/ghost/ghost-china.png\" alt=\"Ghost china\"></li>\n</ol>\n<p>这里简单地介绍了如何在Ghost中添加分类浏览，那么有人要问了，Ghost可以按日期来浏览文章么？其实Ghost可以在发表文章时选择在文章的链接上加上日期的，<img src=\"/images/ghost/ghost-title-date.png\" alt=\"Ghost title date\">但是要实现按日期浏览文章暂时是没有的，起码我没有看到过，不过这个可以通过添加标签的方式来实现，期待高手出现。</p>"},{"title":"CI简介和实际应用","s":"ci-intro","date":"2017-01-16T15:06:00.000Z","thumbnail":"/images/ci/flow.png","_content":"\n## 什么是CI\n引用知乎上的一个回答\n> 作者：赵劼\n> 链接：https://www.zhihu.com/question/23444990/answer/26995938\n> 来源：知乎\n> 著作权归作者所有，转载请联系作者获得授权。\n\n> 集成是指软件个人研发的部分向软件整体部分交付，以便尽早发现个人开发部分的问题；部署是代码尽快向可运行的开发/测试节交付，以便尽早测试；\n交付是指研发尽快向客户交付，以便尽早发现生产环境中存在的问题。\n如果说等到所有东西都完成了才向下个环节交付，导致所有的问题只能再最后才爆发出来，解决成本巨大甚至无法解决。\n而所谓的持续，就是说每完成一个完整的部分，就向下个环节交付，发现问题可以马上调整。是的问题不会放大到其他部分和后面的环节。\n\n> 这种做法的核心思想在于：既然事实上难以做到事先完全了解完整的、正确的需求，那么就干脆一小块一小块的做，并且加快交付的速度和频率，使得交付物尽早在下个环节得到验证。早发现问题早返工。\n\n> 举个例子，你家装修厨房，其中一项是铺地砖，边角地砖要切割大小。如果一次全切割完再铺上去，发现尺寸有误的话浪费和返工时间就大了，不如切一块铺一块。这就是持续集成。\n装修厨房有很多部分，每个部分都有检测手段，如地砖铺完了要测试漏水与否，线路铺完了要通电测试电路通顺，水管装好了也要测试冷水热水。如果全部装完了再测，出现问题可能会互相影响，比如电路不行可能要把地砖给挖开……。那么每完成一部分就测试，这是持续部署。\n全部装修完了，你去验收，发现地砖颜色不合意，水池太小，灶台位置不对，返工吗？所以不如没完成一部分，你就去用一下试用验收，这就是持续交付。\n\\--------------------\n补充：从敏捷思想中提出的这三个观点，还强调一件事：通过技术手段自动化这三个工作。加快交付速度。\n\n还有些细节可以参考[阮一峰的文章](http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html)\n<!-- more -->\n\n![CI](/images/ci/flow.png)\n\n## 常用的持续集成工具\n- [Travis CI](https://travis-ci.org/) 针对开源项目免费，私有项目收费\n- [AppVeyou](https://www.appveyor.com/) 主要是windows平台的持续集成\n- [Gitlab CI](https://about.gitlab.com/gitlab-ci/) 私有仓库Gitlab自带的CI\n- [Jenkins](https://jenkins.io/index.html) 同样的开源产品，适合私有仓库使用，但是需要jre环境来部署\n\n## 项目实践\n- [vue-fullstack](https://github.com/erguotou520/vue-fullstack)\n  该项目为一个`vue`全栈项目模板，项目中使用`travis`做持续集成\n  ```yaml\n  language: node_js\n  node_js:\n    - \"6\"\n  before_install:\n    - git config --global push.default matching\n    - git config --global user.name \"erguotou\"\n    - git config --global user.email \"erguotou525@gmail.com\"\n  install:\n    - npm install -g vue-cli\n    - npm install\n    - node test/index.js\n  script:\n    - cd ../test-fullstack\n    - npm install\n    - npm run lint\n    - npm run build\n  cache:\n    directories:\n      - node_modules\n      - ../test-fullstack/node_modules\n      - $(npm config get prefix)/vue-cli\n  ```\n  该配置文件中主要就做了一件事，根据当前模板生成一个项目文件并执行代码检查和构建操作，以此来简单地验证模板生成的正确性。\n  *TODO:最好可以添加一个文件结构验证的代码，另外后续会根据生成后的项目自动push到github的其它分支中，并通过heroku实现自动部署*\n- [electron-ssr](https://github.com/erguotou520/electron-ssr) 该项目是`ShadowsocksR`的一个多平台pc客户端，该项目同时使用了`travis`和`appveyor`用来构建不同平台上的安装包文件，简单的看下配置文件\n  ```yaml\n  # travis\n  osx_image: xcode7.3\n\n  sudo: required\n  dist: trusty\n\n  language: c\n\n  matrix:\n    include:\n      - os: osx\n      - os: linux\n        env: CC=clang CXX=clang++ npm_config_clang=1\n        compiler: clang\n\n  addons:\n    apt:\n      sources:\n        - ubuntu-toolchain-r-test\n      packages:\n        - icnsutils\n        - graphicsmagick\n        - xz-utils\n        - rpm\n\n  cache:\n    directories:\n    - node_modules\n    - app/node_modules\n    - $HOME/.electron\n    - $HOME/.cache\n\n  before_install:\n    - mkdir -p /tmp/git-lfs && curl -L https://github.com/github/git-lfs/releases/download/v1.2.1/git-lfs-$([ \"$TRAVIS_OS_NAME\" == \"linux\" ] && echo \"linux\" || echo \"darwin\")-amd64-1.2.1.tar.gz | tar -xz -C /tmp/git-lfs --strip-components 1 && /tmp/git-lfs/git-lfs pull\n\n  install:\n  - nvm install 6\n  - npm install electron-builder\n  - npm install\n  - npm prune\n\n  script:\n  - npm run build\n\n  branches:\n    only:\n      - master\n  ```\n\n  ```yaml\n  version: 1.0.{build}\n\n  platform:\n    - x64\n\n  cache:\n    - node_modules\n    - app\\node_modules\n    - '%APPDATA%\\npm-cache'\n    - '%USERPROFILE%\\.electron'\n\n  branches:\n    only:\n    - master\n\n  init:\n    - git config --global core.autocrlf input\n\n  install:\n    - ps: Install-Product node 6 x64\n    - git reset --hard HEAD\n    - npm install npm -g\n    - npm install electron-builder\n    - npm install\n    - npm prune\n\n  build_script:\n    - node --version\n    - npm --version\n    - npm run build\n  ```\n  我们可以看到在`travis`中同时定义了Linux和Mac的构建任务，在`appveyor`中定义了Windows平台的构建任务。任务的大致流程都是根据当前的系统环境构建当前系统的安装包（打包App的任务由构建工具提供），然后自动发布到Gihub Release中，这样就实现了代码push->打包构建（全平台）->发布的完整过程，免去很多手动操作以及对系统环境的要求。\n- [vio-frontend]() T2Cloud的VIO产品前端代码，集成Gitlab CI实现自动编译并发布到poc环境，配置文件如下：\n  ```yaml\n  stages:\n    - install_deps\n    - lint\n    # - test\n    - build\n    - deploy_poc\n  # 安装依赖\n  install_deps:\n    stage: install_deps\n    script:\n      - npm install --registry=https://registry.npm.taobao.org\n  lint:\n    stage: lint\n    script:\n      - npm run lint\n  # 运行测试用例\n  # test:\n  #   stage: test\n  #   only:\n  #     - develop\n  #     - master\n  #   script:\n  #     - npm run test\n  # 编译\n  build:\n    stage: build\n    only:\n      - develop\n      - master\n    script:\n      - npm run build\n  # 部署测试服务器\n  deploy_test:\n    stage: deploy_poc\n    only:\n      - develop\n    script:\n      - npm run deploy\n  ```\n\n## 总结\n简单的说，持续集成帮助我们开发人员免去很重复的手工操作任务，同时可以帮我们持续观察项目的构建状态，测试通过与否，实在是我们开发之幸。\n","source":"_posts/ci.md","raw":"---\ntitle: CI简介和实际应用\ns: ci-intro\ndate: 2017-01-16 23:06:00\nthumbnail: /images/ci/flow.png\ntags:\n  - ci\n  - travis ci\n  - gitlab ci\n---\n\n## 什么是CI\n引用知乎上的一个回答\n> 作者：赵劼\n> 链接：https://www.zhihu.com/question/23444990/answer/26995938\n> 来源：知乎\n> 著作权归作者所有，转载请联系作者获得授权。\n\n> 集成是指软件个人研发的部分向软件整体部分交付，以便尽早发现个人开发部分的问题；部署是代码尽快向可运行的开发/测试节交付，以便尽早测试；\n交付是指研发尽快向客户交付，以便尽早发现生产环境中存在的问题。\n如果说等到所有东西都完成了才向下个环节交付，导致所有的问题只能再最后才爆发出来，解决成本巨大甚至无法解决。\n而所谓的持续，就是说每完成一个完整的部分，就向下个环节交付，发现问题可以马上调整。是的问题不会放大到其他部分和后面的环节。\n\n> 这种做法的核心思想在于：既然事实上难以做到事先完全了解完整的、正确的需求，那么就干脆一小块一小块的做，并且加快交付的速度和频率，使得交付物尽早在下个环节得到验证。早发现问题早返工。\n\n> 举个例子，你家装修厨房，其中一项是铺地砖，边角地砖要切割大小。如果一次全切割完再铺上去，发现尺寸有误的话浪费和返工时间就大了，不如切一块铺一块。这就是持续集成。\n装修厨房有很多部分，每个部分都有检测手段，如地砖铺完了要测试漏水与否，线路铺完了要通电测试电路通顺，水管装好了也要测试冷水热水。如果全部装完了再测，出现问题可能会互相影响，比如电路不行可能要把地砖给挖开……。那么每完成一部分就测试，这是持续部署。\n全部装修完了，你去验收，发现地砖颜色不合意，水池太小，灶台位置不对，返工吗？所以不如没完成一部分，你就去用一下试用验收，这就是持续交付。\n\\--------------------\n补充：从敏捷思想中提出的这三个观点，还强调一件事：通过技术手段自动化这三个工作。加快交付速度。\n\n还有些细节可以参考[阮一峰的文章](http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html)\n<!-- more -->\n\n![CI](/images/ci/flow.png)\n\n## 常用的持续集成工具\n- [Travis CI](https://travis-ci.org/) 针对开源项目免费，私有项目收费\n- [AppVeyou](https://www.appveyor.com/) 主要是windows平台的持续集成\n- [Gitlab CI](https://about.gitlab.com/gitlab-ci/) 私有仓库Gitlab自带的CI\n- [Jenkins](https://jenkins.io/index.html) 同样的开源产品，适合私有仓库使用，但是需要jre环境来部署\n\n## 项目实践\n- [vue-fullstack](https://github.com/erguotou520/vue-fullstack)\n  该项目为一个`vue`全栈项目模板，项目中使用`travis`做持续集成\n  ```yaml\n  language: node_js\n  node_js:\n    - \"6\"\n  before_install:\n    - git config --global push.default matching\n    - git config --global user.name \"erguotou\"\n    - git config --global user.email \"erguotou525@gmail.com\"\n  install:\n    - npm install -g vue-cli\n    - npm install\n    - node test/index.js\n  script:\n    - cd ../test-fullstack\n    - npm install\n    - npm run lint\n    - npm run build\n  cache:\n    directories:\n      - node_modules\n      - ../test-fullstack/node_modules\n      - $(npm config get prefix)/vue-cli\n  ```\n  该配置文件中主要就做了一件事，根据当前模板生成一个项目文件并执行代码检查和构建操作，以此来简单地验证模板生成的正确性。\n  *TODO:最好可以添加一个文件结构验证的代码，另外后续会根据生成后的项目自动push到github的其它分支中，并通过heroku实现自动部署*\n- [electron-ssr](https://github.com/erguotou520/electron-ssr) 该项目是`ShadowsocksR`的一个多平台pc客户端，该项目同时使用了`travis`和`appveyor`用来构建不同平台上的安装包文件，简单的看下配置文件\n  ```yaml\n  # travis\n  osx_image: xcode7.3\n\n  sudo: required\n  dist: trusty\n\n  language: c\n\n  matrix:\n    include:\n      - os: osx\n      - os: linux\n        env: CC=clang CXX=clang++ npm_config_clang=1\n        compiler: clang\n\n  addons:\n    apt:\n      sources:\n        - ubuntu-toolchain-r-test\n      packages:\n        - icnsutils\n        - graphicsmagick\n        - xz-utils\n        - rpm\n\n  cache:\n    directories:\n    - node_modules\n    - app/node_modules\n    - $HOME/.electron\n    - $HOME/.cache\n\n  before_install:\n    - mkdir -p /tmp/git-lfs && curl -L https://github.com/github/git-lfs/releases/download/v1.2.1/git-lfs-$([ \"$TRAVIS_OS_NAME\" == \"linux\" ] && echo \"linux\" || echo \"darwin\")-amd64-1.2.1.tar.gz | tar -xz -C /tmp/git-lfs --strip-components 1 && /tmp/git-lfs/git-lfs pull\n\n  install:\n  - nvm install 6\n  - npm install electron-builder\n  - npm install\n  - npm prune\n\n  script:\n  - npm run build\n\n  branches:\n    only:\n      - master\n  ```\n\n  ```yaml\n  version: 1.0.{build}\n\n  platform:\n    - x64\n\n  cache:\n    - node_modules\n    - app\\node_modules\n    - '%APPDATA%\\npm-cache'\n    - '%USERPROFILE%\\.electron'\n\n  branches:\n    only:\n    - master\n\n  init:\n    - git config --global core.autocrlf input\n\n  install:\n    - ps: Install-Product node 6 x64\n    - git reset --hard HEAD\n    - npm install npm -g\n    - npm install electron-builder\n    - npm install\n    - npm prune\n\n  build_script:\n    - node --version\n    - npm --version\n    - npm run build\n  ```\n  我们可以看到在`travis`中同时定义了Linux和Mac的构建任务，在`appveyor`中定义了Windows平台的构建任务。任务的大致流程都是根据当前的系统环境构建当前系统的安装包（打包App的任务由构建工具提供），然后自动发布到Gihub Release中，这样就实现了代码push->打包构建（全平台）->发布的完整过程，免去很多手动操作以及对系统环境的要求。\n- [vio-frontend]() T2Cloud的VIO产品前端代码，集成Gitlab CI实现自动编译并发布到poc环境，配置文件如下：\n  ```yaml\n  stages:\n    - install_deps\n    - lint\n    # - test\n    - build\n    - deploy_poc\n  # 安装依赖\n  install_deps:\n    stage: install_deps\n    script:\n      - npm install --registry=https://registry.npm.taobao.org\n  lint:\n    stage: lint\n    script:\n      - npm run lint\n  # 运行测试用例\n  # test:\n  #   stage: test\n  #   only:\n  #     - develop\n  #     - master\n  #   script:\n  #     - npm run test\n  # 编译\n  build:\n    stage: build\n    only:\n      - develop\n      - master\n    script:\n      - npm run build\n  # 部署测试服务器\n  deploy_test:\n    stage: deploy_poc\n    only:\n      - develop\n    script:\n      - npm run deploy\n  ```\n\n## 总结\n简单的说，持续集成帮助我们开发人员免去很重复的手工操作任务，同时可以帮我们持续观察项目的构建状态，测试通过与否，实在是我们开发之幸。\n","slug":"ci","published":1,"updated":"2019-03-26T13:47:04.872Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox010009tof9mwgu91q0","content":"<h2 id=\"什么是CI\"><a class=\"header-anchor\" href=\"#什么是CI\">¶</a>什么是CI</h2>\n<p>引用知乎上的一个回答</p>\n<blockquote>\n<p>作者：赵劼<br>\n链接：<a href=\"https://www.zhihu.com/question/23444990/answer/26995938\">https://www.zhihu.com/question/23444990/answer/26995938</a><br>\n来源：知乎<br>\n著作权归作者所有，转载请联系作者获得授权。</p>\n</blockquote>\n<blockquote>\n<p>集成是指软件个人研发的部分向软件整体部分交付，以便尽早发现个人开发部分的问题；部署是代码尽快向可运行的开发/测试节交付，以便尽早测试；<br>\n交付是指研发尽快向客户交付，以便尽早发现生产环境中存在的问题。<br>\n如果说等到所有东西都完成了才向下个环节交付，导致所有的问题只能再最后才爆发出来，解决成本巨大甚至无法解决。<br>\n而所谓的持续，就是说每完成一个完整的部分，就向下个环节交付，发现问题可以马上调整。是的问题不会放大到其他部分和后面的环节。</p>\n</blockquote>\n<blockquote>\n<p>这种做法的核心思想在于：既然事实上难以做到事先完全了解完整的、正确的需求，那么就干脆一小块一小块的做，并且加快交付的速度和频率，使得交付物尽早在下个环节得到验证。早发现问题早返工。</p>\n</blockquote>\n<blockquote>\n<p>举个例子，你家装修厨房，其中一项是铺地砖，边角地砖要切割大小。如果一次全切割完再铺上去，发现尺寸有误的话浪费和返工时间就大了，不如切一块铺一块。这就是持续集成。<br>\n装修厨房有很多部分，每个部分都有检测手段，如地砖铺完了要测试漏水与否，线路铺完了要通电测试电路通顺，水管装好了也要测试冷水热水。如果全部装完了再测，出现问题可能会互相影响，比如电路不行可能要把地砖给挖开……。那么每完成一部分就测试，这是持续部署。<br>\n全部装修完了，你去验收，发现地砖颜色不合意，水池太小，灶台位置不对，返工吗？所以不如没完成一部分，你就去用一下试用验收，这就是持续交付。<br>\n--------------------<br>\n补充：从敏捷思想中提出的这三个观点，还强调一件事：通过技术手段自动化这三个工作。加快交付速度。</p>\n</blockquote>\n<p>还有些细节可以参考<a href=\"http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html\">阮一峰的文章</a></p>\n<a id=\"more\"></a>\n<p><img src=\"/images/ci/flow.png\" alt=\"CI\"></p>\n<h2 id=\"常用的持续集成工具\"><a class=\"header-anchor\" href=\"#常用的持续集成工具\">¶</a>常用的持续集成工具</h2>\n<ul>\n<li><a href=\"https://travis-ci.org/\">Travis CI</a> 针对开源项目免费，私有项目收费</li>\n<li><a href=\"https://www.appveyor.com/\">AppVeyou</a> 主要是windows平台的持续集成</li>\n<li><a href=\"https://about.gitlab.com/gitlab-ci/\">Gitlab CI</a> 私有仓库Gitlab自带的CI</li>\n<li><a href=\"https://jenkins.io/index.html\">Jenkins</a> 同样的开源产品，适合私有仓库使用，但是需要jre环境来部署</li>\n</ul>\n<h2 id=\"项目实践\"><a class=\"header-anchor\" href=\"#项目实践\">¶</a>项目实践</h2>\n<ul>\n<li>\n<p><a href=\"https://github.com/erguotou520/vue-fullstack\">vue-fullstack</a><br>\n该项目为一个<code>vue</code>全栈项目模板，项目中使用<code>travis</code>做持续集成</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">language:</span> <span class=\"hljs-string\">node_js</span></span><br><span class=\"line\"><span class=\"hljs-attr\">node_js:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"6\"</span></span><br><span class=\"line\"><span class=\"hljs-attr\">before_install:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">--global</span> <span class=\"hljs-string\">push.default</span> <span class=\"hljs-string\">matching</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">--global</span> <span class=\"hljs-string\">user.name</span> <span class=\"hljs-string\">\"erguotou\"</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">--global</span> <span class=\"hljs-string\">user.email</span> <span class=\"hljs-string\">\"erguotou525@gmail.com\"</span></span><br><span class=\"line\"><span class=\"hljs-attr\">install:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">-g</span> <span class=\"hljs-string\">vue-cli</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">node</span> <span class=\"hljs-string\">test/index.js</span></span><br><span class=\"line\"><span class=\"hljs-attr\">script:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">cd</span> <span class=\"hljs-string\">../test-fullstack</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">lint</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span></span><br><span class=\"line\"><span class=\"hljs-attr\">cache:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">directories:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">node_modules</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">../test-fullstack/node_modules</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">$(npm</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">get</span> <span class=\"hljs-string\">prefix)/vue-cli</span></span><br></pre></td></tr></table></figure>\n<p>该配置文件中主要就做了一件事，根据当前模板生成一个项目文件并执行代码检查和构建操作，以此来简单地验证模板生成的正确性。<br>\n<em>TODO:最好可以添加一个文件结构验证的代码，另外后续会根据生成后的项目自动push到github的其它分支中，并通过heroku实现自动部署</em></p>\n</li>\n<li>\n<p><a href=\"https://github.com/erguotou520/electron-ssr\">electron-ssr</a> 该项目是<code>ShadowsocksR</code>的一个多平台pc客户端，该项目同时使用了<code>travis</code>和<code>appveyor</code>用来构建不同平台上的安装包文件，简单的看下配置文件</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># travis</span></span><br><span class=\"line\"><span class=\"hljs-attr\">osx_image:</span> <span class=\"hljs-string\">xcode7.3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">sudo:</span> <span class=\"hljs-string\">required</span></span><br><span class=\"line\"><span class=\"hljs-attr\">dist:</span> <span class=\"hljs-string\">trusty</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">language:</span> <span class=\"hljs-string\">c</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">matrix:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">include:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">os:</span> <span class=\"hljs-string\">osx</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">os:</span> <span class=\"hljs-string\">linux</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">env:</span> <span class=\"hljs-string\">CC=clang</span> <span class=\"hljs-string\">CXX=clang++</span> <span class=\"hljs-string\">npm_config_clang=1</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">compiler:</span> <span class=\"hljs-string\">clang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">addons:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">apt:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">sources:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ubuntu-toolchain-r-test</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">packages:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">icnsutils</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">graphicsmagick</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">xz-utils</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">rpm</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">cache:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">directories:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">node_modules</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">app/node_modules</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">$HOME/.electron</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">$HOME/.cache</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">before_install:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">mkdir</span> <span class=\"hljs-string\">-p</span> <span class=\"hljs-string\">/tmp/git-lfs</span> <span class=\"hljs-string\">&amp;&amp;</span> <span class=\"hljs-string\">curl</span> <span class=\"hljs-string\">-L</span> <span class=\"hljs-string\">https://github.com/github/git-lfs/releases/download/v1.2.1/git-lfs-$([</span> <span class=\"hljs-string\">\"$TRAVIS_OS_NAME\"</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">\"linux\"</span> <span class=\"hljs-string\">]</span> <span class=\"hljs-string\">&amp;&amp;</span> <span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">\"linux\"</span> <span class=\"hljs-string\">||</span> <span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">\"darwin\"</span><span class=\"hljs-string\">)-amd64-1.2.1.tar.gz</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">tar</span> <span class=\"hljs-string\">-xz</span> <span class=\"hljs-string\">-C</span> <span class=\"hljs-string\">/tmp/git-lfs</span> <span class=\"hljs-string\">--strip-components</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-string\">&amp;&amp;</span> <span class=\"hljs-string\">/tmp/git-lfs/git-lfs</span> <span class=\"hljs-string\">pull</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">install:</span></span><br><span class=\"line\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nvm</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-number\">6</span></span><br><span class=\"line\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">electron-builder</span></span><br><span class=\"line\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span></span><br><span class=\"line\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">prune</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">script:</span></span><br><span class=\"line\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">branches:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">only:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">master</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">1.0</span><span class=\"hljs-string\">.&#123;build&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">platform:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">x64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">cache:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">node_modules</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">app\\node_modules</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">'%APPDATA%\\npm-cache'</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">'%USERPROFILE%\\.electron'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">branches:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">only:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">master</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">init:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">--global</span> <span class=\"hljs-string\">core.autocrlf</span> <span class=\"hljs-string\">input</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">install:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">ps:</span> <span class=\"hljs-string\">Install-Product</span> <span class=\"hljs-string\">node</span> <span class=\"hljs-number\">6</span> <span class=\"hljs-string\">x64</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">reset</span> <span class=\"hljs-string\">--hard</span> <span class=\"hljs-string\">HEAD</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">-g</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">electron-builder</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">prune</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">build_script:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">node</span> <span class=\"hljs-string\">--version</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">--version</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span></span><br></pre></td></tr></table></figure>\n<p>我们可以看到在<code>travis</code>中同时定义了Linux和Mac的构建任务，在<code>appveyor</code>中定义了Windows平台的构建任务。任务的大致流程都是根据当前的系统环境构建当前系统的安装包（打包App的任务由构建工具提供），然后自动发布到Gihub Release中，这样就实现了代码push-&gt;打包构建（全平台）-&gt;发布的完整过程，免去很多手动操作以及对系统环境的要求。</p>\n</li>\n<li>\n<p><a href>vio-frontend</a> T2Cloud的VIO产品前端代码，集成Gitlab CI实现自动编译并发布到poc环境，配置文件如下：</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">stages:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">install_deps</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">lint</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># - test</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">build</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">deploy_poc</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 安装依赖</span></span><br><span class=\"line\"><span class=\"hljs-attr\">install_deps:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">stage:</span> <span class=\"hljs-string\">install_deps</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">script:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">--registry=https://registry.npm.taobao.org</span></span><br><span class=\"line\"><span class=\"hljs-attr\">lint:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">stage:</span> <span class=\"hljs-string\">lint</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">script:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">lint</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 运行测试用例</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># test:</span></span><br><span class=\"line\"><span class=\"hljs-comment\">#   stage: test</span></span><br><span class=\"line\"><span class=\"hljs-comment\">#   only:</span></span><br><span class=\"line\"><span class=\"hljs-comment\">#     - develop</span></span><br><span class=\"line\"><span class=\"hljs-comment\">#     - master</span></span><br><span class=\"line\"><span class=\"hljs-comment\">#   script:</span></span><br><span class=\"line\"><span class=\"hljs-comment\">#     - npm run test</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 编译</span></span><br><span class=\"line\"><span class=\"hljs-attr\">build:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">stage:</span> <span class=\"hljs-string\">build</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">only:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">develop</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">master</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">script:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 部署测试服务器</span></span><br><span class=\"line\"><span class=\"hljs-attr\">deploy_test:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">stage:</span> <span class=\"hljs-string\">deploy_poc</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">only:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">develop</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">script:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">deploy</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"总结\"><a class=\"header-anchor\" href=\"#总结\">¶</a>总结</h2>\n<p>简单的说，持续集成帮助我们开发人员免去很重复的手工操作任务，同时可以帮我们持续观察项目的构建状态，测试通过与否，实在是我们开发之幸。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"什么是CI\"><a class=\"header-anchor\" href=\"#什么是CI\">¶</a>什么是CI</h2>\n<p>引用知乎上的一个回答</p>\n<blockquote>\n<p>作者：赵劼<br>\n链接：<a href=\"https://www.zhihu.com/question/23444990/answer/26995938\">https://www.zhihu.com/question/23444990/answer/26995938</a><br>\n来源：知乎<br>\n著作权归作者所有，转载请联系作者获得授权。</p>\n</blockquote>\n<blockquote>\n<p>集成是指软件个人研发的部分向软件整体部分交付，以便尽早发现个人开发部分的问题；部署是代码尽快向可运行的开发/测试节交付，以便尽早测试；<br>\n交付是指研发尽快向客户交付，以便尽早发现生产环境中存在的问题。<br>\n如果说等到所有东西都完成了才向下个环节交付，导致所有的问题只能再最后才爆发出来，解决成本巨大甚至无法解决。<br>\n而所谓的持续，就是说每完成一个完整的部分，就向下个环节交付，发现问题可以马上调整。是的问题不会放大到其他部分和后面的环节。</p>\n</blockquote>\n<blockquote>\n<p>这种做法的核心思想在于：既然事实上难以做到事先完全了解完整的、正确的需求，那么就干脆一小块一小块的做，并且加快交付的速度和频率，使得交付物尽早在下个环节得到验证。早发现问题早返工。</p>\n</blockquote>\n<blockquote>\n<p>举个例子，你家装修厨房，其中一项是铺地砖，边角地砖要切割大小。如果一次全切割完再铺上去，发现尺寸有误的话浪费和返工时间就大了，不如切一块铺一块。这就是持续集成。<br>\n装修厨房有很多部分，每个部分都有检测手段，如地砖铺完了要测试漏水与否，线路铺完了要通电测试电路通顺，水管装好了也要测试冷水热水。如果全部装完了再测，出现问题可能会互相影响，比如电路不行可能要把地砖给挖开……。那么每完成一部分就测试，这是持续部署。<br>\n全部装修完了，你去验收，发现地砖颜色不合意，水池太小，灶台位置不对，返工吗？所以不如没完成一部分，你就去用一下试用验收，这就是持续交付。<br>\n--------------------<br>\n补充：从敏捷思想中提出的这三个观点，还强调一件事：通过技术手段自动化这三个工作。加快交付速度。</p>\n</blockquote>\n<p>还有些细节可以参考<a href=\"http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html\">阮一峰的文章</a></p>","more":"<p><img src=\"/images/ci/flow.png\" alt=\"CI\"></p>\n<h2 id=\"常用的持续集成工具\"><a class=\"header-anchor\" href=\"#常用的持续集成工具\">¶</a>常用的持续集成工具</h2>\n<ul>\n<li><a href=\"https://travis-ci.org/\">Travis CI</a> 针对开源项目免费，私有项目收费</li>\n<li><a href=\"https://www.appveyor.com/\">AppVeyou</a> 主要是windows平台的持续集成</li>\n<li><a href=\"https://about.gitlab.com/gitlab-ci/\">Gitlab CI</a> 私有仓库Gitlab自带的CI</li>\n<li><a href=\"https://jenkins.io/index.html\">Jenkins</a> 同样的开源产品，适合私有仓库使用，但是需要jre环境来部署</li>\n</ul>\n<h2 id=\"项目实践\"><a class=\"header-anchor\" href=\"#项目实践\">¶</a>项目实践</h2>\n<ul>\n<li>\n<p><a href=\"https://github.com/erguotou520/vue-fullstack\">vue-fullstack</a><br>\n该项目为一个<code>vue</code>全栈项目模板，项目中使用<code>travis</code>做持续集成</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">language:</span> <span class=\"string\">node_js</span></span><br><span class=\"line\"><span class=\"attr\">node_js:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">\"6\"</span></span><br><span class=\"line\"><span class=\"attr\">before_install:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">push.default</span> <span class=\"string\">matching</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">\"erguotou\"</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">\"erguotou525@gmail.com\"</span></span><br><span class=\"line\"><span class=\"attr\">install:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">-g</span> <span class=\"string\">vue-cli</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">node</span> <span class=\"string\">test/index.js</span></span><br><span class=\"line\"><span class=\"attr\">script:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">cd</span> <span class=\"string\">../test-fullstack</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">lint</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">build</span></span><br><span class=\"line\"><span class=\"attr\">cache:</span></span><br><span class=\"line\">  <span class=\"attr\">directories:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">node_modules</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">../test-fullstack/node_modules</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">$(npm</span> <span class=\"string\">config</span> <span class=\"string\">get</span> <span class=\"string\">prefix)/vue-cli</span></span><br></pre></td></tr></table></figure>\n<p>该配置文件中主要就做了一件事，根据当前模板生成一个项目文件并执行代码检查和构建操作，以此来简单地验证模板生成的正确性。<br>\n<em>TODO:最好可以添加一个文件结构验证的代码，另外后续会根据生成后的项目自动push到github的其它分支中，并通过heroku实现自动部署</em></p>\n</li>\n<li>\n<p><a href=\"https://github.com/erguotou520/electron-ssr\">electron-ssr</a> 该项目是<code>ShadowsocksR</code>的一个多平台pc客户端，该项目同时使用了<code>travis</code>和<code>appveyor</code>用来构建不同平台上的安装包文件，简单的看下配置文件</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># travis</span></span><br><span class=\"line\"><span class=\"attr\">osx_image:</span> <span class=\"string\">xcode7.3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">sudo:</span> <span class=\"string\">required</span></span><br><span class=\"line\"><span class=\"attr\">dist:</span> <span class=\"string\">trusty</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">language:</span> <span class=\"string\">c</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">matrix:</span></span><br><span class=\"line\">  <span class=\"attr\">include:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">os:</span> <span class=\"string\">osx</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">os:</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">env:</span> <span class=\"string\">CC=clang</span> <span class=\"string\">CXX=clang++</span> <span class=\"string\">npm_config_clang=1</span></span><br><span class=\"line\">      <span class=\"attr\">compiler:</span> <span class=\"string\">clang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">addons:</span></span><br><span class=\"line\">  <span class=\"attr\">apt:</span></span><br><span class=\"line\">    <span class=\"attr\">sources:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ubuntu-toolchain-r-test</span></span><br><span class=\"line\">    <span class=\"attr\">packages:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">icnsutils</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">graphicsmagick</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">xz-utils</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">rpm</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">cache:</span></span><br><span class=\"line\">  <span class=\"attr\">directories:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">node_modules</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">app/node_modules</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">$HOME/.electron</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">$HOME/.cache</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">before_install:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">mkdir</span> <span class=\"string\">-p</span> <span class=\"string\">/tmp/git-lfs</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">curl</span> <span class=\"string\">-L</span> <span class=\"string\">https://github.com/github/git-lfs/releases/download/v1.2.1/git-lfs-$([</span> <span class=\"string\">\"$TRAVIS_OS_NAME\"</span> <span class=\"string\">==</span> <span class=\"string\">\"linux\"</span> <span class=\"string\">]</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">echo</span> <span class=\"string\">\"linux\"</span> <span class=\"string\">||</span> <span class=\"string\">echo</span> <span class=\"string\">\"darwin\"</span><span class=\"string\">)-amd64-1.2.1.tar.gz</span> <span class=\"string\">|</span> <span class=\"string\">tar</span> <span class=\"string\">-xz</span> <span class=\"string\">-C</span> <span class=\"string\">/tmp/git-lfs</span> <span class=\"string\">--strip-components</span> <span class=\"number\">1</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">/tmp/git-lfs/git-lfs</span> <span class=\"string\">pull</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">install:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">nvm</span> <span class=\"string\">install</span> <span class=\"number\">6</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">electron-builder</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">prune</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">script:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">build</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">branches:</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"number\">1.0</span><span class=\"string\">.&#123;build&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">platform:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">x64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">cache:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">node_modules</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">app\\node_modules</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">'%APPDATA%\\npm-cache'</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">'%USERPROFILE%\\.electron'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">branches:</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">init:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">core.autocrlf</span> <span class=\"string\">input</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">install:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">ps:</span> <span class=\"string\">Install-Product</span> <span class=\"string\">node</span> <span class=\"number\">6</span> <span class=\"string\">x64</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">reset</span> <span class=\"string\">--hard</span> <span class=\"string\">HEAD</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">npm</span> <span class=\"string\">-g</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">electron-builder</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">prune</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">build_script:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">node</span> <span class=\"string\">--version</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">--version</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">build</span></span><br></pre></td></tr></table></figure>\n<p>我们可以看到在<code>travis</code>中同时定义了Linux和Mac的构建任务，在<code>appveyor</code>中定义了Windows平台的构建任务。任务的大致流程都是根据当前的系统环境构建当前系统的安装包（打包App的任务由构建工具提供），然后自动发布到Gihub Release中，这样就实现了代码push-&gt;打包构建（全平台）-&gt;发布的完整过程，免去很多手动操作以及对系统环境的要求。</p>\n</li>\n<li>\n<p><a href=\"\">vio-frontend</a> T2Cloud的VIO产品前端代码，集成Gitlab CI实现自动编译并发布到poc环境，配置文件如下：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">stages:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">install_deps</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">lint</span></span><br><span class=\"line\">  <span class=\"comment\"># - test</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">build</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">deploy_poc</span></span><br><span class=\"line\"><span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\"><span class=\"attr\">install_deps:</span></span><br><span class=\"line\">  <span class=\"attr\">stage:</span> <span class=\"string\">install_deps</span></span><br><span class=\"line\">  <span class=\"attr\">script:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">--registry=https://registry.npm.taobao.org</span></span><br><span class=\"line\"><span class=\"attr\">lint:</span></span><br><span class=\"line\">  <span class=\"attr\">stage:</span> <span class=\"string\">lint</span></span><br><span class=\"line\">  <span class=\"attr\">script:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">lint</span></span><br><span class=\"line\"><span class=\"comment\"># 运行测试用例</span></span><br><span class=\"line\"><span class=\"comment\"># test:</span></span><br><span class=\"line\"><span class=\"comment\">#   stage: test</span></span><br><span class=\"line\"><span class=\"comment\">#   only:</span></span><br><span class=\"line\"><span class=\"comment\">#     - develop</span></span><br><span class=\"line\"><span class=\"comment\">#     - master</span></span><br><span class=\"line\"><span class=\"comment\">#   script:</span></span><br><span class=\"line\"><span class=\"comment\">#     - npm run test</span></span><br><span class=\"line\"><span class=\"comment\"># 编译</span></span><br><span class=\"line\"><span class=\"attr\">build:</span></span><br><span class=\"line\">  <span class=\"attr\">stage:</span> <span class=\"string\">build</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">develop</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br><span class=\"line\">  <span class=\"attr\">script:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">build</span></span><br><span class=\"line\"><span class=\"comment\"># 部署测试服务器</span></span><br><span class=\"line\"><span class=\"attr\">deploy_test:</span></span><br><span class=\"line\">  <span class=\"attr\">stage:</span> <span class=\"string\">deploy_poc</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">develop</span></span><br><span class=\"line\">  <span class=\"attr\">script:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">deploy</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"总结\"><a class=\"header-anchor\" href=\"#总结\">¶</a>总结</h2>\n<p>简单的说，持续集成帮助我们开发人员免去很重复的手工操作任务，同时可以帮我们持续观察项目的构建状态，测试通过与否，实在是我们开发之幸。</p>"},{"title":"CentOS7升级OpenSSH","s":"centos7-update-openssh","date":"2019-06-13T03:51:00.000Z","thumbnail":"/images/server/openssh.gif","_content":"\n## 当前状态\n\n查看openssh版本 `ssh -V`，查看openssl版本`openssl version`，记录当前版本号以便升级后做对比。\n\n## 开启Telnet\n\n升级ssh的过程中可能导致ssh无法登录，所以最好先开着Telnet。\n\n```bash\nyum install xinetd telnet-server -y\nsystemctl enable xinetd.service\nsystemctl enable telnet.socket\nsystemctl start telnet.socket\nsystemctl start xinetd\n# 允许root登录\necho  'pts/0'  >>/etc/securetty\necho 'pts/1' >>/etc/securetty\nsystemctl restart xinetd.service\n# 防火墙添加过滤\nfirewall-cmd --add-service=telnet --zone=public --permanent\n# 确认下telnet是否可以登录成功\n```\n<!-- more -->\n## 开始安装\n\n```bash\n# 安装一些可能需要的库\nyum install zlib-devel -y pam-devel tcp_wrappers-devel gcc\n# 备份文件\nmv /usr/bin/openssl /usr/bin/openssl.bak\nmv /etc/ssh /etc/ssh.bak\n# 在/opt目录下载\ncd /opt\n# openssl\nwget https://www.openssl.org/source/openssl-1.0.2s.tar.gz\ntar zxvf openssl-1.0.2s.tar.gz\n# openssl-fips\nwget https://www.openssl.org/source/openssl-fips-2.0.16.tar.gz\ntar zxvf openssl-fips-2.0.16.tar.gz\n# openssh\nwget http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.0p1.tar.gz\ntar zxvf openssh-8.0p1.tar.gz\n\n# 编译安装openssl-fips\ncd ./openssl-fips-2.0.16/\n./config && make && make install\n\n# 编译安装openssl\ncd ../openssl-1.0.2s/\n./config fips shared -fPIC\nmake depend\nmake && make install\nln -s /usr/local/ssl/bin/openssl /usr/bin/openssl\nln -s /usr/local/ssl/include/openssl /usr/include/openssl\necho \"/usr/local/ssl/lib\" >> /etc/ld.so.conf\n/sbin/ldconfig\n# 查看版本是否升级成功\nopenssl version\n\n# 编译安装openssh\ncd ../openssh-8.0p1\n./configure --prefix=/usr/ --sysconfdir=/etc/ssh  --with-openssl-includes=/usr/local/ssl/include --with-ssl-dir=/usr/local/ssl --with-zlib --with-md5-passwords --with-pam && make && make install\n# 修改ssh配置文件，修改PermitRootLogin为yes UseDNS为no\nvi /etc/ssh/sshd_config\ncp -a contrib/redhat/sshd.init /etc/init.d/sshd\ncp -a contrib/redhat/sshd.pam /etc/pam.d/sshd.pam\nchmod +x /etc/init.d/sshd\nchkconfig --add sshd\nsystemctl enable sshd\n# 使用命令测试端口是否正常\nsystemctl stop sshd\nnetstat -lntp\nsystemctl start sshd\nnetstat -lntp\n```\n\n## 安装完成后续\n\n安装完成后`reboot`重启下机器，然后测试下ssh版本是否升级成功\n`ssh -V`，测试ok后关闭telnet服务\n\n```bash\nsystemctl disable xinetd.service\nsystemctl stop xinetd.service\nsystemctl disable telnet.socket\nsystemctl stop telnet.socket\n```\n","source":"_posts/centos7-update-openssh.md","raw":"---\ntitle: CentOS7升级OpenSSH\ns: centos7-update-openssh\ndate: 2019-06-13 11:51:00\nthumbnail: /images/server/openssh.gif\ntags:\n  - openssh\n  - centos\n---\n\n## 当前状态\n\n查看openssh版本 `ssh -V`，查看openssl版本`openssl version`，记录当前版本号以便升级后做对比。\n\n## 开启Telnet\n\n升级ssh的过程中可能导致ssh无法登录，所以最好先开着Telnet。\n\n```bash\nyum install xinetd telnet-server -y\nsystemctl enable xinetd.service\nsystemctl enable telnet.socket\nsystemctl start telnet.socket\nsystemctl start xinetd\n# 允许root登录\necho  'pts/0'  >>/etc/securetty\necho 'pts/1' >>/etc/securetty\nsystemctl restart xinetd.service\n# 防火墙添加过滤\nfirewall-cmd --add-service=telnet --zone=public --permanent\n# 确认下telnet是否可以登录成功\n```\n<!-- more -->\n## 开始安装\n\n```bash\n# 安装一些可能需要的库\nyum install zlib-devel -y pam-devel tcp_wrappers-devel gcc\n# 备份文件\nmv /usr/bin/openssl /usr/bin/openssl.bak\nmv /etc/ssh /etc/ssh.bak\n# 在/opt目录下载\ncd /opt\n# openssl\nwget https://www.openssl.org/source/openssl-1.0.2s.tar.gz\ntar zxvf openssl-1.0.2s.tar.gz\n# openssl-fips\nwget https://www.openssl.org/source/openssl-fips-2.0.16.tar.gz\ntar zxvf openssl-fips-2.0.16.tar.gz\n# openssh\nwget http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.0p1.tar.gz\ntar zxvf openssh-8.0p1.tar.gz\n\n# 编译安装openssl-fips\ncd ./openssl-fips-2.0.16/\n./config && make && make install\n\n# 编译安装openssl\ncd ../openssl-1.0.2s/\n./config fips shared -fPIC\nmake depend\nmake && make install\nln -s /usr/local/ssl/bin/openssl /usr/bin/openssl\nln -s /usr/local/ssl/include/openssl /usr/include/openssl\necho \"/usr/local/ssl/lib\" >> /etc/ld.so.conf\n/sbin/ldconfig\n# 查看版本是否升级成功\nopenssl version\n\n# 编译安装openssh\ncd ../openssh-8.0p1\n./configure --prefix=/usr/ --sysconfdir=/etc/ssh  --with-openssl-includes=/usr/local/ssl/include --with-ssl-dir=/usr/local/ssl --with-zlib --with-md5-passwords --with-pam && make && make install\n# 修改ssh配置文件，修改PermitRootLogin为yes UseDNS为no\nvi /etc/ssh/sshd_config\ncp -a contrib/redhat/sshd.init /etc/init.d/sshd\ncp -a contrib/redhat/sshd.pam /etc/pam.d/sshd.pam\nchmod +x /etc/init.d/sshd\nchkconfig --add sshd\nsystemctl enable sshd\n# 使用命令测试端口是否正常\nsystemctl stop sshd\nnetstat -lntp\nsystemctl start sshd\nnetstat -lntp\n```\n\n## 安装完成后续\n\n安装完成后`reboot`重启下机器，然后测试下ssh版本是否升级成功\n`ssh -V`，测试ok后关闭telnet服务\n\n```bash\nsystemctl disable xinetd.service\nsystemctl stop xinetd.service\nsystemctl disable telnet.socket\nsystemctl stop telnet.socket\n```\n","slug":"centos7-update-openssh","published":1,"updated":"2020-02-17T16:50:38.903Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox02000btof9yvl8ztrx","content":"<h2 id=\"当前状态\"><a class=\"header-anchor\" href=\"#当前状态\">¶</a>当前状态</h2>\n<p>查看openssh版本 <code>ssh -V</code>，查看openssl版本<code>openssl version</code>，记录当前版本号以便升级后做对比。</p>\n<h2 id=\"开启Telnet\"><a class=\"header-anchor\" href=\"#开启Telnet\">¶</a>开启Telnet</h2>\n<p>升级ssh的过程中可能导致ssh无法登录，所以最好先开着Telnet。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install xinetd telnet-server -y</span><br><span class=\"line\">systemctl <span class=\"hljs-built_in\">enable</span> xinetd.service</span><br><span class=\"line\">systemctl <span class=\"hljs-built_in\">enable</span> telnet.socket</span><br><span class=\"line\">systemctl start telnet.socket</span><br><span class=\"line\">systemctl start xinetd</span><br><span class=\"line\"><span class=\"hljs-comment\"># 允许root登录</span></span><br><span class=\"line\"><span class=\"hljs-built_in\">echo</span>  <span class=\"hljs-string\">'pts/0'</span>  &gt;&gt;/etc/securetty</span><br><span class=\"line\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'pts/1'</span> &gt;&gt;/etc/securetty</span><br><span class=\"line\">systemctl restart xinetd.service</span><br><span class=\"line\"><span class=\"hljs-comment\"># 防火墙添加过滤</span></span><br><span class=\"line\">firewall-cmd --add-service=telnet --zone=public --permanent</span><br><span class=\"line\"><span class=\"hljs-comment\"># 确认下telnet是否可以登录成功</span></span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h2 id=\"开始安装\"><a class=\"header-anchor\" href=\"#开始安装\">¶</a>开始安装</h2>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># 安装一些可能需要的库</span></span><br><span class=\"line\">yum install zlib-devel -y pam-devel tcp_wrappers-devel gcc</span><br><span class=\"line\"><span class=\"hljs-comment\"># 备份文件</span></span><br><span class=\"line\">mv /usr/bin/openssl /usr/bin/openssl.bak</span><br><span class=\"line\">mv /etc/ssh /etc/ssh.bak</span><br><span class=\"line\"><span class=\"hljs-comment\"># 在/opt目录下载</span></span><br><span class=\"line\"><span class=\"hljs-built_in\">cd</span> /opt</span><br><span class=\"line\"><span class=\"hljs-comment\"># openssl</span></span><br><span class=\"line\">wget https://www.openssl.org/<span class=\"hljs-built_in\">source</span>/openssl-1.0.2s.tar.gz</span><br><span class=\"line\">tar zxvf openssl-1.0.2s.tar.gz</span><br><span class=\"line\"><span class=\"hljs-comment\"># openssl-fips</span></span><br><span class=\"line\">wget https://www.openssl.org/<span class=\"hljs-built_in\">source</span>/openssl-fips-2.0.16.tar.gz</span><br><span class=\"line\">tar zxvf openssl-fips-2.0.16.tar.gz</span><br><span class=\"line\"><span class=\"hljs-comment\"># openssh</span></span><br><span class=\"line\">wget http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.0p1.tar.gz</span><br><span class=\"line\">tar zxvf openssh-8.0p1.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\"># 编译安装openssl-fips</span></span><br><span class=\"line\"><span class=\"hljs-built_in\">cd</span> ./openssl-fips-2.0.16/</span><br><span class=\"line\">./config &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\"># 编译安装openssl</span></span><br><span class=\"line\"><span class=\"hljs-built_in\">cd</span> ../openssl-1.0.2s/</span><br><span class=\"line\">./config fips shared -fPIC</span><br><span class=\"line\">make depend</span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\">ln -s /usr/<span class=\"hljs-built_in\">local</span>/ssl/bin/openssl /usr/bin/openssl</span><br><span class=\"line\">ln -s /usr/<span class=\"hljs-built_in\">local</span>/ssl/include/openssl /usr/include/openssl</span><br><span class=\"line\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"/usr/local/ssl/lib\"</span> &gt;&gt; /etc/ld.so.conf</span><br><span class=\"line\">/sbin/ldconfig</span><br><span class=\"line\"><span class=\"hljs-comment\"># 查看版本是否升级成功</span></span><br><span class=\"line\">openssl version</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\"># 编译安装openssh</span></span><br><span class=\"line\"><span class=\"hljs-built_in\">cd</span> ../openssh-8.0p1</span><br><span class=\"line\">./configure --prefix=/usr/ --sysconfdir=/etc/ssh  --with-openssl-includes=/usr/<span class=\"hljs-built_in\">local</span>/ssl/include --with-ssl-dir=/usr/<span class=\"hljs-built_in\">local</span>/ssl --with-zlib --with-md5-passwords --with-pam &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\"><span class=\"hljs-comment\"># 修改ssh配置文件，修改PermitRootLogin为yes UseDNS为no</span></span><br><span class=\"line\">vi /etc/ssh/sshd_config</span><br><span class=\"line\">cp -a contrib/redhat/sshd.init /etc/init.d/sshd</span><br><span class=\"line\">cp -a contrib/redhat/sshd.pam /etc/pam.d/sshd.pam</span><br><span class=\"line\">chmod +x /etc/init.d/sshd</span><br><span class=\"line\">chkconfig --add sshd</span><br><span class=\"line\">systemctl <span class=\"hljs-built_in\">enable</span> sshd</span><br><span class=\"line\"><span class=\"hljs-comment\"># 使用命令测试端口是否正常</span></span><br><span class=\"line\">systemctl stop sshd</span><br><span class=\"line\">netstat -lntp</span><br><span class=\"line\">systemctl start sshd</span><br><span class=\"line\">netstat -lntp</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装完成后续\"><a class=\"header-anchor\" href=\"#安装完成后续\">¶</a>安装完成后续</h2>\n<p>安装完成后<code>reboot</code>重启下机器，然后测试下ssh版本是否升级成功<br>\n<code>ssh -V</code>，测试ok后关闭telnet服务</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl <span class=\"hljs-built_in\">disable</span> xinetd.service</span><br><span class=\"line\">systemctl stop xinetd.service</span><br><span class=\"line\">systemctl <span class=\"hljs-built_in\">disable</span> telnet.socket</span><br><span class=\"line\">systemctl stop telnet.socket</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"当前状态\"><a class=\"header-anchor\" href=\"#当前状态\">¶</a>当前状态</h2>\n<p>查看openssh版本 <code>ssh -V</code>，查看openssl版本<code>openssl version</code>，记录当前版本号以便升级后做对比。</p>\n<h2 id=\"开启Telnet\"><a class=\"header-anchor\" href=\"#开启Telnet\">¶</a>开启Telnet</h2>\n<p>升级ssh的过程中可能导致ssh无法登录，所以最好先开着Telnet。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install xinetd telnet-server -y</span><br><span class=\"line\">systemctl <span class=\"hljs-built_in\">enable</span> xinetd.service</span><br><span class=\"line\">systemctl <span class=\"hljs-built_in\">enable</span> telnet.socket</span><br><span class=\"line\">systemctl start telnet.socket</span><br><span class=\"line\">systemctl start xinetd</span><br><span class=\"line\"><span class=\"hljs-comment\"># 允许root登录</span></span><br><span class=\"line\"><span class=\"hljs-built_in\">echo</span>  <span class=\"hljs-string\">'pts/0'</span>  &gt;&gt;/etc/securetty</span><br><span class=\"line\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'pts/1'</span> &gt;&gt;/etc/securetty</span><br><span class=\"line\">systemctl restart xinetd.service</span><br><span class=\"line\"><span class=\"hljs-comment\"># 防火墙添加过滤</span></span><br><span class=\"line\">firewall-cmd --add-service=telnet --zone=public --permanent</span><br><span class=\"line\"><span class=\"hljs-comment\"># 确认下telnet是否可以登录成功</span></span><br></pre></td></tr></table></figure>","more":"<h2 id=\"开始安装\"><a class=\"header-anchor\" href=\"#开始安装\">¶</a>开始安装</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装一些可能需要的库</span></span><br><span class=\"line\">yum install zlib-devel -y pam-devel tcp_wrappers-devel gcc</span><br><span class=\"line\"><span class=\"comment\"># 备份文件</span></span><br><span class=\"line\">mv /usr/bin/openssl /usr/bin/openssl.bak</span><br><span class=\"line\">mv /etc/ssh /etc/ssh.bak</span><br><span class=\"line\"><span class=\"comment\"># 在/opt目录下载</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /opt</span><br><span class=\"line\"><span class=\"comment\"># openssl</span></span><br><span class=\"line\">wget https://www.openssl.org/<span class=\"built_in\">source</span>/openssl-1.0.2s.tar.gz</span><br><span class=\"line\">tar zxvf openssl-1.0.2s.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># openssl-fips</span></span><br><span class=\"line\">wget https://www.openssl.org/<span class=\"built_in\">source</span>/openssl-fips-2.0.16.tar.gz</span><br><span class=\"line\">tar zxvf openssl-fips-2.0.16.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># openssh</span></span><br><span class=\"line\">wget http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.0p1.tar.gz</span><br><span class=\"line\">tar zxvf openssh-8.0p1.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译安装openssl-fips</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ./openssl-fips-2.0.16/</span><br><span class=\"line\">./config &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译安装openssl</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../openssl-1.0.2s/</span><br><span class=\"line\">./config fips shared -fPIC</span><br><span class=\"line\">make depend</span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\">ln -s /usr/<span class=\"built_in\">local</span>/ssl/bin/openssl /usr/bin/openssl</span><br><span class=\"line\">ln -s /usr/<span class=\"built_in\">local</span>/ssl/include/openssl /usr/include/openssl</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"/usr/local/ssl/lib\"</span> &gt;&gt; /etc/ld.so.conf</span><br><span class=\"line\">/sbin/ldconfig</span><br><span class=\"line\"><span class=\"comment\"># 查看版本是否升级成功</span></span><br><span class=\"line\">openssl version</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译安装openssh</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../openssh-8.0p1</span><br><span class=\"line\">./configure --prefix=/usr/ --sysconfdir=/etc/ssh  --with-openssl-includes=/usr/<span class=\"built_in\">local</span>/ssl/include --with-ssl-dir=/usr/<span class=\"built_in\">local</span>/ssl --with-zlib --with-md5-passwords --with-pam &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\"><span class=\"comment\"># 修改ssh配置文件，修改PermitRootLogin为yes UseDNS为no</span></span><br><span class=\"line\">vi /etc/ssh/sshd_config</span><br><span class=\"line\">cp -a contrib/redhat/sshd.init /etc/init.d/sshd</span><br><span class=\"line\">cp -a contrib/redhat/sshd.pam /etc/pam.d/sshd.pam</span><br><span class=\"line\">chmod +x /etc/init.d/sshd</span><br><span class=\"line\">chkconfig --add sshd</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> sshd</span><br><span class=\"line\"><span class=\"comment\"># 使用命令测试端口是否正常</span></span><br><span class=\"line\">systemctl stop sshd</span><br><span class=\"line\">netstat -lntp</span><br><span class=\"line\">systemctl start sshd</span><br><span class=\"line\">netstat -lntp</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装完成后续\"><a class=\"header-anchor\" href=\"#安装完成后续\">¶</a>安装完成后续</h2>\n<p>安装完成后<code>reboot</code>重启下机器，然后测试下ssh版本是否升级成功<br>\n<code>ssh -V</code>，测试ok后关闭telnet服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl <span class=\"built_in\">disable</span> xinetd.service</span><br><span class=\"line\">systemctl stop xinetd.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> telnet.socket</span><br><span class=\"line\">systemctl stop telnet.socket</span><br></pre></td></tr></table></figure>"},{"title":"Ghost中添加评论系统","s":"comment-in-ghost","date":"2015-07-23T16:19:00.000Z","_content":"Ghost系统默认是没有评论系统的，虽然官方也在关注这个问题，不过短时间内应该是不会有所进展，所以现在如果要在Ghost中使用评论，还是先使用第三方服务吧。下面介绍几种常见的评论系统，如果有更好的，欢迎来补充。\n<!-- more -->\n1. [Disqus](https://disqus.com/) 一个国外的评论系统。首先注册一个账号，这个不多介绍，记得激活邮箱。进去后点击头像旁边的设置下拉里面的\"Add Disqus To Site\",\n  ![Disqus](/images/ghost/disqus.png)\n  然后在弹出的页面中根据情况设置属性，\n  ![Disqus profile](/images/ghost/disqus-profile.png)\n  完成后会跳到安装页面，在这里我们选择“Universal Code”，\n  ![Disqus code selection](/images/ghost/disqus-code-selection.png)\n  最后我们复制页面中的脚本插入到Ghost的主题文件中，位置是`/content/themes/[casper]/post.hbs`文件的`</article>`结束标签之前。\n  ```html\n  <article>\n    ...\n    <div id=\"disqus_thread\"></div>\n    <script type=\"text/javascript\">\n    /* * * CONFIGURATION VARIABLES * * */\n    /* * * 请将此处改为你自己的 * * */\n    var disqus_shortname = 'erguotou';\n\n    /* * * DON'T EDIT BELOW THIS LINE * * */\n    (function() {\n    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;\n    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';\n    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);\n    })();\n    </script>\n    <noscript>Please enable JavaScript to view the <a href=\"https://disqus.com/?ref_noscript\" rel=\"nofollow\">comments powered by Disqus.</a></noscript>\n  </article>\n  ```\n  到这里应该说基本是完成了，你已经可以在文章页面中看到Disqus的内容了，页面下面还有个统计评论数量的，这里不做介绍了。到这里基本上已经成功地使用上了Disqus，但是我们是不是可以做一点设置，让它更本地化，样式更好看呢？答案肯定是可以的，在Disqus的设置页面(Settings)中有很多设置，其中General选项卡中有一个`Language`，你可以选择`Chinese`，这样你的Disqus就是中文的了，这里还有很多其它设置，请自行研究。另外目前Disqus无法修改样式，虽然可以[微调](https://help.disqus.com/customer/portal/articles/545277-disqus-appearance-tweaks)，然而并没有乱用啊。\n2. [多说](http://duoshuo.com/) 一个国内的评论系统。同样是先登录，然后点击“我要安装”，根据自己情况填写，\n  ![Duoshuo](/images/ghost/duoshuo.png)然后选择通用代码－稳定版进行复制，同样插入到`post.hbs`文件的`</article>`结束标签之前。复制后我们需要对复制的代码进行一些修改，我们将第一行修改为\n  ```html\n  <div class=\"ds-thread\" data-thread-key=\"{{id}}\" data-title=\"{{title}}\" data-url=\"{{url absolute=\"true\"}}\"></div>\n  ```\n  这样就完成来多说的安装，在多说的设置中有很多是我们可以调节的，多说支持自定义CSS，这样我们就可以将多说的评论框调成我们自己喜欢的样子，这部分请自行研究，这里不做过多介绍，我这个博客用的就是多说评论，自己简单的改了点样式。\n3. [友言](http://www.uyan.cc/getcode)以及[畅言](http://changyan.kuaizhan.com/)等其它的第三方社会化评论系统都有类似的功能，安装方式大抵相同，欢迎大家自己研究，给出更多教程。\n\n另外关于各个评论的比较，大家可以看下[这篇文章](http://changyan.sohu.com/blog/?p=126)，不过个人觉得畅言的样式更符合ghost一些。\n","source":"_posts/comment-in-ghost.md","raw":"---\ntitle: Ghost中添加评论系统\ns: comment-in-ghost\ndate: 2015-07-24 00:19:00\ntags:\n  - Ghost\n---\nGhost系统默认是没有评论系统的，虽然官方也在关注这个问题，不过短时间内应该是不会有所进展，所以现在如果要在Ghost中使用评论，还是先使用第三方服务吧。下面介绍几种常见的评论系统，如果有更好的，欢迎来补充。\n<!-- more -->\n1. [Disqus](https://disqus.com/) 一个国外的评论系统。首先注册一个账号，这个不多介绍，记得激活邮箱。进去后点击头像旁边的设置下拉里面的\"Add Disqus To Site\",\n  ![Disqus](/images/ghost/disqus.png)\n  然后在弹出的页面中根据情况设置属性，\n  ![Disqus profile](/images/ghost/disqus-profile.png)\n  完成后会跳到安装页面，在这里我们选择“Universal Code”，\n  ![Disqus code selection](/images/ghost/disqus-code-selection.png)\n  最后我们复制页面中的脚本插入到Ghost的主题文件中，位置是`/content/themes/[casper]/post.hbs`文件的`</article>`结束标签之前。\n  ```html\n  <article>\n    ...\n    <div id=\"disqus_thread\"></div>\n    <script type=\"text/javascript\">\n    /* * * CONFIGURATION VARIABLES * * */\n    /* * * 请将此处改为你自己的 * * */\n    var disqus_shortname = 'erguotou';\n\n    /* * * DON'T EDIT BELOW THIS LINE * * */\n    (function() {\n    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;\n    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';\n    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);\n    })();\n    </script>\n    <noscript>Please enable JavaScript to view the <a href=\"https://disqus.com/?ref_noscript\" rel=\"nofollow\">comments powered by Disqus.</a></noscript>\n  </article>\n  ```\n  到这里应该说基本是完成了，你已经可以在文章页面中看到Disqus的内容了，页面下面还有个统计评论数量的，这里不做介绍了。到这里基本上已经成功地使用上了Disqus，但是我们是不是可以做一点设置，让它更本地化，样式更好看呢？答案肯定是可以的，在Disqus的设置页面(Settings)中有很多设置，其中General选项卡中有一个`Language`，你可以选择`Chinese`，这样你的Disqus就是中文的了，这里还有很多其它设置，请自行研究。另外目前Disqus无法修改样式，虽然可以[微调](https://help.disqus.com/customer/portal/articles/545277-disqus-appearance-tweaks)，然而并没有乱用啊。\n2. [多说](http://duoshuo.com/) 一个国内的评论系统。同样是先登录，然后点击“我要安装”，根据自己情况填写，\n  ![Duoshuo](/images/ghost/duoshuo.png)然后选择通用代码－稳定版进行复制，同样插入到`post.hbs`文件的`</article>`结束标签之前。复制后我们需要对复制的代码进行一些修改，我们将第一行修改为\n  ```html\n  <div class=\"ds-thread\" data-thread-key=\"{{id}}\" data-title=\"{{title}}\" data-url=\"{{url absolute=\"true\"}}\"></div>\n  ```\n  这样就完成来多说的安装，在多说的设置中有很多是我们可以调节的，多说支持自定义CSS，这样我们就可以将多说的评论框调成我们自己喜欢的样子，这部分请自行研究，这里不做过多介绍，我这个博客用的就是多说评论，自己简单的改了点样式。\n3. [友言](http://www.uyan.cc/getcode)以及[畅言](http://changyan.kuaizhan.com/)等其它的第三方社会化评论系统都有类似的功能，安装方式大抵相同，欢迎大家自己研究，给出更多教程。\n\n另外关于各个评论的比较，大家可以看下[这篇文章](http://changyan.sohu.com/blog/?p=126)，不过个人觉得畅言的样式更符合ghost一些。\n","slug":"comment-in-ghost","published":1,"updated":"2019-03-26T13:47:04.872Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox03000ctof9ubouq55y","content":"<p>Ghost系统默认是没有评论系统的，虽然官方也在关注这个问题，不过短时间内应该是不会有所进展，所以现在如果要在Ghost中使用评论，还是先使用第三方服务吧。下面介绍几种常见的评论系统，如果有更好的，欢迎来补充。</p>\n<a id=\"more\"></a>\n<ol>\n<li><a href=\"https://disqus.com/\">Disqus</a> 一个国外的评论系统。首先注册一个账号，这个不多介绍，记得激活邮箱。进去后点击头像旁边的设置下拉里面的&quot;Add Disqus To Site&quot;,<br>\n<img src=\"/images/ghost/disqus.png\" alt=\"Disqus\"><br>\n然后在弹出的页面中根据情况设置属性，<br>\n<img src=\"/images/ghost/disqus-profile.png\" alt=\"Disqus profile\"><br>\n完成后会跳到安装页面，在这里我们选择“Universal Code”，<br>\n<img src=\"/images/ghost/disqus-code-selection.png\" alt=\"Disqus code selection\"><br>\n最后我们复制页面中的脚本插入到Ghost的主题文件中，位置是<code>/content/themes/[casper]/post.hbs</code>文件的<code>&lt;/article&gt;</code>结束标签之前。</li>\n</ol>\n  <figure class=\"highlight html hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">article</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"disqus_thread\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"hljs-actionscript\">  <span class=\"hljs-comment\">/* * * CONFIGURATION VARIABLES * * */</span></span></span><br><span class=\"line\"><span class=\"hljs-actionscript\">  <span class=\"hljs-comment\">/* * * 请将此处改为你自己的 * * */</span></span></span><br><span class=\"line\"><span class=\"hljs-actionscript\">  <span class=\"hljs-keyword\">var</span> disqus_shortname = <span class=\"hljs-string\">'erguotou'</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-actionscript\">  <span class=\"hljs-comment\">/* * * DON'T EDIT BELOW THIS LINE * * */</span></span></span><br><span class=\"line\"><span class=\"hljs-actionscript\">  (<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"hljs-javascript\">  <span class=\"hljs-keyword\">var</span> dsq = <span class=\"hljs-built_in\">document</span>.createElement(<span class=\"hljs-string\">'script'</span>); dsq.type = <span class=\"hljs-string\">'text/javascript'</span>; dsq.async = <span class=\"hljs-literal\">true</span>;</span></span><br><span class=\"line\"><span class=\"hljs-actionscript\">  dsq.src = <span class=\"hljs-string\">'//'</span> + disqus_shortname + <span class=\"hljs-string\">'.disqus.com/embed.js'</span>;</span></span><br><span class=\"line\"><span class=\"hljs-javascript\">  (<span class=\"hljs-built_in\">document</span>.getElementsByTagName(<span class=\"hljs-string\">'head'</span>)[<span class=\"hljs-number\">0</span>] || <span class=\"hljs-built_in\">document</span>.getElementsByTagName(<span class=\"hljs-string\">'body'</span>)[<span class=\"hljs-number\">0</span>]).appendChild(dsq);</span></span><br><span class=\"line\">  &#125;)();</span><br><span class=\"line\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">noscript</span>&gt;</span>Please enable JavaScript to view the <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"https://disqus.com/?ref_noscript\"</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"nofollow\"</span>&gt;</span>comments powered by Disqus.<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">noscript</span>&gt;</span></span><br><span class=\"line\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>到这里应该说基本是完成了，你已经可以在文章页面中看到Disqus的内容了，页面下面还有个统计评论数量的，这里不做介绍了。到这里基本上已经成功地使用上了Disqus，但是我们是不是可以做一点设置，让它更本地化，样式更好看呢？答案肯定是可以的，在Disqus的设置页面(Settings)中有很多设置，其中General选项卡中有一个<code>Language</code>，你可以选择<code>Chinese</code>，这样你的Disqus就是中文的了，这里还有很多其它设置，请自行研究。另外目前Disqus无法修改样式，虽然可以<a href=\"https://help.disqus.com/customer/portal/articles/545277-disqus-appearance-tweaks\">微调</a>，然而并没有乱用啊。<br>\n2. <a href=\"http://duoshuo.com/\">多说</a> 一个国内的评论系统。同样是先登录，然后点击“我要安装”，根据自己情况填写，<br>\n<img src=\"/images/ghost/duoshuo.png\" alt=\"Duoshuo\">然后选择通用代码－稳定版进行复制，同样插入到<code>post.hbs</code>文件的<code>&lt;/article&gt;</code>结束标签之前。复制后我们需要对复制的代码进行一些修改，我们将第一行修改为</p>\n  <figure class=\"highlight html hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"ds-thread\"</span> <span class=\"hljs-attr\">data-thread-key</span>=<span class=\"hljs-string\">\"&#123;&#123;id&#125;&#125;\"</span> <span class=\"hljs-attr\">data-title</span>=<span class=\"hljs-string\">\"&#123;&#123;title&#125;&#125;\"</span> <span class=\"hljs-attr\">data-url</span>=<span class=\"hljs-string\">\"&#123;&#123;url absolute=\"</span><span class=\"hljs-attr\">true</span>\"&#125;&#125;\"&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这样就完成来多说的安装，在多说的设置中有很多是我们可以调节的，多说支持自定义CSS，这样我们就可以将多说的评论框调成我们自己喜欢的样子，这部分请自行研究，这里不做过多介绍，我这个博客用的就是多说评论，自己简单的改了点样式。<br>\n3. <a href=\"http://www.uyan.cc/getcode\">友言</a>以及<a href=\"http://changyan.kuaizhan.com/\">畅言</a>等其它的第三方社会化评论系统都有类似的功能，安装方式大抵相同，欢迎大家自己研究，给出更多教程。</p>\n<p>另外关于各个评论的比较，大家可以看下<a href=\"http://changyan.sohu.com/blog/?p=126\">这篇文章</a>，不过个人觉得畅言的样式更符合ghost一些。</p>\n","site":{"data":{}},"excerpt":"<p>Ghost系统默认是没有评论系统的，虽然官方也在关注这个问题，不过短时间内应该是不会有所进展，所以现在如果要在Ghost中使用评论，还是先使用第三方服务吧。下面介绍几种常见的评论系统，如果有更好的，欢迎来补充。</p>","more":"<ol>\n<li><a href=\"https://disqus.com/\">Disqus</a> 一个国外的评论系统。首先注册一个账号，这个不多介绍，记得激活邮箱。进去后点击头像旁边的设置下拉里面的&quot;Add Disqus To Site&quot;,<br>\n<img src=\"/images/ghost/disqus.png\" alt=\"Disqus\"><br>\n然后在弹出的页面中根据情况设置属性，<br>\n<img src=\"/images/ghost/disqus-profile.png\" alt=\"Disqus profile\"><br>\n完成后会跳到安装页面，在这里我们选择“Universal Code”，<br>\n<img src=\"/images/ghost/disqus-code-selection.png\" alt=\"Disqus code selection\"><br>\n最后我们复制页面中的脚本插入到Ghost的主题文件中，位置是<code>/content/themes/[casper]/post.hbs</code>文件的<code>&lt;/article&gt;</code>结束标签之前。</li>\n</ol>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"disqus_thread\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"actionscript\">  <span class=\"comment\">/* * * CONFIGURATION VARIABLES * * */</span></span></span><br><span class=\"line\"><span class=\"actionscript\">  <span class=\"comment\">/* * * 请将此处改为你自己的 * * */</span></span></span><br><span class=\"line\"><span class=\"actionscript\">  <span class=\"keyword\">var</span> disqus_shortname = <span class=\"string\">'erguotou'</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"actionscript\">  <span class=\"comment\">/* * * DON'T EDIT BELOW THIS LINE * * */</span></span></span><br><span class=\"line\"><span class=\"actionscript\">  (<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">var</span> dsq = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'script'</span>); dsq.type = <span class=\"string\">'text/javascript'</span>; dsq.async = <span class=\"literal\">true</span>;</span></span><br><span class=\"line\"><span class=\"actionscript\">  dsq.src = <span class=\"string\">'//'</span> + disqus_shortname + <span class=\"string\">'.disqus.com/embed.js'</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">  (<span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'head'</span>)[<span class=\"number\">0</span>] || <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'body'</span>)[<span class=\"number\">0</span>]).appendChild(dsq);</span></span><br><span class=\"line\">  &#125;)();</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">noscript</span>&gt;</span>Please enable JavaScript to view the <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://disqus.com/?ref_noscript\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"nofollow\"</span>&gt;</span>comments powered by Disqus.<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">noscript</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>到这里应该说基本是完成了，你已经可以在文章页面中看到Disqus的内容了，页面下面还有个统计评论数量的，这里不做介绍了。到这里基本上已经成功地使用上了Disqus，但是我们是不是可以做一点设置，让它更本地化，样式更好看呢？答案肯定是可以的，在Disqus的设置页面(Settings)中有很多设置，其中General选项卡中有一个<code>Language</code>，你可以选择<code>Chinese</code>，这样你的Disqus就是中文的了，这里还有很多其它设置，请自行研究。另外目前Disqus无法修改样式，虽然可以<a href=\"https://help.disqus.com/customer/portal/articles/545277-disqus-appearance-tweaks\">微调</a>，然而并没有乱用啊。<br>\n2. <a href=\"http://duoshuo.com/\">多说</a> 一个国内的评论系统。同样是先登录，然后点击“我要安装”，根据自己情况填写，<br>\n<img src=\"/images/ghost/duoshuo.png\" alt=\"Duoshuo\">然后选择通用代码－稳定版进行复制，同样插入到<code>post.hbs</code>文件的<code>&lt;/article&gt;</code>结束标签之前。复制后我们需要对复制的代码进行一些修改，我们将第一行修改为</p>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ds-thread\"</span> <span class=\"attr\">data-thread-key</span>=<span class=\"string\">\"&#123;&#123;id&#125;&#125;\"</span> <span class=\"attr\">data-title</span>=<span class=\"string\">\"&#123;&#123;title&#125;&#125;\"</span> <span class=\"attr\">data-url</span>=<span class=\"string\">\"&#123;&#123;url absolute=\"</span><span class=\"attr\">true</span>\"&#125;&#125;\"&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这样就完成来多说的安装，在多说的设置中有很多是我们可以调节的，多说支持自定义CSS，这样我们就可以将多说的评论框调成我们自己喜欢的样子，这部分请自行研究，这里不做过多介绍，我这个博客用的就是多说评论，自己简单的改了点样式。<br>\n3. <a href=\"http://www.uyan.cc/getcode\">友言</a>以及<a href=\"http://changyan.kuaizhan.com/\">畅言</a>等其它的第三方社会化评论系统都有类似的功能，安装方式大抵相同，欢迎大家自己研究，给出更多教程。</p>\n<p>另外关于各个评论的比较，大家可以看下<a href=\"http://changyan.sohu.com/blog/?p=126\">这篇文章</a>，不过个人觉得畅言的样式更符合ghost一些。</p>"},{"title":"工作中遇到的cookie知识整理","s":"cookie-tidy","date":"2017-12-06T03:05:00.000Z","thumbnail":"/images/js/cookie.png","_content":"本文主要记录在工作中遇到的cookie知识的一些整理，这些零散的细节的知识点在没遇到的时候是模棱两可，遇到的时候又不是很深入地了解，所以还要查资料，写demo来反复验证。所以这里把这次关于`cookie`的知识记录下以便后续查看。\n\n在介绍结果之前先阐述个基本知识：`同源`，即相同协议、相同域名、相同端口。浏览器对于跨域访问有一些限制，但是对于`cookie`的限制稍微有些不同。\n<!-- more -->\n\n在实验中我们**不讨论设置`cookie`的`domain`域**，只考虑设置`path`字段，有如下结论：\n\n- 同源情况下共享`cookie`，没毛病\n- 不同协议、同域名、同端口在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，注意这里的默认`path`是`/`，此时http和https是可以共享的\n- 同协议、同域名、不同端口在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，此时跨端口是可以共享的\n- 不同协议、同域名、不同端口在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，此时跨端口是可以共享的\n- 同协议、同域名、同端口、不同子目录的情况下在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，即`http://xxx.xx:port/abc`和`http://xxx.xx:port/def`是共享`cookie`的\n- 同协议、同域名、同端口、不同子目录的情况下在设置`path`为子目录的情况下不同的子目录是不共享`cookie`的，即`path=/abc`时`http://xxx.xx:port/abc`和`http://xxx.xx:port/def`不共享\n- 同协议、同域名、不同端口、不同子目录的情况下在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，即`http://xxx.xx:port1/abc`和`http://xxx.xx:port2/def`是共享`cookie`的\n- 同协议、不同二级域名在不修改`domain`的情况下是不共享`cookie`的，即`https://super.domain.com`与`https://sub.domain.com`是不共享`cookie`的\n\n因此可以得出：\n> 不管使用哪个协议（HTTP/HTTPS）或端口号，浏览器都允许给定的域以及其任何子域名(sub-domains)来访问cookie。\n但跨二级域名是不共享`cookie`的。\n\n## 测试文件\n[测试参考](https://gist.github.com/erguotou520/97aab008e765d80c772e5717ad01c1c1)\n\n## 相关文章\n- [RFC 6265](https://tools.ietf.org/html/rfc6265)\n- [浏览器的同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)\n- [浏览器同源政策及其规避方法](http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html)（文章中关于cookie限制这块有误）\n","source":"_posts/cookie-tidy.md","raw":"---\ntitle: 工作中遇到的cookie知识整理\ns: cookie-tidy\ndate: 2017-12-06 11:05:00\nthumbnail: /images/js/cookie.png\ntags:\n  - Cookie\n---\n本文主要记录在工作中遇到的cookie知识的一些整理，这些零散的细节的知识点在没遇到的时候是模棱两可，遇到的时候又不是很深入地了解，所以还要查资料，写demo来反复验证。所以这里把这次关于`cookie`的知识记录下以便后续查看。\n\n在介绍结果之前先阐述个基本知识：`同源`，即相同协议、相同域名、相同端口。浏览器对于跨域访问有一些限制，但是对于`cookie`的限制稍微有些不同。\n<!-- more -->\n\n在实验中我们**不讨论设置`cookie`的`domain`域**，只考虑设置`path`字段，有如下结论：\n\n- 同源情况下共享`cookie`，没毛病\n- 不同协议、同域名、同端口在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，注意这里的默认`path`是`/`，此时http和https是可以共享的\n- 同协议、同域名、不同端口在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，此时跨端口是可以共享的\n- 不同协议、同域名、不同端口在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，此时跨端口是可以共享的\n- 同协议、同域名、同端口、不同子目录的情况下在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，即`http://xxx.xx:port/abc`和`http://xxx.xx:port/def`是共享`cookie`的\n- 同协议、同域名、同端口、不同子目录的情况下在设置`path`为子目录的情况下不同的子目录是不共享`cookie`的，即`path=/abc`时`http://xxx.xx:port/abc`和`http://xxx.xx:port/def`不共享\n- 同协议、同域名、不同端口、不同子目录的情况下在不设置`path`或使用默认的`path=/`的情况下是共享`cookie`的，即`http://xxx.xx:port1/abc`和`http://xxx.xx:port2/def`是共享`cookie`的\n- 同协议、不同二级域名在不修改`domain`的情况下是不共享`cookie`的，即`https://super.domain.com`与`https://sub.domain.com`是不共享`cookie`的\n\n因此可以得出：\n> 不管使用哪个协议（HTTP/HTTPS）或端口号，浏览器都允许给定的域以及其任何子域名(sub-domains)来访问cookie。\n但跨二级域名是不共享`cookie`的。\n\n## 测试文件\n[测试参考](https://gist.github.com/erguotou520/97aab008e765d80c772e5717ad01c1c1)\n\n## 相关文章\n- [RFC 6265](https://tools.ietf.org/html/rfc6265)\n- [浏览器的同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)\n- [浏览器同源政策及其规避方法](http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html)（文章中关于cookie限制这块有误）\n","slug":"cookie-tidy","published":1,"updated":"2019-03-26T13:47:04.873Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox04000etof9r3pub83l","content":"<p>本文主要记录在工作中遇到的cookie知识的一些整理，这些零散的细节的知识点在没遇到的时候是模棱两可，遇到的时候又不是很深入地了解，所以还要查资料，写demo来反复验证。所以这里把这次关于<code>cookie</code>的知识记录下以便后续查看。</p>\n<p>在介绍结果之前先阐述个基本知识：<code>同源</code>，即相同协议、相同域名、相同端口。浏览器对于跨域访问有一些限制，但是对于<code>cookie</code>的限制稍微有些不同。</p>\n<a id=\"more\"></a>\n<p>在实验中我们<strong>不讨论设置<code>cookie</code>的<code>domain</code>域</strong>，只考虑设置<code>path</code>字段，有如下结论：</p>\n<ul>\n<li>同源情况下共享<code>cookie</code>，没毛病</li>\n<li>不同协议、同域名、同端口在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，注意这里的默认<code>path</code>是<code>/</code>，此时http和https是可以共享的</li>\n<li>同协议、同域名、不同端口在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，此时跨端口是可以共享的</li>\n<li>不同协议、同域名、不同端口在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，此时跨端口是可以共享的</li>\n<li>同协议、同域名、同端口、不同子目录的情况下在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，即<code>http://xxx.xx:port/abc</code>和<code>http://xxx.xx:port/def</code>是共享<code>cookie</code>的</li>\n<li>同协议、同域名、同端口、不同子目录的情况下在设置<code>path</code>为子目录的情况下不同的子目录是不共享<code>cookie</code>的，即<code>path=/abc</code>时<code>http://xxx.xx:port/abc</code>和<code>http://xxx.xx:port/def</code>不共享</li>\n<li>同协议、同域名、不同端口、不同子目录的情况下在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，即<code>http://xxx.xx:port1/abc</code>和<code>http://xxx.xx:port2/def</code>是共享<code>cookie</code>的</li>\n<li>同协议、不同二级域名在不修改<code>domain</code>的情况下是不共享<code>cookie</code>的，即<code>https://super.domain.com</code>与<code>https://sub.domain.com</code>是不共享<code>cookie</code>的</li>\n</ul>\n<p>因此可以得出：</p>\n<blockquote>\n<p>不管使用哪个协议（HTTP/HTTPS）或端口号，浏览器都允许给定的域以及其任何子域名(sub-domains)来访问cookie。<br>\n但跨二级域名是不共享<code>cookie</code>的。</p>\n</blockquote>\n<h2 id=\"测试文件\"><a class=\"header-anchor\" href=\"#测试文件\">¶</a>测试文件</h2>\n<p><a href=\"https://gist.github.com/erguotou520/97aab008e765d80c772e5717ad01c1c1\">测试参考</a></p>\n<h2 id=\"相关文章\"><a class=\"header-anchor\" href=\"#相关文章\">¶</a>相关文章</h2>\n<ul>\n<li><a href=\"https://tools.ietf.org/html/rfc6265\">RFC 6265</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy\">浏览器的同源策略</a></li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html\">浏览器同源政策及其规避方法</a>（文章中关于cookie限制这块有误）</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>本文主要记录在工作中遇到的cookie知识的一些整理，这些零散的细节的知识点在没遇到的时候是模棱两可，遇到的时候又不是很深入地了解，所以还要查资料，写demo来反复验证。所以这里把这次关于<code>cookie</code>的知识记录下以便后续查看。</p>\n<p>在介绍结果之前先阐述个基本知识：<code>同源</code>，即相同协议、相同域名、相同端口。浏览器对于跨域访问有一些限制，但是对于<code>cookie</code>的限制稍微有些不同。</p>","more":"<p>在实验中我们<strong>不讨论设置<code>cookie</code>的<code>domain</code>域</strong>，只考虑设置<code>path</code>字段，有如下结论：</p>\n<ul>\n<li>同源情况下共享<code>cookie</code>，没毛病</li>\n<li>不同协议、同域名、同端口在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，注意这里的默认<code>path</code>是<code>/</code>，此时http和https是可以共享的</li>\n<li>同协议、同域名、不同端口在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，此时跨端口是可以共享的</li>\n<li>不同协议、同域名、不同端口在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，此时跨端口是可以共享的</li>\n<li>同协议、同域名、同端口、不同子目录的情况下在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，即<code>http://xxx.xx:port/abc</code>和<code>http://xxx.xx:port/def</code>是共享<code>cookie</code>的</li>\n<li>同协议、同域名、同端口、不同子目录的情况下在设置<code>path</code>为子目录的情况下不同的子目录是不共享<code>cookie</code>的，即<code>path=/abc</code>时<code>http://xxx.xx:port/abc</code>和<code>http://xxx.xx:port/def</code>不共享</li>\n<li>同协议、同域名、不同端口、不同子目录的情况下在不设置<code>path</code>或使用默认的<code>path=/</code>的情况下是共享<code>cookie</code>的，即<code>http://xxx.xx:port1/abc</code>和<code>http://xxx.xx:port2/def</code>是共享<code>cookie</code>的</li>\n<li>同协议、不同二级域名在不修改<code>domain</code>的情况下是不共享<code>cookie</code>的，即<code>https://super.domain.com</code>与<code>https://sub.domain.com</code>是不共享<code>cookie</code>的</li>\n</ul>\n<p>因此可以得出：</p>\n<blockquote>\n<p>不管使用哪个协议（HTTP/HTTPS）或端口号，浏览器都允许给定的域以及其任何子域名(sub-domains)来访问cookie。<br>\n但跨二级域名是不共享<code>cookie</code>的。</p>\n</blockquote>\n<h2 id=\"测试文件\"><a class=\"header-anchor\" href=\"#测试文件\">¶</a>测试文件</h2>\n<p><a href=\"https://gist.github.com/erguotou520/97aab008e765d80c772e5717ad01c1c1\">测试参考</a></p>\n<h2 id=\"相关文章\"><a class=\"header-anchor\" href=\"#相关文章\">¶</a>相关文章</h2>\n<ul>\n<li><a href=\"https://tools.ietf.org/html/rfc6265\">RFC 6265</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy\">浏览器的同源策略</a></li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html\">浏览器同源政策及其规避方法</a>（文章中关于cookie限制这块有误）</li>\n</ul>"},{"title":"Windows下调试平板设备","s":"debug-pad","date":"2016-08-31T05:56:00.000Z","thumbnail":"/images/others/debug.png","_content":"\n本文主要记录Android上的Chrome和IOS上的Safari浏览器的调试方法，方便以后查看。开始之前请自备梯子，下面会需要翻墙。\n<!-- more -->\n## Android设备调试\n借助于Chrome的inspect工具，我们可以调试Android中使用了WebView的应用，所以调试Chrome网页也是同样的道理。\n1. 安装ADB和驱动。网上有很多这方面的文章介绍，但是鉴于很多时候会出现各种问题，所以建议使用一键工具统一安装，[下载地址，需翻墙](http://forum.xda-developers.com/showthread.php?p=48915118#post48915118)。\n安装时一路`Y`确认安装，结束后你的系统中就已经有了ADB环境和Android驱动。\n2. USB连接上平板设备，并勾选平板设置里面的`USB调试`(一般在开发者选项里，如果没有开发者选项点击关于并连续点击版本号)，如果平板弹出调试授权窗口，勾选一律允许然后点击确定。\n3. 打开命令行输入`adb devices`，此时应该能获取到设备ID，如果没有请上网查找解决方案。\n![](/images/others/adb-devices.png)\n4. 平板上打开Chrome并输入网址，打开后在PC的Chrome上输入`chrome://inspect/#devices`，此时可以查看到已连接的平板上打开的网址，点击对应网址下的`inspect`，此时就会弹出一个调试窗口，这时候你就可以像调试WEB页面一样愉快地调试Android网页了。\n![](/images/others/chrome-inspect.png)\n\n## IOS设备的调试\nIOS上Safari浏览器的调试就比较简单，连接上设备和Mac，打开Mac上的Safari，勾选Safari的偏好设置里高级菜单下的“在菜单栏显示\"开发\"菜单”。\n![](/images/others/safari-develop.png)\n然后点击PC Safari的\"开发\"->\"XXX的Mac\"下的具体网址，此时就可以在弹出的窗口中进行调试了。\n![](/images/others/safari-devices.png)\n\n## 其它环境的调试\n至于其它不能调试的情况，都可以使用weinre等方案进行调试，具体请Google之。\n","source":"_posts/debug-pad.md","raw":"---\ntitle: Windows下调试平板设备\ns: debug-pad\ndate: 2016-08-31 13:56:00\n# thumbnail: /images/others/chrome-inspect.png\nthumbnail: /images/others/debug.png\ntags:\n  - Debug\n---\n\n本文主要记录Android上的Chrome和IOS上的Safari浏览器的调试方法，方便以后查看。开始之前请自备梯子，下面会需要翻墙。\n<!-- more -->\n## Android设备调试\n借助于Chrome的inspect工具，我们可以调试Android中使用了WebView的应用，所以调试Chrome网页也是同样的道理。\n1. 安装ADB和驱动。网上有很多这方面的文章介绍，但是鉴于很多时候会出现各种问题，所以建议使用一键工具统一安装，[下载地址，需翻墙](http://forum.xda-developers.com/showthread.php?p=48915118#post48915118)。\n安装时一路`Y`确认安装，结束后你的系统中就已经有了ADB环境和Android驱动。\n2. USB连接上平板设备，并勾选平板设置里面的`USB调试`(一般在开发者选项里，如果没有开发者选项点击关于并连续点击版本号)，如果平板弹出调试授权窗口，勾选一律允许然后点击确定。\n3. 打开命令行输入`adb devices`，此时应该能获取到设备ID，如果没有请上网查找解决方案。\n![](/images/others/adb-devices.png)\n4. 平板上打开Chrome并输入网址，打开后在PC的Chrome上输入`chrome://inspect/#devices`，此时可以查看到已连接的平板上打开的网址，点击对应网址下的`inspect`，此时就会弹出一个调试窗口，这时候你就可以像调试WEB页面一样愉快地调试Android网页了。\n![](/images/others/chrome-inspect.png)\n\n## IOS设备的调试\nIOS上Safari浏览器的调试就比较简单，连接上设备和Mac，打开Mac上的Safari，勾选Safari的偏好设置里高级菜单下的“在菜单栏显示\"开发\"菜单”。\n![](/images/others/safari-develop.png)\n然后点击PC Safari的\"开发\"->\"XXX的Mac\"下的具体网址，此时就可以在弹出的窗口中进行调试了。\n![](/images/others/safari-devices.png)\n\n## 其它环境的调试\n至于其它不能调试的情况，都可以使用weinre等方案进行调试，具体请Google之。\n","slug":"debug-pad","published":1,"updated":"2019-03-26T13:47:04.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox05000gtof98x2vpolt","content":"<p>本文主要记录Android上的Chrome和IOS上的Safari浏览器的调试方法，方便以后查看。开始之前请自备梯子，下面会需要翻墙。</p>\n<a id=\"more\"></a>\n<h2 id=\"Android设备调试\"><a class=\"header-anchor\" href=\"#Android设备调试\">¶</a>Android设备调试</h2>\n<p>借助于Chrome的inspect工具，我们可以调试Android中使用了WebView的应用，所以调试Chrome网页也是同样的道理。</p>\n<ol>\n<li>安装ADB和驱动。网上有很多这方面的文章介绍，但是鉴于很多时候会出现各种问题，所以建议使用一键工具统一安装，<a href=\"http://forum.xda-developers.com/showthread.php?p=48915118#post48915118\">下载地址，需翻墙</a>。<br>\n安装时一路<code>Y</code>确认安装，结束后你的系统中就已经有了ADB环境和Android驱动。</li>\n<li>USB连接上平板设备，并勾选平板设置里面的<code>USB调试</code>(一般在开发者选项里，如果没有开发者选项点击关于并连续点击版本号)，如果平板弹出调试授权窗口，勾选一律允许然后点击确定。</li>\n<li>打开命令行输入<code>adb devices</code>，此时应该能获取到设备ID，如果没有请上网查找解决方案。<br>\n<img src=\"/images/others/adb-devices.png\" alt></li>\n<li>平板上打开Chrome并输入网址，打开后在PC的Chrome上输入<code>chrome://inspect/#devices</code>，此时可以查看到已连接的平板上打开的网址，点击对应网址下的<code>inspect</code>，此时就会弹出一个调试窗口，这时候你就可以像调试WEB页面一样愉快地调试Android网页了。<br>\n<img src=\"/images/others/chrome-inspect.png\" alt></li>\n</ol>\n<h2 id=\"IOS设备的调试\"><a class=\"header-anchor\" href=\"#IOS设备的调试\">¶</a>IOS设备的调试</h2>\n<p>IOS上Safari浏览器的调试就比较简单，连接上设备和Mac，打开Mac上的Safari，勾选Safari的偏好设置里高级菜单下的“在菜单栏显示&quot;开发&quot;菜单”。<br>\n<img src=\"/images/others/safari-develop.png\" alt><br>\n然后点击PC Safari的&quot;开发&quot;-&gt;&quot;XXX的Mac&quot;下的具体网址，此时就可以在弹出的窗口中进行调试了。<br>\n<img src=\"/images/others/safari-devices.png\" alt></p>\n<h2 id=\"其它环境的调试\"><a class=\"header-anchor\" href=\"#其它环境的调试\">¶</a>其它环境的调试</h2>\n<p>至于其它不能调试的情况，都可以使用weinre等方案进行调试，具体请Google之。</p>\n","site":{"data":{}},"excerpt":"<p>本文主要记录Android上的Chrome和IOS上的Safari浏览器的调试方法，方便以后查看。开始之前请自备梯子，下面会需要翻墙。</p>","more":"<h2 id=\"Android设备调试\"><a class=\"header-anchor\" href=\"#Android设备调试\">¶</a>Android设备调试</h2>\n<p>借助于Chrome的inspect工具，我们可以调试Android中使用了WebView的应用，所以调试Chrome网页也是同样的道理。</p>\n<ol>\n<li>安装ADB和驱动。网上有很多这方面的文章介绍，但是鉴于很多时候会出现各种问题，所以建议使用一键工具统一安装，<a href=\"http://forum.xda-developers.com/showthread.php?p=48915118#post48915118\">下载地址，需翻墙</a>。<br>\n安装时一路<code>Y</code>确认安装，结束后你的系统中就已经有了ADB环境和Android驱动。</li>\n<li>USB连接上平板设备，并勾选平板设置里面的<code>USB调试</code>(一般在开发者选项里，如果没有开发者选项点击关于并连续点击版本号)，如果平板弹出调试授权窗口，勾选一律允许然后点击确定。</li>\n<li>打开命令行输入<code>adb devices</code>，此时应该能获取到设备ID，如果没有请上网查找解决方案。<br>\n<img src=\"/images/others/adb-devices.png\" alt=\"\"></li>\n<li>平板上打开Chrome并输入网址，打开后在PC的Chrome上输入<code>chrome://inspect/#devices</code>，此时可以查看到已连接的平板上打开的网址，点击对应网址下的<code>inspect</code>，此时就会弹出一个调试窗口，这时候你就可以像调试WEB页面一样愉快地调试Android网页了。<br>\n<img src=\"/images/others/chrome-inspect.png\" alt=\"\"></li>\n</ol>\n<h2 id=\"IOS设备的调试\"><a class=\"header-anchor\" href=\"#IOS设备的调试\">¶</a>IOS设备的调试</h2>\n<p>IOS上Safari浏览器的调试就比较简单，连接上设备和Mac，打开Mac上的Safari，勾选Safari的偏好设置里高级菜单下的“在菜单栏显示&quot;开发&quot;菜单”。<br>\n<img src=\"/images/others/safari-develop.png\" alt=\"\"><br>\n然后点击PC Safari的&quot;开发&quot;-&gt;&quot;XXX的Mac&quot;下的具体网址，此时就可以在弹出的窗口中进行调试了。<br>\n<img src=\"/images/others/safari-devices.png\" alt=\"\"></p>\n<h2 id=\"其它环境的调试\"><a class=\"header-anchor\" href=\"#其它环境的调试\">¶</a>其它环境的调试</h2>\n<p>至于其它不能调试的情况，都可以使用weinre等方案进行调试，具体请Google之。</p>"},{"title":"利用dokku打造自己的私有云仓库和自动化部署","s":"dokku_ci_cd","date":"2017-07-09T10:15:00.000Z","thumbnail":"/images/cloud/dokku.png","_content":"\n`dokku`是什么？一句话概括就是一个几百行shell代码的高可扩展性的类`Heroku`的单服务器PAAS平台，利用它可以简化很多docker操作，更加方便我们维护一个`docker driven`的平台。\n<!-- more -->\n\n1. 创建机器，选择`Ubuntu`系统，同时做好域名映射\n2. 安装`dokku`\n  ```bash\n  wget https://raw.githubusercontent.com/dokku/dokku/v0.14.5/bootstrap.sh\n  sudo DOKKU_TAG=v0.14.5 bash bootstrap.sh\n  ```\n  然后打开对应的域名，完成`dokku`的初始化\n3. 创建`gogs`应用，参照[https://dokku.github.io/tutorials/deploying-gogs-to-dokku](https://dokku.github.io/tutorials/deploying-gogs-to-dokku)\n  其中推送代码部分可以用`tag`部署方式，所有命令如下\n  ```bash\n  dokku apps:create gogs\n  # 设置域名\n  dokku domains:add gogs gogs.erguotou.me\n  # 端口映射\n  dokku proxy:ports-add gogs http:80:3000\n  dokku docker-options:add gogs deploy -p 2222:22\n  mkdir -p /var/lib/dokku/data/storage/gogs\n  chown -R dokku:dokku /var/lib/dokku/data/storage/gogs\n  dokku storage:mount gogs /var/lib/dokku/data/storage/gogs:/data\n  # 如果选择用mysql作为gogs数据库需要执行下面这些\n  dokku plugin:install https://github.com/dokku/dokku-mysql.git mysql\n  dokku mysql:create gogs\n  dokku mysql:link gogs gogs\n  # 使用指定版本\n  docker pull gogs/gogs\n  docker tag gogs/gogs dokku/gogs\n  dokku tags:deploy gogs\n  ```\n4. 使用Let's Encrypt进行https加密\n  ```bash\n  sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git\n  dokku config:set --global DOKKU_LETSENCRYPT_EMAIL=erguotou525@gmail.com\n  dokku letsencrypt gogs\n  dokku letsencrypt:cron-job --add\n  ```\n  完成之后打开web页面完成`gogs`的`install`，注意配置页面的各设置（mysql的配置地址可以用`dokku mysql:info gogs`查看。即使设置错了，也可以后期使用`dokku enter gogs`，在`/data/gogs/conf/app.ini`中直接修改），其中`SSH 端口号`填`2222`，`HTTP 端口号`填`3000`，。\n5. 创建`drone`应用，`drone`分`server`端和`agent`端\n  ```bash\n  # server\n  export RPC_SECRET=09asudjfkqwn41u2389ahnoqwjn123\n  dokku apps:create drone\n  # 设置域名\n  dokku domains:add drone drone.erguotou.me\n  dokku proxy:ports-add drone http:80:80 https:443:80\n  # 这里同样适用sqlite作为数据库\n  # dokku mysql:create drone\n  # dokku mysql:link drone drone\n  ## 暂时不能使用最新版本，坑了很久\n  # docker pull drone/drone:latest\n  docker pull drone/drone\n  docker tag drone/drone dokku/drone\n  dokku storage:mount drone /var/run/docker.sock:/var/run/docker.sock\n  mkdir -p /var/lib/dokku/data/storage/drone\n  chown -R dokku:dokku /var/lib/dokku/data/storage/drone\n  dokku storage:mount drone /var/lib/dokku/data/storage/drone:/data\n  # 配置drone的环境变量\n  dokku config:set drone DRONE_GOGS_SERVER=https://gogs.erguotou.me DRONE_GIT_ALWAYS_AUTH=true DRONE_RUNNER_CAPACITY=1 DRONE_SERVER_PROTO=https DRONE_SERVER_HOST=drone.erguotou.me DRONE_RPC_SECRET=$RPC_SECRET\n  # dokku config:set drone DRONE_OPEN=false DRONE_GOGS_PRIVATE_MODE=true DRONE_DATABASE_DRIVER=mysql DRONE_DATABASE_DATASOURCE='root:password@tcp(1.2.3.4:3306)/drone?parseTime=true' DRONE_HOST=https://drone.erguotou.me DRONE_GOGS=true DRONE_GOGS_URL=https://gogs.erguotou.me DRONE_SECRET=secret DRONE_ADMIN=username,password\n  dokku tags:deploy drone\n  # dokku proxy:ports-add drone http:80:8000\n  # dokku proxy:ports-remove drone http:443:443 http:8000:8000 http:80:80\n  dokku letsencrypt drone\n  # agent\n  dokku apps:create drone-agent\n  dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock\n  dokku config:set drone-agent DRONE_RPC_SERVER=https://drone.erguotou.me  DRONE_RPC_SECRET=$RPC_SECRET\n  docker pull drone/agent\n  docker tag drone/agent dokku/drone-agent\n  dokku tags:deploy drone-agent\n  ## agent，暂时不能使用最新版，直接使用docker命令启动，看最新版源码里/ws/broker请求都没有了\n  # dokku apps:create drone-agent\n  # docker pull drone/agent:latest\n  # docker tag drone/agent:latest dokku/drone-agent:latest\n  # docker run -d -e DRONE_SERVER=wss://drone.erguotou.me/ws/broker -e DRONE_SECRET=password -e DRONE_TIMEOUT=15m -v /var/run/docker.sock:/var/run/docker.sock --restart=always --name=drone-agent-docker drone/drone:0.7.3 agent\n  # 配置agent的环境变量\n  # dokku config:set drone-agent DRONE_SERVER=wss://drone.erguotou.me/ws/broker DRONE_SECRET=secret\n  # dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock\n  # dokku tags:deploy drone-agent latest\n  ```\n7. 检查应用运行情况\n  可使用的命令\n  ```bash\n  dokku proxy:report app\n  dokku proxy:ports-remove app http:80:3000\n  dokku proxy:ports-add app http:80:3000\n  cat /home/dokku/app/nginx.conf\n  dokku ps:stop app\n  dokku ps:start app\n  ```\n8. 创建自己的应用\n  在`dokku`中创建对应的app `dokku apps:create gift`，完成域名映射，配置`proxy:ports`，使用`Let's encrypt`插件进行https加密，这些步骤就不多说了。接着在gogs中创建对应的一个仓库，记得项目根目录下要有一个`.drone.yml`文件（参考[https://docs.drone.io/user-guide/](https://docs.drone.io/user-guide/)进行配置），然后提交代码。\n9. 自动发布应用\n  CD可以有很多种方法，具体还得根据部署环境决定。可以直接用`drone`中现有的插件去实现也可以自己去开发`drone`的插件。下面记录的是以前的骚操作完成的项目部署方案。\n  上一步只能使用drone进行自动构建，要想将构建后的项目自动打包发布，还需要一些额外的操作（这里也是坑了自己好久，主要难题是如何将drone agent生成的文件发布到dokku git里，后来经人提醒可以通过共享ssh的方式，然后后续的共享ssh的操作也是摸索了好久才成功，可谓一路心酸）。\n  - 找1台虚机生成一份新的ssh公私钥对（也可以本地备份原来的，然后重新生成）\n    ```bash\n    ssh-keygen -t rsa -C \"dokku-deploy\"\n    ```\n  - 将上一步生成的`id_rsa.pub`上传至服务器并添加到dokku中\n    ```bash\n    # local\n    scp ~/.ssh/id_rsa.pub root@erguotou.me:/root/deploy.pub\n    # server\n    dokku ssh-keys:add deploy ./deploy.pub\n    ```\n  - 项目根目录新建一个`ssh`目录，然后将上一步生成的ssh公私钥复制进去\n    ```bash\n    cp ~/.ssh/id_rsa* ./ssh\n    ```\n  - 修改原来的`.drone.yml`，在原来build之后添加一些操作\n    ```bash\n    - rm -rf ~/.ssh\n    - mkdir -p ~/.ssh\n    - cp ssh/* ~/.ssh\n    - chmod 600 ~/.ssh/id_rsa # 特别要注意这3行\n    - chmod 644 ~/.ssh/id_rsa.pub\n    - ssh-keyscan erguotou.me >> ~/.ssh/known_hosts\n    - ssh-keyscan 45.77.42.201 >> ~/.ssh/known_hosts\n    - echo 'FROM ilyasemenov/dokku-static-site' > dist/Dockerfile # 根据自己的项目选择合适的Dockerfile或者实现适合自己项目的Dockerfile，也可以使用buildpacks\n    - cd dist\n    - git config --global user.email \"erguotou525@gmail.com\"\n    - git config --global user.name \"erguotou\"\n    - git init\n    - git add ./ -A\n    - git commit -m \"auto build\"\n    - git remote add dokku dokku@erguotou.me:gift\n    - git push -u dokku master --force\n    ```\n    至此就完成了自动化部署的工作，现在就可以访问[https://gift.erguotou.me](https://gift.erguotou.me)了。\n","source":"_posts/dokku_ci_cd.md","raw":"---\ntitle: 利用dokku打造自己的私有云仓库和自动化部署\ns: dokku_ci_cd\ndate: 2017-07-09 18:15:00\n# thumbnail: https://raw.githubusercontent.com/dokku/dokku/v0.10.3/docs/assets/dokku.png\nthumbnail: /images/cloud/dokku.png\ntags:\n  - dokku\n  - gogs\n  - drone\n  - CI\n  - CD\n---\n\n`dokku`是什么？一句话概括就是一个几百行shell代码的高可扩展性的类`Heroku`的单服务器PAAS平台，利用它可以简化很多docker操作，更加方便我们维护一个`docker driven`的平台。\n<!-- more -->\n\n1. 创建机器，选择`Ubuntu`系统，同时做好域名映射\n2. 安装`dokku`\n  ```bash\n  wget https://raw.githubusercontent.com/dokku/dokku/v0.14.5/bootstrap.sh\n  sudo DOKKU_TAG=v0.14.5 bash bootstrap.sh\n  ```\n  然后打开对应的域名，完成`dokku`的初始化\n3. 创建`gogs`应用，参照[https://dokku.github.io/tutorials/deploying-gogs-to-dokku](https://dokku.github.io/tutorials/deploying-gogs-to-dokku)\n  其中推送代码部分可以用`tag`部署方式，所有命令如下\n  ```bash\n  dokku apps:create gogs\n  # 设置域名\n  dokku domains:add gogs gogs.erguotou.me\n  # 端口映射\n  dokku proxy:ports-add gogs http:80:3000\n  dokku docker-options:add gogs deploy -p 2222:22\n  mkdir -p /var/lib/dokku/data/storage/gogs\n  chown -R dokku:dokku /var/lib/dokku/data/storage/gogs\n  dokku storage:mount gogs /var/lib/dokku/data/storage/gogs:/data\n  # 如果选择用mysql作为gogs数据库需要执行下面这些\n  dokku plugin:install https://github.com/dokku/dokku-mysql.git mysql\n  dokku mysql:create gogs\n  dokku mysql:link gogs gogs\n  # 使用指定版本\n  docker pull gogs/gogs\n  docker tag gogs/gogs dokku/gogs\n  dokku tags:deploy gogs\n  ```\n4. 使用Let's Encrypt进行https加密\n  ```bash\n  sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git\n  dokku config:set --global DOKKU_LETSENCRYPT_EMAIL=erguotou525@gmail.com\n  dokku letsencrypt gogs\n  dokku letsencrypt:cron-job --add\n  ```\n  完成之后打开web页面完成`gogs`的`install`，注意配置页面的各设置（mysql的配置地址可以用`dokku mysql:info gogs`查看。即使设置错了，也可以后期使用`dokku enter gogs`，在`/data/gogs/conf/app.ini`中直接修改），其中`SSH 端口号`填`2222`，`HTTP 端口号`填`3000`，。\n5. 创建`drone`应用，`drone`分`server`端和`agent`端\n  ```bash\n  # server\n  export RPC_SECRET=09asudjfkqwn41u2389ahnoqwjn123\n  dokku apps:create drone\n  # 设置域名\n  dokku domains:add drone drone.erguotou.me\n  dokku proxy:ports-add drone http:80:80 https:443:80\n  # 这里同样适用sqlite作为数据库\n  # dokku mysql:create drone\n  # dokku mysql:link drone drone\n  ## 暂时不能使用最新版本，坑了很久\n  # docker pull drone/drone:latest\n  docker pull drone/drone\n  docker tag drone/drone dokku/drone\n  dokku storage:mount drone /var/run/docker.sock:/var/run/docker.sock\n  mkdir -p /var/lib/dokku/data/storage/drone\n  chown -R dokku:dokku /var/lib/dokku/data/storage/drone\n  dokku storage:mount drone /var/lib/dokku/data/storage/drone:/data\n  # 配置drone的环境变量\n  dokku config:set drone DRONE_GOGS_SERVER=https://gogs.erguotou.me DRONE_GIT_ALWAYS_AUTH=true DRONE_RUNNER_CAPACITY=1 DRONE_SERVER_PROTO=https DRONE_SERVER_HOST=drone.erguotou.me DRONE_RPC_SECRET=$RPC_SECRET\n  # dokku config:set drone DRONE_OPEN=false DRONE_GOGS_PRIVATE_MODE=true DRONE_DATABASE_DRIVER=mysql DRONE_DATABASE_DATASOURCE='root:password@tcp(1.2.3.4:3306)/drone?parseTime=true' DRONE_HOST=https://drone.erguotou.me DRONE_GOGS=true DRONE_GOGS_URL=https://gogs.erguotou.me DRONE_SECRET=secret DRONE_ADMIN=username,password\n  dokku tags:deploy drone\n  # dokku proxy:ports-add drone http:80:8000\n  # dokku proxy:ports-remove drone http:443:443 http:8000:8000 http:80:80\n  dokku letsencrypt drone\n  # agent\n  dokku apps:create drone-agent\n  dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock\n  dokku config:set drone-agent DRONE_RPC_SERVER=https://drone.erguotou.me  DRONE_RPC_SECRET=$RPC_SECRET\n  docker pull drone/agent\n  docker tag drone/agent dokku/drone-agent\n  dokku tags:deploy drone-agent\n  ## agent，暂时不能使用最新版，直接使用docker命令启动，看最新版源码里/ws/broker请求都没有了\n  # dokku apps:create drone-agent\n  # docker pull drone/agent:latest\n  # docker tag drone/agent:latest dokku/drone-agent:latest\n  # docker run -d -e DRONE_SERVER=wss://drone.erguotou.me/ws/broker -e DRONE_SECRET=password -e DRONE_TIMEOUT=15m -v /var/run/docker.sock:/var/run/docker.sock --restart=always --name=drone-agent-docker drone/drone:0.7.3 agent\n  # 配置agent的环境变量\n  # dokku config:set drone-agent DRONE_SERVER=wss://drone.erguotou.me/ws/broker DRONE_SECRET=secret\n  # dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock\n  # dokku tags:deploy drone-agent latest\n  ```\n7. 检查应用运行情况\n  可使用的命令\n  ```bash\n  dokku proxy:report app\n  dokku proxy:ports-remove app http:80:3000\n  dokku proxy:ports-add app http:80:3000\n  cat /home/dokku/app/nginx.conf\n  dokku ps:stop app\n  dokku ps:start app\n  ```\n8. 创建自己的应用\n  在`dokku`中创建对应的app `dokku apps:create gift`，完成域名映射，配置`proxy:ports`，使用`Let's encrypt`插件进行https加密，这些步骤就不多说了。接着在gogs中创建对应的一个仓库，记得项目根目录下要有一个`.drone.yml`文件（参考[https://docs.drone.io/user-guide/](https://docs.drone.io/user-guide/)进行配置），然后提交代码。\n9. 自动发布应用\n  CD可以有很多种方法，具体还得根据部署环境决定。可以直接用`drone`中现有的插件去实现也可以自己去开发`drone`的插件。下面记录的是以前的骚操作完成的项目部署方案。\n  上一步只能使用drone进行自动构建，要想将构建后的项目自动打包发布，还需要一些额外的操作（这里也是坑了自己好久，主要难题是如何将drone agent生成的文件发布到dokku git里，后来经人提醒可以通过共享ssh的方式，然后后续的共享ssh的操作也是摸索了好久才成功，可谓一路心酸）。\n  - 找1台虚机生成一份新的ssh公私钥对（也可以本地备份原来的，然后重新生成）\n    ```bash\n    ssh-keygen -t rsa -C \"dokku-deploy\"\n    ```\n  - 将上一步生成的`id_rsa.pub`上传至服务器并添加到dokku中\n    ```bash\n    # local\n    scp ~/.ssh/id_rsa.pub root@erguotou.me:/root/deploy.pub\n    # server\n    dokku ssh-keys:add deploy ./deploy.pub\n    ```\n  - 项目根目录新建一个`ssh`目录，然后将上一步生成的ssh公私钥复制进去\n    ```bash\n    cp ~/.ssh/id_rsa* ./ssh\n    ```\n  - 修改原来的`.drone.yml`，在原来build之后添加一些操作\n    ```bash\n    - rm -rf ~/.ssh\n    - mkdir -p ~/.ssh\n    - cp ssh/* ~/.ssh\n    - chmod 600 ~/.ssh/id_rsa # 特别要注意这3行\n    - chmod 644 ~/.ssh/id_rsa.pub\n    - ssh-keyscan erguotou.me >> ~/.ssh/known_hosts\n    - ssh-keyscan 45.77.42.201 >> ~/.ssh/known_hosts\n    - echo 'FROM ilyasemenov/dokku-static-site' > dist/Dockerfile # 根据自己的项目选择合适的Dockerfile或者实现适合自己项目的Dockerfile，也可以使用buildpacks\n    - cd dist\n    - git config --global user.email \"erguotou525@gmail.com\"\n    - git config --global user.name \"erguotou\"\n    - git init\n    - git add ./ -A\n    - git commit -m \"auto build\"\n    - git remote add dokku dokku@erguotou.me:gift\n    - git push -u dokku master --force\n    ```\n    至此就完成了自动化部署的工作，现在就可以访问[https://gift.erguotou.me](https://gift.erguotou.me)了。\n","slug":"dokku_ci_cd","published":1,"updated":"2020-02-17T16:50:38.905Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox06000jtof9w1ij9s7j","content":"<p><code>dokku</code>是什么？一句话概括就是一个几百行shell代码的高可扩展性的类<code>Heroku</code>的单服务器PAAS平台，利用它可以简化很多docker操作，更加方便我们维护一个<code>docker driven</code>的平台。</p>\n<a id=\"more\"></a>\n<ol>\n<li>创建机器，选择<code>Ubuntu</code>系统，同时做好域名映射</li>\n<li>安装<code>dokku</code></li>\n</ol>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/dokku/dokku/v0.14.5/bootstrap.sh</span><br><span class=\"line\">sudo DOKKU_TAG=v0.14.5 bash bootstrap.sh</span><br></pre></td></tr></table></figure>\n<p>然后打开对应的域名，完成<code>dokku</code>的初始化<br>\n3. 创建<code>gogs</code>应用，参照<a href=\"https://dokku.github.io/tutorials/deploying-gogs-to-dokku\">https://dokku.github.io/tutorials/deploying-gogs-to-dokku</a><br>\n其中推送代码部分可以用<code>tag</code>部署方式，所有命令如下</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dokku apps:create gogs</span><br><span class=\"line\"><span class=\"hljs-comment\"># 设置域名</span></span><br><span class=\"line\">dokku domains:add gogs gogs.erguotou.me</span><br><span class=\"line\"><span class=\"hljs-comment\"># 端口映射</span></span><br><span class=\"line\">dokku proxy:ports-add gogs http:80:3000</span><br><span class=\"line\">dokku docker-options:add gogs deploy -p 2222:22</span><br><span class=\"line\">mkdir -p /var/lib/dokku/data/storage/gogs</span><br><span class=\"line\">chown -R dokku:dokku /var/lib/dokku/data/storage/gogs</span><br><span class=\"line\">dokku storage:mount gogs /var/lib/dokku/data/storage/gogs:/data</span><br><span class=\"line\"><span class=\"hljs-comment\"># 如果选择用mysql作为gogs数据库需要执行下面这些</span></span><br><span class=\"line\">dokku plugin:install https://github.com/dokku/dokku-mysql.git mysql</span><br><span class=\"line\">dokku mysql:create gogs</span><br><span class=\"line\">dokku mysql:link gogs gogs</span><br><span class=\"line\"><span class=\"hljs-comment\"># 使用指定版本</span></span><br><span class=\"line\">docker pull gogs/gogs</span><br><span class=\"line\">docker tag gogs/gogs dokku/gogs</span><br><span class=\"line\">dokku tags:deploy gogs</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>使用Let’s Encrypt进行https加密</li>\n</ol>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git</span><br><span class=\"line\">dokku config:<span class=\"hljs-built_in\">set</span> --global DOKKU_LETSENCRYPT_EMAIL=erguotou525@gmail.com</span><br><span class=\"line\">dokku letsencrypt gogs</span><br><span class=\"line\">dokku letsencrypt:cron-job --add</span><br></pre></td></tr></table></figure>\n<p>完成之后打开web页面完成<code>gogs</code>的<code>install</code>，注意配置页面的各设置（mysql的配置地址可以用<code>dokku mysql:info gogs</code>查看。即使设置错了，也可以后期使用<code>dokku enter gogs</code>，在<code>/data/gogs/conf/app.ini</code>中直接修改），其中<code>SSH 端口号</code>填<code>2222</code>，<code>HTTP 端口号</code>填<code>3000</code>，。<br>\n5. 创建<code>drone</code>应用，<code>drone</code>分<code>server</code>端和<code>agent</code>端</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># server</span></span><br><span class=\"line\"><span class=\"hljs-built_in\">export</span> RPC_SECRET=09asudjfkqwn41u2389ahnoqwjn123</span><br><span class=\"line\">dokku apps:create drone</span><br><span class=\"line\"><span class=\"hljs-comment\"># 设置域名</span></span><br><span class=\"line\">dokku domains:add drone drone.erguotou.me</span><br><span class=\"line\">dokku proxy:ports-add drone http:80:80 https:443:80</span><br><span class=\"line\"><span class=\"hljs-comment\"># 这里同样适用sqlite作为数据库</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku mysql:create drone</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku mysql:link drone drone</span></span><br><span class=\"line\"><span class=\"hljs-comment\">## 暂时不能使用最新版本，坑了很久</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># docker pull drone/drone:latest</span></span><br><span class=\"line\">docker pull drone/drone</span><br><span class=\"line\">docker tag drone/drone dokku/drone</span><br><span class=\"line\">dokku storage:mount drone /var/run/docker.sock:/var/run/docker.sock</span><br><span class=\"line\">mkdir -p /var/lib/dokku/data/storage/drone</span><br><span class=\"line\">chown -R dokku:dokku /var/lib/dokku/data/storage/drone</span><br><span class=\"line\">dokku storage:mount drone /var/lib/dokku/data/storage/drone:/data</span><br><span class=\"line\"><span class=\"hljs-comment\"># 配置drone的环境变量</span></span><br><span class=\"line\">dokku config:<span class=\"hljs-built_in\">set</span> drone DRONE_GOGS_SERVER=https://gogs.erguotou.me DRONE_GIT_ALWAYS_AUTH=<span class=\"hljs-literal\">true</span> DRONE_RUNNER_CAPACITY=1 DRONE_SERVER_PROTO=https DRONE_SERVER_HOST=drone.erguotou.me DRONE_RPC_SECRET=<span class=\"hljs-variable\">$RPC_SECRET</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku config:set drone DRONE_OPEN=false DRONE_GOGS_PRIVATE_MODE=true DRONE_DATABASE_DRIVER=mysql DRONE_DATABASE_DATASOURCE='root:password@tcp(1.2.3.4:3306)/drone?parseTime=true' DRONE_HOST=https://drone.erguotou.me DRONE_GOGS=true DRONE_GOGS_URL=https://gogs.erguotou.me DRONE_SECRET=secret DRONE_ADMIN=username,password</span></span><br><span class=\"line\">dokku tags:deploy drone</span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku proxy:ports-add drone http:80:8000</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku proxy:ports-remove drone http:443:443 http:8000:8000 http:80:80</span></span><br><span class=\"line\">dokku letsencrypt drone</span><br><span class=\"line\"><span class=\"hljs-comment\"># agent</span></span><br><span class=\"line\">dokku apps:create drone-agent</span><br><span class=\"line\">dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock</span><br><span class=\"line\">dokku config:<span class=\"hljs-built_in\">set</span> drone-agent DRONE_RPC_SERVER=https://drone.erguotou.me  DRONE_RPC_SECRET=<span class=\"hljs-variable\">$RPC_SECRET</span></span><br><span class=\"line\">docker pull drone/agent</span><br><span class=\"line\">docker tag drone/agent dokku/drone-agent</span><br><span class=\"line\">dokku tags:deploy drone-agent</span><br><span class=\"line\"><span class=\"hljs-comment\">## agent，暂时不能使用最新版，直接使用docker命令启动，看最新版源码里/ws/broker请求都没有了</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku apps:create drone-agent</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># docker pull drone/agent:latest</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># docker tag drone/agent:latest dokku/drone-agent:latest</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># docker run -d -e DRONE_SERVER=wss://drone.erguotou.me/ws/broker -e DRONE_SECRET=password -e DRONE_TIMEOUT=15m -v /var/run/docker.sock:/var/run/docker.sock --restart=always --name=drone-agent-docker drone/drone:0.7.3 agent</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 配置agent的环境变量</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku config:set drone-agent DRONE_SERVER=wss://drone.erguotou.me/ws/broker DRONE_SECRET=secret</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># dokku tags:deploy drone-agent latest</span></span><br></pre></td></tr></table></figure>\n<ol start=\"7\">\n<li>检查应用运行情况<br>\n可使用的命令</li>\n</ol>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dokku proxy:report app</span><br><span class=\"line\">dokku proxy:ports-remove app http:80:3000</span><br><span class=\"line\">dokku proxy:ports-add app http:80:3000</span><br><span class=\"line\">cat /home/dokku/app/nginx.conf</span><br><span class=\"line\">dokku ps:stop app</span><br><span class=\"line\">dokku ps:start app</span><br></pre></td></tr></table></figure>\n<ol start=\"8\">\n<li>创建自己的应用<br>\n在<code>dokku</code>中创建对应的app <code>dokku apps:create gift</code>，完成域名映射，配置<code>proxy:ports</code>，使用<code>Let's encrypt</code>插件进行https加密，这些步骤就不多说了。接着在gogs中创建对应的一个仓库，记得项目根目录下要有一个<code>.drone.yml</code>文件（参考<a href=\"https://docs.drone.io/user-guide/\">https://docs.drone.io/user-guide/</a>进行配置），然后提交代码。</li>\n<li>自动发布应用<br>\nCD可以有很多种方法，具体还得根据部署环境决定。可以直接用<code>drone</code>中现有的插件去实现也可以自己去开发<code>drone</code>的插件。下面记录的是以前的骚操作完成的项目部署方案。<br>\n上一步只能使用drone进行自动构建，要想将构建后的项目自动打包发布，还需要一些额外的操作（这里也是坑了自己好久，主要难题是如何将drone agent生成的文件发布到dokku git里，后来经人提醒可以通过共享ssh的方式，然后后续的共享ssh的操作也是摸索了好久才成功，可谓一路心酸）。</li>\n</ol>\n<ul>\n<li>\n<p>找1台虚机生成一份新的ssh公私钥对（也可以本地备份原来的，然后重新生成）</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"hljs-string\">\"dokku-deploy\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>将上一步生成的<code>id_rsa.pub</code>上传至服务器并添加到dokku中</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># local</span></span><br><span class=\"line\">scp ~/.ssh/id_rsa.pub root@erguotou.me:/root/deploy.pub</span><br><span class=\"line\"><span class=\"hljs-comment\"># server</span></span><br><span class=\"line\">dokku ssh-keys:add deploy ./deploy.pub</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>项目根目录新建一个<code>ssh</code>目录，然后将上一步生成的ssh公私钥复制进去</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp ~/.ssh/id_rsa* ./ssh</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>修改原来的<code>.drone.yml</code>，在原来build之后添加一些操作</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- rm -rf ~/.ssh</span><br><span class=\"line\">- mkdir -p ~/.ssh</span><br><span class=\"line\">- cp ssh/* ~/.ssh</span><br><span class=\"line\">- chmod 600 ~/.ssh/id_rsa <span class=\"hljs-comment\"># 特别要注意这3行</span></span><br><span class=\"line\">- chmod 644 ~/.ssh/id_rsa.pub</span><br><span class=\"line\">- ssh-keyscan erguotou.me &gt;&gt; ~/.ssh/known_hosts</span><br><span class=\"line\">- ssh-keyscan 45.77.42.201 &gt;&gt; ~/.ssh/known_hosts</span><br><span class=\"line\">- <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'FROM ilyasemenov/dokku-static-site'</span> &gt; dist/Dockerfile <span class=\"hljs-comment\"># 根据自己的项目选择合适的Dockerfile或者实现适合自己项目的Dockerfile，也可以使用buildpacks</span></span><br><span class=\"line\">- <span class=\"hljs-built_in\">cd</span> dist</span><br><span class=\"line\">- git config --global user.email <span class=\"hljs-string\">\"erguotou525@gmail.com\"</span></span><br><span class=\"line\">- git config --global user.name <span class=\"hljs-string\">\"erguotou\"</span></span><br><span class=\"line\">- git init</span><br><span class=\"line\">- git add ./ -A</span><br><span class=\"line\">- git commit -m <span class=\"hljs-string\">\"auto build\"</span></span><br><span class=\"line\">- git remote add dokku dokku@erguotou.me:gift</span><br><span class=\"line\">- git push -u dokku master --force</span><br></pre></td></tr></table></figure>\n<p>至此就完成了自动化部署的工作，现在就可以访问<a href=\"https://gift.erguotou.me\">https://gift.erguotou.me</a>了。</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><code>dokku</code>是什么？一句话概括就是一个几百行shell代码的高可扩展性的类<code>Heroku</code>的单服务器PAAS平台，利用它可以简化很多docker操作，更加方便我们维护一个<code>docker driven</code>的平台。</p>","more":"<ol>\n<li>创建机器，选择<code>Ubuntu</code>系统，同时做好域名映射</li>\n<li>安装<code>dokku</code></li>\n</ol>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/dokku/dokku/v0.14.5/bootstrap.sh</span><br><span class=\"line\">sudo DOKKU_TAG=v0.14.5 bash bootstrap.sh</span><br></pre></td></tr></table></figure>\n<p>然后打开对应的域名，完成<code>dokku</code>的初始化<br>\n3. 创建<code>gogs</code>应用，参照<a href=\"https://dokku.github.io/tutorials/deploying-gogs-to-dokku\">https://dokku.github.io/tutorials/deploying-gogs-to-dokku</a><br>\n其中推送代码部分可以用<code>tag</code>部署方式，所有命令如下</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dokku apps:create gogs</span><br><span class=\"line\"><span class=\"comment\"># 设置域名</span></span><br><span class=\"line\">dokku domains:add gogs gogs.erguotou.me</span><br><span class=\"line\"><span class=\"comment\"># 端口映射</span></span><br><span class=\"line\">dokku proxy:ports-add gogs http:80:3000</span><br><span class=\"line\">dokku docker-options:add gogs deploy -p 2222:22</span><br><span class=\"line\">mkdir -p /var/lib/dokku/data/storage/gogs</span><br><span class=\"line\">chown -R dokku:dokku /var/lib/dokku/data/storage/gogs</span><br><span class=\"line\">dokku storage:mount gogs /var/lib/dokku/data/storage/gogs:/data</span><br><span class=\"line\"><span class=\"comment\"># 如果选择用mysql作为gogs数据库需要执行下面这些</span></span><br><span class=\"line\">dokku plugin:install https://github.com/dokku/dokku-mysql.git mysql</span><br><span class=\"line\">dokku mysql:create gogs</span><br><span class=\"line\">dokku mysql:link gogs gogs</span><br><span class=\"line\"><span class=\"comment\"># 使用指定版本</span></span><br><span class=\"line\">docker pull gogs/gogs</span><br><span class=\"line\">docker tag gogs/gogs dokku/gogs</span><br><span class=\"line\">dokku tags:deploy gogs</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>使用Let’s Encrypt进行https加密</li>\n</ol>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git</span><br><span class=\"line\">dokku config:<span class=\"built_in\">set</span> --global DOKKU_LETSENCRYPT_EMAIL=erguotou525@gmail.com</span><br><span class=\"line\">dokku letsencrypt gogs</span><br><span class=\"line\">dokku letsencrypt:cron-job --add</span><br></pre></td></tr></table></figure>\n<p>完成之后打开web页面完成<code>gogs</code>的<code>install</code>，注意配置页面的各设置（mysql的配置地址可以用<code>dokku mysql:info gogs</code>查看。即使设置错了，也可以后期使用<code>dokku enter gogs</code>，在<code>/data/gogs/conf/app.ini</code>中直接修改），其中<code>SSH 端口号</code>填<code>2222</code>，<code>HTTP 端口号</code>填<code>3000</code>，。<br>\n5. 创建<code>drone</code>应用，<code>drone</code>分<code>server</code>端和<code>agent</code>端</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># server</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> RPC_SECRET=09asudjfkqwn41u2389ahnoqwjn123</span><br><span class=\"line\">dokku apps:create drone</span><br><span class=\"line\"><span class=\"comment\"># 设置域名</span></span><br><span class=\"line\">dokku domains:add drone drone.erguotou.me</span><br><span class=\"line\">dokku proxy:ports-add drone http:80:80 https:443:80</span><br><span class=\"line\"><span class=\"comment\"># 这里同样适用sqlite作为数据库</span></span><br><span class=\"line\"><span class=\"comment\"># dokku mysql:create drone</span></span><br><span class=\"line\"><span class=\"comment\"># dokku mysql:link drone drone</span></span><br><span class=\"line\"><span class=\"comment\">## 暂时不能使用最新版本，坑了很久</span></span><br><span class=\"line\"><span class=\"comment\"># docker pull drone/drone:latest</span></span><br><span class=\"line\">docker pull drone/drone</span><br><span class=\"line\">docker tag drone/drone dokku/drone</span><br><span class=\"line\">dokku storage:mount drone /var/run/docker.sock:/var/run/docker.sock</span><br><span class=\"line\">mkdir -p /var/lib/dokku/data/storage/drone</span><br><span class=\"line\">chown -R dokku:dokku /var/lib/dokku/data/storage/drone</span><br><span class=\"line\">dokku storage:mount drone /var/lib/dokku/data/storage/drone:/data</span><br><span class=\"line\"><span class=\"comment\"># 配置drone的环境变量</span></span><br><span class=\"line\">dokku config:<span class=\"built_in\">set</span> drone DRONE_GOGS_SERVER=https://gogs.erguotou.me DRONE_GIT_ALWAYS_AUTH=<span class=\"literal\">true</span> DRONE_RUNNER_CAPACITY=1 DRONE_SERVER_PROTO=https DRONE_SERVER_HOST=drone.erguotou.me DRONE_RPC_SECRET=<span class=\"variable\">$RPC_SECRET</span></span><br><span class=\"line\"><span class=\"comment\"># dokku config:set drone DRONE_OPEN=false DRONE_GOGS_PRIVATE_MODE=true DRONE_DATABASE_DRIVER=mysql DRONE_DATABASE_DATASOURCE='root:password@tcp(1.2.3.4:3306)/drone?parseTime=true' DRONE_HOST=https://drone.erguotou.me DRONE_GOGS=true DRONE_GOGS_URL=https://gogs.erguotou.me DRONE_SECRET=secret DRONE_ADMIN=username,password</span></span><br><span class=\"line\">dokku tags:deploy drone</span><br><span class=\"line\"><span class=\"comment\"># dokku proxy:ports-add drone http:80:8000</span></span><br><span class=\"line\"><span class=\"comment\"># dokku proxy:ports-remove drone http:443:443 http:8000:8000 http:80:80</span></span><br><span class=\"line\">dokku letsencrypt drone</span><br><span class=\"line\"><span class=\"comment\"># agent</span></span><br><span class=\"line\">dokku apps:create drone-agent</span><br><span class=\"line\">dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock</span><br><span class=\"line\">dokku config:<span class=\"built_in\">set</span> drone-agent DRONE_RPC_SERVER=https://drone.erguotou.me  DRONE_RPC_SECRET=<span class=\"variable\">$RPC_SECRET</span></span><br><span class=\"line\">docker pull drone/agent</span><br><span class=\"line\">docker tag drone/agent dokku/drone-agent</span><br><span class=\"line\">dokku tags:deploy drone-agent</span><br><span class=\"line\"><span class=\"comment\">## agent，暂时不能使用最新版，直接使用docker命令启动，看最新版源码里/ws/broker请求都没有了</span></span><br><span class=\"line\"><span class=\"comment\"># dokku apps:create drone-agent</span></span><br><span class=\"line\"><span class=\"comment\"># docker pull drone/agent:latest</span></span><br><span class=\"line\"><span class=\"comment\"># docker tag drone/agent:latest dokku/drone-agent:latest</span></span><br><span class=\"line\"><span class=\"comment\"># docker run -d -e DRONE_SERVER=wss://drone.erguotou.me/ws/broker -e DRONE_SECRET=password -e DRONE_TIMEOUT=15m -v /var/run/docker.sock:/var/run/docker.sock --restart=always --name=drone-agent-docker drone/drone:0.7.3 agent</span></span><br><span class=\"line\"><span class=\"comment\"># 配置agent的环境变量</span></span><br><span class=\"line\"><span class=\"comment\"># dokku config:set drone-agent DRONE_SERVER=wss://drone.erguotou.me/ws/broker DRONE_SECRET=secret</span></span><br><span class=\"line\"><span class=\"comment\"># dokku storage:mount drone-agent /var/run/docker.sock:/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"comment\"># dokku tags:deploy drone-agent latest</span></span><br></pre></td></tr></table></figure>\n<ol start=\"7\">\n<li>检查应用运行情况<br>\n可使用的命令</li>\n</ol>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dokku proxy:report app</span><br><span class=\"line\">dokku proxy:ports-remove app http:80:3000</span><br><span class=\"line\">dokku proxy:ports-add app http:80:3000</span><br><span class=\"line\">cat /home/dokku/app/nginx.conf</span><br><span class=\"line\">dokku ps:stop app</span><br><span class=\"line\">dokku ps:start app</span><br></pre></td></tr></table></figure>\n<ol start=\"8\">\n<li>创建自己的应用<br>\n在<code>dokku</code>中创建对应的app <code>dokku apps:create gift</code>，完成域名映射，配置<code>proxy:ports</code>，使用<code>Let's encrypt</code>插件进行https加密，这些步骤就不多说了。接着在gogs中创建对应的一个仓库，记得项目根目录下要有一个<code>.drone.yml</code>文件（参考<a href=\"https://docs.drone.io/user-guide/\">https://docs.drone.io/user-guide/</a>进行配置），然后提交代码。</li>\n<li>自动发布应用<br>\nCD可以有很多种方法，具体还得根据部署环境决定。可以直接用<code>drone</code>中现有的插件去实现也可以自己去开发<code>drone</code>的插件。下面记录的是以前的骚操作完成的项目部署方案。<br>\n上一步只能使用drone进行自动构建，要想将构建后的项目自动打包发布，还需要一些额外的操作（这里也是坑了自己好久，主要难题是如何将drone agent生成的文件发布到dokku git里，后来经人提醒可以通过共享ssh的方式，然后后续的共享ssh的操作也是摸索了好久才成功，可谓一路心酸）。</li>\n</ol>\n<ul>\n<li>\n<p>找1台虚机生成一份新的ssh公私钥对（也可以本地备份原来的，然后重新生成）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"dokku-deploy\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>将上一步生成的<code>id_rsa.pub</code>上传至服务器并添加到dokku中</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># local</span></span><br><span class=\"line\">scp ~/.ssh/id_rsa.pub root@erguotou.me:/root/deploy.pub</span><br><span class=\"line\"><span class=\"comment\"># server</span></span><br><span class=\"line\">dokku ssh-keys:add deploy ./deploy.pub</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>项目根目录新建一个<code>ssh</code>目录，然后将上一步生成的ssh公私钥复制进去</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp ~/.ssh/id_rsa* ./ssh</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>修改原来的<code>.drone.yml</code>，在原来build之后添加一些操作</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- rm -rf ~/.ssh</span><br><span class=\"line\">- mkdir -p ~/.ssh</span><br><span class=\"line\">- cp ssh/* ~/.ssh</span><br><span class=\"line\">- chmod 600 ~/.ssh/id_rsa <span class=\"comment\"># 特别要注意这3行</span></span><br><span class=\"line\">- chmod 644 ~/.ssh/id_rsa.pub</span><br><span class=\"line\">- ssh-keyscan erguotou.me &gt;&gt; ~/.ssh/known_hosts</span><br><span class=\"line\">- ssh-keyscan 45.77.42.201 &gt;&gt; ~/.ssh/known_hosts</span><br><span class=\"line\">- <span class=\"built_in\">echo</span> <span class=\"string\">'FROM ilyasemenov/dokku-static-site'</span> &gt; dist/Dockerfile <span class=\"comment\"># 根据自己的项目选择合适的Dockerfile或者实现适合自己项目的Dockerfile，也可以使用buildpacks</span></span><br><span class=\"line\">- <span class=\"built_in\">cd</span> dist</span><br><span class=\"line\">- git config --global user.email <span class=\"string\">\"erguotou525@gmail.com\"</span></span><br><span class=\"line\">- git config --global user.name <span class=\"string\">\"erguotou\"</span></span><br><span class=\"line\">- git init</span><br><span class=\"line\">- git add ./ -A</span><br><span class=\"line\">- git commit -m <span class=\"string\">\"auto build\"</span></span><br><span class=\"line\">- git remote add dokku dokku@erguotou.me:gift</span><br><span class=\"line\">- git push -u dokku master --force</span><br></pre></td></tr></table></figure>\n<p>至此就完成了自动化部署的工作，现在就可以访问<a href=\"https://gift.erguotou.me\">https://gift.erguotou.me</a>了。</p>\n</li>\n</ul>"},{"title":"Ghost源码解读系列（一）目录结构","s":"ghost-code-1","date":"2015-01-28T06:04:00.000Z","seo":{"title":"Ghost源码分析解读"},"_content":"**本系列文章以Ghost0.5.8安装版本为基础，后续版本升级时可能会做升级记录日志**\n*由于个人水平和理解有限，可能部分地方没有给出分析或者解读有误，欢迎指正*\n<!-- more -->\n## Ghost目录结构\n```\n├content: 内容\n　├apps: 以后Ghost开发的app会放在这个目录下，期待吧！\n　├data: 数据文件夹，请勿修改此文件下任何内容，默认sqlite数据文件会存放与此\n　├images: 图片文件夹，默认使用本地存储时，上传的图片会存于此处\n　├themes: 主题文件夹，所有的主题文件夹存放于此，下面以默认的casper主题为例\n　　├casper: 默认主题\n　　　├assets: 资源目录，不做更多介绍\n　　　├partials:\n　　　author.hbs: 作者页面\n　　　default.hbs:\n　　　index.hbs: 首页\n　　　page.hbs:\n　　　post.hbs:\n　　　tag.hbs:\n├core: 核心模块\n　├built: 用Grunt合并压缩后的js代码，不做展开介绍\n　├client: 客户端代码，主要是js css font image等内容，后续详细介绍\n　├server: 服务端代码，后续详细介绍\n　├shared: 共享文件\n　index.js: 服务器启动入口文件\n.bower.json: bower文件配置\n.config.example.js: 示例的配置文件\nGruntfile.js: grunt配置\nindex.js: 主入口函数，启动函数位置\nLICENSE: LICENSE\npackage.json: 项目配置\nPRIVACY.md: 隐私控制，可用的第三方功能说明，可以在config.js中修改\nREADME.md: 项目说明文档\n```\n","source":"_posts/ghost-code-1.md","raw":"---\ntitle: Ghost源码解读系列（一）目录结构\ns: ghost-code-1\ndate: 2015-01-28 14:04:00\ntags:\n  - Ghost\nseo:\n  title: Ghost源码分析解读\n---\n**本系列文章以Ghost0.5.8安装版本为基础，后续版本升级时可能会做升级记录日志**\n*由于个人水平和理解有限，可能部分地方没有给出分析或者解读有误，欢迎指正*\n<!-- more -->\n## Ghost目录结构\n```\n├content: 内容\n　├apps: 以后Ghost开发的app会放在这个目录下，期待吧！\n　├data: 数据文件夹，请勿修改此文件下任何内容，默认sqlite数据文件会存放与此\n　├images: 图片文件夹，默认使用本地存储时，上传的图片会存于此处\n　├themes: 主题文件夹，所有的主题文件夹存放于此，下面以默认的casper主题为例\n　　├casper: 默认主题\n　　　├assets: 资源目录，不做更多介绍\n　　　├partials:\n　　　author.hbs: 作者页面\n　　　default.hbs:\n　　　index.hbs: 首页\n　　　page.hbs:\n　　　post.hbs:\n　　　tag.hbs:\n├core: 核心模块\n　├built: 用Grunt合并压缩后的js代码，不做展开介绍\n　├client: 客户端代码，主要是js css font image等内容，后续详细介绍\n　├server: 服务端代码，后续详细介绍\n　├shared: 共享文件\n　index.js: 服务器启动入口文件\n.bower.json: bower文件配置\n.config.example.js: 示例的配置文件\nGruntfile.js: grunt配置\nindex.js: 主入口函数，启动函数位置\nLICENSE: LICENSE\npackage.json: 项目配置\nPRIVACY.md: 隐私控制，可用的第三方功能说明，可以在config.js中修改\nREADME.md: 项目说明文档\n```\n","slug":"ghost-code-1","published":1,"updated":"2019-03-26T13:47:04.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox07000ltof91d05jwbh","content":"<p><strong>本系列文章以Ghost0.5.8安装版本为基础，后续版本升级时可能会做升级记录日志</strong><br>\n<em>由于个人水平和理解有限，可能部分地方没有给出分析或者解读有误，欢迎指正</em></p>\n<a id=\"more\"></a>\n<h2 id=\"Ghost目录结构\"><a class=\"header-anchor\" href=\"#Ghost目录结构\">¶</a>Ghost目录结构</h2>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├content: 内容</span><br><span class=\"line\">　├apps: 以后Ghost开发的app会放在这个目录下，期待吧！</span><br><span class=\"line\">　├data: 数据文件夹，请勿修改此文件下任何内容，默认sqlite数据文件会存放与此</span><br><span class=\"line\">　├images: 图片文件夹，默认使用本地存储时，上传的图片会存于此处</span><br><span class=\"line\">　├themes: 主题文件夹，所有的主题文件夹存放于此，下面以默认的casper主题为例</span><br><span class=\"line\">　　├casper: 默认主题</span><br><span class=\"line\">　　　├assets: 资源目录，不做更多介绍</span><br><span class=\"line\">　　　├partials:</span><br><span class=\"line\">　　　author.hbs: 作者页面</span><br><span class=\"line\">　　　default.hbs:</span><br><span class=\"line\">　　　index.hbs: 首页</span><br><span class=\"line\">　　　page.hbs:</span><br><span class=\"line\">　　　post.hbs:</span><br><span class=\"line\">　　　tag.hbs:</span><br><span class=\"line\">├core: 核心模块</span><br><span class=\"line\">　├built: 用Grunt合并压缩后的js代码，不做展开介绍</span><br><span class=\"line\">　├client: 客户端代码，主要是js css font image等内容，后续详细介绍</span><br><span class=\"line\">　├server: 服务端代码，后续详细介绍</span><br><span class=\"line\">　├shared: 共享文件</span><br><span class=\"line\">　index.js: 服务器启动入口文件</span><br><span class=\"line\">.bower.json: bower文件配置</span><br><span class=\"line\">.config.example.js: 示例的配置文件</span><br><span class=\"line\">Gruntfile.js: grunt配置</span><br><span class=\"line\">index.js: 主入口函数，启动函数位置</span><br><span class=\"line\">LICENSE: LICENSE</span><br><span class=\"line\">package.json: 项目配置</span><br><span class=\"line\">PRIVACY.md: 隐私控制，可用的第三方功能说明，可以在config.js中修改</span><br><span class=\"line\">README.md: 项目说明文档</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p><strong>本系列文章以Ghost0.5.8安装版本为基础，后续版本升级时可能会做升级记录日志</strong><br>\n<em>由于个人水平和理解有限，可能部分地方没有给出分析或者解读有误，欢迎指正</em></p>","more":"<h2 id=\"Ghost目录结构\"><a class=\"header-anchor\" href=\"#Ghost目录结构\">¶</a>Ghost目录结构</h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├content: 内容</span><br><span class=\"line\">　├apps: 以后Ghost开发的app会放在这个目录下，期待吧！</span><br><span class=\"line\">　├data: 数据文件夹，请勿修改此文件下任何内容，默认sqlite数据文件会存放与此</span><br><span class=\"line\">　├images: 图片文件夹，默认使用本地存储时，上传的图片会存于此处</span><br><span class=\"line\">　├themes: 主题文件夹，所有的主题文件夹存放于此，下面以默认的casper主题为例</span><br><span class=\"line\">　　├casper: 默认主题</span><br><span class=\"line\">　　　├assets: 资源目录，不做更多介绍</span><br><span class=\"line\">　　　├partials:</span><br><span class=\"line\">　　　author.hbs: 作者页面</span><br><span class=\"line\">　　　default.hbs:</span><br><span class=\"line\">　　　index.hbs: 首页</span><br><span class=\"line\">　　　page.hbs:</span><br><span class=\"line\">　　　post.hbs:</span><br><span class=\"line\">　　　tag.hbs:</span><br><span class=\"line\">├core: 核心模块</span><br><span class=\"line\">　├built: 用Grunt合并压缩后的js代码，不做展开介绍</span><br><span class=\"line\">　├client: 客户端代码，主要是js css font image等内容，后续详细介绍</span><br><span class=\"line\">　├server: 服务端代码，后续详细介绍</span><br><span class=\"line\">　├shared: 共享文件</span><br><span class=\"line\">　index.js: 服务器启动入口文件</span><br><span class=\"line\">.bower.json: bower文件配置</span><br><span class=\"line\">.config.example.js: 示例的配置文件</span><br><span class=\"line\">Gruntfile.js: grunt配置</span><br><span class=\"line\">index.js: 主入口函数，启动函数位置</span><br><span class=\"line\">LICENSE: LICENSE</span><br><span class=\"line\">package.json: 项目配置</span><br><span class=\"line\">PRIVACY.md: 隐私控制，可用的第三方功能说明，可以在config.js中修改</span><br><span class=\"line\">README.md: 项目说明文档</span><br></pre></td></tr></table></figure>"},{"title":"在搬瓦工上安装Ghost","s":"ghost-on-banwagong","date":"2015-02-05T04:35:00.000Z","_content":"1. 前面的内容不做介绍，SSH连接上（本文以CentOS 6 64位系统做说明）\n2. 安装需要的环境，中间有确认的过程，直接输入y回车\n```bash\nyum install libtool automake autoconf gcc-c++ openssl-devel\n```\n<!-- more -->\n3. 在/home目录下新建一个目录（名字随意，主要用于存放我们的文件，本例使用的是latazu）`latazu`，并下载我们需要的文件nodejs、ghost\n```bash\ncd /home\nmkdir latazu\ncd latazu\nwget http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz\nwget http://cdn.diancloud.com/ghost/releases/Ghost-0.5.8-zh.zip\n```\n4. 编译安装nodejs（make的过程有点长，耐心等待）\n```bash\ntar zxvf node-v0.10.36.tar.gz\ncd node-v0.10.36\n./configure\nmake && make install\n```\n5. 解压ghost文件，并配置ghost配置文件`config.js`\n```bash\ncd ../\nunzip Ghost-0.5.8-zh.zip -d ghost\ncd ghost\ncp config.example.js config.js\nvi config.js\n```\n配置完成后保存（具体配置不做详细说明）\n6. 安装依赖文件（只安装生产环境需要的文件）\n```bash\nnpm install --production\n```\n*如果npm过程中出现glibc版本过低的问题，请参考[\"libc.so.6: version `GLIBC_2.14' not found\"系统的glibc版本太低](http://www.cnblogs.com/gw811/p/3676856.html)升级glibc版本*\n\n7. 设置环境变量并启动Ghost（这里使用的是forever守护进程）\n```bash\nexport NODE_ENV=production\nnpm install -g forever\nforever start index.js\n```\n8. 安装Nginx\n```bash\nrpm -Uvh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\nyum install nginx\n```\n配置nginx（新建一个配置文件`ghost.conf`，下面有一个样例）\n```bash\nmkdir /etc/nginx/logs\nvi /etc/nginx/conf.d/ghost.conf\n\nserver {\n\tlisten       80;\n    server_name  www.renshiwo.me renshiwo.me;\n\tcharset      utf-8;\n\taccess_log   logs/ghost.log;\n\tlocation / {\n\t\tproxy_set_header X-Real-IP $remote_addr;\n\t\tproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\t\tproxy_set_header Host $http_host;\n\t\tproxy_set_header X-NginX-Proxy true;\n\n\t\tproxy_pass http://127.0.0.1:2368;\n\t\tproxy_redirect off;\n\t}\n}\n\n```\n9. 启动nginx，并设置开机自启动\n```bash\nservice start nginx\nchkconfig nginx on\n```\n\nOK!可以了，现在访问你的域名看看吧！哦~对了，不要忘记设置域名解析！\n\n\n其它后续操作\n  1.安装FTP [vsftpd的安装配置](http://noblog.xyz/conf-vsptdd-user/)\n  2.安装ShandowSocks（翻墙必备） [CentOS下shadowsocks一键安装脚本](http://teddysun.com/342.html)\n","source":"_posts/ghost-on-banwagong.md","raw":"---\ntitle: 在搬瓦工上安装Ghost\ns: ghost-on-banwagong\ndate: 2015-02-05 12:35:00\ntags:\n  - Ghost\n  - Vps\n---\n1. 前面的内容不做介绍，SSH连接上（本文以CentOS 6 64位系统做说明）\n2. 安装需要的环境，中间有确认的过程，直接输入y回车\n```bash\nyum install libtool automake autoconf gcc-c++ openssl-devel\n```\n<!-- more -->\n3. 在/home目录下新建一个目录（名字随意，主要用于存放我们的文件，本例使用的是latazu）`latazu`，并下载我们需要的文件nodejs、ghost\n```bash\ncd /home\nmkdir latazu\ncd latazu\nwget http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz\nwget http://cdn.diancloud.com/ghost/releases/Ghost-0.5.8-zh.zip\n```\n4. 编译安装nodejs（make的过程有点长，耐心等待）\n```bash\ntar zxvf node-v0.10.36.tar.gz\ncd node-v0.10.36\n./configure\nmake && make install\n```\n5. 解压ghost文件，并配置ghost配置文件`config.js`\n```bash\ncd ../\nunzip Ghost-0.5.8-zh.zip -d ghost\ncd ghost\ncp config.example.js config.js\nvi config.js\n```\n配置完成后保存（具体配置不做详细说明）\n6. 安装依赖文件（只安装生产环境需要的文件）\n```bash\nnpm install --production\n```\n*如果npm过程中出现glibc版本过低的问题，请参考[\"libc.so.6: version `GLIBC_2.14' not found\"系统的glibc版本太低](http://www.cnblogs.com/gw811/p/3676856.html)升级glibc版本*\n\n7. 设置环境变量并启动Ghost（这里使用的是forever守护进程）\n```bash\nexport NODE_ENV=production\nnpm install -g forever\nforever start index.js\n```\n8. 安装Nginx\n```bash\nrpm -Uvh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\nyum install nginx\n```\n配置nginx（新建一个配置文件`ghost.conf`，下面有一个样例）\n```bash\nmkdir /etc/nginx/logs\nvi /etc/nginx/conf.d/ghost.conf\n\nserver {\n\tlisten       80;\n    server_name  www.renshiwo.me renshiwo.me;\n\tcharset      utf-8;\n\taccess_log   logs/ghost.log;\n\tlocation / {\n\t\tproxy_set_header X-Real-IP $remote_addr;\n\t\tproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\t\tproxy_set_header Host $http_host;\n\t\tproxy_set_header X-NginX-Proxy true;\n\n\t\tproxy_pass http://127.0.0.1:2368;\n\t\tproxy_redirect off;\n\t}\n}\n\n```\n9. 启动nginx，并设置开机自启动\n```bash\nservice start nginx\nchkconfig nginx on\n```\n\nOK!可以了，现在访问你的域名看看吧！哦~对了，不要忘记设置域名解析！\n\n\n其它后续操作\n  1.安装FTP [vsftpd的安装配置](http://noblog.xyz/conf-vsptdd-user/)\n  2.安装ShandowSocks（翻墙必备） [CentOS下shadowsocks一键安装脚本](http://teddysun.com/342.html)\n","slug":"ghost-on-banwagong","published":1,"updated":"2019-03-26T13:47:04.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox08000ntof9aovtdklx","content":"<ol>\n<li>前面的内容不做介绍，SSH连接上（本文以CentOS 6 64位系统做说明）</li>\n<li>安装需要的环境，中间有确认的过程，直接输入y回车</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libtool automake autoconf gcc-c++ openssl-devel</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<ol start=\"3\">\n<li>在/home目录下新建一个目录（名字随意，主要用于存放我们的文件，本例使用的是latazu）<code>latazu</code>，并下载我们需要的文件nodejs、ghost</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-built_in\">cd</span> /home</span><br><span class=\"line\">mkdir latazu</span><br><span class=\"line\"><span class=\"hljs-built_in\">cd</span> latazu</span><br><span class=\"line\">wget http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz</span><br><span class=\"line\">wget http://cdn.diancloud.com/ghost/releases/Ghost-0.5.8-zh.zip</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>编译安装nodejs（make的过程有点长，耐心等待）</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf node-v0.10.36.tar.gz</span><br><span class=\"line\"><span class=\"hljs-built_in\">cd</span> node-v0.10.36</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>解压ghost文件，并配置ghost配置文件<code>config.js</code></li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-built_in\">cd</span> ../</span><br><span class=\"line\">unzip Ghost-0.5.8-zh.zip -d ghost</span><br><span class=\"line\"><span class=\"hljs-built_in\">cd</span> ghost</span><br><span class=\"line\">cp config.example.js config.js</span><br><span class=\"line\">vi config.js</span><br></pre></td></tr></table></figure>\n<p>配置完成后保存（具体配置不做详细说明）<br>\n6. 安装依赖文件（只安装生产环境需要的文件）</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --production</span><br></pre></td></tr></table></figure>\n<p><em>如果npm过程中出现glibc版本过低的问题，请参考<a href=\"http://www.cnblogs.com/gw811/p/3676856.html\">&quot;libc.so.6: version `GLIBC_2.14’ not found&quot;系统的glibc版本太低</a>升级glibc版本</em></p>\n<ol start=\"7\">\n<li>设置环境变量并启动Ghost（这里使用的是forever守护进程）</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-built_in\">export</span> NODE_ENV=production</span><br><span class=\"line\">npm install -g forever</span><br><span class=\"line\">forever start index.js</span><br></pre></td></tr></table></figure>\n<ol start=\"8\">\n<li>安装Nginx</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -Uvh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm</span><br><span class=\"line\">yum install nginx</span><br></pre></td></tr></table></figure>\n<p>配置nginx（新建一个配置文件<code>ghost.conf</code>，下面有一个样例）</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /etc/nginx/logs</span><br><span class=\"line\">vi /etc/nginx/conf.d/ghost.conf</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">\tlisten       80;</span><br><span class=\"line\">    server_name  www.renshiwo.me renshiwo.me;</span><br><span class=\"line\">\tcharset      utf-8;</span><br><span class=\"line\">\taccess_log   logs/ghost.log;</span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\tproxy_set_header X-Real-IP <span class=\"hljs-variable\">$remote_addr</span>;</span><br><span class=\"line\">\t\tproxy_set_header X-Forwarded-For <span class=\"hljs-variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">\t\tproxy_set_header Host <span class=\"hljs-variable\">$http_host</span>;</span><br><span class=\"line\">\t\tproxy_set_header X-NginX-Proxy <span class=\"hljs-literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tproxy_pass http://127.0.0.1:2368;</span><br><span class=\"line\">\t\tproxy_redirect off;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"9\">\n<li>启动nginx，并设置开机自启动</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service start nginx</span><br><span class=\"line\">chkconfig nginx on</span><br></pre></td></tr></table></figure>\n<p>OK!可以了，现在访问你的域名看看吧！哦~对了，不要忘记设置域名解析！</p>\n<p>其它后续操作<br>\n1.安装FTP <a href=\"http://noblog.xyz/conf-vsptdd-user/\">vsftpd的安装配置</a><br>\n2.安装ShandowSocks（翻墙必备） <a href=\"http://teddysun.com/342.html\">CentOS下shadowsocks一键安装脚本</a></p>\n","site":{"data":{}},"excerpt":"<ol>\n<li>前面的内容不做介绍，SSH连接上（本文以CentOS 6 64位系统做说明）</li>\n<li>安装需要的环境，中间有确认的过程，直接输入y回车</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libtool automake autoconf gcc-c++ openssl-devel</span><br></pre></td></tr></table></figure>","more":"<ol start=\"3\">\n<li>在/home目录下新建一个目录（名字随意，主要用于存放我们的文件，本例使用的是latazu）<code>latazu</code>，并下载我们需要的文件nodejs、ghost</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /home</span><br><span class=\"line\">mkdir latazu</span><br><span class=\"line\"><span class=\"built_in\">cd</span> latazu</span><br><span class=\"line\">wget http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz</span><br><span class=\"line\">wget http://cdn.diancloud.com/ghost/releases/Ghost-0.5.8-zh.zip</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>编译安装nodejs（make的过程有点长，耐心等待）</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf node-v0.10.36.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> node-v0.10.36</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>解压ghost文件，并配置ghost配置文件<code>config.js</code></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> ../</span><br><span class=\"line\">unzip Ghost-0.5.8-zh.zip -d ghost</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ghost</span><br><span class=\"line\">cp config.example.js config.js</span><br><span class=\"line\">vi config.js</span><br></pre></td></tr></table></figure>\n<p>配置完成后保存（具体配置不做详细说明）<br>\n6. 安装依赖文件（只安装生产环境需要的文件）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --production</span><br></pre></td></tr></table></figure>\n<p><em>如果npm过程中出现glibc版本过低的问题，请参考<a href=\"http://www.cnblogs.com/gw811/p/3676856.html\">&quot;libc.so.6: version `GLIBC_2.14’ not found&quot;系统的glibc版本太低</a>升级glibc版本</em></p>\n<ol start=\"7\">\n<li>设置环境变量并启动Ghost（这里使用的是forever守护进程）</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> NODE_ENV=production</span><br><span class=\"line\">npm install -g forever</span><br><span class=\"line\">forever start index.js</span><br></pre></td></tr></table></figure>\n<ol start=\"8\">\n<li>安装Nginx</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -Uvh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm</span><br><span class=\"line\">yum install nginx</span><br></pre></td></tr></table></figure>\n<p>配置nginx（新建一个配置文件<code>ghost.conf</code>，下面有一个样例）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /etc/nginx/logs</span><br><span class=\"line\">vi /etc/nginx/conf.d/ghost.conf</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">\tlisten       80;</span><br><span class=\"line\">    server_name  www.renshiwo.me renshiwo.me;</span><br><span class=\"line\">\tcharset      utf-8;</span><br><span class=\"line\">\taccess_log   logs/ghost.log;</span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\tproxy_set_header X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">\t\tproxy_set_header X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">\t\tproxy_set_header Host <span class=\"variable\">$http_host</span>;</span><br><span class=\"line\">\t\tproxy_set_header X-NginX-Proxy <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tproxy_pass http://127.0.0.1:2368;</span><br><span class=\"line\">\t\tproxy_redirect off;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"9\">\n<li>启动nginx，并设置开机自启动</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service start nginx</span><br><span class=\"line\">chkconfig nginx on</span><br></pre></td></tr></table></figure>\n<p>OK!可以了，现在访问你的域名看看吧！哦~对了，不要忘记设置域名解析！</p>\n<p>其它后续操作<br>\n1.安装FTP <a href=\"http://noblog.xyz/conf-vsptdd-user/\">vsftpd的安装配置</a><br>\n2.安装ShandowSocks（翻墙必备） <a href=\"http://teddysun.com/342.html\">CentOS下shadowsocks一键安装脚本</a></p>"},{"title":"在OpenShift上安装Ghost","s":"ghost-on-openshift","date":"2015-04-29T12:29:00.000Z","_content":"使用OpenShift(以下简称OS)搭建Ghost环境的好处就是简单、免费，速度还不错。如果只是希望使用Ghost的用户不妨试试吧。\n<!-- more -->\n## 注册OS并登录\n这一步不做介绍，很简单。\n## 创建Ghost\n1. 在OS的控制台中切换到`Applications`页面，点击`Add Application`。\n2. 在搜索输入框中输入`ghost`并回车，在搜索结果页面中点击`Ghost 0.5.10`(目前版本)。\n3. 在`Public URL`中输入一个唯一的二级域名，这里输入的内容不重要，后面可以使用自己的域名，其它默认就可以了，点击`Create Application`。\n4. 完成后的页面可以无视，重新点击`Applications`就可以看到已经创建好的Ghost博客了，点击进去可以看到系统给你分配的二级域名，点击此链接即可访问博客。\n## 使用自定义的域名\n1. 在上面第4步的二级域名旁有一个`change`链接，点击之。\n2. 在新页面的`Domain name`里输入你想要绑定的域名，下面的ssl本文不做介绍，接着点击下面的`Save`按钮。\n3. 最后在你的域名的dns解析的地方加一条cname解析，cname的指向是之前系统给你分配的二级域名。配置好了以后等待一段时间，你就可以用你自定义的域名来访问Ghost博客了。\n## Ghost汉化与升级\n### 汉化\n汉化我采用的是[GhostChina](http://www.ghostchina.com/)提供的汉化版本。\n1. 首先去下载页面下载最新的版本。\n2. 然后再OS的控制台的应用界面里面找到`Source Code`。\n  ![Source Code](/images/ghost/openshift-source-code.png)复制此地址。\n3. 使用git拷贝项目\n\n  ```bash\n  #xxxxxx是刚复制的地址\n  git clone ssh://xxxxxx\n  ```\n4. 将第1步下载的中文版的`/content/themes/casper-zh`目录下的所有文件拷贝到第3步clone的项目下的`/content/themes/casper`目录下并覆盖原文件。将中文版的`/core`目录下的所有文件拷贝到第3步clone的项目下的`/core`目录下并覆盖原文件。\n5. 在第3步clone的项目的根目录下执行\n  ```bash\n  git add ./ --all\n  git commit-m \"hanhua\"\n  git push\n  ```\n\n  *在执行push前请在OS中添加自己电脑的ssh公钥，生成公钥的方法可参考[Git SSH Key 生成步骤](http://blog.csdn.net/hustpzb/article/details/8230454/)，OS添加公钥的方法就是点击`Settings`-->`Add a new key`，在`Key name`中输入一个名字，在`Paste the contents of your public key file`中输入你的公钥并保存。*\n\n  push完成后系统会自动重启，无需担心重启的问题，完成后再次访问你的域名吧。\n### 升级\n升级请参照[更新 Ghost](http://docs.ghostchina.com/zh/installation/upgrading/)\n","source":"_posts/ghost-on-openshift.md","raw":"---\ntitle: 在OpenShift上安装Ghost\ns: ghost-on-openshift\ndate: 2015-04-29 20:29:00\ntags:\n  - Ghost\n---\n使用OpenShift(以下简称OS)搭建Ghost环境的好处就是简单、免费，速度还不错。如果只是希望使用Ghost的用户不妨试试吧。\n<!-- more -->\n## 注册OS并登录\n这一步不做介绍，很简单。\n## 创建Ghost\n1. 在OS的控制台中切换到`Applications`页面，点击`Add Application`。\n2. 在搜索输入框中输入`ghost`并回车，在搜索结果页面中点击`Ghost 0.5.10`(目前版本)。\n3. 在`Public URL`中输入一个唯一的二级域名，这里输入的内容不重要，后面可以使用自己的域名，其它默认就可以了，点击`Create Application`。\n4. 完成后的页面可以无视，重新点击`Applications`就可以看到已经创建好的Ghost博客了，点击进去可以看到系统给你分配的二级域名，点击此链接即可访问博客。\n## 使用自定义的域名\n1. 在上面第4步的二级域名旁有一个`change`链接，点击之。\n2. 在新页面的`Domain name`里输入你想要绑定的域名，下面的ssl本文不做介绍，接着点击下面的`Save`按钮。\n3. 最后在你的域名的dns解析的地方加一条cname解析，cname的指向是之前系统给你分配的二级域名。配置好了以后等待一段时间，你就可以用你自定义的域名来访问Ghost博客了。\n## Ghost汉化与升级\n### 汉化\n汉化我采用的是[GhostChina](http://www.ghostchina.com/)提供的汉化版本。\n1. 首先去下载页面下载最新的版本。\n2. 然后再OS的控制台的应用界面里面找到`Source Code`。\n  ![Source Code](/images/ghost/openshift-source-code.png)复制此地址。\n3. 使用git拷贝项目\n\n  ```bash\n  #xxxxxx是刚复制的地址\n  git clone ssh://xxxxxx\n  ```\n4. 将第1步下载的中文版的`/content/themes/casper-zh`目录下的所有文件拷贝到第3步clone的项目下的`/content/themes/casper`目录下并覆盖原文件。将中文版的`/core`目录下的所有文件拷贝到第3步clone的项目下的`/core`目录下并覆盖原文件。\n5. 在第3步clone的项目的根目录下执行\n  ```bash\n  git add ./ --all\n  git commit-m \"hanhua\"\n  git push\n  ```\n\n  *在执行push前请在OS中添加自己电脑的ssh公钥，生成公钥的方法可参考[Git SSH Key 生成步骤](http://blog.csdn.net/hustpzb/article/details/8230454/)，OS添加公钥的方法就是点击`Settings`-->`Add a new key`，在`Key name`中输入一个名字，在`Paste the contents of your public key file`中输入你的公钥并保存。*\n\n  push完成后系统会自动重启，无需担心重启的问题，完成后再次访问你的域名吧。\n### 升级\n升级请参照[更新 Ghost](http://docs.ghostchina.com/zh/installation/upgrading/)\n","slug":"ghost-on-openshift","published":1,"updated":"2019-03-26T13:47:04.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox08000ptof9ekdhruv0","content":"<p>使用OpenShift(以下简称OS)搭建Ghost环境的好处就是简单、免费，速度还不错。如果只是希望使用Ghost的用户不妨试试吧。</p>\n<a id=\"more\"></a>\n<h2 id=\"注册OS并登录\"><a class=\"header-anchor\" href=\"#注册OS并登录\">¶</a>注册OS并登录</h2>\n<p>这一步不做介绍，很简单。</p>\n<h2 id=\"创建Ghost\"><a class=\"header-anchor\" href=\"#创建Ghost\">¶</a>创建Ghost</h2>\n<ol>\n<li>在OS的控制台中切换到<code>Applications</code>页面，点击<code>Add Application</code>。</li>\n<li>在搜索输入框中输入<code>ghost</code>并回车，在搜索结果页面中点击<code>Ghost 0.5.10</code>(目前版本)。</li>\n<li>在<code>Public URL</code>中输入一个唯一的二级域名，这里输入的内容不重要，后面可以使用自己的域名，其它默认就可以了，点击<code>Create Application</code>。</li>\n<li>完成后的页面可以无视，重新点击<code>Applications</code>就可以看到已经创建好的Ghost博客了，点击进去可以看到系统给你分配的二级域名，点击此链接即可访问博客。</li>\n</ol>\n<h2 id=\"使用自定义的域名\"><a class=\"header-anchor\" href=\"#使用自定义的域名\">¶</a>使用自定义的域名</h2>\n<ol>\n<li>在上面第4步的二级域名旁有一个<code>change</code>链接，点击之。</li>\n<li>在新页面的<code>Domain name</code>里输入你想要绑定的域名，下面的ssl本文不做介绍，接着点击下面的<code>Save</code>按钮。</li>\n<li>最后在你的域名的dns解析的地方加一条cname解析，cname的指向是之前系统给你分配的二级域名。配置好了以后等待一段时间，你就可以用你自定义的域名来访问Ghost博客了。</li>\n</ol>\n<h2 id=\"Ghost汉化与升级\"><a class=\"header-anchor\" href=\"#Ghost汉化与升级\">¶</a>Ghost汉化与升级</h2>\n<h3 id=\"汉化\"><a class=\"header-anchor\" href=\"#汉化\">¶</a>汉化</h3>\n<p>汉化我采用的是<a href=\"http://www.ghostchina.com/\">GhostChina</a>提供的汉化版本。</p>\n<ol>\n<li>首先去下载页面下载最新的版本。</li>\n<li>然后再OS的控制台的应用界面里面找到<code>Source Code</code>。<br>\n<img src=\"/images/ghost/openshift-source-code.png\" alt=\"Source Code\">复制此地址。</li>\n<li>使用git拷贝项目</li>\n</ol>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">#xxxxxx是刚复制的地址</span></span><br><span class=\"line\">git <span class=\"hljs-built_in\">clone</span> ssh://xxxxxx</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>将第1步下载的中文版的<code>/content/themes/casper-zh</code>目录下的所有文件拷贝到第3步clone的项目下的<code>/content/themes/casper</code>目录下并覆盖原文件。将中文版的<code>/core</code>目录下的所有文件拷贝到第3步clone的项目下的<code>/core</code>目录下并覆盖原文件。</li>\n<li>在第3步clone的项目的根目录下执行</li>\n</ol>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add ./ --all</span><br><span class=\"line\">git commit-m <span class=\"hljs-string\">\"hanhua\"</span></span><br><span class=\"line\">git push</span><br></pre></td></tr></table></figure>\n<p><em>在执行push前请在OS中添加自己电脑的ssh公钥，生成公钥的方法可参考<a href=\"http://blog.csdn.net/hustpzb/article/details/8230454/\">Git SSH Key 生成步骤</a>，OS添加公钥的方法就是点击<code>Settings</code>–&gt;<code>Add a new key</code>，在<code>Key name</code>中输入一个名字，在<code>Paste the contents of your public key file</code>中输入你的公钥并保存。</em></p>\n<p>push完成后系统会自动重启，无需担心重启的问题，完成后再次访问你的域名吧。</p>\n<h3 id=\"升级\"><a class=\"header-anchor\" href=\"#升级\">¶</a>升级</h3>\n<p>升级请参照<a href=\"http://docs.ghostchina.com/zh/installation/upgrading/\">更新 Ghost</a></p>\n","site":{"data":{}},"excerpt":"<p>使用OpenShift(以下简称OS)搭建Ghost环境的好处就是简单、免费，速度还不错。如果只是希望使用Ghost的用户不妨试试吧。</p>","more":"<h2 id=\"注册OS并登录\"><a class=\"header-anchor\" href=\"#注册OS并登录\">¶</a>注册OS并登录</h2>\n<p>这一步不做介绍，很简单。</p>\n<h2 id=\"创建Ghost\"><a class=\"header-anchor\" href=\"#创建Ghost\">¶</a>创建Ghost</h2>\n<ol>\n<li>在OS的控制台中切换到<code>Applications</code>页面，点击<code>Add Application</code>。</li>\n<li>在搜索输入框中输入<code>ghost</code>并回车，在搜索结果页面中点击<code>Ghost 0.5.10</code>(目前版本)。</li>\n<li>在<code>Public URL</code>中输入一个唯一的二级域名，这里输入的内容不重要，后面可以使用自己的域名，其它默认就可以了，点击<code>Create Application</code>。</li>\n<li>完成后的页面可以无视，重新点击<code>Applications</code>就可以看到已经创建好的Ghost博客了，点击进去可以看到系统给你分配的二级域名，点击此链接即可访问博客。</li>\n</ol>\n<h2 id=\"使用自定义的域名\"><a class=\"header-anchor\" href=\"#使用自定义的域名\">¶</a>使用自定义的域名</h2>\n<ol>\n<li>在上面第4步的二级域名旁有一个<code>change</code>链接，点击之。</li>\n<li>在新页面的<code>Domain name</code>里输入你想要绑定的域名，下面的ssl本文不做介绍，接着点击下面的<code>Save</code>按钮。</li>\n<li>最后在你的域名的dns解析的地方加一条cname解析，cname的指向是之前系统给你分配的二级域名。配置好了以后等待一段时间，你就可以用你自定义的域名来访问Ghost博客了。</li>\n</ol>\n<h2 id=\"Ghost汉化与升级\"><a class=\"header-anchor\" href=\"#Ghost汉化与升级\">¶</a>Ghost汉化与升级</h2>\n<h3 id=\"汉化\"><a class=\"header-anchor\" href=\"#汉化\">¶</a>汉化</h3>\n<p>汉化我采用的是<a href=\"http://www.ghostchina.com/\">GhostChina</a>提供的汉化版本。</p>\n<ol>\n<li>首先去下载页面下载最新的版本。</li>\n<li>然后再OS的控制台的应用界面里面找到<code>Source Code</code>。<br>\n<img src=\"/images/ghost/openshift-source-code.png\" alt=\"Source Code\">复制此地址。</li>\n<li>使用git拷贝项目</li>\n</ol>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#xxxxxx是刚复制的地址</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> ssh://xxxxxx</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>将第1步下载的中文版的<code>/content/themes/casper-zh</code>目录下的所有文件拷贝到第3步clone的项目下的<code>/content/themes/casper</code>目录下并覆盖原文件。将中文版的<code>/core</code>目录下的所有文件拷贝到第3步clone的项目下的<code>/core</code>目录下并覆盖原文件。</li>\n<li>在第3步clone的项目的根目录下执行</li>\n</ol>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add ./ --all</span><br><span class=\"line\">git commit-m <span class=\"string\">\"hanhua\"</span></span><br><span class=\"line\">git push</span><br></pre></td></tr></table></figure>\n<p><em>在执行push前请在OS中添加自己电脑的ssh公钥，生成公钥的方法可参考<a href=\"http://blog.csdn.net/hustpzb/article/details/8230454/\">Git SSH Key 生成步骤</a>，OS添加公钥的方法就是点击<code>Settings</code>–&gt;<code>Add a new key</code>，在<code>Key name</code>中输入一个名字，在<code>Paste the contents of your public key file</code>中输入你的公钥并保存。</em></p>\n<p>push完成后系统会自动重启，无需担心重启的问题，完成后再次访问你的域名吧。</p>\n<h3 id=\"升级\"><a class=\"header-anchor\" href=\"#升级\">¶</a>升级</h3>\n<p>升级请参照<a href=\"http://docs.ghostchina.com/zh/installation/upgrading/\">更新 Ghost</a></p>"},{"title":"使用Swiftype完成Ghost搜索功能","s":"ghost-swiftype-guide","date":"2015-04-18T13:58:00.000Z","_content":"不知道出于什么目的，Ghost并没有给出搜索功能，但是我们可以使用第三方服务来完成站内搜索，本文推荐使用[Swiftype](https://swiftype.com/)来实现这一功能（不仅仅说Ghost可以使用该服务，所有需要站内搜索的都可以，可以查看本站[blog.erguotou.me](blog.erguotou.me)体验）。\n<!-- more -->\n## 注册\nOK，这一步不做过多介绍，应该都会，记得激活账号，激活后进入控制台主界面。\n## 创建一个搜索引擎\n![](/images/ghost/swiftype-create-engine.png)\n选择左侧的“Create a search engine(standard web crawler)”，然后输入你的Ghost博客地址。接着系统会验证你输入的网址，验证成功后在弹出框中输入引擎名称。\n## 安装搜索引擎\n1. 在控制面板中切换至“install”，点击\"Start Installation\"。在\"Appearance\"中选择搜索引擎到外貌，这里我选择默认设置一直Next下去，最后点击\"Save&Preview\"。\n2. 然后点击“Install Code”，将代码复制到你的Ghost中去（可以在default.hbs的body标签后面添加），完成后点击Next。\n3. 在“Search Field”中根据自己的情况（一般Ghost博客没有搜索输入框）选择，这里我选择第二个“ No, my site needs an input field”，接着选择“Use the Swiftype search tab”，下面会有一个预览样式，然后点击Next。\n4. 最后点击页面最下方的“Active Swiftype”就可以为你的Ghost博客提供一个样式不错的搜索引擎啦～\n","source":"_posts/ghost-swiftype-guide.md","raw":"---\ntitle: 使用Swiftype完成Ghost搜索功能\ns: ghost-swiftype-guide\ndate: 2015-04-18 21:58:00\ntags:\n  - Ghost\n  - Swiftype\n---\n不知道出于什么目的，Ghost并没有给出搜索功能，但是我们可以使用第三方服务来完成站内搜索，本文推荐使用[Swiftype](https://swiftype.com/)来实现这一功能（不仅仅说Ghost可以使用该服务，所有需要站内搜索的都可以，可以查看本站[blog.erguotou.me](blog.erguotou.me)体验）。\n<!-- more -->\n## 注册\nOK，这一步不做过多介绍，应该都会，记得激活账号，激活后进入控制台主界面。\n## 创建一个搜索引擎\n![](/images/ghost/swiftype-create-engine.png)\n选择左侧的“Create a search engine(standard web crawler)”，然后输入你的Ghost博客地址。接着系统会验证你输入的网址，验证成功后在弹出框中输入引擎名称。\n## 安装搜索引擎\n1. 在控制面板中切换至“install”，点击\"Start Installation\"。在\"Appearance\"中选择搜索引擎到外貌，这里我选择默认设置一直Next下去，最后点击\"Save&Preview\"。\n2. 然后点击“Install Code”，将代码复制到你的Ghost中去（可以在default.hbs的body标签后面添加），完成后点击Next。\n3. 在“Search Field”中根据自己的情况（一般Ghost博客没有搜索输入框）选择，这里我选择第二个“ No, my site needs an input field”，接着选择“Use the Swiftype search tab”，下面会有一个预览样式，然后点击Next。\n4. 最后点击页面最下方的“Active Swiftype”就可以为你的Ghost博客提供一个样式不错的搜索引擎啦～\n","slug":"ghost-swiftype-guide","published":1,"updated":"2019-03-26T13:47:04.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0a000qtof92wv27htb","content":"<p>不知道出于什么目的，Ghost并没有给出搜索功能，但是我们可以使用第三方服务来完成站内搜索，本文推荐使用<a href=\"https://swiftype.com/\">Swiftype</a>来实现这一功能（不仅仅说Ghost可以使用该服务，所有需要站内搜索的都可以，可以查看本站<a href=\"blog.erguotou.me\">blog.erguotou.me</a>体验）。</p>\n<a id=\"more\"></a>\n<h2 id=\"注册\"><a class=\"header-anchor\" href=\"#注册\">¶</a>注册</h2>\n<p>OK，这一步不做过多介绍，应该都会，记得激活账号，激活后进入控制台主界面。</p>\n<h2 id=\"创建一个搜索引擎\"><a class=\"header-anchor\" href=\"#创建一个搜索引擎\">¶</a>创建一个搜索引擎</h2>\n<p><img src=\"/images/ghost/swiftype-create-engine.png\" alt><br>\n选择左侧的“Create a search engine(standard web crawler)”，然后输入你的Ghost博客地址。接着系统会验证你输入的网址，验证成功后在弹出框中输入引擎名称。</p>\n<h2 id=\"安装搜索引擎\"><a class=\"header-anchor\" href=\"#安装搜索引擎\">¶</a>安装搜索引擎</h2>\n<ol>\n<li>在控制面板中切换至“install”，点击&quot;Start Installation&quot;。在&quot;Appearance&quot;中选择搜索引擎到外貌，这里我选择默认设置一直Next下去，最后点击&quot;Save&amp;Preview&quot;。</li>\n<li>然后点击“Install Code”，将代码复制到你的Ghost中去（可以在default.hbs的body标签后面添加），完成后点击Next。</li>\n<li>在“Search Field”中根据自己的情况（一般Ghost博客没有搜索输入框）选择，这里我选择第二个“ No, my site needs an input field”，接着选择“Use the Swiftype search tab”，下面会有一个预览样式，然后点击Next。</li>\n<li>最后点击页面最下方的“Active Swiftype”就可以为你的Ghost博客提供一个样式不错的搜索引擎啦～</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>不知道出于什么目的，Ghost并没有给出搜索功能，但是我们可以使用第三方服务来完成站内搜索，本文推荐使用<a href=\"https://swiftype.com/\">Swiftype</a>来实现这一功能（不仅仅说Ghost可以使用该服务，所有需要站内搜索的都可以，可以查看本站<a href=\"blog.erguotou.me\">blog.erguotou.me</a>体验）。</p>","more":"<h2 id=\"注册\"><a class=\"header-anchor\" href=\"#注册\">¶</a>注册</h2>\n<p>OK，这一步不做过多介绍，应该都会，记得激活账号，激活后进入控制台主界面。</p>\n<h2 id=\"创建一个搜索引擎\"><a class=\"header-anchor\" href=\"#创建一个搜索引擎\">¶</a>创建一个搜索引擎</h2>\n<p><img src=\"/images/ghost/swiftype-create-engine.png\" alt=\"\"><br>\n选择左侧的“Create a search engine(standard web crawler)”，然后输入你的Ghost博客地址。接着系统会验证你输入的网址，验证成功后在弹出框中输入引擎名称。</p>\n<h2 id=\"安装搜索引擎\"><a class=\"header-anchor\" href=\"#安装搜索引擎\">¶</a>安装搜索引擎</h2>\n<ol>\n<li>在控制面板中切换至“install”，点击&quot;Start Installation&quot;。在&quot;Appearance&quot;中选择搜索引擎到外貌，这里我选择默认设置一直Next下去，最后点击&quot;Save&amp;Preview&quot;。</li>\n<li>然后点击“Install Code”，将代码复制到你的Ghost中去（可以在default.hbs的body标签后面添加），完成后点击Next。</li>\n<li>在“Search Field”中根据自己的情况（一般Ghost博客没有搜索输入框）选择，这里我选择第二个“ No, my site needs an input field”，接着选择“Use the Swiftype search tab”，下面会有一个预览样式，然后点击Next。</li>\n<li>最后点击页面最下方的“Active Swiftype”就可以为你的Ghost博客提供一个样式不错的搜索引擎啦～</li>\n</ol>"},{"title":"在树莓派上安装Ghost的一些坑","s":"ghost-on-raspberry","date":"2015-11-07T16:45:00.000Z","_content":"最近开始玩树莓派，自然要在小pi上装个node，跑个Ghost啊。中途遇到了一些小坑，这里记录一下。\n<!-- more -->\n\n1. `raspbian`系统安装后默认只有大概4G左右的空间（可以使用`df -hl`查看磁盘空间），tf卡的其它空间浪费了，需要扩容到整个tf卡的大小。在`raspbian`中运行\n```bash\nsudo raspi-config\n```\n选择`expand_rootfs`，按照提示操作并重启。\n\n2. 删除了一些不需要的安装包。首先安装`wajig`（这个工具集成了apt-get/dpkg/aptitude等等）：\n```bash\nsudo apt-get install wajig -y\n```\n然后查看已安装的包\n```bash\nwajig large\n```\n找到后面几个用不到的且占用体积较大的删除掉，可一次性删除多个：\n```bash\nsudo aptitude remove xxxx xxxx xxxx\n```\n\n3. nodejs的`sqlite3`模块似乎没有arm平台的编译包，我也懒得自己编辑了，直接改成使用mysql了。\n\n4. 其它没什么不一样的，使用`pm2`守护Ghost，使用`Nginx`做代理，运行，OK！\n","source":"_posts/ghost-on-raspberry.md","raw":"---\ntitle: 在树莓派上安装Ghost的一些坑\ns: ghost-on-raspberry\ndate: 2015-11-08 00:45:00\ntags:\n  - Ghost\n  - Raspberry\n---\n最近开始玩树莓派，自然要在小pi上装个node，跑个Ghost啊。中途遇到了一些小坑，这里记录一下。\n<!-- more -->\n\n1. `raspbian`系统安装后默认只有大概4G左右的空间（可以使用`df -hl`查看磁盘空间），tf卡的其它空间浪费了，需要扩容到整个tf卡的大小。在`raspbian`中运行\n```bash\nsudo raspi-config\n```\n选择`expand_rootfs`，按照提示操作并重启。\n\n2. 删除了一些不需要的安装包。首先安装`wajig`（这个工具集成了apt-get/dpkg/aptitude等等）：\n```bash\nsudo apt-get install wajig -y\n```\n然后查看已安装的包\n```bash\nwajig large\n```\n找到后面几个用不到的且占用体积较大的删除掉，可一次性删除多个：\n```bash\nsudo aptitude remove xxxx xxxx xxxx\n```\n\n3. nodejs的`sqlite3`模块似乎没有arm平台的编译包，我也懒得自己编辑了，直接改成使用mysql了。\n\n4. 其它没什么不一样的，使用`pm2`守护Ghost，使用`Nginx`做代理，运行，OK！\n","slug":"ghost-on-raspberry","published":1,"updated":"2019-03-26T13:47:04.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0c000ttof9p5pv4113","content":"<p>最近开始玩树莓派，自然要在小pi上装个node，跑个Ghost啊。中途遇到了一些小坑，这里记录一下。</p>\n<a id=\"more\"></a>\n<ol>\n<li><code>raspbian</code>系统安装后默认只有大概4G左右的空间（可以使用<code>df -hl</code>查看磁盘空间），tf卡的其它空间浪费了，需要扩容到整个tf卡的大小。在<code>raspbian</code>中运行</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo raspi-config</span><br></pre></td></tr></table></figure>\n<p>选择<code>expand_rootfs</code>，按照提示操作并重启。</p>\n<ol start=\"2\">\n<li>删除了一些不需要的安装包。首先安装<code>wajig</code>（这个工具集成了apt-get/dpkg/aptitude等等）：</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install wajig -y</span><br></pre></td></tr></table></figure>\n<p>然后查看已安装的包</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wajig large</span><br></pre></td></tr></table></figure>\n<p>找到后面几个用不到的且占用体积较大的删除掉，可一次性删除多个：</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo aptitude remove xxxx xxxx xxxx</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>\n<p>nodejs的<code>sqlite3</code>模块似乎没有arm平台的编译包，我也懒得自己编辑了，直接改成使用mysql了。</p>\n</li>\n<li>\n<p>其它没什么不一样的，使用<code>pm2</code>守护Ghost，使用<code>Nginx</code>做代理，运行，OK！</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>最近开始玩树莓派，自然要在小pi上装个node，跑个Ghost啊。中途遇到了一些小坑，这里记录一下。</p>","more":"<ol>\n<li><code>raspbian</code>系统安装后默认只有大概4G左右的空间（可以使用<code>df -hl</code>查看磁盘空间），tf卡的其它空间浪费了，需要扩容到整个tf卡的大小。在<code>raspbian</code>中运行</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo raspi-config</span><br></pre></td></tr></table></figure>\n<p>选择<code>expand_rootfs</code>，按照提示操作并重启。</p>\n<ol start=\"2\">\n<li>删除了一些不需要的安装包。首先安装<code>wajig</code>（这个工具集成了apt-get/dpkg/aptitude等等）：</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install wajig -y</span><br></pre></td></tr></table></figure>\n<p>然后查看已安装的包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wajig large</span><br></pre></td></tr></table></figure>\n<p>找到后面几个用不到的且占用体积较大的删除掉，可一次性删除多个：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo aptitude remove xxxx xxxx xxxx</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>\n<p>nodejs的<code>sqlite3</code>模块似乎没有arm平台的编译包，我也懒得自己编辑了，直接改成使用mysql了。</p>\n</li>\n<li>\n<p>其它没什么不一样的，使用<code>pm2</code>守护Ghost，使用<code>Nginx</code>做代理，运行，OK！</p>\n</li>\n</ol>"},{"title":"GIT分支管理策略(非Git workflow)","s":"git-branch-management-strategy","date":"2015-04-11T15:28:00.000Z","seo":{"description":"GIT分支管理策略，非Git workflow，主分支Master，主分支有且只有一个，所有提供给用户使用的正式版本都在这个分支上发布。开发分支Develop，日常的开发工作应该都在这个分支上进行。"},"_content":"[参照  http://www.ruanyifeng.com/blog/2012/07/git.html](http://www.ruanyifeng.com/blog/2012/07/git.html)\n## 主分支Master\n主分支有且只有一个，所有提供给用户使用的正式版本都在这个分支上发布。\n## 开发分支Develop\n日常的开发工作应该都在这个分支上进行。\n```bash\ngit checkout -b develop\n```\n如果需要从develop对外发布版本\n```bash\ngit checkout master\ngit merge --no-ff development\n```\n注：这里的参数`--no-ff`是不进行快速合并(快速合并只是改变指针)的意思。\n<!-- more -->\n## 临时分支\n前面介绍的是两条主要分支，一般正常情况下仓库中只存在这2个分支，但有时需要一些临时性的分支用于特定目的，这些分支在使用完成后应该删除掉，删除的命令为\n```bash\ngit branch -d temp-branch\n```\n如果删除过程中出现错误需要强制删除的话可以执行\n```bash\ngit branch -D temp-branch\n```\n注：临时分支不要提交到远程，在本地提交就可以了。\n### 功能分支(feature)\n比如突然需要开发某个新的功能，但不是必需的，或者实现起来可能有些困难而直接放弃，或者是BOSS临时的想法，但不确定是否要加入到产品中，此时可以使用功能分支。\n```bash\ngit checkout -b feature-xxx develop\n```\n开发完成后需要合并到develop分支的话\n```bash\ngit checkout develop\ngit merge --no-ff feature-xxx\n```\n然后删除\n### 预发布分支(release)\n当我们需要在正式发布版本前做一个测试的时候就需要预发布分支。使用过程和功能分支稍有差别，第一步创建\n```bash\ngit checkout -b release-xxx develop\n```\n然后可能要执行一些操作，比如我会在这时执行grunt构建命令，完成开发代码到发布代码的构建。\n当测试完成且没有问题的时候就开始合并代码\n```bash\ngit checkout master\ngit merge --no-ff release-xxx\n# 对合并后产生的新节点做一个标签(一般为版本号)\ngit tag -a xxx\n```\n接着根据情况考虑是否需要合并到开发分支(比如我grunt构建后的代码就不需要)，最后说删除此分支。\n### 修复bug分支\n项目正式发布后难免会有bug出现，此时就需要这样的分支，命名为`fixbug-xxx`，`xxx`一般是项目的bug管理中对应的bug编号。\n```bash\ngit checkout -b fixbug-xxx master\n```\n修改完成后合并到`master`分支\n```bash\ngit checkout master\ngit merge --no-ff fixbug-xxx\n# 遵循版本升级原则\n# 一般bug修复后的版本号在上个版本的最后一位上面加1\n# 比如上个版本为0.1.0，那么bug修复后的版本就是0.1.1\ngit tag -a xxx\n```\n再合并到develop分支\n```bash\ngit checkout develop\ngit merge --no-ff fixbug-xxx\n```\n最后删除此分支。\n","source":"_posts/git-branch-management-strategy.md","raw":"---\ntitle: GIT分支管理策略(非Git workflow)\ns: git-branch-management-strategy\ndate: 2015-04-11 23:28:00\ntags:\n  - Git\nseo:\n  description: GIT分支管理策略，非Git workflow，主分支Master，主分支有且只有一个，所有提供给用户使用的正式版本都在这个分支上发布。开发分支Develop，日常的开发工作应该都在这个分支上进行。\n---\n[参照  http://www.ruanyifeng.com/blog/2012/07/git.html](http://www.ruanyifeng.com/blog/2012/07/git.html)\n## 主分支Master\n主分支有且只有一个，所有提供给用户使用的正式版本都在这个分支上发布。\n## 开发分支Develop\n日常的开发工作应该都在这个分支上进行。\n```bash\ngit checkout -b develop\n```\n如果需要从develop对外发布版本\n```bash\ngit checkout master\ngit merge --no-ff development\n```\n注：这里的参数`--no-ff`是不进行快速合并(快速合并只是改变指针)的意思。\n<!-- more -->\n## 临时分支\n前面介绍的是两条主要分支，一般正常情况下仓库中只存在这2个分支，但有时需要一些临时性的分支用于特定目的，这些分支在使用完成后应该删除掉，删除的命令为\n```bash\ngit branch -d temp-branch\n```\n如果删除过程中出现错误需要强制删除的话可以执行\n```bash\ngit branch -D temp-branch\n```\n注：临时分支不要提交到远程，在本地提交就可以了。\n### 功能分支(feature)\n比如突然需要开发某个新的功能，但不是必需的，或者实现起来可能有些困难而直接放弃，或者是BOSS临时的想法，但不确定是否要加入到产品中，此时可以使用功能分支。\n```bash\ngit checkout -b feature-xxx develop\n```\n开发完成后需要合并到develop分支的话\n```bash\ngit checkout develop\ngit merge --no-ff feature-xxx\n```\n然后删除\n### 预发布分支(release)\n当我们需要在正式发布版本前做一个测试的时候就需要预发布分支。使用过程和功能分支稍有差别，第一步创建\n```bash\ngit checkout -b release-xxx develop\n```\n然后可能要执行一些操作，比如我会在这时执行grunt构建命令，完成开发代码到发布代码的构建。\n当测试完成且没有问题的时候就开始合并代码\n```bash\ngit checkout master\ngit merge --no-ff release-xxx\n# 对合并后产生的新节点做一个标签(一般为版本号)\ngit tag -a xxx\n```\n接着根据情况考虑是否需要合并到开发分支(比如我grunt构建后的代码就不需要)，最后说删除此分支。\n### 修复bug分支\n项目正式发布后难免会有bug出现，此时就需要这样的分支，命名为`fixbug-xxx`，`xxx`一般是项目的bug管理中对应的bug编号。\n```bash\ngit checkout -b fixbug-xxx master\n```\n修改完成后合并到`master`分支\n```bash\ngit checkout master\ngit merge --no-ff fixbug-xxx\n# 遵循版本升级原则\n# 一般bug修复后的版本号在上个版本的最后一位上面加1\n# 比如上个版本为0.1.0，那么bug修复后的版本就是0.1.1\ngit tag -a xxx\n```\n再合并到develop分支\n```bash\ngit checkout develop\ngit merge --no-ff fixbug-xxx\n```\n最后删除此分支。\n","slug":"git-branch-management-strategy","published":1,"updated":"2019-03-26T13:47:04.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0d000vtof92vn5w6a3","content":"<p><a href=\"http://www.ruanyifeng.com/blog/2012/07/git.html\">参照  http://www.ruanyifeng.com/blog/2012/07/git.html</a></p>\n<h2 id=\"主分支Master\"><a class=\"header-anchor\" href=\"#主分支Master\">¶</a>主分支Master</h2>\n<p>主分支有且只有一个，所有提供给用户使用的正式版本都在这个分支上发布。</p>\n<h2 id=\"开发分支Develop\"><a class=\"header-anchor\" href=\"#开发分支Develop\">¶</a>开发分支Develop</h2>\n<p>日常的开发工作应该都在这个分支上进行。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b develop</span><br></pre></td></tr></table></figure>\n<p>如果需要从develop对外发布版本</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff development</span><br></pre></td></tr></table></figure>\n<p>注：这里的参数<code>--no-ff</code>是不进行快速合并(快速合并只是改变指针)的意思。</p>\n<a id=\"more\"></a>\n<h2 id=\"临时分支\"><a class=\"header-anchor\" href=\"#临时分支\">¶</a>临时分支</h2>\n<p>前面介绍的是两条主要分支，一般正常情况下仓库中只存在这2个分支，但有时需要一些临时性的分支用于特定目的，这些分支在使用完成后应该删除掉，删除的命令为</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d temp-branch</span><br></pre></td></tr></table></figure>\n<p>如果删除过程中出现错误需要强制删除的话可以执行</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -D temp-branch</span><br></pre></td></tr></table></figure>\n<p>注：临时分支不要提交到远程，在本地提交就可以了。</p>\n<h3 id=\"功能分支-feature\"><a class=\"header-anchor\" href=\"#功能分支-feature\">¶</a>功能分支(feature)</h3>\n<p>比如突然需要开发某个新的功能，但不是必需的，或者实现起来可能有些困难而直接放弃，或者是BOSS临时的想法，但不确定是否要加入到产品中，此时可以使用功能分支。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b feature-xxx develop</span><br></pre></td></tr></table></figure>\n<p>开发完成后需要合并到develop分支的话</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge --no-ff feature-xxx</span><br></pre></td></tr></table></figure>\n<p>然后删除</p>\n<h3 id=\"预发布分支-release\"><a class=\"header-anchor\" href=\"#预发布分支-release\">¶</a>预发布分支(release)</h3>\n<p>当我们需要在正式发布版本前做一个测试的时候就需要预发布分支。使用过程和功能分支稍有差别，第一步创建</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b release-xxx develop</span><br></pre></td></tr></table></figure>\n<p>然后可能要执行一些操作，比如我会在这时执行grunt构建命令，完成开发代码到发布代码的构建。<br>\n当测试完成且没有问题的时候就开始合并代码</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff release-xxx</span><br><span class=\"line\"><span class=\"hljs-comment\"># 对合并后产生的新节点做一个标签(一般为版本号)</span></span><br><span class=\"line\">git tag -a xxx</span><br></pre></td></tr></table></figure>\n<p>接着根据情况考虑是否需要合并到开发分支(比如我grunt构建后的代码就不需要)，最后说删除此分支。</p>\n<h3 id=\"修复bug分支\"><a class=\"header-anchor\" href=\"#修复bug分支\">¶</a>修复bug分支</h3>\n<p>项目正式发布后难免会有bug出现，此时就需要这样的分支，命名为<code>fixbug-xxx</code>，<code>xxx</code>一般是项目的bug管理中对应的bug编号。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b fixbug-xxx master</span><br></pre></td></tr></table></figure>\n<p>修改完成后合并到<code>master</code>分支</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff fixbug-xxx</span><br><span class=\"line\"><span class=\"hljs-comment\"># 遵循版本升级原则</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 一般bug修复后的版本号在上个版本的最后一位上面加1</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 比如上个版本为0.1.0，那么bug修复后的版本就是0.1.1</span></span><br><span class=\"line\">git tag -a xxx</span><br></pre></td></tr></table></figure>\n<p>再合并到develop分支</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge --no-ff fixbug-xxx</span><br></pre></td></tr></table></figure>\n<p>最后删除此分支。</p>\n","site":{"data":{}},"excerpt":"<p><a href=\"http://www.ruanyifeng.com/blog/2012/07/git.html\">参照  http://www.ruanyifeng.com/blog/2012/07/git.html</a></p>\n<h2 id=\"主分支Master\"><a class=\"header-anchor\" href=\"#主分支Master\">¶</a>主分支Master</h2>\n<p>主分支有且只有一个，所有提供给用户使用的正式版本都在这个分支上发布。</p>\n<h2 id=\"开发分支Develop\"><a class=\"header-anchor\" href=\"#开发分支Develop\">¶</a>开发分支Develop</h2>\n<p>日常的开发工作应该都在这个分支上进行。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b develop</span><br></pre></td></tr></table></figure>\n<p>如果需要从develop对外发布版本</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff development</span><br></pre></td></tr></table></figure>\n<p>注：这里的参数<code>--no-ff</code>是不进行快速合并(快速合并只是改变指针)的意思。</p>","more":"<h2 id=\"临时分支\"><a class=\"header-anchor\" href=\"#临时分支\">¶</a>临时分支</h2>\n<p>前面介绍的是两条主要分支，一般正常情况下仓库中只存在这2个分支，但有时需要一些临时性的分支用于特定目的，这些分支在使用完成后应该删除掉，删除的命令为</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d temp-branch</span><br></pre></td></tr></table></figure>\n<p>如果删除过程中出现错误需要强制删除的话可以执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -D temp-branch</span><br></pre></td></tr></table></figure>\n<p>注：临时分支不要提交到远程，在本地提交就可以了。</p>\n<h3 id=\"功能分支-feature\"><a class=\"header-anchor\" href=\"#功能分支-feature\">¶</a>功能分支(feature)</h3>\n<p>比如突然需要开发某个新的功能，但不是必需的，或者实现起来可能有些困难而直接放弃，或者是BOSS临时的想法，但不确定是否要加入到产品中，此时可以使用功能分支。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b feature-xxx develop</span><br></pre></td></tr></table></figure>\n<p>开发完成后需要合并到develop分支的话</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge --no-ff feature-xxx</span><br></pre></td></tr></table></figure>\n<p>然后删除</p>\n<h3 id=\"预发布分支-release\"><a class=\"header-anchor\" href=\"#预发布分支-release\">¶</a>预发布分支(release)</h3>\n<p>当我们需要在正式发布版本前做一个测试的时候就需要预发布分支。使用过程和功能分支稍有差别，第一步创建</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b release-xxx develop</span><br></pre></td></tr></table></figure>\n<p>然后可能要执行一些操作，比如我会在这时执行grunt构建命令，完成开发代码到发布代码的构建。<br>\n当测试完成且没有问题的时候就开始合并代码</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff release-xxx</span><br><span class=\"line\"><span class=\"comment\"># 对合并后产生的新节点做一个标签(一般为版本号)</span></span><br><span class=\"line\">git tag -a xxx</span><br></pre></td></tr></table></figure>\n<p>接着根据情况考虑是否需要合并到开发分支(比如我grunt构建后的代码就不需要)，最后说删除此分支。</p>\n<h3 id=\"修复bug分支\"><a class=\"header-anchor\" href=\"#修复bug分支\">¶</a>修复bug分支</h3>\n<p>项目正式发布后难免会有bug出现，此时就需要这样的分支，命名为<code>fixbug-xxx</code>，<code>xxx</code>一般是项目的bug管理中对应的bug编号。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b fixbug-xxx master</span><br></pre></td></tr></table></figure>\n<p>修改完成后合并到<code>master</code>分支</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff fixbug-xxx</span><br><span class=\"line\"><span class=\"comment\"># 遵循版本升级原则</span></span><br><span class=\"line\"><span class=\"comment\"># 一般bug修复后的版本号在上个版本的最后一位上面加1</span></span><br><span class=\"line\"><span class=\"comment\"># 比如上个版本为0.1.0，那么bug修复后的版本就是0.1.1</span></span><br><span class=\"line\">git tag -a xxx</span><br></pre></td></tr></table></figure>\n<p>再合并到develop分支</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout develop</span><br><span class=\"line\">git merge --no-ff fixbug-xxx</span><br></pre></td></tr></table></figure>\n<p>最后删除此分支。</p>"},{"title":"利用firebase打造极速静态博客","s":"hexo-on-firebase","date":"2016-07-25T06:38:24.000Z","thumbnail":"/images/server/firebase.png","_content":"之前博客一直是做的动态的，后台页面，添加博文，然后保存后查看博文。但最近VPS感觉不稳定加之价格有点小高（主要是穷），打算将vps上的所有东西都放在云端，使用免费资源（还不是因为穷）。第一步就是从博客开始。\n<!-- more -->\n## Hexo介绍\n`Hexo`是由台湾的一名大学生创建的静态博客系统，它基于'NodeJs'，生成文章的速度非常快，这也是为什么选择它的原因。当然还有很多其它的系统，但是作为`NodeJs`阵营的我当然是选择它啦。\n## Hexo项目搭建\n首先，安装[官方文档](https://hexo.io/zh-cn/docs/index.html)过一遍，在本地安装搭建一个`Hexo`项目，例如我的`HexoBlog`。\n这时运行`hexo server`并打开浏览器访问`http://localhost:4000`应该就可以访问到你搭建后的博客了，如果没有，请仔细阅读文档，重来一遍。\n这里我稍微修改了下`_config.yml`文件，然后添加了deploy模块\n```yaml\ndeploy:\n  type: git\n  repo: https://github.com/erguotou520/HexoBlog.git\n  branch: gh-pages\n```\n这样以后deploy后的`public`文件夹里的内容会自动提交到`gh-pages`分支下。\n## 数据迁移\n最开始的博客是在`Ghost`上跑的，后来又是用的`pagekit`，到现在的`Hexo`，每次数据迁移都是手动复制粘贴，太麻烦了，即使它们可能提供了一些迁移工具，但是还是会存在不靠谱的情况，所以还是手动复制吧。\n这里要提到`Hexo`的一个好处了，文章是以`markdown`格式的文件存储，而不是存在数据库中，对于我们是可视的，再配合上后面的git，可以实现文章的历史管理。\n## 结合Github\n本地环境搭建好了之前就开始将它推送到github了，为什么放在github？一来是有个存储的地方，二来自带历史版本管理，三来可以实现自动化。\n首先，添加hexo的git deploy插件。\n```bash\nnpm install hexo-deployer-git --save\n```\n\n接着在项目中添加一些必要的文件，因为`Hexo`的生成器并没有生成这些文件和内容。\n1. 添加`.gitignore`，把`node_modules`和`.deploy_git`添加进来，后者是在添加`hexo-deployer-git`插件并执行`hexo deploy`命令时会生成。\n2. 补充`package.json`文件，可以加上`description`等其它字段，可选\n3. 添加`README.md`说明文件，可选\n\nOK，完成后开始推送。这个时候已经实现了hexo和github的结合，但是现在，每次添加完文章后都需要手动执行`hexo generate`和`hexo deploy`，是否可以更简单呢？\n## 与Travis结合\n我们可以利用`TravisCI`的自动化测试来进行自动构建任务。网上也有很多介绍`Hexo`+`Github`的文章，简单来说，就是在项目根目录下添加`.travis.yml`，内容如下\n```yaml\nlanguage: node_js\n\nnode_js:\n  - \"6\"\n\nbranches:\n  only:\n    - master\n\nbefore_install:\n  - npm install hexo-cli -g\n  - git config --global push.default matching\n  - git config --global user.name \"erguotou\"\n  - git config --global user.email \"erguotou525@gmail.com\"\n  - sed -i'' \"/^ *repo/s~github\\.com~${ACCESS_TOKEN}@github.com~\" _config.yml\n\ninstall:\n  - npm install\n\nscript:\n  # - git submodule init      # 用于更新主题\n  # - git submodule update\n  - hexo clean\n  - hexo d -g\n\ncache:\n  directories:\n    - node_modules\n```\n其中`{ACCESS_TOKEN}`就是下文要介绍的token。\n\n接着在github中生成一个用于自动提交用的token。点击github中头像-->'Settings'-->`Personal access tokens`-->`Generate new token`生成一个给travis用的token（权限我只勾选了repo相关的）。\n因为github提供了中使用token进行push的方式，这也是我为什么`_config.yml`文件中`deploy`模块用的repo是https地址的原因了。\n生成token后将其添加到travis的环境变量中`ACCESS_TOKEN`=token。\n最后提交所有文件，等待`TravisCI`的构建结果，此时应当完成了与`TravisCI`结合的功能，如果构建报错，请具体结合报错内容修改。\n## 与Firebase结合\n说到现在，我们都还没提到我们的主角`Firebase`。对于还不了解Firebase的同学建议先去看下网上的介绍。Firebase为我们提供了实时的云端存储和并提供全球CDN服务，我就是要利用它的CDN服务将我们的静态博客挂在CDN上。\n首先，全局安装它的cli工具\n```bash\nnpm install -g firebase-tools\n```\n然后登录firebase\n```bash\n# 不带参数会登录报错\n# 如遇到翻墙问题请自行解决\nfirebase login --no-localhost\n```\n接着进入项目根目录，执行\n```bash\nfirebase init\n```\n安装提示完成初始化，Firebase会自动在项目根目录下创建`firebase.json`文件，我们保证`firebase.json`里的`public`值为`public`即可，因为`public`文件夹是`hexo`生成的博客的目录。\n```json\n{\n  \"hosting\": {\n    \"public\": \"public\"\n  }\n}\n```\n此时执行`firebase deploy`就可以将我们的博客推送上去了。但是我们需要结合`TravisCI`实现自动部署，所以在`.travis.yml`中添加firebase的自动部署模块\n```yaml\n# 2017-07-10更新\nafter_success:\n  - firebase deploy --non-interactive --token ${FIREBASE_TOKEN}\n```\n其中`FIREBASE_TOKEN`是让`TravisCI`进行部署时的密钥，它需要我们通过下面的命令来生成\n```bash\nfirebase login:ci --no-localhost\n```\n登录验证成功后会得到一个token，复制它，在travis中添加环境变量`FIREBASE_TOKEN`，`value`为刚复制的token。\n最后git提交推送，travis自动构建，firebase自动部署，OK，完美。\n## Firebase自定义域名\n默认firebase会为我们提供一个域名访问地址，但我们一般会用自己的域名来访问。此时按照Firebase Hosting的文档提示，在我们的域名中添加2个txt记录完成域名拥有权的验证，验证完成后等待firebase颁发https证书（我睡了一晚，醒来之后就好了），最后按照提示，将我们自己的域名做一个cname，解析到firebase给我们提供的域名上就可以啦。\n\n## 总结\n本文介绍了Hexo+Github+TravisCI+Firebase搭建一个免费的拥有https的全球cdn加速的静态博客，综合利用了现有的网上资源，整个搭建过程会遇到各种问题，但都被一一解决。当然，Hexo作为静态博客，也会有一些不足，但这些不足我们都可以使用插件系统来实现，这也是后面要做的内容。\n后面打算利用Firebase的database功能实现一个简单的博客评论系统，然后是定义一个自己用的主题，默认的太难看啦。后面的还有很长的一段路要走呢～\n","source":"_posts/hexo-on-firebase.md","raw":"---\ntitle: 利用firebase打造极速静态博客\ns: hexo-on-firebase\ndate: 2016-07-25 14:38:24\n# thumbnail: https://www.gstatic.com/mobilesdk/160503_mobilesdk/logo/2x/firebase_28dp.png\nthumbnail: /images/server/firebase.png\ntags:\n  - Hexo\n  - TravisCI\n  - Firebase\n  - Github\n---\n之前博客一直是做的动态的，后台页面，添加博文，然后保存后查看博文。但最近VPS感觉不稳定加之价格有点小高（主要是穷），打算将vps上的所有东西都放在云端，使用免费资源（还不是因为穷）。第一步就是从博客开始。\n<!-- more -->\n## Hexo介绍\n`Hexo`是由台湾的一名大学生创建的静态博客系统，它基于'NodeJs'，生成文章的速度非常快，这也是为什么选择它的原因。当然还有很多其它的系统，但是作为`NodeJs`阵营的我当然是选择它啦。\n## Hexo项目搭建\n首先，安装[官方文档](https://hexo.io/zh-cn/docs/index.html)过一遍，在本地安装搭建一个`Hexo`项目，例如我的`HexoBlog`。\n这时运行`hexo server`并打开浏览器访问`http://localhost:4000`应该就可以访问到你搭建后的博客了，如果没有，请仔细阅读文档，重来一遍。\n这里我稍微修改了下`_config.yml`文件，然后添加了deploy模块\n```yaml\ndeploy:\n  type: git\n  repo: https://github.com/erguotou520/HexoBlog.git\n  branch: gh-pages\n```\n这样以后deploy后的`public`文件夹里的内容会自动提交到`gh-pages`分支下。\n## 数据迁移\n最开始的博客是在`Ghost`上跑的，后来又是用的`pagekit`，到现在的`Hexo`，每次数据迁移都是手动复制粘贴，太麻烦了，即使它们可能提供了一些迁移工具，但是还是会存在不靠谱的情况，所以还是手动复制吧。\n这里要提到`Hexo`的一个好处了，文章是以`markdown`格式的文件存储，而不是存在数据库中，对于我们是可视的，再配合上后面的git，可以实现文章的历史管理。\n## 结合Github\n本地环境搭建好了之前就开始将它推送到github了，为什么放在github？一来是有个存储的地方，二来自带历史版本管理，三来可以实现自动化。\n首先，添加hexo的git deploy插件。\n```bash\nnpm install hexo-deployer-git --save\n```\n\n接着在项目中添加一些必要的文件，因为`Hexo`的生成器并没有生成这些文件和内容。\n1. 添加`.gitignore`，把`node_modules`和`.deploy_git`添加进来，后者是在添加`hexo-deployer-git`插件并执行`hexo deploy`命令时会生成。\n2. 补充`package.json`文件，可以加上`description`等其它字段，可选\n3. 添加`README.md`说明文件，可选\n\nOK，完成后开始推送。这个时候已经实现了hexo和github的结合，但是现在，每次添加完文章后都需要手动执行`hexo generate`和`hexo deploy`，是否可以更简单呢？\n## 与Travis结合\n我们可以利用`TravisCI`的自动化测试来进行自动构建任务。网上也有很多介绍`Hexo`+`Github`的文章，简单来说，就是在项目根目录下添加`.travis.yml`，内容如下\n```yaml\nlanguage: node_js\n\nnode_js:\n  - \"6\"\n\nbranches:\n  only:\n    - master\n\nbefore_install:\n  - npm install hexo-cli -g\n  - git config --global push.default matching\n  - git config --global user.name \"erguotou\"\n  - git config --global user.email \"erguotou525@gmail.com\"\n  - sed -i'' \"/^ *repo/s~github\\.com~${ACCESS_TOKEN}@github.com~\" _config.yml\n\ninstall:\n  - npm install\n\nscript:\n  # - git submodule init      # 用于更新主题\n  # - git submodule update\n  - hexo clean\n  - hexo d -g\n\ncache:\n  directories:\n    - node_modules\n```\n其中`{ACCESS_TOKEN}`就是下文要介绍的token。\n\n接着在github中生成一个用于自动提交用的token。点击github中头像-->'Settings'-->`Personal access tokens`-->`Generate new token`生成一个给travis用的token（权限我只勾选了repo相关的）。\n因为github提供了中使用token进行push的方式，这也是我为什么`_config.yml`文件中`deploy`模块用的repo是https地址的原因了。\n生成token后将其添加到travis的环境变量中`ACCESS_TOKEN`=token。\n最后提交所有文件，等待`TravisCI`的构建结果，此时应当完成了与`TravisCI`结合的功能，如果构建报错，请具体结合报错内容修改。\n## 与Firebase结合\n说到现在，我们都还没提到我们的主角`Firebase`。对于还不了解Firebase的同学建议先去看下网上的介绍。Firebase为我们提供了实时的云端存储和并提供全球CDN服务，我就是要利用它的CDN服务将我们的静态博客挂在CDN上。\n首先，全局安装它的cli工具\n```bash\nnpm install -g firebase-tools\n```\n然后登录firebase\n```bash\n# 不带参数会登录报错\n# 如遇到翻墙问题请自行解决\nfirebase login --no-localhost\n```\n接着进入项目根目录，执行\n```bash\nfirebase init\n```\n安装提示完成初始化，Firebase会自动在项目根目录下创建`firebase.json`文件，我们保证`firebase.json`里的`public`值为`public`即可，因为`public`文件夹是`hexo`生成的博客的目录。\n```json\n{\n  \"hosting\": {\n    \"public\": \"public\"\n  }\n}\n```\n此时执行`firebase deploy`就可以将我们的博客推送上去了。但是我们需要结合`TravisCI`实现自动部署，所以在`.travis.yml`中添加firebase的自动部署模块\n```yaml\n# 2017-07-10更新\nafter_success:\n  - firebase deploy --non-interactive --token ${FIREBASE_TOKEN}\n```\n其中`FIREBASE_TOKEN`是让`TravisCI`进行部署时的密钥，它需要我们通过下面的命令来生成\n```bash\nfirebase login:ci --no-localhost\n```\n登录验证成功后会得到一个token，复制它，在travis中添加环境变量`FIREBASE_TOKEN`，`value`为刚复制的token。\n最后git提交推送，travis自动构建，firebase自动部署，OK，完美。\n## Firebase自定义域名\n默认firebase会为我们提供一个域名访问地址，但我们一般会用自己的域名来访问。此时按照Firebase Hosting的文档提示，在我们的域名中添加2个txt记录完成域名拥有权的验证，验证完成后等待firebase颁发https证书（我睡了一晚，醒来之后就好了），最后按照提示，将我们自己的域名做一个cname，解析到firebase给我们提供的域名上就可以啦。\n\n## 总结\n本文介绍了Hexo+Github+TravisCI+Firebase搭建一个免费的拥有https的全球cdn加速的静态博客，综合利用了现有的网上资源，整个搭建过程会遇到各种问题，但都被一一解决。当然，Hexo作为静态博客，也会有一些不足，但这些不足我们都可以使用插件系统来实现，这也是后面要做的内容。\n后面打算利用Firebase的database功能实现一个简单的博客评论系统，然后是定义一个自己用的主题，默认的太难看啦。后面的还有很长的一段路要走呢～\n","slug":"hexo-on-firebase","published":1,"updated":"2019-03-26T13:47:04.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0e000ytof9bm3ysr9y","content":"<p>之前博客一直是做的动态的，后台页面，添加博文，然后保存后查看博文。但最近VPS感觉不稳定加之价格有点小高（主要是穷），打算将vps上的所有东西都放在云端，使用免费资源（还不是因为穷）。第一步就是从博客开始。</p>\n<a id=\"more\"></a>\n<h2 id=\"Hexo介绍\"><a class=\"header-anchor\" href=\"#Hexo介绍\">¶</a>Hexo介绍</h2>\n<p><code>Hexo</code>是由台湾的一名大学生创建的静态博客系统，它基于’NodeJs’，生成文章的速度非常快，这也是为什么选择它的原因。当然还有很多其它的系统，但是作为<code>NodeJs</code>阵营的我当然是选择它啦。</p>\n<h2 id=\"Hexo项目搭建\"><a class=\"header-anchor\" href=\"#Hexo项目搭建\">¶</a>Hexo项目搭建</h2>\n<p>首先，安装<a href=\"https://hexo.io/zh-cn/docs/index.html\">官方文档</a>过一遍，在本地安装搭建一个<code>Hexo</code>项目，例如我的<code>HexoBlog</code>。<br>\n这时运行<code>hexo server</code>并打开浏览器访问<code>http://localhost:4000</code>应该就可以访问到你搭建后的博客了，如果没有，请仔细阅读文档，重来一遍。<br>\n这里我稍微修改了下<code>_config.yml</code>文件，然后添加了deploy模块</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">deploy:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">git</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">repo:</span> <span class=\"hljs-string\">https://github.com/erguotou520/HexoBlog.git</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">branch:</span> <span class=\"hljs-string\">gh-pages</span></span><br></pre></td></tr></table></figure>\n<p>这样以后deploy后的<code>public</code>文件夹里的内容会自动提交到<code>gh-pages</code>分支下。</p>\n<h2 id=\"数据迁移\"><a class=\"header-anchor\" href=\"#数据迁移\">¶</a>数据迁移</h2>\n<p>最开始的博客是在<code>Ghost</code>上跑的，后来又是用的<code>pagekit</code>，到现在的<code>Hexo</code>，每次数据迁移都是手动复制粘贴，太麻烦了，即使它们可能提供了一些迁移工具，但是还是会存在不靠谱的情况，所以还是手动复制吧。<br>\n这里要提到<code>Hexo</code>的一个好处了，文章是以<code>markdown</code>格式的文件存储，而不是存在数据库中，对于我们是可视的，再配合上后面的git，可以实现文章的历史管理。</p>\n<h2 id=\"结合Github\"><a class=\"header-anchor\" href=\"#结合Github\">¶</a>结合Github</h2>\n<p>本地环境搭建好了之前就开始将它推送到github了，为什么放在github？一来是有个存储的地方，二来自带历史版本管理，三来可以实现自动化。<br>\n首先，添加hexo的git deploy插件。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>\n<p>接着在项目中添加一些必要的文件，因为<code>Hexo</code>的生成器并没有生成这些文件和内容。</p>\n<ol>\n<li>添加<code>.gitignore</code>，把<code>node_modules</code>和<code>.deploy_git</code>添加进来，后者是在添加<code>hexo-deployer-git</code>插件并执行<code>hexo deploy</code>命令时会生成。</li>\n<li>补充<code>package.json</code>文件，可以加上<code>description</code>等其它字段，可选</li>\n<li>添加<code>README.md</code>说明文件，可选</li>\n</ol>\n<p>OK，完成后开始推送。这个时候已经实现了hexo和github的结合，但是现在，每次添加完文章后都需要手动执行<code>hexo generate</code>和<code>hexo deploy</code>，是否可以更简单呢？</p>\n<h2 id=\"与Travis结合\"><a class=\"header-anchor\" href=\"#与Travis结合\">¶</a>与Travis结合</h2>\n<p>我们可以利用<code>TravisCI</code>的自动化测试来进行自动构建任务。网上也有很多介绍<code>Hexo</code>+<code>Github</code>的文章，简单来说，就是在项目根目录下添加<code>.travis.yml</code>，内容如下</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">language:</span> <span class=\"hljs-string\">node_js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">node_js:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"6\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">branches:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">only:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">master</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">before_install:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">hexo-cli</span> <span class=\"hljs-string\">-g</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">--global</span> <span class=\"hljs-string\">push.default</span> <span class=\"hljs-string\">matching</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">--global</span> <span class=\"hljs-string\">user.name</span> <span class=\"hljs-string\">\"erguotou\"</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">git</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">--global</span> <span class=\"hljs-string\">user.email</span> <span class=\"hljs-string\">\"erguotou525@gmail.com\"</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">sed</span> <span class=\"hljs-string\">-i''</span> <span class=\"hljs-string\">\"/^ *repo/s~github\\.com~$&#123;ACCESS_TOKEN&#125;@github.com~\"</span> <span class=\"hljs-string\">_config.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">install:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">script:</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># - git submodule init      # 用于更新主题</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># - git submodule update</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">hexo</span> <span class=\"hljs-string\">clean</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">hexo</span> <span class=\"hljs-string\">d</span> <span class=\"hljs-string\">-g</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">cache:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">directories:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">node_modules</span></span><br></pre></td></tr></table></figure>\n<p>其中<code>{ACCESS_TOKEN}</code>就是下文要介绍的token。</p>\n<p>接着在github中生成一个用于自动提交用的token。点击github中头像–&gt;‘Settings’–&gt;<code>Personal access tokens</code>–&gt;<code>Generate new token</code>生成一个给travis用的token（权限我只勾选了repo相关的）。<br>\n因为github提供了中使用token进行push的方式，这也是我为什么<code>_config.yml</code>文件中<code>deploy</code>模块用的repo是https地址的原因了。<br>\n生成token后将其添加到travis的环境变量中<code>ACCESS_TOKEN</code>=token。<br>\n最后提交所有文件，等待<code>TravisCI</code>的构建结果，此时应当完成了与<code>TravisCI</code>结合的功能，如果构建报错，请具体结合报错内容修改。</p>\n<h2 id=\"与Firebase结合\"><a class=\"header-anchor\" href=\"#与Firebase结合\">¶</a>与Firebase结合</h2>\n<p>说到现在，我们都还没提到我们的主角<code>Firebase</code>。对于还不了解Firebase的同学建议先去看下网上的介绍。Firebase为我们提供了实时的云端存储和并提供全球CDN服务，我就是要利用它的CDN服务将我们的静态博客挂在CDN上。<br>\n首先，全局安装它的cli工具</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g firebase-tools</span><br></pre></td></tr></table></figure>\n<p>然后登录firebase</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># 不带参数会登录报错</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 如遇到翻墙问题请自行解决</span></span><br><span class=\"line\">firebase login --no-localhost</span><br></pre></td></tr></table></figure>\n<p>接着进入项目根目录，执行</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firebase init</span><br></pre></td></tr></table></figure>\n<p>安装提示完成初始化，Firebase会自动在项目根目录下创建<code>firebase.json</code>文件，我们保证<code>firebase.json</code>里的<code>public</code>值为<code>public</code>即可，因为<code>public</code>文件夹是<code>hexo</code>生成的博客的目录。</p>\n<figure class=\"highlight json hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"hljs-attr\">\"hosting\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"public\"</span>: <span class=\"hljs-string\">\"public\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此时执行<code>firebase deploy</code>就可以将我们的博客推送上去了。但是我们需要结合<code>TravisCI</code>实现自动部署，所以在<code>.travis.yml</code>中添加firebase的自动部署模块</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># 2017-07-10更新</span></span><br><span class=\"line\"><span class=\"hljs-attr\">after_success:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">firebase</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">--non-interactive</span> <span class=\"hljs-string\">--token</span> <span class=\"hljs-string\">$&#123;FIREBASE_TOKEN&#125;</span></span><br></pre></td></tr></table></figure>\n<p>其中<code>FIREBASE_TOKEN</code>是让<code>TravisCI</code>进行部署时的密钥，它需要我们通过下面的命令来生成</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firebase login:ci --no-localhost</span><br></pre></td></tr></table></figure>\n<p>登录验证成功后会得到一个token，复制它，在travis中添加环境变量<code>FIREBASE_TOKEN</code>，<code>value</code>为刚复制的token。<br>\n最后git提交推送，travis自动构建，firebase自动部署，OK，完美。</p>\n<h2 id=\"Firebase自定义域名\"><a class=\"header-anchor\" href=\"#Firebase自定义域名\">¶</a>Firebase自定义域名</h2>\n<p>默认firebase会为我们提供一个域名访问地址，但我们一般会用自己的域名来访问。此时按照Firebase Hosting的文档提示，在我们的域名中添加2个txt记录完成域名拥有权的验证，验证完成后等待firebase颁发https证书（我睡了一晚，醒来之后就好了），最后按照提示，将我们自己的域名做一个cname，解析到firebase给我们提供的域名上就可以啦。</p>\n<h2 id=\"总结\"><a class=\"header-anchor\" href=\"#总结\">¶</a>总结</h2>\n<p>本文介绍了Hexo+Github+TravisCI+Firebase搭建一个免费的拥有https的全球cdn加速的静态博客，综合利用了现有的网上资源，整个搭建过程会遇到各种问题，但都被一一解决。当然，Hexo作为静态博客，也会有一些不足，但这些不足我们都可以使用插件系统来实现，这也是后面要做的内容。<br>\n后面打算利用Firebase的database功能实现一个简单的博客评论系统，然后是定义一个自己用的主题，默认的太难看啦。后面的还有很长的一段路要走呢～</p>\n","site":{"data":{}},"excerpt":"<p>之前博客一直是做的动态的，后台页面，添加博文，然后保存后查看博文。但最近VPS感觉不稳定加之价格有点小高（主要是穷），打算将vps上的所有东西都放在云端，使用免费资源（还不是因为穷）。第一步就是从博客开始。</p>","more":"<h2 id=\"Hexo介绍\"><a class=\"header-anchor\" href=\"#Hexo介绍\">¶</a>Hexo介绍</h2>\n<p><code>Hexo</code>是由台湾的一名大学生创建的静态博客系统，它基于’NodeJs’，生成文章的速度非常快，这也是为什么选择它的原因。当然还有很多其它的系统，但是作为<code>NodeJs</code>阵营的我当然是选择它啦。</p>\n<h2 id=\"Hexo项目搭建\"><a class=\"header-anchor\" href=\"#Hexo项目搭建\">¶</a>Hexo项目搭建</h2>\n<p>首先，安装<a href=\"https://hexo.io/zh-cn/docs/index.html\">官方文档</a>过一遍，在本地安装搭建一个<code>Hexo</code>项目，例如我的<code>HexoBlog</code>。<br>\n这时运行<code>hexo server</code>并打开浏览器访问<code>http://localhost:4000</code>应该就可以访问到你搭建后的博客了，如果没有，请仔细阅读文档，重来一遍。<br>\n这里我稍微修改了下<code>_config.yml</code>文件，然后添加了deploy模块</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">git</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">https://github.com/erguotou520/HexoBlog.git</span></span><br><span class=\"line\">  <span class=\"attr\">branch:</span> <span class=\"string\">gh-pages</span></span><br></pre></td></tr></table></figure>\n<p>这样以后deploy后的<code>public</code>文件夹里的内容会自动提交到<code>gh-pages</code>分支下。</p>\n<h2 id=\"数据迁移\"><a class=\"header-anchor\" href=\"#数据迁移\">¶</a>数据迁移</h2>\n<p>最开始的博客是在<code>Ghost</code>上跑的，后来又是用的<code>pagekit</code>，到现在的<code>Hexo</code>，每次数据迁移都是手动复制粘贴，太麻烦了，即使它们可能提供了一些迁移工具，但是还是会存在不靠谱的情况，所以还是手动复制吧。<br>\n这里要提到<code>Hexo</code>的一个好处了，文章是以<code>markdown</code>格式的文件存储，而不是存在数据库中，对于我们是可视的，再配合上后面的git，可以实现文章的历史管理。</p>\n<h2 id=\"结合Github\"><a class=\"header-anchor\" href=\"#结合Github\">¶</a>结合Github</h2>\n<p>本地环境搭建好了之前就开始将它推送到github了，为什么放在github？一来是有个存储的地方，二来自带历史版本管理，三来可以实现自动化。<br>\n首先，添加hexo的git deploy插件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>\n<p>接着在项目中添加一些必要的文件，因为<code>Hexo</code>的生成器并没有生成这些文件和内容。</p>\n<ol>\n<li>添加<code>.gitignore</code>，把<code>node_modules</code>和<code>.deploy_git</code>添加进来，后者是在添加<code>hexo-deployer-git</code>插件并执行<code>hexo deploy</code>命令时会生成。</li>\n<li>补充<code>package.json</code>文件，可以加上<code>description</code>等其它字段，可选</li>\n<li>添加<code>README.md</code>说明文件，可选</li>\n</ol>\n<p>OK，完成后开始推送。这个时候已经实现了hexo和github的结合，但是现在，每次添加完文章后都需要手动执行<code>hexo generate</code>和<code>hexo deploy</code>，是否可以更简单呢？</p>\n<h2 id=\"与Travis结合\"><a class=\"header-anchor\" href=\"#与Travis结合\">¶</a>与Travis结合</h2>\n<p>我们可以利用<code>TravisCI</code>的自动化测试来进行自动构建任务。网上也有很多介绍<code>Hexo</code>+<code>Github</code>的文章，简单来说，就是在项目根目录下添加<code>.travis.yml</code>，内容如下</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">language:</span> <span class=\"string\">node_js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">node_js:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">\"6\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">branches:</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">before_install:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">hexo-cli</span> <span class=\"string\">-g</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">push.default</span> <span class=\"string\">matching</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">\"erguotou\"</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">\"erguotou525@gmail.com\"</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">sed</span> <span class=\"string\">-i''</span> <span class=\"string\">\"/^ *repo/s~github\\.com~$&#123;ACCESS_TOKEN&#125;@github.com~\"</span> <span class=\"string\">_config.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">install:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">script:</span></span><br><span class=\"line\">  <span class=\"comment\"># - git submodule init      # 用于更新主题</span></span><br><span class=\"line\">  <span class=\"comment\"># - git submodule update</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">clean</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">d</span> <span class=\"string\">-g</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">cache:</span></span><br><span class=\"line\">  <span class=\"attr\">directories:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">node_modules</span></span><br></pre></td></tr></table></figure>\n<p>其中<code>{ACCESS_TOKEN}</code>就是下文要介绍的token。</p>\n<p>接着在github中生成一个用于自动提交用的token。点击github中头像–&gt;‘Settings’–&gt;<code>Personal access tokens</code>–&gt;<code>Generate new token</code>生成一个给travis用的token（权限我只勾选了repo相关的）。<br>\n因为github提供了中使用token进行push的方式，这也是我为什么<code>_config.yml</code>文件中<code>deploy</code>模块用的repo是https地址的原因了。<br>\n生成token后将其添加到travis的环境变量中<code>ACCESS_TOKEN</code>=token。<br>\n最后提交所有文件，等待<code>TravisCI</code>的构建结果，此时应当完成了与<code>TravisCI</code>结合的功能，如果构建报错，请具体结合报错内容修改。</p>\n<h2 id=\"与Firebase结合\"><a class=\"header-anchor\" href=\"#与Firebase结合\">¶</a>与Firebase结合</h2>\n<p>说到现在，我们都还没提到我们的主角<code>Firebase</code>。对于还不了解Firebase的同学建议先去看下网上的介绍。Firebase为我们提供了实时的云端存储和并提供全球CDN服务，我就是要利用它的CDN服务将我们的静态博客挂在CDN上。<br>\n首先，全局安装它的cli工具</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g firebase-tools</span><br></pre></td></tr></table></figure>\n<p>然后登录firebase</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不带参数会登录报错</span></span><br><span class=\"line\"><span class=\"comment\"># 如遇到翻墙问题请自行解决</span></span><br><span class=\"line\">firebase login --no-localhost</span><br></pre></td></tr></table></figure>\n<p>接着进入项目根目录，执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firebase init</span><br></pre></td></tr></table></figure>\n<p>安装提示完成初始化，Firebase会自动在项目根目录下创建<code>firebase.json</code>文件，我们保证<code>firebase.json</code>里的<code>public</code>值为<code>public</code>即可，因为<code>public</code>文件夹是<code>hexo</code>生成的博客的目录。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"hosting\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"public\"</span>: <span class=\"string\">\"public\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此时执行<code>firebase deploy</code>就可以将我们的博客推送上去了。但是我们需要结合<code>TravisCI</code>实现自动部署，所以在<code>.travis.yml</code>中添加firebase的自动部署模块</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 2017-07-10更新</span></span><br><span class=\"line\"><span class=\"attr\">after_success:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">firebase</span> <span class=\"string\">deploy</span> <span class=\"string\">--non-interactive</span> <span class=\"string\">--token</span> <span class=\"string\">$&#123;FIREBASE_TOKEN&#125;</span></span><br></pre></td></tr></table></figure>\n<p>其中<code>FIREBASE_TOKEN</code>是让<code>TravisCI</code>进行部署时的密钥，它需要我们通过下面的命令来生成</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firebase login:ci --no-localhost</span><br></pre></td></tr></table></figure>\n<p>登录验证成功后会得到一个token，复制它，在travis中添加环境变量<code>FIREBASE_TOKEN</code>，<code>value</code>为刚复制的token。<br>\n最后git提交推送，travis自动构建，firebase自动部署，OK，完美。</p>\n<h2 id=\"Firebase自定义域名\"><a class=\"header-anchor\" href=\"#Firebase自定义域名\">¶</a>Firebase自定义域名</h2>\n<p>默认firebase会为我们提供一个域名访问地址，但我们一般会用自己的域名来访问。此时按照Firebase Hosting的文档提示，在我们的域名中添加2个txt记录完成域名拥有权的验证，验证完成后等待firebase颁发https证书（我睡了一晚，醒来之后就好了），最后按照提示，将我们自己的域名做一个cname，解析到firebase给我们提供的域名上就可以啦。</p>\n<h2 id=\"总结\"><a class=\"header-anchor\" href=\"#总结\">¶</a>总结</h2>\n<p>本文介绍了Hexo+Github+TravisCI+Firebase搭建一个免费的拥有https的全球cdn加速的静态博客，综合利用了现有的网上资源，整个搭建过程会遇到各种问题，但都被一一解决。当然，Hexo作为静态博客，也会有一些不足，但这些不足我们都可以使用插件系统来实现，这也是后面要做的内容。<br>\n后面打算利用Firebase的database功能实现一个简单的博客评论系统，然后是定义一个自己用的主题，默认的太难看啦。后面的还有很长的一段路要走呢～</p>"},{"title":"Git迁移记录","s":"git-migration","date":"2016-04-12T07:32:00.000Z","_content":"## 背景\n之前公司的Git服务器是用的[Gogs](https://gogs.io/)，当时安装时选择的是`tidb`数据库。后来发现`tidb`数据库无法使用`ssh`服务（更改为其它数据库是可以的），但是我们的开发过程中有很多命令行的一些操作，导致每次使用命令时都需要输入用户名和密码，很麻烦，所以想改下数据库，然后使用`ssh://`格式的Git仓库。\n<!-- more -->\n## 尝试\n第一次是打算从`Gogs`入手，但是`Gogs`并不提供数据迁移的能力。\n后来准备从数据库角度出发，备份之前的数据库和仓库。仓库备份很简单，但是数据库是`tidb`采用了`xorm`库封装的，没有启动服务，所以没法用mysql客户端连接。\n再后来准备尝试用`xorm`库提供的方法新建个工程然后把数据备份出来，奈何需要学习`Go`语言，而且好多不会玩，后来还是没有尝试了。\n也找过DBA帮我看下，无果...\n## 现行解决方案\n现在采用的解决方案虽然有点麻烦，但好歹也是可行的。首先重新建个`Gogs`的服务，初始化安装（这次选择的是`sqlite`，因为那台服务器上没有mysql，也就懒得装了），重新建立组织和空仓库，建用户。然后通过clone之前的仓库并添加新的仓库地址最后push的方式来完成的。理论虽然简单，但中间还是遇到了一些小问题，这里记录下。下面是shell脚本（参考了[Push local Git repo to new remote including all branches and tags](http://stackoverflow.com/questions/6865302/push-local-git-repo-to-new-remote-including-all-branches-and-tags)）。\n```bash\n#!/bin/sh\nsourceProtocal='http://'\nsourcePrefix='192.168.10.240:3000/'\ntargetPrefix='git@192.168.10.240:'\narray=(\n  org/repo.git\n  org/repo1.git\n)\nfor repository in ${array[@]}; do\n  # username是原仓库的用户名，password是原仓库的密码\n  source=${sourceProtocal}username:password@${sourcePrefix}${repository}\n  target=${targetPrefix}${repository}\n  tmp=${repository##*/}\n  dir=${tmp%.git*}\n  git clone ${source}\n  cd ${dir}\n  git remote add target ${target}\n  for remote in `git branch -r | grep -v master `; do\n    git checkout --track remotes/$remote\n  done\n  # git push target '*:*'\n  git push target --all\n  git push target --tags\n  echo 'source '${source}' clone OK.'\n  cd ../\ndone\n```\n## 添加ssh公钥\nssh公钥是为了让我们和服务器通讯时免去输入用户名和密码的一种认证方式，详细可以查看[这篇文章](https://wiki.archlinux.org/index.php/SSH_keys_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87))，我们改成ssh方式后需要将我们电脑的公钥上传至`Gogs`才能实现无需密码的`push`操作。\n1.生成公钥（已经生成过可以跳过）。如果电脑上安装了`Git`并且有`Git Bash`，那么可以打开`Git Bash`运行\n```bash\n# -C 后面的是注释，可不传\nssh-keygen -t rsa -C \"youremail@xxx.com\"\n```\n然后一路回车生成我们的公私钥，文件存放在`C:\\Users\\{your windows accoutn}\\.ssh`。\n如果该方法不适合你请自行百度生成ssh公钥。\n2.上传我们的公钥。打开上面说的目录里面的`id_rsa.pub`文件，复制里面的所有内容。再打开`Gogs`服务的网址，登陆。\n点击右上角头像，选择`用户设置`，选择`管理 SSH 密钥`，点击`增加密钥`。`密钥名称`处随便填写个，然后在`密钥内容`中粘贴我们前面复制的内容，点击下面的`增加密钥`按钮完成添加。\n## 工作副本的仓库地址修改\n1.进入原克隆的工作目录\n```bash\ncd /path/to/your/workspace\n```\n2.查看原工作副本的远程地址\n```bash\ngit remote -v\n```\n可以看到之前的地址是以`http://`开头的，我们需要修改其为新的`ssh://`方式。\n3.修改地址\n```bash\ngit remote set-url origin <git@192.168.10.240:org/repo.git>\n```\n`org`和`repo`为上述`git remote -v`查看得到的组织名和仓库名，该地址也可以通过网页上复制得到\n![Gogs ssh](/images/git/gogs-ssh.png)。\n一切OK！\n> 如果有其它非origin远程，可以通过同样的方法修改仓库地址。\n","source":"_posts/git-migration.md","raw":"---\ntitle: Git迁移记录\ns: git-migration\ndate: 2016-04-12 15:32:00\ntags:\n  - Git\n---\n## 背景\n之前公司的Git服务器是用的[Gogs](https://gogs.io/)，当时安装时选择的是`tidb`数据库。后来发现`tidb`数据库无法使用`ssh`服务（更改为其它数据库是可以的），但是我们的开发过程中有很多命令行的一些操作，导致每次使用命令时都需要输入用户名和密码，很麻烦，所以想改下数据库，然后使用`ssh://`格式的Git仓库。\n<!-- more -->\n## 尝试\n第一次是打算从`Gogs`入手，但是`Gogs`并不提供数据迁移的能力。\n后来准备从数据库角度出发，备份之前的数据库和仓库。仓库备份很简单，但是数据库是`tidb`采用了`xorm`库封装的，没有启动服务，所以没法用mysql客户端连接。\n再后来准备尝试用`xorm`库提供的方法新建个工程然后把数据备份出来，奈何需要学习`Go`语言，而且好多不会玩，后来还是没有尝试了。\n也找过DBA帮我看下，无果...\n## 现行解决方案\n现在采用的解决方案虽然有点麻烦，但好歹也是可行的。首先重新建个`Gogs`的服务，初始化安装（这次选择的是`sqlite`，因为那台服务器上没有mysql，也就懒得装了），重新建立组织和空仓库，建用户。然后通过clone之前的仓库并添加新的仓库地址最后push的方式来完成的。理论虽然简单，但中间还是遇到了一些小问题，这里记录下。下面是shell脚本（参考了[Push local Git repo to new remote including all branches and tags](http://stackoverflow.com/questions/6865302/push-local-git-repo-to-new-remote-including-all-branches-and-tags)）。\n```bash\n#!/bin/sh\nsourceProtocal='http://'\nsourcePrefix='192.168.10.240:3000/'\ntargetPrefix='git@192.168.10.240:'\narray=(\n  org/repo.git\n  org/repo1.git\n)\nfor repository in ${array[@]}; do\n  # username是原仓库的用户名，password是原仓库的密码\n  source=${sourceProtocal}username:password@${sourcePrefix}${repository}\n  target=${targetPrefix}${repository}\n  tmp=${repository##*/}\n  dir=${tmp%.git*}\n  git clone ${source}\n  cd ${dir}\n  git remote add target ${target}\n  for remote in `git branch -r | grep -v master `; do\n    git checkout --track remotes/$remote\n  done\n  # git push target '*:*'\n  git push target --all\n  git push target --tags\n  echo 'source '${source}' clone OK.'\n  cd ../\ndone\n```\n## 添加ssh公钥\nssh公钥是为了让我们和服务器通讯时免去输入用户名和密码的一种认证方式，详细可以查看[这篇文章](https://wiki.archlinux.org/index.php/SSH_keys_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87))，我们改成ssh方式后需要将我们电脑的公钥上传至`Gogs`才能实现无需密码的`push`操作。\n1.生成公钥（已经生成过可以跳过）。如果电脑上安装了`Git`并且有`Git Bash`，那么可以打开`Git Bash`运行\n```bash\n# -C 后面的是注释，可不传\nssh-keygen -t rsa -C \"youremail@xxx.com\"\n```\n然后一路回车生成我们的公私钥，文件存放在`C:\\Users\\{your windows accoutn}\\.ssh`。\n如果该方法不适合你请自行百度生成ssh公钥。\n2.上传我们的公钥。打开上面说的目录里面的`id_rsa.pub`文件，复制里面的所有内容。再打开`Gogs`服务的网址，登陆。\n点击右上角头像，选择`用户设置`，选择`管理 SSH 密钥`，点击`增加密钥`。`密钥名称`处随便填写个，然后在`密钥内容`中粘贴我们前面复制的内容，点击下面的`增加密钥`按钮完成添加。\n## 工作副本的仓库地址修改\n1.进入原克隆的工作目录\n```bash\ncd /path/to/your/workspace\n```\n2.查看原工作副本的远程地址\n```bash\ngit remote -v\n```\n可以看到之前的地址是以`http://`开头的，我们需要修改其为新的`ssh://`方式。\n3.修改地址\n```bash\ngit remote set-url origin <git@192.168.10.240:org/repo.git>\n```\n`org`和`repo`为上述`git remote -v`查看得到的组织名和仓库名，该地址也可以通过网页上复制得到\n![Gogs ssh](/images/git/gogs-ssh.png)。\n一切OK！\n> 如果有其它非origin远程，可以通过同样的方法修改仓库地址。\n","slug":"git-migration","published":1,"updated":"2019-03-26T13:47:04.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0f0010tof9ohfkg1fo","content":"<h2 id=\"背景\"><a class=\"header-anchor\" href=\"#背景\">¶</a>背景</h2>\n<p>之前公司的Git服务器是用的<a href=\"https://gogs.io/\">Gogs</a>，当时安装时选择的是<code>tidb</code>数据库。后来发现<code>tidb</code>数据库无法使用<code>ssh</code>服务（更改为其它数据库是可以的），但是我们的开发过程中有很多命令行的一些操作，导致每次使用命令时都需要输入用户名和密码，很麻烦，所以想改下数据库，然后使用<code>ssh://</code>格式的Git仓库。</p>\n<a id=\"more\"></a>\n<h2 id=\"尝试\"><a class=\"header-anchor\" href=\"#尝试\">¶</a>尝试</h2>\n<p>第一次是打算从<code>Gogs</code>入手，但是<code>Gogs</code>并不提供数据迁移的能力。<br>\n后来准备从数据库角度出发，备份之前的数据库和仓库。仓库备份很简单，但是数据库是<code>tidb</code>采用了<code>xorm</code>库封装的，没有启动服务，所以没法用mysql客户端连接。<br>\n再后来准备尝试用<code>xorm</code>库提供的方法新建个工程然后把数据备份出来，奈何需要学习<code>Go</code>语言，而且好多不会玩，后来还是没有尝试了。<br>\n也找过DBA帮我看下，无果…</p>\n<h2 id=\"现行解决方案\"><a class=\"header-anchor\" href=\"#现行解决方案\">¶</a>现行解决方案</h2>\n<p>现在采用的解决方案虽然有点麻烦，但好歹也是可行的。首先重新建个<code>Gogs</code>的服务，初始化安装（这次选择的是<code>sqlite</code>，因为那台服务器上没有mysql，也就懒得装了），重新建立组织和空仓库，建用户。然后通过clone之前的仓库并添加新的仓库地址最后push的方式来完成的。理论虽然简单，但中间还是遇到了一些小问题，这里记录下。下面是shell脚本（参考了<a href=\"http://stackoverflow.com/questions/6865302/push-local-git-repo-to-new-remote-including-all-branches-and-tags\">Push local Git repo to new remote including all branches and tags</a>）。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">#!/bin/sh</span></span><br><span class=\"line\">sourceProtocal=<span class=\"hljs-string\">'http://'</span></span><br><span class=\"line\">sourcePrefix=<span class=\"hljs-string\">'192.168.10.240:3000/'</span></span><br><span class=\"line\">targetPrefix=<span class=\"hljs-string\">'git@192.168.10.240:'</span></span><br><span class=\"line\">array=(</span><br><span class=\"line\">  org/repo.git</span><br><span class=\"line\">  org/repo1.git</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"hljs-keyword\">for</span> repository <span class=\"hljs-keyword\">in</span> <span class=\"hljs-variable\">$&#123;array[@]&#125;</span>; <span class=\"hljs-keyword\">do</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># username是原仓库的用户名，password是原仓库的密码</span></span><br><span class=\"line\">  <span class=\"hljs-built_in\">source</span>=<span class=\"hljs-variable\">$&#123;sourceProtocal&#125;</span>username:password@<span class=\"hljs-variable\">$&#123;sourcePrefix&#125;</span><span class=\"hljs-variable\">$&#123;repository&#125;</span></span><br><span class=\"line\">  target=<span class=\"hljs-variable\">$&#123;targetPrefix&#125;</span><span class=\"hljs-variable\">$&#123;repository&#125;</span></span><br><span class=\"line\">  tmp=<span class=\"hljs-variable\">$&#123;repository##*/&#125;</span></span><br><span class=\"line\">  dir=<span class=\"hljs-variable\">$&#123;tmp%.git*&#125;</span></span><br><span class=\"line\">  git <span class=\"hljs-built_in\">clone</span> <span class=\"hljs-variable\">$&#123;source&#125;</span></span><br><span class=\"line\">  <span class=\"hljs-built_in\">cd</span> <span class=\"hljs-variable\">$&#123;dir&#125;</span></span><br><span class=\"line\">  git remote add target <span class=\"hljs-variable\">$&#123;target&#125;</span></span><br><span class=\"line\">  <span class=\"hljs-keyword\">for</span> remote <span class=\"hljs-keyword\">in</span> `git branch -r | grep -v master `; <span class=\"hljs-keyword\">do</span></span><br><span class=\"line\">    git checkout --track remotes/<span class=\"hljs-variable\">$remote</span></span><br><span class=\"line\">  <span class=\"hljs-keyword\">done</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># git push target '*:*'</span></span><br><span class=\"line\">  git push target --all</span><br><span class=\"line\">  git push target --tags</span><br><span class=\"line\">  <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'source '</span><span class=\"hljs-variable\">$&#123;source&#125;</span><span class=\"hljs-string\">' clone OK.'</span></span><br><span class=\"line\">  <span class=\"hljs-built_in\">cd</span> ../</span><br><span class=\"line\"><span class=\"hljs-keyword\">done</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"添加ssh公钥\"><a class=\"header-anchor\" href=\"#添加ssh公钥\">¶</a>添加ssh公钥</h2>\n<p>ssh公钥是为了让我们和服务器通讯时免去输入用户名和密码的一种认证方式，详细可以查看<a href=\"https://wiki.archlinux.org/index.php/SSH_keys_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)\">这篇文章</a>，我们改成ssh方式后需要将我们电脑的公钥上传至<code>Gogs</code>才能实现无需密码的<code>push</code>操作。<br>\n1.生成公钥（已经生成过可以跳过）。如果电脑上安装了<code>Git</code>并且有<code>Git Bash</code>，那么可以打开<code>Git Bash</code>运行</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># -C 后面的是注释，可不传</span></span><br><span class=\"line\">ssh-keygen -t rsa -C <span class=\"hljs-string\">\"youremail@xxx.com\"</span></span><br></pre></td></tr></table></figure>\n<p>然后一路回车生成我们的公私钥，文件存放在<code>C:\\Users\\{your windows accoutn}\\.ssh</code>。<br>\n如果该方法不适合你请自行百度生成ssh公钥。<br>\n2.上传我们的公钥。打开上面说的目录里面的<code>id_rsa.pub</code>文件，复制里面的所有内容。再打开<code>Gogs</code>服务的网址，登陆。<br>\n点击右上角头像，选择<code>用户设置</code>，选择<code>管理 SSH 密钥</code>，点击<code>增加密钥</code>。<code>密钥名称</code>处随便填写个，然后在<code>密钥内容</code>中粘贴我们前面复制的内容，点击下面的<code>增加密钥</code>按钮完成添加。</p>\n<h2 id=\"工作副本的仓库地址修改\"><a class=\"header-anchor\" href=\"#工作副本的仓库地址修改\">¶</a>工作副本的仓库地址修改</h2>\n<p>1.进入原克隆的工作目录</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-built_in\">cd</span> /path/to/your/workspace</span><br></pre></td></tr></table></figure>\n<p>2.查看原工作副本的远程地址</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n<p>可以看到之前的地址是以<code>http://</code>开头的，我们需要修改其为新的<code>ssh://</code>方式。<br>\n3.修改地址</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote <span class=\"hljs-built_in\">set</span>-url origin &lt;git@192.168.10.240:org/repo.git&gt;</span><br></pre></td></tr></table></figure>\n<p><code>org</code>和<code>repo</code>为上述<code>git remote -v</code>查看得到的组织名和仓库名，该地址也可以通过网页上复制得到<br>\n<img src=\"/images/git/gogs-ssh.png\" alt=\"Gogs ssh\">。<br>\n一切OK！</p>\n<blockquote>\n<p>如果有其它非origin远程，可以通过同样的方法修改仓库地址。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h2 id=\"背景\"><a class=\"header-anchor\" href=\"#背景\">¶</a>背景</h2>\n<p>之前公司的Git服务器是用的<a href=\"https://gogs.io/\">Gogs</a>，当时安装时选择的是<code>tidb</code>数据库。后来发现<code>tidb</code>数据库无法使用<code>ssh</code>服务（更改为其它数据库是可以的），但是我们的开发过程中有很多命令行的一些操作，导致每次使用命令时都需要输入用户名和密码，很麻烦，所以想改下数据库，然后使用<code>ssh://</code>格式的Git仓库。</p>","more":"<h2 id=\"尝试\"><a class=\"header-anchor\" href=\"#尝试\">¶</a>尝试</h2>\n<p>第一次是打算从<code>Gogs</code>入手，但是<code>Gogs</code>并不提供数据迁移的能力。<br>\n后来准备从数据库角度出发，备份之前的数据库和仓库。仓库备份很简单，但是数据库是<code>tidb</code>采用了<code>xorm</code>库封装的，没有启动服务，所以没法用mysql客户端连接。<br>\n再后来准备尝试用<code>xorm</code>库提供的方法新建个工程然后把数据备份出来，奈何需要学习<code>Go</code>语言，而且好多不会玩，后来还是没有尝试了。<br>\n也找过DBA帮我看下，无果…</p>\n<h2 id=\"现行解决方案\"><a class=\"header-anchor\" href=\"#现行解决方案\">¶</a>现行解决方案</h2>\n<p>现在采用的解决方案虽然有点麻烦，但好歹也是可行的。首先重新建个<code>Gogs</code>的服务，初始化安装（这次选择的是<code>sqlite</code>，因为那台服务器上没有mysql，也就懒得装了），重新建立组织和空仓库，建用户。然后通过clone之前的仓库并添加新的仓库地址最后push的方式来完成的。理论虽然简单，但中间还是遇到了一些小问题，这里记录下。下面是shell脚本（参考了<a href=\"http://stackoverflow.com/questions/6865302/push-local-git-repo-to-new-remote-including-all-branches-and-tags\">Push local Git repo to new remote including all branches and tags</a>）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\">sourceProtocal=<span class=\"string\">'http://'</span></span><br><span class=\"line\">sourcePrefix=<span class=\"string\">'192.168.10.240:3000/'</span></span><br><span class=\"line\">targetPrefix=<span class=\"string\">'git@192.168.10.240:'</span></span><br><span class=\"line\">array=(</span><br><span class=\"line\">  org/repo.git</span><br><span class=\"line\">  org/repo1.git</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">for</span> repository <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;array[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"comment\"># username是原仓库的用户名，password是原仓库的密码</span></span><br><span class=\"line\">  <span class=\"built_in\">source</span>=<span class=\"variable\">$&#123;sourceProtocal&#125;</span>username:password@<span class=\"variable\">$&#123;sourcePrefix&#125;</span><span class=\"variable\">$&#123;repository&#125;</span></span><br><span class=\"line\">  target=<span class=\"variable\">$&#123;targetPrefix&#125;</span><span class=\"variable\">$&#123;repository&#125;</span></span><br><span class=\"line\">  tmp=<span class=\"variable\">$&#123;repository##*/&#125;</span></span><br><span class=\"line\">  dir=<span class=\"variable\">$&#123;tmp%.git*&#125;</span></span><br><span class=\"line\">  git <span class=\"built_in\">clone</span> <span class=\"variable\">$&#123;source&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;dir&#125;</span></span><br><span class=\"line\">  git remote add target <span class=\"variable\">$&#123;target&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> remote <span class=\"keyword\">in</span> `git branch -r | grep -v master `; <span class=\"keyword\">do</span></span><br><span class=\"line\">    git checkout --track remotes/<span class=\"variable\">$remote</span></span><br><span class=\"line\">  <span class=\"keyword\">done</span></span><br><span class=\"line\">  <span class=\"comment\"># git push target '*:*'</span></span><br><span class=\"line\">  git push target --all</span><br><span class=\"line\">  git push target --tags</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">'source '</span><span class=\"variable\">$&#123;source&#125;</span><span class=\"string\">' clone OK.'</span></span><br><span class=\"line\">  <span class=\"built_in\">cd</span> ../</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"添加ssh公钥\"><a class=\"header-anchor\" href=\"#添加ssh公钥\">¶</a>添加ssh公钥</h2>\n<p>ssh公钥是为了让我们和服务器通讯时免去输入用户名和密码的一种认证方式，详细可以查看<a href=\"https://wiki.archlinux.org/index.php/SSH_keys_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)\">这篇文章</a>，我们改成ssh方式后需要将我们电脑的公钥上传至<code>Gogs</code>才能实现无需密码的<code>push</code>操作。<br>\n1.生成公钥（已经生成过可以跳过）。如果电脑上安装了<code>Git</code>并且有<code>Git Bash</code>，那么可以打开<code>Git Bash</code>运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -C 后面的是注释，可不传</span></span><br><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"youremail@xxx.com\"</span></span><br></pre></td></tr></table></figure>\n<p>然后一路回车生成我们的公私钥，文件存放在<code>C:\\Users\\{your windows accoutn}\\.ssh</code>。<br>\n如果该方法不适合你请自行百度生成ssh公钥。<br>\n2.上传我们的公钥。打开上面说的目录里面的<code>id_rsa.pub</code>文件，复制里面的所有内容。再打开<code>Gogs</code>服务的网址，登陆。<br>\n点击右上角头像，选择<code>用户设置</code>，选择<code>管理 SSH 密钥</code>，点击<code>增加密钥</code>。<code>密钥名称</code>处随便填写个，然后在<code>密钥内容</code>中粘贴我们前面复制的内容，点击下面的<code>增加密钥</code>按钮完成添加。</p>\n<h2 id=\"工作副本的仓库地址修改\"><a class=\"header-anchor\" href=\"#工作副本的仓库地址修改\">¶</a>工作副本的仓库地址修改</h2>\n<p>1.进入原克隆的工作目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /path/to/your/workspace</span><br></pre></td></tr></table></figure>\n<p>2.查看原工作副本的远程地址</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n<p>可以看到之前的地址是以<code>http://</code>开头的，我们需要修改其为新的<code>ssh://</code>方式。<br>\n3.修改地址</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote <span class=\"built_in\">set</span>-url origin &lt;git@192.168.10.240:org/repo.git&gt;</span><br></pre></td></tr></table></figure>\n<p><code>org</code>和<code>repo</code>为上述<code>git remote -v</code>查看得到的组织名和仓库名，该地址也可以通过网页上复制得到<br>\n<img src=\"/images/git/gogs-ssh.png\" alt=\"Gogs ssh\">。<br>\n一切OK！</p>\n<blockquote>\n<p>如果有其它非origin远程，可以通过同样的方法修改仓库地址。</p>\n</blockquote>"},{"title":"记新windows电脑打造前端开发环境流程","s":"new-windows-develop-env","date":"2018-05-21T07:33:45.000Z","thumbnail":"/images/windows/win10.png","_content":"## 系统环境\n\n- 查看电脑配置（主要是CPU内存硬盘SSD这些），对于该配置能完成什么样的开发强度心里有数\n- 联网，设置固定IP（较推荐）\n- 清理已安装工具，取消不常用的任务栏（比如IE浏览器，应用商店）\n- 规划分区，明确每个分区盘的用处\n\n<!-- more -->\n## 工具下载\n下载以下常用工具并安装\n\n- 7z\n- Chrome\n- VSCode\n- python\n- Git（VSCode安装后再安装），SourceTree（图形化Git管理），BeyondCompare（Diff对比工具）\n- NodeJs\n- yarn\n- Everything\n- Wox（Everything和python安装后再安装）\n- Cmder\n- Office工具\n- MacType（美化windows字体显示）\n- 迅雷极速版/FDM/Motrix\n- IM工具 QQ/TIM 微信 钉钉\n- VirtualBox\n- 其它工具 坚果云 Zerotier-One\n- 从坚果云的同步文件中安装ssr并添加订阅地址\n\n## Chrome\n前端开发浏览器是重头，所以要配置好浏览器的一些东西\n\n- ssr运行后登录chrome同步扩展程序，确保常用的`vue-devtool` `Proxy SwitchSharp` `NIM(NodeJs调试管理工具)` `划词翻译`扩展已安装\n- 登录后等待同步书签\n- 为`Proxy SwitchSharp`导入坚果云同步的备份文件，并点击扩展图标选择自动模式，至此FQ已完成，后续可以科学上网\n- 设置 -> 下载内容 -> 下载前询问每个文件的保存位置 勾选上\n\n## Cmder\nwindows下如果要获得流畅的命令行使用体验，`Cmder`那是必备的工具，后续的命令行操作也是使用该工具执行，安装后需要做一些简单的设置，参考[](https://www.jianshu.com/p/979db1a96f6d)\n\n- 注册右键菜单 管理员身份打开cmd并cd到`Cmder`目录，执行`Cmder.exe /REGISTER ALL`\n- 设置启动目录 Settings -> Startup - > Task，修改{cmd::Cmder}项，把:\n`cmd /k \"%ConEmuDir%\\..\\init.bat\"`改为`cmd /k \"%ConEmuDir%\\..\\init.bat\" -new_console:d:G:\\workspace`\n- 设置alias 打开`Cmder`安装目录下的`config/user-aliases.cmd`文件，添加常用的简写命令，比如\n    ```bash\n    gc = git commit -am $1\n    ```\n- 设置常用快捷键 在Settings -> Keys & Macro页面中搜索`split`，为split bottom设置快捷键`Ctrl+Shift+D`为split right设置快捷键`Ctrl+D`，保持和`iTerm2`一致。设置`Minimize/Restore (Quake-style hotkey also)`的快捷键为`Ctrl+F1`，这个可以用来快速显隐窗口。\n\n## Git\nGit现在几乎成了主流的版本控制工具，在开发之前我们需要先对Git做个简单的配置\n\n- 配置Git\n    ```bash\n    git config --global user.name \"erguotou\"\n    git config --global user.email erguotou525@gmail.com\n    ```\n- 生成本地公私钥\n    ```bash\n    ssh-keygen -t rsa\n    cat ~/.ssh/id_rsa.pub\n    ```\n    将生成的公钥复制到Github/Gitlab之类的仓库中。\n- 修改文件默认结尾格式\n    ```bash\n    git config core.eol lf\n    git config core.autocrlf false\n    ```\n\n## VSCode\n目前来看最火的编辑器，速度比`Atom`快很多，使用前先安装几个常用的插件\n\n- EditorConfig for VS Code\n- ESLint\n- HTML Snippets\n- language-postcss\n- PostCSS syntax\n- language-stylus\n- Path Intellisense\n- Prettier\n- Vetur\n- Beautify\n- 其它如Flutter/Dart/Docker/Docker Compose/DotENV/Python/英汉词典\n\n然后修改创建文件的默认结尾为`LF`，在用户配置中加入`\"files.eol\": \"\\n\"`\n\n## NodeJs\n前端开发必备，主要是换源，安装常用全局模块\n\n```bash\nnpm i -g nrm http-server\nnrm use taobao\nyarn config set registry 'https://registry.npm.taobao.org'\n```\n\n## Everything & Wox\n类似Mac上的`Alfred`，配置简单，主要是改下快捷键为`Ctrl+~`\n\n## 高级玩法\n- AutoHotKey `AHK`为windows用户提供了更多的可能，开发时可以用它定义快捷输入、执行自动化操作，可以定义开机自启动脚本，显隐应用窗口等等\n- MacType Windows的ClearType字体很多时候看着都很难受，这时我们需要MacType来优化字体显示，可以参考这个做个自定义优化[](https://blog.csdn.net/w19981220/article/details/47993893)或者直接使用Candy改的MacType\n\n## 其它\n- 使用`ssh-keygen -t rsa`生成公私钥，并将公钥上传到Github/Bitbucket/Gitlab等\n- 使用`ssh-copy-id -i ~/.ssh/id_rsa.pub user@server.host`命令将公钥上传到服务器实现免密登录\n\n## 开发一段时间后使用到的一些工具\n- Photoshop CC\n- Cow 本地代理\n- GifCam 本地录屏并生成gif文件\n- navcat 数据库连接工具\n- oss-aliyun 连接阿里OSS\n- 15_Second_ADB_Installer 快速安装adb工具\n- Android SDK\n- besttrace 路由跟踪工具\n- charles-proxy/Fiddler 本地请求拦截\n- 网易云音乐\n- Dism 轻量级windows管理工具\n- DockerToolbox 没有用Docker for Windows，因为它和VirtualBox冲突\n- Golang\n- lean cli leancloud命令行工具\n- Medis redis连接工具\n- minio 本地oss服务\n- mingw-w64\n- mongodb/robo3t mongodb和其连接工具\n- ngrok 内网穿透工具\n- postman api测试工具\n- 搜狗输入法\n- TeamViewer/向日葵 远程连接工具\n- Telegram\n- TunSafe\n- Vagrant\n- 微信web开发者工具\n- windirstat 查看本地磁盘占用空间，磁盘清理就靠它定位了\n- WinSCP 远程连接和管理工具\n- 各种虚拟机镜像 Windows/Ubuntu等\n","source":"_posts/new-windows-develop-env.md","raw":"---\ntitle: 记新windows电脑打造前端开发环境流程\ns: new-windows-develop-env\ndate: 2018-05-21 15:33:45\nthumbnail: /images/windows/win10.png\ntags:\n  - windows\n  - 前端开发环境\n---\n## 系统环境\n\n- 查看电脑配置（主要是CPU内存硬盘SSD这些），对于该配置能完成什么样的开发强度心里有数\n- 联网，设置固定IP（较推荐）\n- 清理已安装工具，取消不常用的任务栏（比如IE浏览器，应用商店）\n- 规划分区，明确每个分区盘的用处\n\n<!-- more -->\n## 工具下载\n下载以下常用工具并安装\n\n- 7z\n- Chrome\n- VSCode\n- python\n- Git（VSCode安装后再安装），SourceTree（图形化Git管理），BeyondCompare（Diff对比工具）\n- NodeJs\n- yarn\n- Everything\n- Wox（Everything和python安装后再安装）\n- Cmder\n- Office工具\n- MacType（美化windows字体显示）\n- 迅雷极速版/FDM/Motrix\n- IM工具 QQ/TIM 微信 钉钉\n- VirtualBox\n- 其它工具 坚果云 Zerotier-One\n- 从坚果云的同步文件中安装ssr并添加订阅地址\n\n## Chrome\n前端开发浏览器是重头，所以要配置好浏览器的一些东西\n\n- ssr运行后登录chrome同步扩展程序，确保常用的`vue-devtool` `Proxy SwitchSharp` `NIM(NodeJs调试管理工具)` `划词翻译`扩展已安装\n- 登录后等待同步书签\n- 为`Proxy SwitchSharp`导入坚果云同步的备份文件，并点击扩展图标选择自动模式，至此FQ已完成，后续可以科学上网\n- 设置 -> 下载内容 -> 下载前询问每个文件的保存位置 勾选上\n\n## Cmder\nwindows下如果要获得流畅的命令行使用体验，`Cmder`那是必备的工具，后续的命令行操作也是使用该工具执行，安装后需要做一些简单的设置，参考[](https://www.jianshu.com/p/979db1a96f6d)\n\n- 注册右键菜单 管理员身份打开cmd并cd到`Cmder`目录，执行`Cmder.exe /REGISTER ALL`\n- 设置启动目录 Settings -> Startup - > Task，修改{cmd::Cmder}项，把:\n`cmd /k \"%ConEmuDir%\\..\\init.bat\"`改为`cmd /k \"%ConEmuDir%\\..\\init.bat\" -new_console:d:G:\\workspace`\n- 设置alias 打开`Cmder`安装目录下的`config/user-aliases.cmd`文件，添加常用的简写命令，比如\n    ```bash\n    gc = git commit -am $1\n    ```\n- 设置常用快捷键 在Settings -> Keys & Macro页面中搜索`split`，为split bottom设置快捷键`Ctrl+Shift+D`为split right设置快捷键`Ctrl+D`，保持和`iTerm2`一致。设置`Minimize/Restore (Quake-style hotkey also)`的快捷键为`Ctrl+F1`，这个可以用来快速显隐窗口。\n\n## Git\nGit现在几乎成了主流的版本控制工具，在开发之前我们需要先对Git做个简单的配置\n\n- 配置Git\n    ```bash\n    git config --global user.name \"erguotou\"\n    git config --global user.email erguotou525@gmail.com\n    ```\n- 生成本地公私钥\n    ```bash\n    ssh-keygen -t rsa\n    cat ~/.ssh/id_rsa.pub\n    ```\n    将生成的公钥复制到Github/Gitlab之类的仓库中。\n- 修改文件默认结尾格式\n    ```bash\n    git config core.eol lf\n    git config core.autocrlf false\n    ```\n\n## VSCode\n目前来看最火的编辑器，速度比`Atom`快很多，使用前先安装几个常用的插件\n\n- EditorConfig for VS Code\n- ESLint\n- HTML Snippets\n- language-postcss\n- PostCSS syntax\n- language-stylus\n- Path Intellisense\n- Prettier\n- Vetur\n- Beautify\n- 其它如Flutter/Dart/Docker/Docker Compose/DotENV/Python/英汉词典\n\n然后修改创建文件的默认结尾为`LF`，在用户配置中加入`\"files.eol\": \"\\n\"`\n\n## NodeJs\n前端开发必备，主要是换源，安装常用全局模块\n\n```bash\nnpm i -g nrm http-server\nnrm use taobao\nyarn config set registry 'https://registry.npm.taobao.org'\n```\n\n## Everything & Wox\n类似Mac上的`Alfred`，配置简单，主要是改下快捷键为`Ctrl+~`\n\n## 高级玩法\n- AutoHotKey `AHK`为windows用户提供了更多的可能，开发时可以用它定义快捷输入、执行自动化操作，可以定义开机自启动脚本，显隐应用窗口等等\n- MacType Windows的ClearType字体很多时候看着都很难受，这时我们需要MacType来优化字体显示，可以参考这个做个自定义优化[](https://blog.csdn.net/w19981220/article/details/47993893)或者直接使用Candy改的MacType\n\n## 其它\n- 使用`ssh-keygen -t rsa`生成公私钥，并将公钥上传到Github/Bitbucket/Gitlab等\n- 使用`ssh-copy-id -i ~/.ssh/id_rsa.pub user@server.host`命令将公钥上传到服务器实现免密登录\n\n## 开发一段时间后使用到的一些工具\n- Photoshop CC\n- Cow 本地代理\n- GifCam 本地录屏并生成gif文件\n- navcat 数据库连接工具\n- oss-aliyun 连接阿里OSS\n- 15_Second_ADB_Installer 快速安装adb工具\n- Android SDK\n- besttrace 路由跟踪工具\n- charles-proxy/Fiddler 本地请求拦截\n- 网易云音乐\n- Dism 轻量级windows管理工具\n- DockerToolbox 没有用Docker for Windows，因为它和VirtualBox冲突\n- Golang\n- lean cli leancloud命令行工具\n- Medis redis连接工具\n- minio 本地oss服务\n- mingw-w64\n- mongodb/robo3t mongodb和其连接工具\n- ngrok 内网穿透工具\n- postman api测试工具\n- 搜狗输入法\n- TeamViewer/向日葵 远程连接工具\n- Telegram\n- TunSafe\n- Vagrant\n- 微信web开发者工具\n- windirstat 查看本地磁盘占用空间，磁盘清理就靠它定位了\n- WinSCP 远程连接和管理工具\n- 各种虚拟机镜像 Windows/Ubuntu等\n","slug":"new-windows-develop-env","published":1,"updated":"2019-03-26T13:47:04.880Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0g0012tof9t7k946zr","content":"<h2 id=\"系统环境\"><a class=\"header-anchor\" href=\"#系统环境\">¶</a>系统环境</h2>\n<ul>\n<li>查看电脑配置（主要是CPU内存硬盘SSD这些），对于该配置能完成什么样的开发强度心里有数</li>\n<li>联网，设置固定IP（较推荐）</li>\n<li>清理已安装工具，取消不常用的任务栏（比如IE浏览器，应用商店）</li>\n<li>规划分区，明确每个分区盘的用处</li>\n</ul>\n<a id=\"more\"></a>\n<h2 id=\"工具下载\"><a class=\"header-anchor\" href=\"#工具下载\">¶</a>工具下载</h2>\n<p>下载以下常用工具并安装</p>\n<ul>\n<li>7z</li>\n<li>Chrome</li>\n<li>VSCode</li>\n<li>python</li>\n<li>Git（VSCode安装后再安装），SourceTree（图形化Git管理），BeyondCompare（Diff对比工具）</li>\n<li>NodeJs</li>\n<li>yarn</li>\n<li>Everything</li>\n<li>Wox（Everything和python安装后再安装）</li>\n<li>Cmder</li>\n<li>Office工具</li>\n<li>MacType（美化windows字体显示）</li>\n<li>迅雷极速版/FDM/Motrix</li>\n<li>IM工具 QQ/TIM 微信 钉钉</li>\n<li>VirtualBox</li>\n<li>其它工具 坚果云 Zerotier-One</li>\n<li>从坚果云的同步文件中安装ssr并添加订阅地址</li>\n</ul>\n<h2 id=\"Chrome\"><a class=\"header-anchor\" href=\"#Chrome\">¶</a>Chrome</h2>\n<p>前端开发浏览器是重头，所以要配置好浏览器的一些东西</p>\n<ul>\n<li>ssr运行后登录chrome同步扩展程序，确保常用的<code>vue-devtool</code> <code>Proxy SwitchSharp</code> <code>NIM(NodeJs调试管理工具)</code> <code>划词翻译</code>扩展已安装</li>\n<li>登录后等待同步书签</li>\n<li>为<code>Proxy SwitchSharp</code>导入坚果云同步的备份文件，并点击扩展图标选择自动模式，至此FQ已完成，后续可以科学上网</li>\n<li>设置 -&gt; 下载内容 -&gt; 下载前询问每个文件的保存位置 勾选上</li>\n</ul>\n<h2 id=\"Cmder\"><a class=\"header-anchor\" href=\"#Cmder\">¶</a>Cmder</h2>\n<p>windows下如果要获得流畅的命令行使用体验，<code>Cmder</code>那是必备的工具，后续的命令行操作也是使用该工具执行，安装后需要做一些简单的设置，参考<a href=\"https://www.jianshu.com/p/979db1a96f6d\"></a></p>\n<ul>\n<li>\n<p>注册右键菜单 管理员身份打开cmd并cd到<code>Cmder</code>目录，执行<code>Cmder.exe /REGISTER ALL</code></p>\n</li>\n<li>\n<p>设置启动目录 Settings -&gt; Startup - &gt; Task，修改{cmd::Cmder}项，把:<br>\n<code>cmd /k &quot;%ConEmuDir%\\..\\init.bat&quot;</code>改为<code>cmd /k &quot;%ConEmuDir%\\..\\init.bat&quot; -new_console:d:G:\\workspace</code></p>\n</li>\n<li>\n<p>设置alias 打开<code>Cmder</code>安装目录下的<code>config/user-aliases.cmd</code>文件，添加常用的简写命令，比如</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gc = git commit -am <span class=\"hljs-variable\">$1</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>设置常用快捷键 在Settings -&gt; Keys &amp; Macro页面中搜索<code>split</code>，为split bottom设置快捷键<code>Ctrl+Shift+D</code>为split right设置快捷键<code>Ctrl+D</code>，保持和<code>iTerm2</code>一致。设置<code>Minimize/Restore (Quake-style hotkey also)</code>的快捷键为<code>Ctrl+F1</code>，这个可以用来快速显隐窗口。</p>\n</li>\n</ul>\n<h2 id=\"Git\"><a class=\"header-anchor\" href=\"#Git\">¶</a>Git</h2>\n<p>Git现在几乎成了主流的版本控制工具，在开发之前我们需要先对Git做个简单的配置</p>\n<ul>\n<li>\n<p>配置Git</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name <span class=\"hljs-string\">\"erguotou\"</span></span><br><span class=\"line\">git config --global user.email erguotou525@gmail.com</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>生成本地公私钥</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\">cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n<p>将生成的公钥复制到Github/Gitlab之类的仓库中。</p>\n</li>\n<li>\n<p>修改文件默认结尾格式</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config core.eol lf</span><br><span class=\"line\">git config core.autocrlf <span class=\"hljs-literal\">false</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"VSCode\"><a class=\"header-anchor\" href=\"#VSCode\">¶</a>VSCode</h2>\n<p>目前来看最火的编辑器，速度比<code>Atom</code>快很多，使用前先安装几个常用的插件</p>\n<ul>\n<li>EditorConfig for VS Code</li>\n<li>ESLint</li>\n<li>HTML Snippets</li>\n<li>language-postcss</li>\n<li>PostCSS syntax</li>\n<li>language-stylus</li>\n<li>Path Intellisense</li>\n<li>Prettier</li>\n<li>Vetur</li>\n<li>Beautify</li>\n<li>其它如Flutter/Dart/Docker/Docker Compose/DotENV/Python/英汉词典</li>\n</ul>\n<p>然后修改创建文件的默认结尾为<code>LF</code>，在用户配置中加入<code>&quot;files.eol&quot;: &quot;\\n&quot;</code></p>\n<h2 id=\"NodeJs\"><a class=\"header-anchor\" href=\"#NodeJs\">¶</a>NodeJs</h2>\n<p>前端开发必备，主要是换源，安装常用全局模块</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -g nrm http-server</span><br><span class=\"line\">nrm use taobao</span><br><span class=\"line\">yarn config <span class=\"hljs-built_in\">set</span> registry <span class=\"hljs-string\">'https://registry.npm.taobao.org'</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Everything-Wox\"><a class=\"header-anchor\" href=\"#Everything-Wox\">¶</a>Everything &amp; Wox</h2>\n<p>类似Mac上的<code>Alfred</code>，配置简单，主要是改下快捷键为<code>Ctrl+~</code></p>\n<h2 id=\"高级玩法\"><a class=\"header-anchor\" href=\"#高级玩法\">¶</a>高级玩法</h2>\n<ul>\n<li>AutoHotKey <code>AHK</code>为windows用户提供了更多的可能，开发时可以用它定义快捷输入、执行自动化操作，可以定义开机自启动脚本，显隐应用窗口等等</li>\n<li>MacType Windows的ClearType字体很多时候看着都很难受，这时我们需要MacType来优化字体显示，可以参考这个做个自定义优化<a href=\"https://blog.csdn.net/w19981220/article/details/47993893\"></a>或者直接使用Candy改的MacType</li>\n</ul>\n<h2 id=\"其它\"><a class=\"header-anchor\" href=\"#其它\">¶</a>其它</h2>\n<ul>\n<li>使用<code>ssh-keygen -t rsa</code>生成公私钥，并将公钥上传到Github/Bitbucket/Gitlab等</li>\n<li>使用<code>ssh-copy-id -i ~/.ssh/id_rsa.pub user@server.host</code>命令将公钥上传到服务器实现免密登录</li>\n</ul>\n<h2 id=\"开发一段时间后使用到的一些工具\"><a class=\"header-anchor\" href=\"#开发一段时间后使用到的一些工具\">¶</a>开发一段时间后使用到的一些工具</h2>\n<ul>\n<li>Photoshop CC</li>\n<li>Cow 本地代理</li>\n<li>GifCam 本地录屏并生成gif文件</li>\n<li>navcat 数据库连接工具</li>\n<li>oss-aliyun 连接阿里OSS</li>\n<li>15_Second_ADB_Installer 快速安装adb工具</li>\n<li>Android SDK</li>\n<li>besttrace 路由跟踪工具</li>\n<li>charles-proxy/Fiddler 本地请求拦截</li>\n<li>网易云音乐</li>\n<li>Dism 轻量级windows管理工具</li>\n<li>DockerToolbox 没有用Docker for Windows，因为它和VirtualBox冲突</li>\n<li>Golang</li>\n<li>lean cli leancloud命令行工具</li>\n<li>Medis redis连接工具</li>\n<li>minio 本地oss服务</li>\n<li>mingw-w64</li>\n<li>mongodb/robo3t mongodb和其连接工具</li>\n<li>ngrok 内网穿透工具</li>\n<li>postman api测试工具</li>\n<li>搜狗输入法</li>\n<li>TeamViewer/向日葵 远程连接工具</li>\n<li>Telegram</li>\n<li>TunSafe</li>\n<li>Vagrant</li>\n<li>微信web开发者工具</li>\n<li>windirstat 查看本地磁盘占用空间，磁盘清理就靠它定位了</li>\n<li>WinSCP 远程连接和管理工具</li>\n<li>各种虚拟机镜像 Windows/Ubuntu等</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"系统环境\"><a class=\"header-anchor\" href=\"#系统环境\">¶</a>系统环境</h2>\n<ul>\n<li>查看电脑配置（主要是CPU内存硬盘SSD这些），对于该配置能完成什么样的开发强度心里有数</li>\n<li>联网，设置固定IP（较推荐）</li>\n<li>清理已安装工具，取消不常用的任务栏（比如IE浏览器，应用商店）</li>\n<li>规划分区，明确每个分区盘的用处</li>\n</ul>","more":"<h2 id=\"工具下载\"><a class=\"header-anchor\" href=\"#工具下载\">¶</a>工具下载</h2>\n<p>下载以下常用工具并安装</p>\n<ul>\n<li>7z</li>\n<li>Chrome</li>\n<li>VSCode</li>\n<li>python</li>\n<li>Git（VSCode安装后再安装），SourceTree（图形化Git管理），BeyondCompare（Diff对比工具）</li>\n<li>NodeJs</li>\n<li>yarn</li>\n<li>Everything</li>\n<li>Wox（Everything和python安装后再安装）</li>\n<li>Cmder</li>\n<li>Office工具</li>\n<li>MacType（美化windows字体显示）</li>\n<li>迅雷极速版/FDM/Motrix</li>\n<li>IM工具 QQ/TIM 微信 钉钉</li>\n<li>VirtualBox</li>\n<li>其它工具 坚果云 Zerotier-One</li>\n<li>从坚果云的同步文件中安装ssr并添加订阅地址</li>\n</ul>\n<h2 id=\"Chrome\"><a class=\"header-anchor\" href=\"#Chrome\">¶</a>Chrome</h2>\n<p>前端开发浏览器是重头，所以要配置好浏览器的一些东西</p>\n<ul>\n<li>ssr运行后登录chrome同步扩展程序，确保常用的<code>vue-devtool</code> <code>Proxy SwitchSharp</code> <code>NIM(NodeJs调试管理工具)</code> <code>划词翻译</code>扩展已安装</li>\n<li>登录后等待同步书签</li>\n<li>为<code>Proxy SwitchSharp</code>导入坚果云同步的备份文件，并点击扩展图标选择自动模式，至此FQ已完成，后续可以科学上网</li>\n<li>设置 -&gt; 下载内容 -&gt; 下载前询问每个文件的保存位置 勾选上</li>\n</ul>\n<h2 id=\"Cmder\"><a class=\"header-anchor\" href=\"#Cmder\">¶</a>Cmder</h2>\n<p>windows下如果要获得流畅的命令行使用体验，<code>Cmder</code>那是必备的工具，后续的命令行操作也是使用该工具执行，安装后需要做一些简单的设置，参考<a href=\"https://www.jianshu.com/p/979db1a96f6d\"></a></p>\n<ul>\n<li>\n<p>注册右键菜单 管理员身份打开cmd并cd到<code>Cmder</code>目录，执行<code>Cmder.exe /REGISTER ALL</code></p>\n</li>\n<li>\n<p>设置启动目录 Settings -&gt; Startup - &gt; Task，修改{cmd::Cmder}项，把:<br>\n<code>cmd /k &quot;%ConEmuDir%\\..\\init.bat&quot;</code>改为<code>cmd /k &quot;%ConEmuDir%\\..\\init.bat&quot; -new_console:d:G:\\workspace</code></p>\n</li>\n<li>\n<p>设置alias 打开<code>Cmder</code>安装目录下的<code>config/user-aliases.cmd</code>文件，添加常用的简写命令，比如</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gc = git commit -am <span class=\"variable\">$1</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>设置常用快捷键 在Settings -&gt; Keys &amp; Macro页面中搜索<code>split</code>，为split bottom设置快捷键<code>Ctrl+Shift+D</code>为split right设置快捷键<code>Ctrl+D</code>，保持和<code>iTerm2</code>一致。设置<code>Minimize/Restore (Quake-style hotkey also)</code>的快捷键为<code>Ctrl+F1</code>，这个可以用来快速显隐窗口。</p>\n</li>\n</ul>\n<h2 id=\"Git\"><a class=\"header-anchor\" href=\"#Git\">¶</a>Git</h2>\n<p>Git现在几乎成了主流的版本控制工具，在开发之前我们需要先对Git做个简单的配置</p>\n<ul>\n<li>\n<p>配置Git</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name <span class=\"string\">\"erguotou\"</span></span><br><span class=\"line\">git config --global user.email erguotou525@gmail.com</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>生成本地公私钥</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\">cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n<p>将生成的公钥复制到Github/Gitlab之类的仓库中。</p>\n</li>\n<li>\n<p>修改文件默认结尾格式</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config core.eol lf</span><br><span class=\"line\">git config core.autocrlf <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"VSCode\"><a class=\"header-anchor\" href=\"#VSCode\">¶</a>VSCode</h2>\n<p>目前来看最火的编辑器，速度比<code>Atom</code>快很多，使用前先安装几个常用的插件</p>\n<ul>\n<li>EditorConfig for VS Code</li>\n<li>ESLint</li>\n<li>HTML Snippets</li>\n<li>language-postcss</li>\n<li>PostCSS syntax</li>\n<li>language-stylus</li>\n<li>Path Intellisense</li>\n<li>Prettier</li>\n<li>Vetur</li>\n<li>Beautify</li>\n<li>其它如Flutter/Dart/Docker/Docker Compose/DotENV/Python/英汉词典</li>\n</ul>\n<p>然后修改创建文件的默认结尾为<code>LF</code>，在用户配置中加入<code>&quot;files.eol&quot;: &quot;\\n&quot;</code></p>\n<h2 id=\"NodeJs\"><a class=\"header-anchor\" href=\"#NodeJs\">¶</a>NodeJs</h2>\n<p>前端开发必备，主要是换源，安装常用全局模块</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -g nrm http-server</span><br><span class=\"line\">nrm use taobao</span><br><span class=\"line\">yarn config <span class=\"built_in\">set</span> registry <span class=\"string\">'https://registry.npm.taobao.org'</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Everything-Wox\"><a class=\"header-anchor\" href=\"#Everything-Wox\">¶</a>Everything &amp; Wox</h2>\n<p>类似Mac上的<code>Alfred</code>，配置简单，主要是改下快捷键为<code>Ctrl+~</code></p>\n<h2 id=\"高级玩法\"><a class=\"header-anchor\" href=\"#高级玩法\">¶</a>高级玩法</h2>\n<ul>\n<li>AutoHotKey <code>AHK</code>为windows用户提供了更多的可能，开发时可以用它定义快捷输入、执行自动化操作，可以定义开机自启动脚本，显隐应用窗口等等</li>\n<li>MacType Windows的ClearType字体很多时候看着都很难受，这时我们需要MacType来优化字体显示，可以参考这个做个自定义优化<a href=\"https://blog.csdn.net/w19981220/article/details/47993893\"></a>或者直接使用Candy改的MacType</li>\n</ul>\n<h2 id=\"其它\"><a class=\"header-anchor\" href=\"#其它\">¶</a>其它</h2>\n<ul>\n<li>使用<code>ssh-keygen -t rsa</code>生成公私钥，并将公钥上传到Github/Bitbucket/Gitlab等</li>\n<li>使用<code>ssh-copy-id -i ~/.ssh/id_rsa.pub user@server.host</code>命令将公钥上传到服务器实现免密登录</li>\n</ul>\n<h2 id=\"开发一段时间后使用到的一些工具\"><a class=\"header-anchor\" href=\"#开发一段时间后使用到的一些工具\">¶</a>开发一段时间后使用到的一些工具</h2>\n<ul>\n<li>Photoshop CC</li>\n<li>Cow 本地代理</li>\n<li>GifCam 本地录屏并生成gif文件</li>\n<li>navcat 数据库连接工具</li>\n<li>oss-aliyun 连接阿里OSS</li>\n<li>15_Second_ADB_Installer 快速安装adb工具</li>\n<li>Android SDK</li>\n<li>besttrace 路由跟踪工具</li>\n<li>charles-proxy/Fiddler 本地请求拦截</li>\n<li>网易云音乐</li>\n<li>Dism 轻量级windows管理工具</li>\n<li>DockerToolbox 没有用Docker for Windows，因为它和VirtualBox冲突</li>\n<li>Golang</li>\n<li>lean cli leancloud命令行工具</li>\n<li>Medis redis连接工具</li>\n<li>minio 本地oss服务</li>\n<li>mingw-w64</li>\n<li>mongodb/robo3t mongodb和其连接工具</li>\n<li>ngrok 内网穿透工具</li>\n<li>postman api测试工具</li>\n<li>搜狗输入法</li>\n<li>TeamViewer/向日葵 远程连接工具</li>\n<li>Telegram</li>\n<li>TunSafe</li>\n<li>Vagrant</li>\n<li>微信web开发者工具</li>\n<li>windirstat 查看本地磁盘占用空间，磁盘清理就靠它定位了</li>\n<li>WinSCP 远程连接和管理工具</li>\n<li>各种虚拟机镜像 Windows/Ubuntu等</li>\n</ul>"},{"title":"NodeJs分享","s":"nodejs-share","date":"2016-04-26T12:50:25.000Z","_content":"\n*技术分享以及项目实践*\n\n## 目录\n* 起源\n* 特性\n* 发展\n* 影响\n* 安装\n* 生态圈\n* 项目应用\n<!-- more -->\n\n## 起源\n### Nodejs是什么？\n* 服务器端运行的 Javascript\n* 基于 Google Chrome的javascript engine V8\n* 事件驱动，无阻塞 Evented,no-blocking\n* 扩展js语义：增加了模块化\n* 大约有8000行 c/c++代码，2000行 js 代码\n\n另外这里有一篇在线的文章[深入浅出Node.js](http://book.51cto.com/art/201311/417099.htm)可以参阅。\n\n### 特性\n* 支持高并发\n* 异步io\n\n### 发展\n#### Nodejs版本\n在和`io.js`合并之前一直维持着`0.x.x`版本，但是和`io.js`合并后就已经开始是`4.x.x`，`5.x.x`甚至`6.x.x`。\n\n### 影响\n由于js语法简单，掌握起来非常快，且大多数开发者都比较熟悉，所以上手很快。再加上有npm库的支持，使得nodejs开发也是很快，而且是越发展越迅猛的势头。它可以运用于许多场景，不仅仅是web开发，可以做桌面应用，手机App，可以命令行等等。\n\n* 在web通讯中运用最广的应该是`socket.io`，它可以应用到web实时通讯，可以用于游戏通讯，可以用于在线开发工具通讯或者热重载等等。\n* 在服务器领域最火的应该是`express`，用它开发web服务器非常快而且性能不错。\n* 在用户身份认证方面使用最多的应该是`passport`，它为身份认证提供了统一的接口，支持本地身份认证和各种第三方身份认证。\n* 在桌面应用开发方面有`nw.js`和`electron`，相对来说`electron`更好，而且Github官方出的开发工具`Atom`就是使用`electron`开发的。使用它们开发的工具还有很多，包括`slack` // todo\n* 在手机App方向应用最火的、热度最高的应该算是`ionic`和`React Native`，前者借助于`Angularjs`和`PhoneGap`可以实现用js开发跨平台的手机应用。后者是Fackbook依赖于其`React`推出的手机应用开发套件，其火热程度非同一般。\n* 其它更多的产品等你发现和分享。\n\n### 安装\nNodejs环境的安装方法各平台不一致，但都比较简单。非windows平台建议使用`nvm`进行nodejs的安装和版本管理。\n#### 全局安装模块\n使用npm安装全局模块`npm install -g some-module`\n#### 本地安装\n使用npm安装本地模块`npm install some-module`，它有2个常用的参数`--save`和`--save-dev`，分别表示将该模块依赖信息保存到`package.json`的`dependencies`和`devDependencies`，分别表示运行时依赖和开发时依赖。这样项目发布出去后别人就可以通过`npm install --production`和`npm install`命令将依赖安装上。\n#### 安装指定版本或指定tag\n* 安装指定版本 `npm install some-module@1.3.0`\n* 安装指定tag `npm install some-module#dev`\n* 更多其它的安装条件在这里不做说明\n\n#### 更新\n更新可以直接重新安装也可以使用update命令`npm update [-g] some-module`\n\n#### 卸载\n对应于install命令有uninstall命令，使用方法和install一致`npm uninstall [-g] [--save|--save-dev]`\n\n#### 一些说明\n* npm的包大多是嵌套的，即包A依赖包B，包B又依赖包C，npm会处理所有的依赖关系并全部安装（npm 2和npm 3有所区别，npm 2是在每个包下安装其所有的依赖包，包括嵌套依赖，而npm 3会先分析包的依赖关系，将依赖扁平化，减少重复依赖）\n* 由于国内网络管制原因，可能有些包在安装时会出现失败，如果出现失败，建议使用国内npm源，比如cnpm等。个人喜欢使用`nrm`进行管理\n\n```bash\nnpm install -g nrm\nnrm ls\nnrm use taobao # 这里使用的是淘宝源\n```\n\n### 生态圈\nNodejs的生态圈主要靠npm(node package manager)。这里面有成千上万的工具，每天更新的包数量就有//todo\n当我们需要使用node开发某些功能时要善用npm，因为它里面已经有很多现成的包，不需要我们重复造轮子，直接拿来用就可以了。\n我们可以通过npm search或者去[npm官网](https://npmjs.org)搜索，输入关键词，找到包后查看其说明，如果是我们想要的，那就`npm install`它吧。\n\n### 项目应用\n此次精总前端项目就大量使用了Nodejs的相关技术。\n\n* 包安装。使用npm（npm也是很多前端库文件的发布目录，bower等已经不适合现在的趋势）将项目使用的框架文件安装到本地并使用node的文件模块将其复制到我们的项目目录中（多这一步是因为我们没有采用开发时编译的思路，因为这对框架的搭建和开发学习的成本要求较高）\n* `gulp`任务。使用`gulp`添加开发时任务`gulp dev`，包括代码风格检查和预编译语言的实时编译以及浏览器自动重载等。还有其它的包括js文档生成任务和文档查看服务器任务等。\n* 源代码的构建。使用nodejs生态圈中的构建工具对源码进行构建，生成服务发布的目录文件，主要是对代码进行合并压缩和版本控制。\n","source":"_posts/nodejs-share.md","raw":"---\ntitle: NodeJs分享\ns: nodejs-share\ndate: 2016-04-26 20:50:25\ntags:\n- NodeJs\n---\n\n*技术分享以及项目实践*\n\n## 目录\n* 起源\n* 特性\n* 发展\n* 影响\n* 安装\n* 生态圈\n* 项目应用\n<!-- more -->\n\n## 起源\n### Nodejs是什么？\n* 服务器端运行的 Javascript\n* 基于 Google Chrome的javascript engine V8\n* 事件驱动，无阻塞 Evented,no-blocking\n* 扩展js语义：增加了模块化\n* 大约有8000行 c/c++代码，2000行 js 代码\n\n另外这里有一篇在线的文章[深入浅出Node.js](http://book.51cto.com/art/201311/417099.htm)可以参阅。\n\n### 特性\n* 支持高并发\n* 异步io\n\n### 发展\n#### Nodejs版本\n在和`io.js`合并之前一直维持着`0.x.x`版本，但是和`io.js`合并后就已经开始是`4.x.x`，`5.x.x`甚至`6.x.x`。\n\n### 影响\n由于js语法简单，掌握起来非常快，且大多数开发者都比较熟悉，所以上手很快。再加上有npm库的支持，使得nodejs开发也是很快，而且是越发展越迅猛的势头。它可以运用于许多场景，不仅仅是web开发，可以做桌面应用，手机App，可以命令行等等。\n\n* 在web通讯中运用最广的应该是`socket.io`，它可以应用到web实时通讯，可以用于游戏通讯，可以用于在线开发工具通讯或者热重载等等。\n* 在服务器领域最火的应该是`express`，用它开发web服务器非常快而且性能不错。\n* 在用户身份认证方面使用最多的应该是`passport`，它为身份认证提供了统一的接口，支持本地身份认证和各种第三方身份认证。\n* 在桌面应用开发方面有`nw.js`和`electron`，相对来说`electron`更好，而且Github官方出的开发工具`Atom`就是使用`electron`开发的。使用它们开发的工具还有很多，包括`slack` // todo\n* 在手机App方向应用最火的、热度最高的应该算是`ionic`和`React Native`，前者借助于`Angularjs`和`PhoneGap`可以实现用js开发跨平台的手机应用。后者是Fackbook依赖于其`React`推出的手机应用开发套件，其火热程度非同一般。\n* 其它更多的产品等你发现和分享。\n\n### 安装\nNodejs环境的安装方法各平台不一致，但都比较简单。非windows平台建议使用`nvm`进行nodejs的安装和版本管理。\n#### 全局安装模块\n使用npm安装全局模块`npm install -g some-module`\n#### 本地安装\n使用npm安装本地模块`npm install some-module`，它有2个常用的参数`--save`和`--save-dev`，分别表示将该模块依赖信息保存到`package.json`的`dependencies`和`devDependencies`，分别表示运行时依赖和开发时依赖。这样项目发布出去后别人就可以通过`npm install --production`和`npm install`命令将依赖安装上。\n#### 安装指定版本或指定tag\n* 安装指定版本 `npm install some-module@1.3.0`\n* 安装指定tag `npm install some-module#dev`\n* 更多其它的安装条件在这里不做说明\n\n#### 更新\n更新可以直接重新安装也可以使用update命令`npm update [-g] some-module`\n\n#### 卸载\n对应于install命令有uninstall命令，使用方法和install一致`npm uninstall [-g] [--save|--save-dev]`\n\n#### 一些说明\n* npm的包大多是嵌套的，即包A依赖包B，包B又依赖包C，npm会处理所有的依赖关系并全部安装（npm 2和npm 3有所区别，npm 2是在每个包下安装其所有的依赖包，包括嵌套依赖，而npm 3会先分析包的依赖关系，将依赖扁平化，减少重复依赖）\n* 由于国内网络管制原因，可能有些包在安装时会出现失败，如果出现失败，建议使用国内npm源，比如cnpm等。个人喜欢使用`nrm`进行管理\n\n```bash\nnpm install -g nrm\nnrm ls\nnrm use taobao # 这里使用的是淘宝源\n```\n\n### 生态圈\nNodejs的生态圈主要靠npm(node package manager)。这里面有成千上万的工具，每天更新的包数量就有//todo\n当我们需要使用node开发某些功能时要善用npm，因为它里面已经有很多现成的包，不需要我们重复造轮子，直接拿来用就可以了。\n我们可以通过npm search或者去[npm官网](https://npmjs.org)搜索，输入关键词，找到包后查看其说明，如果是我们想要的，那就`npm install`它吧。\n\n### 项目应用\n此次精总前端项目就大量使用了Nodejs的相关技术。\n\n* 包安装。使用npm（npm也是很多前端库文件的发布目录，bower等已经不适合现在的趋势）将项目使用的框架文件安装到本地并使用node的文件模块将其复制到我们的项目目录中（多这一步是因为我们没有采用开发时编译的思路，因为这对框架的搭建和开发学习的成本要求较高）\n* `gulp`任务。使用`gulp`添加开发时任务`gulp dev`，包括代码风格检查和预编译语言的实时编译以及浏览器自动重载等。还有其它的包括js文档生成任务和文档查看服务器任务等。\n* 源代码的构建。使用nodejs生态圈中的构建工具对源码进行构建，生成服务发布的目录文件，主要是对代码进行合并压缩和版本控制。\n","slug":"nodejs-share","published":1,"updated":"2019-03-26T13:47:04.881Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0h0013tof9zxsywa65","content":"<p><em>技术分享以及项目实践</em></p>\n<h2 id=\"目录\"><a class=\"header-anchor\" href=\"#目录\">¶</a>目录</h2>\n<ul>\n<li>起源</li>\n<li>特性</li>\n<li>发展</li>\n<li>影响</li>\n<li>安装</li>\n<li>生态圈</li>\n<li>项目应用</li>\n</ul>\n<a id=\"more\"></a>\n<h2 id=\"起源\"><a class=\"header-anchor\" href=\"#起源\">¶</a>起源</h2>\n<h3 id=\"Nodejs是什么？\"><a class=\"header-anchor\" href=\"#Nodejs是什么？\">¶</a>Nodejs是什么？</h3>\n<ul>\n<li>服务器端运行的 Javascript</li>\n<li>基于 Google Chrome的javascript engine V8</li>\n<li>事件驱动，无阻塞 Evented,no-blocking</li>\n<li>扩展js语义：增加了模块化</li>\n<li>大约有8000行 c/c++代码，2000行 js 代码</li>\n</ul>\n<p>另外这里有一篇在线的文章<a href=\"http://book.51cto.com/art/201311/417099.htm\">深入浅出Node.js</a>可以参阅。</p>\n<h3 id=\"特性\"><a class=\"header-anchor\" href=\"#特性\">¶</a>特性</h3>\n<ul>\n<li>支持高并发</li>\n<li>异步io</li>\n</ul>\n<h3 id=\"发展\"><a class=\"header-anchor\" href=\"#发展\">¶</a>发展</h3>\n<h4 id=\"Nodejs版本\"><a class=\"header-anchor\" href=\"#Nodejs版本\">¶</a>Nodejs版本</h4>\n<p>在和<code>io.js</code>合并之前一直维持着<code>0.x.x</code>版本，但是和<code>io.js</code>合并后就已经开始是<code>4.x.x</code>，<code>5.x.x</code>甚至<code>6.x.x</code>。</p>\n<h3 id=\"影响\"><a class=\"header-anchor\" href=\"#影响\">¶</a>影响</h3>\n<p>由于js语法简单，掌握起来非常快，且大多数开发者都比较熟悉，所以上手很快。再加上有npm库的支持，使得nodejs开发也是很快，而且是越发展越迅猛的势头。它可以运用于许多场景，不仅仅是web开发，可以做桌面应用，手机App，可以命令行等等。</p>\n<ul>\n<li>在web通讯中运用最广的应该是<code>socket.io</code>，它可以应用到web实时通讯，可以用于游戏通讯，可以用于在线开发工具通讯或者热重载等等。</li>\n<li>在服务器领域最火的应该是<code>express</code>，用它开发web服务器非常快而且性能不错。</li>\n<li>在用户身份认证方面使用最多的应该是<code>passport</code>，它为身份认证提供了统一的接口，支持本地身份认证和各种第三方身份认证。</li>\n<li>在桌面应用开发方面有<code>nw.js</code>和<code>electron</code>，相对来说<code>electron</code>更好，而且Github官方出的开发工具<code>Atom</code>就是使用<code>electron</code>开发的。使用它们开发的工具还有很多，包括<code>slack</code> // todo</li>\n<li>在手机App方向应用最火的、热度最高的应该算是<code>ionic</code>和<code>React Native</code>，前者借助于<code>Angularjs</code>和<code>PhoneGap</code>可以实现用js开发跨平台的手机应用。后者是Fackbook依赖于其<code>React</code>推出的手机应用开发套件，其火热程度非同一般。</li>\n<li>其它更多的产品等你发现和分享。</li>\n</ul>\n<h3 id=\"安装\"><a class=\"header-anchor\" href=\"#安装\">¶</a>安装</h3>\n<p>Nodejs环境的安装方法各平台不一致，但都比较简单。非windows平台建议使用<code>nvm</code>进行nodejs的安装和版本管理。</p>\n<h4 id=\"全局安装模块\"><a class=\"header-anchor\" href=\"#全局安装模块\">¶</a>全局安装模块</h4>\n<p>使用npm安装全局模块<code>npm install -g some-module</code></p>\n<h4 id=\"本地安装\"><a class=\"header-anchor\" href=\"#本地安装\">¶</a>本地安装</h4>\n<p>使用npm安装本地模块<code>npm install some-module</code>，它有2个常用的参数<code>--save</code>和<code>--save-dev</code>，分别表示将该模块依赖信息保存到<code>package.json</code>的<code>dependencies</code>和<code>devDependencies</code>，分别表示运行时依赖和开发时依赖。这样项目发布出去后别人就可以通过<code>npm install --production</code>和<code>npm install</code>命令将依赖安装上。</p>\n<h4 id=\"安装指定版本或指定tag\"><a class=\"header-anchor\" href=\"#安装指定版本或指定tag\">¶</a>安装指定版本或指定tag</h4>\n<ul>\n<li>安装指定版本 <code>npm install some-module@1.3.0</code></li>\n<li>安装指定tag <code>npm install some-module#dev</code></li>\n<li>更多其它的安装条件在这里不做说明</li>\n</ul>\n<h4 id=\"更新\"><a class=\"header-anchor\" href=\"#更新\">¶</a>更新</h4>\n<p>更新可以直接重新安装也可以使用update命令<code>npm update [-g] some-module</code></p>\n<h4 id=\"卸载\"><a class=\"header-anchor\" href=\"#卸载\">¶</a>卸载</h4>\n<p>对应于install命令有uninstall命令，使用方法和install一致<code>npm uninstall [-g] [--save|--save-dev]</code></p>\n<h4 id=\"一些说明\"><a class=\"header-anchor\" href=\"#一些说明\">¶</a>一些说明</h4>\n<ul>\n<li>npm的包大多是嵌套的，即包A依赖包B，包B又依赖包C，npm会处理所有的依赖关系并全部安装（npm 2和npm 3有所区别，npm 2是在每个包下安装其所有的依赖包，包括嵌套依赖，而npm 3会先分析包的依赖关系，将依赖扁平化，减少重复依赖）</li>\n<li>由于国内网络管制原因，可能有些包在安装时会出现失败，如果出现失败，建议使用国内npm源，比如cnpm等。个人喜欢使用<code>nrm</code>进行管理</li>\n</ul>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g nrm</span><br><span class=\"line\">nrm ls</span><br><span class=\"line\">nrm use taobao <span class=\"hljs-comment\"># 这里使用的是淘宝源</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"生态圈\"><a class=\"header-anchor\" href=\"#生态圈\">¶</a>生态圈</h3>\n<p>Nodejs的生态圈主要靠npm(node package manager)。这里面有成千上万的工具，每天更新的包数量就有//todo<br>\n当我们需要使用node开发某些功能时要善用npm，因为它里面已经有很多现成的包，不需要我们重复造轮子，直接拿来用就可以了。<br>\n我们可以通过npm search或者去<a href=\"https://npmjs.org\">npm官网</a>搜索，输入关键词，找到包后查看其说明，如果是我们想要的，那就<code>npm install</code>它吧。</p>\n<h3 id=\"项目应用\"><a class=\"header-anchor\" href=\"#项目应用\">¶</a>项目应用</h3>\n<p>此次精总前端项目就大量使用了Nodejs的相关技术。</p>\n<ul>\n<li>包安装。使用npm（npm也是很多前端库文件的发布目录，bower等已经不适合现在的趋势）将项目使用的框架文件安装到本地并使用node的文件模块将其复制到我们的项目目录中（多这一步是因为我们没有采用开发时编译的思路，因为这对框架的搭建和开发学习的成本要求较高）</li>\n<li><code>gulp</code>任务。使用<code>gulp</code>添加开发时任务<code>gulp dev</code>，包括代码风格检查和预编译语言的实时编译以及浏览器自动重载等。还有其它的包括js文档生成任务和文档查看服务器任务等。</li>\n<li>源代码的构建。使用nodejs生态圈中的构建工具对源码进行构建，生成服务发布的目录文件，主要是对代码进行合并压缩和版本控制。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><em>技术分享以及项目实践</em></p>\n<h2 id=\"目录\"><a class=\"header-anchor\" href=\"#目录\">¶</a>目录</h2>\n<ul>\n<li>起源</li>\n<li>特性</li>\n<li>发展</li>\n<li>影响</li>\n<li>安装</li>\n<li>生态圈</li>\n<li>项目应用</li>\n</ul>","more":"<h2 id=\"起源\"><a class=\"header-anchor\" href=\"#起源\">¶</a>起源</h2>\n<h3 id=\"Nodejs是什么？\"><a class=\"header-anchor\" href=\"#Nodejs是什么？\">¶</a>Nodejs是什么？</h3>\n<ul>\n<li>服务器端运行的 Javascript</li>\n<li>基于 Google Chrome的javascript engine V8</li>\n<li>事件驱动，无阻塞 Evented,no-blocking</li>\n<li>扩展js语义：增加了模块化</li>\n<li>大约有8000行 c/c++代码，2000行 js 代码</li>\n</ul>\n<p>另外这里有一篇在线的文章<a href=\"http://book.51cto.com/art/201311/417099.htm\">深入浅出Node.js</a>可以参阅。</p>\n<h3 id=\"特性\"><a class=\"header-anchor\" href=\"#特性\">¶</a>特性</h3>\n<ul>\n<li>支持高并发</li>\n<li>异步io</li>\n</ul>\n<h3 id=\"发展\"><a class=\"header-anchor\" href=\"#发展\">¶</a>发展</h3>\n<h4 id=\"Nodejs版本\"><a class=\"header-anchor\" href=\"#Nodejs版本\">¶</a>Nodejs版本</h4>\n<p>在和<code>io.js</code>合并之前一直维持着<code>0.x.x</code>版本，但是和<code>io.js</code>合并后就已经开始是<code>4.x.x</code>，<code>5.x.x</code>甚至<code>6.x.x</code>。</p>\n<h3 id=\"影响\"><a class=\"header-anchor\" href=\"#影响\">¶</a>影响</h3>\n<p>由于js语法简单，掌握起来非常快，且大多数开发者都比较熟悉，所以上手很快。再加上有npm库的支持，使得nodejs开发也是很快，而且是越发展越迅猛的势头。它可以运用于许多场景，不仅仅是web开发，可以做桌面应用，手机App，可以命令行等等。</p>\n<ul>\n<li>在web通讯中运用最广的应该是<code>socket.io</code>，它可以应用到web实时通讯，可以用于游戏通讯，可以用于在线开发工具通讯或者热重载等等。</li>\n<li>在服务器领域最火的应该是<code>express</code>，用它开发web服务器非常快而且性能不错。</li>\n<li>在用户身份认证方面使用最多的应该是<code>passport</code>，它为身份认证提供了统一的接口，支持本地身份认证和各种第三方身份认证。</li>\n<li>在桌面应用开发方面有<code>nw.js</code>和<code>electron</code>，相对来说<code>electron</code>更好，而且Github官方出的开发工具<code>Atom</code>就是使用<code>electron</code>开发的。使用它们开发的工具还有很多，包括<code>slack</code> // todo</li>\n<li>在手机App方向应用最火的、热度最高的应该算是<code>ionic</code>和<code>React Native</code>，前者借助于<code>Angularjs</code>和<code>PhoneGap</code>可以实现用js开发跨平台的手机应用。后者是Fackbook依赖于其<code>React</code>推出的手机应用开发套件，其火热程度非同一般。</li>\n<li>其它更多的产品等你发现和分享。</li>\n</ul>\n<h3 id=\"安装\"><a class=\"header-anchor\" href=\"#安装\">¶</a>安装</h3>\n<p>Nodejs环境的安装方法各平台不一致，但都比较简单。非windows平台建议使用<code>nvm</code>进行nodejs的安装和版本管理。</p>\n<h4 id=\"全局安装模块\"><a class=\"header-anchor\" href=\"#全局安装模块\">¶</a>全局安装模块</h4>\n<p>使用npm安装全局模块<code>npm install -g some-module</code></p>\n<h4 id=\"本地安装\"><a class=\"header-anchor\" href=\"#本地安装\">¶</a>本地安装</h4>\n<p>使用npm安装本地模块<code>npm install some-module</code>，它有2个常用的参数<code>--save</code>和<code>--save-dev</code>，分别表示将该模块依赖信息保存到<code>package.json</code>的<code>dependencies</code>和<code>devDependencies</code>，分别表示运行时依赖和开发时依赖。这样项目发布出去后别人就可以通过<code>npm install --production</code>和<code>npm install</code>命令将依赖安装上。</p>\n<h4 id=\"安装指定版本或指定tag\"><a class=\"header-anchor\" href=\"#安装指定版本或指定tag\">¶</a>安装指定版本或指定tag</h4>\n<ul>\n<li>安装指定版本 <code>npm install some-module@1.3.0</code></li>\n<li>安装指定tag <code>npm install some-module#dev</code></li>\n<li>更多其它的安装条件在这里不做说明</li>\n</ul>\n<h4 id=\"更新\"><a class=\"header-anchor\" href=\"#更新\">¶</a>更新</h4>\n<p>更新可以直接重新安装也可以使用update命令<code>npm update [-g] some-module</code></p>\n<h4 id=\"卸载\"><a class=\"header-anchor\" href=\"#卸载\">¶</a>卸载</h4>\n<p>对应于install命令有uninstall命令，使用方法和install一致<code>npm uninstall [-g] [--save|--save-dev]</code></p>\n<h4 id=\"一些说明\"><a class=\"header-anchor\" href=\"#一些说明\">¶</a>一些说明</h4>\n<ul>\n<li>npm的包大多是嵌套的，即包A依赖包B，包B又依赖包C，npm会处理所有的依赖关系并全部安装（npm 2和npm 3有所区别，npm 2是在每个包下安装其所有的依赖包，包括嵌套依赖，而npm 3会先分析包的依赖关系，将依赖扁平化，减少重复依赖）</li>\n<li>由于国内网络管制原因，可能有些包在安装时会出现失败，如果出现失败，建议使用国内npm源，比如cnpm等。个人喜欢使用<code>nrm</code>进行管理</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g nrm</span><br><span class=\"line\">nrm ls</span><br><span class=\"line\">nrm use taobao <span class=\"comment\"># 这里使用的是淘宝源</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"生态圈\"><a class=\"header-anchor\" href=\"#生态圈\">¶</a>生态圈</h3>\n<p>Nodejs的生态圈主要靠npm(node package manager)。这里面有成千上万的工具，每天更新的包数量就有//todo<br>\n当我们需要使用node开发某些功能时要善用npm，因为它里面已经有很多现成的包，不需要我们重复造轮子，直接拿来用就可以了。<br>\n我们可以通过npm search或者去<a href=\"https://npmjs.org\">npm官网</a>搜索，输入关键词，找到包后查看其说明，如果是我们想要的，那就<code>npm install</code>它吧。</p>\n<h3 id=\"项目应用\"><a class=\"header-anchor\" href=\"#项目应用\">¶</a>项目应用</h3>\n<p>此次精总前端项目就大量使用了Nodejs的相关技术。</p>\n<ul>\n<li>包安装。使用npm（npm也是很多前端库文件的发布目录，bower等已经不适合现在的趋势）将项目使用的框架文件安装到本地并使用node的文件模块将其复制到我们的项目目录中（多这一步是因为我们没有采用开发时编译的思路，因为这对框架的搭建和开发学习的成本要求较高）</li>\n<li><code>gulp</code>任务。使用<code>gulp</code>添加开发时任务<code>gulp dev</code>，包括代码风格检查和预编译语言的实时编译以及浏览器自动重载等。还有其它的包括js文档生成任务和文档查看服务器任务等。</li>\n<li>源代码的构建。使用nodejs生态圈中的构建工具对源码进行构建，生成服务发布的目录文件，主要是对代码进行合并压缩和版本控制。</li>\n</ul>"},{"title":"利用Nginx让IIS和tomcat共用80端口","s":"nginx-tomcat-iis","date":"2015-01-14T08:46:00.000Z","thumbnail":"/images/server/nginx.png","_content":"*项目：《安徽省儿童医院》主网站（PHP开发）与微信（JAVA开发）共用服务器*\n\n原来整合时使用的是jakarta桥接插件，但当时整合时就各种弄不懂，也是各种迷糊然后就好了，最终主网站用的域名是[www.ahetyy.com](www.ahetyy.com)，微信端用的是[211.149.198.47/etyy](http://211.149.198.47/etyy)。\n\n然后网站和微信一直都能使用，相安无事，但有一次莫名其妙地出了问题，不得其解。\n\n在修复时打算按照原来的方式来，可是发现又不会弄了，因为当初怎么弄好的都不记得。\n\n无奈之下在百度搜索时发现一篇[《IIS tomcat共用80端口解决一个IP多个域名：使用Nginx反向代理方式使两者兼容》](http://www.cnblogs.com/wuyou/p/3455619.html)的文章，受其启发，准备改用Nginx来完成。\n<!-- more -->\n\n## 1.下载\n[http://nginx.org/en/download.html](http://nginx.org/en/download.html) 我当时下载的是nginx/Windows-1.7.8 版本。\n\n## 2.解压\n\n## 3.修改配置\n*nginx的配置看起来还是比较复杂的，现在的配置只是保证能使用，但不一定是最好的*\n\n修改Nginx的conf目录下的nginx.conf文件，修改server的配置如下：\n\n    server {\n      listen       80;\n      server_name  www.ahetyy.com;\n      location ^~ /etyy {\n          proxy_pass   http://localhost:8080/etyy;\n          proxy_set_header Host $host;\n          proxy_set_header X-Real-IP $remote_addr;\n          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      }\n      location / {\n          \tproxy_pass   http://localhost:81;\n      }\n\t}\n\n其中server_name表示对外访问的域名，第一个location的规则是 任意以\"/etyy\"开头的请求都转发给[http://localhost:8080/etyy](http://localhost:8080/etyy)也就是tomcat来处理，第二个location的规则是其余请求全都发给php的主网站处理。\n\n特别注意：第一个location下的配置中的proxy_set_header的配置是必须的，否则最后打开[http://www.ahetyy.com/etyy](http://www.ahetyy.com/etyy)时页面请求的css和js路径都会是localhost:8080的，因为tomcat那边得到的请求就是localhost:8080的，需要将请求的头信息修改为真实请求的请求路径才行。（但是现在页面的base的路径上会有一个端口80，有点小小强迫症的我就忍了~）\n\n## 4.运行\ncmd切换到nginx.exe的目录下，启动-- start nginx 停止-- nginx -s stop，有时会结束不掉，我就会手动关闭进程~\n\n## 5.设置Nginx以服务方式启动\n（暂时没做，网上教程看着好复杂- -！），搞定！\n","source":"_posts/nginx-tomcat-iis.md","raw":"---\ntitle: 利用Nginx让IIS和tomcat共用80端口\ns: nginx-tomcat-iis\ndate: 2015-01-14 16:46:00\nthumbnail: /images/server/nginx.png\ntags:\n  - Nginx\n---\n*项目：《安徽省儿童医院》主网站（PHP开发）与微信（JAVA开发）共用服务器*\n\n原来整合时使用的是jakarta桥接插件，但当时整合时就各种弄不懂，也是各种迷糊然后就好了，最终主网站用的域名是[www.ahetyy.com](www.ahetyy.com)，微信端用的是[211.149.198.47/etyy](http://211.149.198.47/etyy)。\n\n然后网站和微信一直都能使用，相安无事，但有一次莫名其妙地出了问题，不得其解。\n\n在修复时打算按照原来的方式来，可是发现又不会弄了，因为当初怎么弄好的都不记得。\n\n无奈之下在百度搜索时发现一篇[《IIS tomcat共用80端口解决一个IP多个域名：使用Nginx反向代理方式使两者兼容》](http://www.cnblogs.com/wuyou/p/3455619.html)的文章，受其启发，准备改用Nginx来完成。\n<!-- more -->\n\n## 1.下载\n[http://nginx.org/en/download.html](http://nginx.org/en/download.html) 我当时下载的是nginx/Windows-1.7.8 版本。\n\n## 2.解压\n\n## 3.修改配置\n*nginx的配置看起来还是比较复杂的，现在的配置只是保证能使用，但不一定是最好的*\n\n修改Nginx的conf目录下的nginx.conf文件，修改server的配置如下：\n\n    server {\n      listen       80;\n      server_name  www.ahetyy.com;\n      location ^~ /etyy {\n          proxy_pass   http://localhost:8080/etyy;\n          proxy_set_header Host $host;\n          proxy_set_header X-Real-IP $remote_addr;\n          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      }\n      location / {\n          \tproxy_pass   http://localhost:81;\n      }\n\t}\n\n其中server_name表示对外访问的域名，第一个location的规则是 任意以\"/etyy\"开头的请求都转发给[http://localhost:8080/etyy](http://localhost:8080/etyy)也就是tomcat来处理，第二个location的规则是其余请求全都发给php的主网站处理。\n\n特别注意：第一个location下的配置中的proxy_set_header的配置是必须的，否则最后打开[http://www.ahetyy.com/etyy](http://www.ahetyy.com/etyy)时页面请求的css和js路径都会是localhost:8080的，因为tomcat那边得到的请求就是localhost:8080的，需要将请求的头信息修改为真实请求的请求路径才行。（但是现在页面的base的路径上会有一个端口80，有点小小强迫症的我就忍了~）\n\n## 4.运行\ncmd切换到nginx.exe的目录下，启动-- start nginx 停止-- nginx -s stop，有时会结束不掉，我就会手动关闭进程~\n\n## 5.设置Nginx以服务方式启动\n（暂时没做，网上教程看着好复杂- -！），搞定！\n","slug":"nginx-tomcat-iis","published":1,"updated":"2019-03-26T13:47:04.880Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0i0015tof9yax21ynh","content":"<p><em>项目：《安徽省儿童医院》主网站（PHP开发）与微信（JAVA开发）共用服务器</em></p>\n<p>原来整合时使用的是jakarta桥接插件，但当时整合时就各种弄不懂，也是各种迷糊然后就好了，最终主网站用的域名是<a href=\"www.ahetyy.com\">www.ahetyy.com</a>，微信端用的是<a href=\"http://211.149.198.47/etyy\">211.149.198.47/etyy</a>。</p>\n<p>然后网站和微信一直都能使用，相安无事，但有一次莫名其妙地出了问题，不得其解。</p>\n<p>在修复时打算按照原来的方式来，可是发现又不会弄了，因为当初怎么弄好的都不记得。</p>\n<p>无奈之下在百度搜索时发现一篇<a href=\"http://www.cnblogs.com/wuyou/p/3455619.html\">《IIS tomcat共用80端口解决一个IP多个域名：使用Nginx反向代理方式使两者兼容》</a>的文章，受其启发，准备改用Nginx来完成。</p>\n<a id=\"more\"></a>\n<h2 id=\"1-下载\"><a class=\"header-anchor\" href=\"#1-下载\">¶</a>1.下载</h2>\n<p><a href=\"http://nginx.org/en/download.html\">http://nginx.org/en/download.html</a> 我当时下载的是nginx/Windows-1.7.8 版本。</p>\n<h2 id=\"2-解压\"><a class=\"header-anchor\" href=\"#2-解压\">¶</a>2.解压</h2>\n<h2 id=\"3-修改配置\"><a class=\"header-anchor\" href=\"#3-修改配置\">¶</a>3.修改配置</h2>\n<p><em>nginx的配置看起来还是比较复杂的，现在的配置只是保证能使用，但不一定是最好的</em></p>\n<p>修改Nginx的conf目录下的nginx.conf文件，修改server的配置如下：</p>\n<pre><code>server {\n  listen       80;\n  server_name  www.ahetyy.com;\n  location ^~ /etyy {\n      proxy_pass   http://localhost:8080/etyy;\n      proxy_set_header Host $host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n  location / {\n      \tproxy_pass   http://localhost:81;\n  }\n}\n</code></pre>\n<p>其中server_name表示对外访问的域名，第一个location的规则是 任意以&quot;/etyy&quot;开头的请求都转发给<a href=\"http://localhost:8080/etyy\">http://localhost:8080/etyy</a>也就是tomcat来处理，第二个location的规则是其余请求全都发给php的主网站处理。</p>\n<p>特别注意：第一个location下的配置中的proxy_set_header的配置是必须的，否则最后打开<a href=\"http://www.ahetyy.com/etyy\">http://www.ahetyy.com/etyy</a>时页面请求的css和js路径都会是localhost:8080的，因为tomcat那边得到的请求就是localhost:8080的，需要将请求的头信息修改为真实请求的请求路径才行。（但是现在页面的base的路径上会有一个端口80，有点小小强迫症的我就忍了~）</p>\n<h2 id=\"4-运行\"><a class=\"header-anchor\" href=\"#4-运行\">¶</a>4.运行</h2>\n<p>cmd切换到nginx.exe的目录下，启动-- start nginx 停止-- nginx -s stop，有时会结束不掉，我就会手动关闭进程~</p>\n<h2 id=\"5-设置Nginx以服务方式启动\"><a class=\"header-anchor\" href=\"#5-设置Nginx以服务方式启动\">¶</a>5.设置Nginx以服务方式启动</h2>\n<p>（暂时没做，网上教程看着好复杂- -！），搞定！</p>\n","site":{"data":{}},"excerpt":"<p><em>项目：《安徽省儿童医院》主网站（PHP开发）与微信（JAVA开发）共用服务器</em></p>\n<p>原来整合时使用的是jakarta桥接插件，但当时整合时就各种弄不懂，也是各种迷糊然后就好了，最终主网站用的域名是<a href=\"www.ahetyy.com\">www.ahetyy.com</a>，微信端用的是<a href=\"http://211.149.198.47/etyy\">211.149.198.47/etyy</a>。</p>\n<p>然后网站和微信一直都能使用，相安无事，但有一次莫名其妙地出了问题，不得其解。</p>\n<p>在修复时打算按照原来的方式来，可是发现又不会弄了，因为当初怎么弄好的都不记得。</p>\n<p>无奈之下在百度搜索时发现一篇<a href=\"http://www.cnblogs.com/wuyou/p/3455619.html\">《IIS tomcat共用80端口解决一个IP多个域名：使用Nginx反向代理方式使两者兼容》</a>的文章，受其启发，准备改用Nginx来完成。</p>","more":"<h2 id=\"1-下载\"><a class=\"header-anchor\" href=\"#1-下载\">¶</a>1.下载</h2>\n<p><a href=\"http://nginx.org/en/download.html\">http://nginx.org/en/download.html</a> 我当时下载的是nginx/Windows-1.7.8 版本。</p>\n<h2 id=\"2-解压\"><a class=\"header-anchor\" href=\"#2-解压\">¶</a>2.解压</h2>\n<h2 id=\"3-修改配置\"><a class=\"header-anchor\" href=\"#3-修改配置\">¶</a>3.修改配置</h2>\n<p><em>nginx的配置看起来还是比较复杂的，现在的配置只是保证能使用，但不一定是最好的</em></p>\n<p>修改Nginx的conf目录下的nginx.conf文件，修改server的配置如下：</p>\n<pre><code>server {\n  listen       80;\n  server_name  www.ahetyy.com;\n  location ^~ /etyy {\n      proxy_pass   http://localhost:8080/etyy;\n      proxy_set_header Host $host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n  location / {\n      \tproxy_pass   http://localhost:81;\n  }\n}\n</code></pre>\n<p>其中server_name表示对外访问的域名，第一个location的规则是 任意以&quot;/etyy&quot;开头的请求都转发给<a href=\"http://localhost:8080/etyy\">http://localhost:8080/etyy</a>也就是tomcat来处理，第二个location的规则是其余请求全都发给php的主网站处理。</p>\n<p>特别注意：第一个location下的配置中的proxy_set_header的配置是必须的，否则最后打开<a href=\"http://www.ahetyy.com/etyy\">http://www.ahetyy.com/etyy</a>时页面请求的css和js路径都会是localhost:8080的，因为tomcat那边得到的请求就是localhost:8080的，需要将请求的头信息修改为真实请求的请求路径才行。（但是现在页面的base的路径上会有一个端口80，有点小小强迫症的我就忍了~）</p>\n<h2 id=\"4-运行\"><a class=\"header-anchor\" href=\"#4-运行\">¶</a>4.运行</h2>\n<p>cmd切换到nginx.exe的目录下，启动-- start nginx 停止-- nginx -s stop，有时会结束不掉，我就会手动关闭进程~</p>\n<h2 id=\"5-设置Nginx以服务方式启动\"><a class=\"header-anchor\" href=\"#5-设置Nginx以服务方式启动\">¶</a>5.设置Nginx以服务方式启动</h2>\n<p>（暂时没做，网上教程看着好复杂- -！），搞定！</p>"},{"title":"ppt-online","s":"ppt-online","date":"2016-03-23T07:01:00.000Z","author":"合肥小朋友","_content":"在做科大学生骨干培训班这个项目时 ,由于需要用到在线浏览学生的ppt文件,为了实现这个问题,采用的解决方案是通过一个软件将其转换为flash进行播放.\n<!-- more -->\n\n软件准备:链接:http://pan.baidu.com/s/1sjv5DPb\n\n解压之后,可以看到iSpring Presenter文件夹,iSpring Presenter 是以 PowerPoint 插件的形式工作的，下载解压后先运行 !)iSpringPresenterPortable.exe，选择安装后会自动添加插件，再打开 PowerPoint 就能看到了，支持 Microsoft PowerPoint 2003/2007/2010.\n\n安装完毕之后,打开一个ppt文件,这时ppt菜单工具栏会出现一个iSpring Presenter工具选项,点击切换到该工具选项,点击publish按钮,弹出一个对话框,general选项卡有个Player Template,可以选择一个适合的播放器模板,还有就是选择生成路径,其他选项卡设置可以不动,点击弹出框的按钮publish即可.具体如下图\n![](/images/others/test.png)\n\n完了之后生成一个文件,里面有swf文件以及js 和html文件,在实际应用中,把html和js文件写成jsp形式,然后把jsp文件里面引用swf的路径替换为从数据库读取的路径即可.\n\n整个过程就是把ppt转swf文件,然后通过,软件提供的html和js整合一个公共的ppt在线播放页面,用来加载swf文件即可.\n","source":"_posts/ppt-online.md","raw":"---\ntitle: ppt-online\ns: ppt-online\ndate: 2016-03-23 15:01:00\nauthor: 合肥小朋友\ntags:\n---\n在做科大学生骨干培训班这个项目时 ,由于需要用到在线浏览学生的ppt文件,为了实现这个问题,采用的解决方案是通过一个软件将其转换为flash进行播放.\n<!-- more -->\n\n软件准备:链接:http://pan.baidu.com/s/1sjv5DPb\n\n解压之后,可以看到iSpring Presenter文件夹,iSpring Presenter 是以 PowerPoint 插件的形式工作的，下载解压后先运行 !)iSpringPresenterPortable.exe，选择安装后会自动添加插件，再打开 PowerPoint 就能看到了，支持 Microsoft PowerPoint 2003/2007/2010.\n\n安装完毕之后,打开一个ppt文件,这时ppt菜单工具栏会出现一个iSpring Presenter工具选项,点击切换到该工具选项,点击publish按钮,弹出一个对话框,general选项卡有个Player Template,可以选择一个适合的播放器模板,还有就是选择生成路径,其他选项卡设置可以不动,点击弹出框的按钮publish即可.具体如下图\n![](/images/others/test.png)\n\n完了之后生成一个文件,里面有swf文件以及js 和html文件,在实际应用中,把html和js文件写成jsp形式,然后把jsp文件里面引用swf的路径替换为从数据库读取的路径即可.\n\n整个过程就是把ppt转swf文件,然后通过,软件提供的html和js整合一个公共的ppt在线播放页面,用来加载swf文件即可.\n","slug":"ppt-online","published":1,"updated":"2019-03-26T13:47:04.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0j0016tof95snsrwda","content":"<p>在做科大学生骨干培训班这个项目时 ,由于需要用到在线浏览学生的ppt文件,为了实现这个问题,采用的解决方案是通过一个软件将其转换为flash进行播放.</p>\n<a id=\"more\"></a>\n<p>软件准备:链接:<a href=\"http://pan.baidu.com/s/1sjv5DPb\">http://pan.baidu.com/s/1sjv5DPb</a></p>\n<p>解压之后,可以看到iSpring Presenter文件夹,iSpring Presenter 是以 PowerPoint 插件的形式工作的，下载解压后先运行 !)iSpringPresenterPortable.exe，选择安装后会自动添加插件，再打开 PowerPoint 就能看到了，支持 Microsoft PowerPoint 2003/2007/2010.</p>\n<p>安装完毕之后,打开一个ppt文件,这时ppt菜单工具栏会出现一个iSpring Presenter工具选项,点击切换到该工具选项,点击publish按钮,弹出一个对话框,general选项卡有个Player Template,可以选择一个适合的播放器模板,还有就是选择生成路径,其他选项卡设置可以不动,点击弹出框的按钮publish即可.具体如下图<br>\n<img src=\"/images/others/test.png\" alt></p>\n<p>完了之后生成一个文件,里面有swf文件以及js 和html文件,在实际应用中,把html和js文件写成jsp形式,然后把jsp文件里面引用swf的路径替换为从数据库读取的路径即可.</p>\n<p>整个过程就是把ppt转swf文件,然后通过,软件提供的html和js整合一个公共的ppt在线播放页面,用来加载swf文件即可.</p>\n","site":{"data":{}},"excerpt":"<p>在做科大学生骨干培训班这个项目时 ,由于需要用到在线浏览学生的ppt文件,为了实现这个问题,采用的解决方案是通过一个软件将其转换为flash进行播放.</p>","more":"<p>软件准备:链接:<a href=\"http://pan.baidu.com/s/1sjv5DPb\">http://pan.baidu.com/s/1sjv5DPb</a></p>\n<p>解压之后,可以看到iSpring Presenter文件夹,iSpring Presenter 是以 PowerPoint 插件的形式工作的，下载解压后先运行 !)iSpringPresenterPortable.exe，选择安装后会自动添加插件，再打开 PowerPoint 就能看到了，支持 Microsoft PowerPoint 2003/2007/2010.</p>\n<p>安装完毕之后,打开一个ppt文件,这时ppt菜单工具栏会出现一个iSpring Presenter工具选项,点击切换到该工具选项,点击publish按钮,弹出一个对话框,general选项卡有个Player Template,可以选择一个适合的播放器模板,还有就是选择生成路径,其他选项卡设置可以不动,点击弹出框的按钮publish即可.具体如下图<br>\n<img src=\"/images/others/test.png\" alt=\"\"></p>\n<p>完了之后生成一个文件,里面有swf文件以及js 和html文件,在实际应用中,把html和js文件写成jsp形式,然后把jsp文件里面引用swf的路径替换为从数据库读取的路径即可.</p>\n<p>整个过程就是把ppt转swf文件,然后通过,软件提供的html和js整合一个公共的ppt在线播放页面,用来加载swf文件即可.</p>"},{"title":"mp4视频实现边下载边播放","s":"play-video-while-downloading","date":"2016-03-23T07:35:00.000Z","author":"合肥小朋友","_content":"在做视频播放时,出现了这样一个问题,就是网页上播放mp4视频时,必须要等到视频下载完成之后,才能播放,不能够随意拖拽,之后通过一个叫做ffmpeg的视频转码软件解决了这个问题.\n<!-- more -->\n\n1. 软件地址:链接: http://pan.baidu.com/s/1qW2ZpJe 密码: 291n\n\n2. windows下进入,通过cmd命令行进入该软件的目录bin文件夹下,然后,输入qt-faststart.exe 源文件.mp4 新文件.mp4 就会当前目录生成一个转过的mp4视频,\n\n3. 最后,视频要通过nginx服务器作为中转来实现在线播放,具体配置如下:\n\nnginx服务器的root目录要改为具体的tomcat目录存放转换好了的视频资源路径,端口要改成一个不和tomcat冲突的端口号\n\njsp视频播放页面,加载视频资源的时候访问的是nginx服务器(通过nginx的端口号来访问)不访问tomcat,访问nginx之后,然后nginx寻找资源从tomcat的静态资源存放路径中去读取事先上传过来的视频,当然如果你愿意把视频直接拷到nginx的默认根目录,也可以不需要改动nginx的conf配置文件的root目录\n这里是当时jsp页面端的部分代码,nginx的端口号改的是8080,视频播放插件用的是ckplayer\n```\n//nginx服务器视频地址\nvar path=location.protocol+\"//\"+window.location.host+\":8080\"+\"${path}\";\n\tvar flashvars={\n\t\tf:path,\n\t\tc:0,\n\t\tb:1\n\t\t};\nvar params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};\n\tCKobject.embedSWF(\"<c:url value='/static/ckplayer6.4/ckplayer/ckplayer.swf'/>\",'a1','ckplayer_a1','800','470',flashvars,params);\n```\n","source":"_posts/play-video-while-downloading.md","raw":"---\ntitle: mp4视频实现边下载边播放\ns: play-video-while-downloading\ndate: 2016-03-23 15:35:00\nauthor: 合肥小朋友\ntags:\n---\n在做视频播放时,出现了这样一个问题,就是网页上播放mp4视频时,必须要等到视频下载完成之后,才能播放,不能够随意拖拽,之后通过一个叫做ffmpeg的视频转码软件解决了这个问题.\n<!-- more -->\n\n1. 软件地址:链接: http://pan.baidu.com/s/1qW2ZpJe 密码: 291n\n\n2. windows下进入,通过cmd命令行进入该软件的目录bin文件夹下,然后,输入qt-faststart.exe 源文件.mp4 新文件.mp4 就会当前目录生成一个转过的mp4视频,\n\n3. 最后,视频要通过nginx服务器作为中转来实现在线播放,具体配置如下:\n\nnginx服务器的root目录要改为具体的tomcat目录存放转换好了的视频资源路径,端口要改成一个不和tomcat冲突的端口号\n\njsp视频播放页面,加载视频资源的时候访问的是nginx服务器(通过nginx的端口号来访问)不访问tomcat,访问nginx之后,然后nginx寻找资源从tomcat的静态资源存放路径中去读取事先上传过来的视频,当然如果你愿意把视频直接拷到nginx的默认根目录,也可以不需要改动nginx的conf配置文件的root目录\n这里是当时jsp页面端的部分代码,nginx的端口号改的是8080,视频播放插件用的是ckplayer\n```\n//nginx服务器视频地址\nvar path=location.protocol+\"//\"+window.location.host+\":8080\"+\"${path}\";\n\tvar flashvars={\n\t\tf:path,\n\t\tc:0,\n\t\tb:1\n\t\t};\nvar params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};\n\tCKobject.embedSWF(\"<c:url value='/static/ckplayer6.4/ckplayer/ckplayer.swf'/>\",'a1','ckplayer_a1','800','470',flashvars,params);\n```\n","slug":"play-video-while-downloading","published":1,"updated":"2019-03-26T13:47:04.881Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0j0018tof9jmfcemdi","content":"<p>在做视频播放时,出现了这样一个问题,就是网页上播放mp4视频时,必须要等到视频下载完成之后,才能播放,不能够随意拖拽,之后通过一个叫做ffmpeg的视频转码软件解决了这个问题.</p>\n<a id=\"more\"></a>\n<ol>\n<li>\n<p>软件地址:链接: <a href=\"http://pan.baidu.com/s/1qW2ZpJe\">http://pan.baidu.com/s/1qW2ZpJe</a> 密码: 291n</p>\n</li>\n<li>\n<p>windows下进入,通过cmd命令行进入该软件的目录bin文件夹下,然后,输入qt-faststart.exe 源文件.mp4 新文件.mp4 就会当前目录生成一个转过的mp4视频,</p>\n</li>\n<li>\n<p>最后,视频要通过nginx服务器作为中转来实现在线播放,具体配置如下:</p>\n</li>\n</ol>\n<p>nginx服务器的root目录要改为具体的tomcat目录存放转换好了的视频资源路径,端口要改成一个不和tomcat冲突的端口号</p>\n<p>jsp视频播放页面,加载视频资源的时候访问的是nginx服务器(通过nginx的端口号来访问)不访问tomcat,访问nginx之后,然后nginx寻找资源从tomcat的静态资源存放路径中去读取事先上传过来的视频,当然如果你愿意把视频直接拷到nginx的默认根目录,也可以不需要改动nginx的conf配置文件的root目录<br>\n这里是当时jsp页面端的部分代码,nginx的端口号改的是8080,视频播放插件用的是ckplayer</p>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//nginx服务器视频地址</span><br><span class=\"line\">var path=location.protocol+&quot;//&quot;+window.location.host+&quot;:8080&quot;+&quot;$&#123;path&#125;&quot;;</span><br><span class=\"line\">\tvar flashvars=&#123;</span><br><span class=\"line\">\t\tf:path,</span><br><span class=\"line\">\t\tc:0,</span><br><span class=\"line\">\t\tb:1</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\">var params=&#123;bgcolor:&apos;#FFF&apos;,allowFullScreen:true,allowScriptAccess:&apos;always&apos;,wmode:&apos;transparent&apos;&#125;;</span><br><span class=\"line\">\tCKobject.embedSWF(&quot;&lt;c:url value=&apos;/static/ckplayer6.4/ckplayer/ckplayer.swf&apos;/&gt;&quot;,&apos;a1&apos;,&apos;ckplayer_a1&apos;,&apos;800&apos;,&apos;470&apos;,flashvars,params);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>在做视频播放时,出现了这样一个问题,就是网页上播放mp4视频时,必须要等到视频下载完成之后,才能播放,不能够随意拖拽,之后通过一个叫做ffmpeg的视频转码软件解决了这个问题.</p>","more":"<ol>\n<li>\n<p>软件地址:链接: <a href=\"http://pan.baidu.com/s/1qW2ZpJe\">http://pan.baidu.com/s/1qW2ZpJe</a> 密码: 291n</p>\n</li>\n<li>\n<p>windows下进入,通过cmd命令行进入该软件的目录bin文件夹下,然后,输入qt-faststart.exe 源文件.mp4 新文件.mp4 就会当前目录生成一个转过的mp4视频,</p>\n</li>\n<li>\n<p>最后,视频要通过nginx服务器作为中转来实现在线播放,具体配置如下:</p>\n</li>\n</ol>\n<p>nginx服务器的root目录要改为具体的tomcat目录存放转换好了的视频资源路径,端口要改成一个不和tomcat冲突的端口号</p>\n<p>jsp视频播放页面,加载视频资源的时候访问的是nginx服务器(通过nginx的端口号来访问)不访问tomcat,访问nginx之后,然后nginx寻找资源从tomcat的静态资源存放路径中去读取事先上传过来的视频,当然如果你愿意把视频直接拷到nginx的默认根目录,也可以不需要改动nginx的conf配置文件的root目录<br>\n这里是当时jsp页面端的部分代码,nginx的端口号改的是8080,视频播放插件用的是ckplayer</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//nginx服务器视频地址</span><br><span class=\"line\">var path=location.protocol+&quot;//&quot;+window.location.host+&quot;:8080&quot;+&quot;$&#123;path&#125;&quot;;</span><br><span class=\"line\">\tvar flashvars=&#123;</span><br><span class=\"line\">\t\tf:path,</span><br><span class=\"line\">\t\tc:0,</span><br><span class=\"line\">\t\tb:1</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\">var params=&#123;bgcolor:&apos;#FFF&apos;,allowFullScreen:true,allowScriptAccess:&apos;always&apos;,wmode:&apos;transparent&apos;&#125;;</span><br><span class=\"line\">\tCKobject.embedSWF(&quot;&lt;c:url value=&apos;/static/ckplayer6.4/ckplayer/ckplayer.swf&apos;/&gt;&quot;,&apos;a1&apos;,&apos;ckplayer_a1&apos;,&apos;800&apos;,&apos;470&apos;,flashvars,params);</span><br></pre></td></tr></table></figure>"},{"title":"优秀Web字体收集","s":"pretty-webfont","date":"2015-11-15T11:00:00.000Z","_content":"- InfoQ\n\n```css\np: {\n  font-family: 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, Helvetica, sans-serif;\n}\n```\n- Vue.js\n```css\np: {\n  font-family: 'Source Sans Pro', 'Helvetica Neue', Arial, sans-serif;\n}\n```\n\n- Source code\n```css\npre: {\n  font-family: \"Source Code Pro\", Consolas, Monaco, Menlo, monospace;\n}\n```\n","source":"_posts/pretty-webfont.md","raw":"---\ntitle: 优秀Web字体收集\ns: pretty-webfont\ndate: 2015-11-15 19:00:00\ntags:\n  - Fonts\n---\n- InfoQ\n\n```css\np: {\n  font-family: 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, STHeiti, 'WenQuanYi Micro Hei', SimSun, Helvetica, sans-serif;\n}\n```\n- Vue.js\n```css\np: {\n  font-family: 'Source Sans Pro', 'Helvetica Neue', Arial, sans-serif;\n}\n```\n\n- Source code\n```css\npre: {\n  font-family: \"Source Code Pro\", Consolas, Monaco, Menlo, monospace;\n}\n```\n","slug":"pretty-webfont","published":1,"updated":"2016-08-28T08:52:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0k001atof9hn1cie2y","content":"<ul>\n<li>InfoQ</li>\n</ul>\n<figure class=\"highlight css hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-selector-tag\">p</span>: &#123;</span><br><span class=\"line\">  <span class=\"hljs-attribute\">font-family</span>: <span class=\"hljs-string\">'Lantinghei SC'</span>, <span class=\"hljs-string\">'Open Sans'</span>, Arial, <span class=\"hljs-string\">'Hiragino Sans GB'</span>, <span class=\"hljs-string\">'Microsoft YaHei'</span>, 微软雅黑, STHeiti, <span class=\"hljs-string\">'WenQuanYi Micro Hei'</span>, SimSun, Helvetica, sans-serif;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Vue.js</li>\n</ul>\n<figure class=\"highlight css hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-selector-tag\">p</span>: &#123;</span><br><span class=\"line\">  <span class=\"hljs-attribute\">font-family</span>: <span class=\"hljs-string\">'Source Sans Pro'</span>, <span class=\"hljs-string\">'Helvetica Neue'</span>, Arial, sans-serif;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Source code</li>\n</ul>\n<figure class=\"highlight css hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-selector-tag\">pre</span>: &#123;</span><br><span class=\"line\">  <span class=\"hljs-attribute\">font-family</span>: <span class=\"hljs-string\">\"Source Code Pro\"</span>, Consolas, Monaco, Menlo, monospace;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>InfoQ</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span>: &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">'Lantinghei SC'</span>, <span class=\"string\">'Open Sans'</span>, Arial, <span class=\"string\">'Hiragino Sans GB'</span>, <span class=\"string\">'Microsoft YaHei'</span>, 微软雅黑, STHeiti, <span class=\"string\">'WenQuanYi Micro Hei'</span>, SimSun, Helvetica, sans-serif;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Vue.js</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span>: &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">'Source Sans Pro'</span>, <span class=\"string\">'Helvetica Neue'</span>, Arial, sans-serif;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Source code</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">pre</span>: &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">\"Source Code Pro\"</span>, Consolas, Monaco, Menlo, monospace;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"基于Rancher搭建k8s的集群环境","s":"k8s-over-rancher","date":"2018-03-21T01:38:11.000Z","thumbnail":"/images/rancher/logo.png","_content":"本文主要纪录了在k8s的学习过程中我是如何搭建k8s集群环境的经历。\n在学习和了解了k8s的一些基础概念我开始尝试去自己搭建一套集群环境，经过一段时间的尝试，我决定使用`rancher`来帮助搭建环境，并使用`rancher os`作为主机镜像。\n你要问我为什么使用`rancher`搭建？因为简单啊！为什么使用`rancher os`作为主机镜像？因为小啊！\n<!-- more -->\n\n## 环境准备\n\n- 官网下载好`rancheros.iso`文件\n- 4台虚拟机或者主机，根据实际业务场景增加或减少，机器用途如下：\n\nHostname       | IP              | Role           | Configuration\n:------------: | :-------------: | :------------: | :-----------:\nrancher-server | 192.168.103.90  | rancher server | 1C1G8G\nk8s-node1      | 192.168.103.101 | k8s node       | 2C2G20G\nk8s-node2      | 192.168.103.102 | k8s node       | 2C2G20G\nk8s-node3      | 192.168.103.103 | k8s node       | 2C2G20G\n\n- 确认本机已生成ssh密钥对，然后在本机生成`cloud-config.yml`，用于ssh连接到node节点：\n    ```bash\n    echo -e \"#cloud-config\\nhostname: rancher-server\\nssh_authorized_keys:\\n - $(cat .ssh/id_rsa.pub)\" > $HOME/cloud-config.yml\n    ```\n  如果虚拟机网络没有dhcp，还需要在`cloud-config.yml`中加入`network`相关的配置\n    ```bash\n    echo -e \"#cloud-config\\nhostname: rancher-server\\nrancher:\\n  network:\\n    interfaces:\\n      eth0:\\n        address: 192.168.103.90/24\\n        gateway: 192.168.103.1\\n        mtu: 1500\\n        dhcp: false\\nssh_authorized_keys:\\n  - $(cat .ssh/id_rsa.pub)\" > $HOME/cloud-config.yml\n    ```\n  PS：一定要保证hostname唯一，\b我之前就被坑了\n\n### 安装Rancher OS系统\n\n- 在`rancher-server`虚机上选择iso镜像，启动虚机，进入系统后启动的是类似`Live CD`的系统，所以我们需要先安装`rancheros`到硬盘，否则下次重启后数据都将丢失\n- 使用命令`ip addr`查看网卡是否被分配ip，如果没有请参考官网介绍配置静态ip\n    ```bash\n    sudo ros config set rancher.network.interfaces.eth0.address 192.168.103.90/24\n    sudo ros config set rancher.network.interfaces.eth0.gateway 192.168.103.1\n    sudo ros config set rancher.network.interfaces.eth0.mtu 1500\n    sudo ros config set rancher.network.interfaces.eth0.dhcp false\n    ```\n  设置完成后执行`sudo system-docker restart network`使其生效\n- 给虚机设置password：`sudo passwd rancher`\n- 将本机的`cloud-config.yml`文件复制到虚机上：`scp $HOME/cloud-config.yml rancher@172.68.1.100:/home/rancher/cloud-config.yml`，如果本机可以通过ssh登录那么反向的从虚机上执行scp命令也可以\n- 在虚机上执行安装：`sudo ros install -d /dev/sda -c cloud-config.yml`，完成后重启虚机\n- 注意：如果使用`ros`命令设置的网络ip和`cloud-config.yml`配置的ip是一致的，那么在虚机装好系统后本机将无法ssh连上，因为本机已经存储了该ip对应的公钥，所以需要删除`~/.ssh/known_hosts`文件中该ip所在行\n- 重新ssh连到虚机，\b切换虚机`docker`版本，参考[](http://rancher.com/docs/rancher/v1.6/en/hosts/#supported-docker-versions)切换到支持的版本号，切换命令：`sudo ros engine switch docker-17.03.2-ce`\n- 重复之前的操作，注意在安装之前要先修改`cloud-config.yml`文件中的ip地址以及hostname，这样我们就可以得到3台node节点。PS：之前试过克隆虚机的方式，但打开克隆的机器无法登陆，所以还是选择重复执行的方式。\n\n### Docker加速\n\n在所有的虚机上执行`sudo vi /etc/docker/daemon.json`并填入下面内容\n```json\n{\n  \"registry-mirrors\": [\"https://registry.docker-cn.com\"]\n}\n```\n保存后执行`sudo system-docker restart docker`然后执行`docker info`查看是否成功设置docker源\n\n## 安装Rancher server\n在`rancher-server`虚机上执行\n```bash\nsudo docker run -d --restart=unless-stopped -p 8080:8080 rancher/server:stable\n```\n等待一段时间后在本地打开浏览器访问`http://<rancher-server-ip>:8080`即可访问Rancher UI。\n在web页面中的操作就不做详细介绍，大致就是添加环境，然后按照页面提示添加我们的3台`k8s node`主机，然后等待各种服务安装完成即可，[点击查看官方视频介绍（需翻墙）](https://player.vimeo.com/video/212648517?autoplay=1&title=0&byline=0)\nPS：参考[](https://www.cnrancher.com/kubernetes-installation/)文章中**kubernetes环境管理**一节修改国内加速。\n","source":"_posts/rancher-k8s.md","raw":"---\ntitle: 基于Rancher搭建k8s的集群环境\ns: k8s-over-rancher\ndate: 2018-03-21 09:38:11\nthumbnail: /images/rancher/logo.png\ntags:\n  - rancher\n  - rancher os\n  - kubernetes\n  - k8s\n---\n本文主要纪录了在k8s的学习过程中我是如何搭建k8s集群环境的经历。\n在学习和了解了k8s的一些基础概念我开始尝试去自己搭建一套集群环境，经过一段时间的尝试，我决定使用`rancher`来帮助搭建环境，并使用`rancher os`作为主机镜像。\n你要问我为什么使用`rancher`搭建？因为简单啊！为什么使用`rancher os`作为主机镜像？因为小啊！\n<!-- more -->\n\n## 环境准备\n\n- 官网下载好`rancheros.iso`文件\n- 4台虚拟机或者主机，根据实际业务场景增加或减少，机器用途如下：\n\nHostname       | IP              | Role           | Configuration\n:------------: | :-------------: | :------------: | :-----------:\nrancher-server | 192.168.103.90  | rancher server | 1C1G8G\nk8s-node1      | 192.168.103.101 | k8s node       | 2C2G20G\nk8s-node2      | 192.168.103.102 | k8s node       | 2C2G20G\nk8s-node3      | 192.168.103.103 | k8s node       | 2C2G20G\n\n- 确认本机已生成ssh密钥对，然后在本机生成`cloud-config.yml`，用于ssh连接到node节点：\n    ```bash\n    echo -e \"#cloud-config\\nhostname: rancher-server\\nssh_authorized_keys:\\n - $(cat .ssh/id_rsa.pub)\" > $HOME/cloud-config.yml\n    ```\n  如果虚拟机网络没有dhcp，还需要在`cloud-config.yml`中加入`network`相关的配置\n    ```bash\n    echo -e \"#cloud-config\\nhostname: rancher-server\\nrancher:\\n  network:\\n    interfaces:\\n      eth0:\\n        address: 192.168.103.90/24\\n        gateway: 192.168.103.1\\n        mtu: 1500\\n        dhcp: false\\nssh_authorized_keys:\\n  - $(cat .ssh/id_rsa.pub)\" > $HOME/cloud-config.yml\n    ```\n  PS：一定要保证hostname唯一，\b我之前就被坑了\n\n### 安装Rancher OS系统\n\n- 在`rancher-server`虚机上选择iso镜像，启动虚机，进入系统后启动的是类似`Live CD`的系统，所以我们需要先安装`rancheros`到硬盘，否则下次重启后数据都将丢失\n- 使用命令`ip addr`查看网卡是否被分配ip，如果没有请参考官网介绍配置静态ip\n    ```bash\n    sudo ros config set rancher.network.interfaces.eth0.address 192.168.103.90/24\n    sudo ros config set rancher.network.interfaces.eth0.gateway 192.168.103.1\n    sudo ros config set rancher.network.interfaces.eth0.mtu 1500\n    sudo ros config set rancher.network.interfaces.eth0.dhcp false\n    ```\n  设置完成后执行`sudo system-docker restart network`使其生效\n- 给虚机设置password：`sudo passwd rancher`\n- 将本机的`cloud-config.yml`文件复制到虚机上：`scp $HOME/cloud-config.yml rancher@172.68.1.100:/home/rancher/cloud-config.yml`，如果本机可以通过ssh登录那么反向的从虚机上执行scp命令也可以\n- 在虚机上执行安装：`sudo ros install -d /dev/sda -c cloud-config.yml`，完成后重启虚机\n- 注意：如果使用`ros`命令设置的网络ip和`cloud-config.yml`配置的ip是一致的，那么在虚机装好系统后本机将无法ssh连上，因为本机已经存储了该ip对应的公钥，所以需要删除`~/.ssh/known_hosts`文件中该ip所在行\n- 重新ssh连到虚机，\b切换虚机`docker`版本，参考[](http://rancher.com/docs/rancher/v1.6/en/hosts/#supported-docker-versions)切换到支持的版本号，切换命令：`sudo ros engine switch docker-17.03.2-ce`\n- 重复之前的操作，注意在安装之前要先修改`cloud-config.yml`文件中的ip地址以及hostname，这样我们就可以得到3台node节点。PS：之前试过克隆虚机的方式，但打开克隆的机器无法登陆，所以还是选择重复执行的方式。\n\n### Docker加速\n\n在所有的虚机上执行`sudo vi /etc/docker/daemon.json`并填入下面内容\n```json\n{\n  \"registry-mirrors\": [\"https://registry.docker-cn.com\"]\n}\n```\n保存后执行`sudo system-docker restart docker`然后执行`docker info`查看是否成功设置docker源\n\n## 安装Rancher server\n在`rancher-server`虚机上执行\n```bash\nsudo docker run -d --restart=unless-stopped -p 8080:8080 rancher/server:stable\n```\n等待一段时间后在本地打开浏览器访问`http://<rancher-server-ip>:8080`即可访问Rancher UI。\n在web页面中的操作就不做详细介绍，大致就是添加环境，然后按照页面提示添加我们的3台`k8s node`主机，然后等待各种服务安装完成即可，[点击查看官方视频介绍（需翻墙）](https://player.vimeo.com/video/212648517?autoplay=1&title=0&byline=0)\nPS：参考[](https://www.cnrancher.com/kubernetes-installation/)文章中**kubernetes环境管理**一节修改国内加速。\n","slug":"rancher-k8s","published":1,"updated":"2019-03-26T13:47:04.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0l001ctof9d98pj4xn","content":"<p>本文主要纪录了在k8s的学习过程中我是如何搭建k8s集群环境的经历。<br>\n在学习和了解了k8s的一些基础概念我开始尝试去自己搭建一套集群环境，经过一段时间的尝试，我决定使用<code>rancher</code>来帮助搭建环境，并使用<code>rancher os</code>作为主机镜像。<br>\n你要问我为什么使用<code>rancher</code>搭建？因为简单啊！为什么使用<code>rancher os</code>作为主机镜像？因为小啊！</p>\n<a id=\"more\"></a>\n<h2 id=\"环境准备\"><a class=\"header-anchor\" href=\"#环境准备\">¶</a>环境准备</h2>\n<ul>\n<li>官网下载好<code>rancheros.iso</code>文件</li>\n<li>4台虚拟机或者主机，根据实际业务场景增加或减少，机器用途如下：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Hostname</th>\n<th style=\"text-align:center\">IP</th>\n<th style=\"text-align:center\">Role</th>\n<th style=\"text-align:center\">Configuration</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">rancher-server</td>\n<td style=\"text-align:center\">192.168.103.90</td>\n<td style=\"text-align:center\">rancher server</td>\n<td style=\"text-align:center\">1C1G8G</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">k8s-node1</td>\n<td style=\"text-align:center\">192.168.103.101</td>\n<td style=\"text-align:center\">k8s node</td>\n<td style=\"text-align:center\">2C2G20G</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">k8s-node2</td>\n<td style=\"text-align:center\">192.168.103.102</td>\n<td style=\"text-align:center\">k8s node</td>\n<td style=\"text-align:center\">2C2G20G</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">k8s-node3</td>\n<td style=\"text-align:center\">192.168.103.103</td>\n<td style=\"text-align:center\">k8s node</td>\n<td style=\"text-align:center\">2C2G20G</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>\n<p>确认本机已生成ssh密钥对，然后在本机生成<code>cloud-config.yml</code>，用于ssh连接到node节点：</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">\"#cloud-config\\nhostname: rancher-server\\nssh_authorized_keys:\\n - <span class=\"hljs-variable\">$(cat .ssh/id_rsa.pub)</span>\"</span> &gt; <span class=\"hljs-variable\">$HOME</span>/cloud-config.yml</span><br></pre></td></tr></table></figure>\n<p>如果虚拟机网络没有dhcp，还需要在<code>cloud-config.yml</code>中加入<code>network</code>相关的配置</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">\"#cloud-config\\nhostname: rancher-server\\nrancher:\\n  network:\\n    interfaces:\\n      eth0:\\n        address: 192.168.103.90/24\\n        gateway: 192.168.103.1\\n        mtu: 1500\\n        dhcp: false\\nssh_authorized_keys:\\n  - <span class=\"hljs-variable\">$(cat .ssh/id_rsa.pub)</span>\"</span> &gt; <span class=\"hljs-variable\">$HOME</span>/cloud-config.yml</span><br></pre></td></tr></table></figure>\n<p>PS：一定要保证hostname唯一，\b我之前就被坑了</p>\n</li>\n</ul>\n<h3 id=\"安装Rancher-OS系统\"><a class=\"header-anchor\" href=\"#安装Rancher-OS系统\">¶</a>安装Rancher OS系统</h3>\n<ul>\n<li>\n<p>在<code>rancher-server</code>虚机上选择iso镜像，启动虚机，进入系统后启动的是类似<code>Live CD</code>的系统，所以我们需要先安装<code>rancheros</code>到硬盘，否则下次重启后数据都将丢失</p>\n</li>\n<li>\n<p>使用命令<code>ip addr</code>查看网卡是否被分配ip，如果没有请参考官网介绍配置静态ip</p>\n  <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ros config <span class=\"hljs-built_in\">set</span> rancher.network.interfaces.eth0.address 192.168.103.90/24</span><br><span class=\"line\">sudo ros config <span class=\"hljs-built_in\">set</span> rancher.network.interfaces.eth0.gateway 192.168.103.1</span><br><span class=\"line\">sudo ros config <span class=\"hljs-built_in\">set</span> rancher.network.interfaces.eth0.mtu 1500</span><br><span class=\"line\">sudo ros config <span class=\"hljs-built_in\">set</span> rancher.network.interfaces.eth0.dhcp <span class=\"hljs-literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>设置完成后执行<code>sudo system-docker restart network</code>使其生效</p>\n</li>\n<li>\n<p>给虚机设置password：<code>sudo passwd rancher</code></p>\n</li>\n<li>\n<p>将本机的<code>cloud-config.yml</code>文件复制到虚机上：<code>scp $HOME/cloud-config.yml rancher@172.68.1.100:/home/rancher/cloud-config.yml</code>，如果本机可以通过ssh登录那么反向的从虚机上执行scp命令也可以</p>\n</li>\n<li>\n<p>在虚机上执行安装：<code>sudo ros install -d /dev/sda -c cloud-config.yml</code>，完成后重启虚机</p>\n</li>\n<li>\n<p>注意：如果使用<code>ros</code>命令设置的网络ip和<code>cloud-config.yml</code>配置的ip是一致的，那么在虚机装好系统后本机将无法ssh连上，因为本机已经存储了该ip对应的公钥，所以需要删除<code>~/.ssh/known_hosts</code>文件中该ip所在行</p>\n</li>\n<li>\n<p>重新ssh连到虚机，\b切换虚机<code>docker</code>版本，参考<a href=\"http://rancher.com/docs/rancher/v1.6/en/hosts/#supported-docker-versions\"></a>切换到支持的版本号，切换命令：<code>sudo ros engine switch docker-17.03.2-ce</code></p>\n</li>\n<li>\n<p>重复之前的操作，注意在安装之前要先修改<code>cloud-config.yml</code>文件中的ip地址以及hostname，这样我们就可以得到3台node节点。PS：之前试过克隆虚机的方式，但打开克隆的机器无法登陆，所以还是选择重复执行的方式。</p>\n</li>\n</ul>\n<h3 id=\"Docker加速\"><a class=\"header-anchor\" href=\"#Docker加速\">¶</a>Docker加速</h3>\n<p>在所有的虚机上执行<code>sudo vi /etc/docker/daemon.json</code>并填入下面内容</p>\n<figure class=\"highlight json hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"hljs-attr\">\"registry-mirrors\"</span>: [<span class=\"hljs-string\">\"https://registry.docker-cn.com\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>保存后执行<code>sudo system-docker restart docker</code>然后执行<code>docker info</code>查看是否成功设置docker源</p>\n<h2 id=\"安装Rancher-server\"><a class=\"header-anchor\" href=\"#安装Rancher-server\">¶</a>安装Rancher server</h2>\n<p>在<code>rancher-server</code>虚机上执行</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -d --restart=unless-stopped -p 8080:8080 rancher/server:stable</span><br></pre></td></tr></table></figure>\n<p>等待一段时间后在本地打开浏览器访问<code>http://&lt;rancher-server-ip&gt;:8080</code>即可访问Rancher UI。<br>\n在web页面中的操作就不做详细介绍，大致就是添加环境，然后按照页面提示添加我们的3台<code>k8s node</code>主机，然后等待各种服务安装完成即可，<a href=\"https://player.vimeo.com/video/212648517?autoplay=1&amp;title=0&amp;byline=0\">点击查看官方视频介绍（需翻墙）</a><br>\nPS：参考<a href=\"https://www.cnrancher.com/kubernetes-installation/\"></a>文章中<strong>kubernetes环境管理</strong>一节修改国内加速。</p>\n","site":{"data":{}},"excerpt":"<p>本文主要纪录了在k8s的学习过程中我是如何搭建k8s集群环境的经历。<br>\n在学习和了解了k8s的一些基础概念我开始尝试去自己搭建一套集群环境，经过一段时间的尝试，我决定使用<code>rancher</code>来帮助搭建环境，并使用<code>rancher os</code>作为主机镜像。<br>\n你要问我为什么使用<code>rancher</code>搭建？因为简单啊！为什么使用<code>rancher os</code>作为主机镜像？因为小啊！</p>","more":"<h2 id=\"环境准备\"><a class=\"header-anchor\" href=\"#环境准备\">¶</a>环境准备</h2>\n<ul>\n<li>官网下载好<code>rancheros.iso</code>文件</li>\n<li>4台虚拟机或者主机，根据实际业务场景增加或减少，机器用途如下：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Hostname</th>\n<th style=\"text-align:center\">IP</th>\n<th style=\"text-align:center\">Role</th>\n<th style=\"text-align:center\">Configuration</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">rancher-server</td>\n<td style=\"text-align:center\">192.168.103.90</td>\n<td style=\"text-align:center\">rancher server</td>\n<td style=\"text-align:center\">1C1G8G</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">k8s-node1</td>\n<td style=\"text-align:center\">192.168.103.101</td>\n<td style=\"text-align:center\">k8s node</td>\n<td style=\"text-align:center\">2C2G20G</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">k8s-node2</td>\n<td style=\"text-align:center\">192.168.103.102</td>\n<td style=\"text-align:center\">k8s node</td>\n<td style=\"text-align:center\">2C2G20G</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">k8s-node3</td>\n<td style=\"text-align:center\">192.168.103.103</td>\n<td style=\"text-align:center\">k8s node</td>\n<td style=\"text-align:center\">2C2G20G</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>\n<p>确认本机已生成ssh密钥对，然后在本机生成<code>cloud-config.yml</code>，用于ssh连接到node节点：</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#cloud-config\\nhostname: rancher-server\\nssh_authorized_keys:\\n - <span class=\"variable\">$(cat .ssh/id_rsa.pub)</span>\"</span> &gt; <span class=\"variable\">$HOME</span>/cloud-config.yml</span><br></pre></td></tr></table></figure>\n<p>如果虚拟机网络没有dhcp，还需要在<code>cloud-config.yml</code>中加入<code>network</code>相关的配置</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#cloud-config\\nhostname: rancher-server\\nrancher:\\n  network:\\n    interfaces:\\n      eth0:\\n        address: 192.168.103.90/24\\n        gateway: 192.168.103.1\\n        mtu: 1500\\n        dhcp: false\\nssh_authorized_keys:\\n  - <span class=\"variable\">$(cat .ssh/id_rsa.pub)</span>\"</span> &gt; <span class=\"variable\">$HOME</span>/cloud-config.yml</span><br></pre></td></tr></table></figure>\n<p>PS：一定要保证hostname唯一，\b我之前就被坑了</p>\n</li>\n</ul>\n<h3 id=\"安装Rancher-OS系统\"><a class=\"header-anchor\" href=\"#安装Rancher-OS系统\">¶</a>安装Rancher OS系统</h3>\n<ul>\n<li>\n<p>在<code>rancher-server</code>虚机上选择iso镜像，启动虚机，进入系统后启动的是类似<code>Live CD</code>的系统，所以我们需要先安装<code>rancheros</code>到硬盘，否则下次重启后数据都将丢失</p>\n</li>\n<li>\n<p>使用命令<code>ip addr</code>查看网卡是否被分配ip，如果没有请参考官网介绍配置静态ip</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ros config <span class=\"built_in\">set</span> rancher.network.interfaces.eth0.address 192.168.103.90/24</span><br><span class=\"line\">sudo ros config <span class=\"built_in\">set</span> rancher.network.interfaces.eth0.gateway 192.168.103.1</span><br><span class=\"line\">sudo ros config <span class=\"built_in\">set</span> rancher.network.interfaces.eth0.mtu 1500</span><br><span class=\"line\">sudo ros config <span class=\"built_in\">set</span> rancher.network.interfaces.eth0.dhcp <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>设置完成后执行<code>sudo system-docker restart network</code>使其生效</p>\n</li>\n<li>\n<p>给虚机设置password：<code>sudo passwd rancher</code></p>\n</li>\n<li>\n<p>将本机的<code>cloud-config.yml</code>文件复制到虚机上：<code>scp $HOME/cloud-config.yml rancher@172.68.1.100:/home/rancher/cloud-config.yml</code>，如果本机可以通过ssh登录那么反向的从虚机上执行scp命令也可以</p>\n</li>\n<li>\n<p>在虚机上执行安装：<code>sudo ros install -d /dev/sda -c cloud-config.yml</code>，完成后重启虚机</p>\n</li>\n<li>\n<p>注意：如果使用<code>ros</code>命令设置的网络ip和<code>cloud-config.yml</code>配置的ip是一致的，那么在虚机装好系统后本机将无法ssh连上，因为本机已经存储了该ip对应的公钥，所以需要删除<code>~/.ssh/known_hosts</code>文件中该ip所在行</p>\n</li>\n<li>\n<p>重新ssh连到虚机，\b切换虚机<code>docker</code>版本，参考<a href=\"http://rancher.com/docs/rancher/v1.6/en/hosts/#supported-docker-versions\"></a>切换到支持的版本号，切换命令：<code>sudo ros engine switch docker-17.03.2-ce</code></p>\n</li>\n<li>\n<p>重复之前的操作，注意在安装之前要先修改<code>cloud-config.yml</code>文件中的ip地址以及hostname，这样我们就可以得到3台node节点。PS：之前试过克隆虚机的方式，但打开克隆的机器无法登陆，所以还是选择重复执行的方式。</p>\n</li>\n</ul>\n<h3 id=\"Docker加速\"><a class=\"header-anchor\" href=\"#Docker加速\">¶</a>Docker加速</h3>\n<p>在所有的虚机上执行<code>sudo vi /etc/docker/daemon.json</code>并填入下面内容</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"registry-mirrors\"</span>: [<span class=\"string\">\"https://registry.docker-cn.com\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>保存后执行<code>sudo system-docker restart docker</code>然后执行<code>docker info</code>查看是否成功设置docker源</p>\n<h2 id=\"安装Rancher-server\"><a class=\"header-anchor\" href=\"#安装Rancher-server\">¶</a>安装Rancher server</h2>\n<p>在<code>rancher-server</code>虚机上执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -d --restart=unless-stopped -p 8080:8080 rancher/server:stable</span><br></pre></td></tr></table></figure>\n<p>等待一段时间后在本地打开浏览器访问<code>http://&lt;rancher-server-ip&gt;:8080</code>即可访问Rancher UI。<br>\n在web页面中的操作就不做详细介绍，大致就是添加环境，然后按照页面提示添加我们的3台<code>k8s node</code>主机，然后等待各种服务安装完成即可，<a href=\"https://player.vimeo.com/video/212648517?autoplay=1&amp;title=0&amp;byline=0\">点击查看官方视频介绍（需翻墙）</a><br>\nPS：参考<a href=\"https://www.cnrancher.com/kubernetes-installation/\"></a>文章中<strong>kubernetes环境管理</strong>一节修改国内加速。</p>"},{"title":"闲置树莓派捣腾记","s":"raspberry-pi-samba","date":"2016-06-07T13:32:12.000Z","thumbnail":"/images/linux/raspberry.png","_content":"手上有一个树莓派，之前装个`openelec`看看视频什么的，后来因为一些原因废弃了。本来打算做私有云的，但是树莓派做私有云可能有些力不从心，等安定了后再捣腾私有云吧，到时可能黑群晖，也可能白群晖，也可能其它方案，都还不一定呢。现在先拿来玩耍玩耍做个共享弄个开源`ownCloud`还是可以的。废话不多说，进入正题。\n<!-- more -->\n\n## 安装系统\n1. 使用`SDFormat`格掉SD卡。\n2. 使用`Win32 Disk Imager`将img镜像写入SD卡。这2步都在Win主机上执行，因为快，这也是为什么不推荐使用`NOOBS`安装的原因，太慢了。\n3. 卸下SD卡，装在我们的树莓派上，其它电源、网线、键鼠、显示器都接上。键鼠和显示器不是必须，但是有时为了方便会接上，而且刚进入系统用界面看IP地址也比较方便。\n4. 开机，点亮。\n5. 简单配置。如果是用`NOOBS`安装的系统，这步可以跳过。进入系统界面后，打开控制台，运行`sudo raspi-config`进入配置页面。选择第一个`Expand Filesystem`，将SD卡里的剩余空间全部扩充上。完成后可能要求重启。\n\n## 调教系统\n1. 更新源。参考[科大的帮助页](https://lug.ustc.edu.cn/wiki/mirrors/help/raspbian)。如果需要更新已有软件，可以使用`sudo apt-get upgrade`。\n2. 静态IP。网上关于更改`/etc/network/interfaces`文件的方法我试了，没用（`jessie`版本开始不能用此方法了），在界面中也没找到网络设置的位置。不过可以使用这种方法：\n    ```bash\n    sudo nano /etc/dhcpcd.conf\n    # 在配置文件最后加上\n    interface eth0\n    static ip_address=192.168.1.200\n    static routers=192.168.1.1\n    static domain_name_servers=114.114.114.114\n    ```\n改完后记得重启下。\n3. 安装`samba`。不知道是因为执行过`apt-get upgrade`的原因还是什么，在安装时会出现依赖冲突，不能安装的情况。最后参考[http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10](http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10) 里面介绍的方法解决的。首先执行\n\t```bash\n    sudo apt-get install --fix-broken && sudo apt-get autoremove && sudo apt-get update && sudo apt-get install samba\n    ```\n  失败，然后卸载。\n\t```bash\n    sudo apt-get remove samba-common libwbclient0 tdb-tools`，卸载完成后重新安装`sudo apt-get install samba samba-common-bin\n    ```\n4. 配置`samba`。参照[http://www.dreamxu.com/raspberrypi-nas/](http://www.dreamxu.com/raspberrypi-nas/) 。先备份配置\n    ```bash\n    sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak\n    ```\n  然后修改配置文件`sudo vim /etc/samba/smb.conf`并删除默认的`home`共享。\n\t```bash\n    [share]\n        comment = Raspberry smb\n        path = /home/pi/share\n        browseable = yes\n        writeable = yes\n        create mask = 0664\n        directory mask = 0775\n  ```\n  为了简单，此处直接使用已有的`pi`用户。在`/home/pi`下新建`share`目录。完成后重启`samba`服务`sudo service samba restart`。到此就完成了`samba`的安装配置，可以在设备上拷贝文件测试了。\n","source":"_posts/raspberry-pi-samba.md","raw":"---\ntitle: 闲置树莓派捣腾记\ns: raspberry-pi-samba\ndate: 2016-06-07 21:32:12\n# thumbnail: https://www.raspberrypi.org/app/uploads/2015/08/raspberry-pi-logo.png\nthumbnail: /images/linux/raspberry.png\ntags:\n  - Raspberry\n---\n手上有一个树莓派，之前装个`openelec`看看视频什么的，后来因为一些原因废弃了。本来打算做私有云的，但是树莓派做私有云可能有些力不从心，等安定了后再捣腾私有云吧，到时可能黑群晖，也可能白群晖，也可能其它方案，都还不一定呢。现在先拿来玩耍玩耍做个共享弄个开源`ownCloud`还是可以的。废话不多说，进入正题。\n<!-- more -->\n\n## 安装系统\n1. 使用`SDFormat`格掉SD卡。\n2. 使用`Win32 Disk Imager`将img镜像写入SD卡。这2步都在Win主机上执行，因为快，这也是为什么不推荐使用`NOOBS`安装的原因，太慢了。\n3. 卸下SD卡，装在我们的树莓派上，其它电源、网线、键鼠、显示器都接上。键鼠和显示器不是必须，但是有时为了方便会接上，而且刚进入系统用界面看IP地址也比较方便。\n4. 开机，点亮。\n5. 简单配置。如果是用`NOOBS`安装的系统，这步可以跳过。进入系统界面后，打开控制台，运行`sudo raspi-config`进入配置页面。选择第一个`Expand Filesystem`，将SD卡里的剩余空间全部扩充上。完成后可能要求重启。\n\n## 调教系统\n1. 更新源。参考[科大的帮助页](https://lug.ustc.edu.cn/wiki/mirrors/help/raspbian)。如果需要更新已有软件，可以使用`sudo apt-get upgrade`。\n2. 静态IP。网上关于更改`/etc/network/interfaces`文件的方法我试了，没用（`jessie`版本开始不能用此方法了），在界面中也没找到网络设置的位置。不过可以使用这种方法：\n    ```bash\n    sudo nano /etc/dhcpcd.conf\n    # 在配置文件最后加上\n    interface eth0\n    static ip_address=192.168.1.200\n    static routers=192.168.1.1\n    static domain_name_servers=114.114.114.114\n    ```\n改完后记得重启下。\n3. 安装`samba`。不知道是因为执行过`apt-get upgrade`的原因还是什么，在安装时会出现依赖冲突，不能安装的情况。最后参考[http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10](http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10) 里面介绍的方法解决的。首先执行\n\t```bash\n    sudo apt-get install --fix-broken && sudo apt-get autoremove && sudo apt-get update && sudo apt-get install samba\n    ```\n  失败，然后卸载。\n\t```bash\n    sudo apt-get remove samba-common libwbclient0 tdb-tools`，卸载完成后重新安装`sudo apt-get install samba samba-common-bin\n    ```\n4. 配置`samba`。参照[http://www.dreamxu.com/raspberrypi-nas/](http://www.dreamxu.com/raspberrypi-nas/) 。先备份配置\n    ```bash\n    sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak\n    ```\n  然后修改配置文件`sudo vim /etc/samba/smb.conf`并删除默认的`home`共享。\n\t```bash\n    [share]\n        comment = Raspberry smb\n        path = /home/pi/share\n        browseable = yes\n        writeable = yes\n        create mask = 0664\n        directory mask = 0775\n  ```\n  为了简单，此处直接使用已有的`pi`用户。在`/home/pi`下新建`share`目录。完成后重启`samba`服务`sudo service samba restart`。到此就完成了`samba`的安装配置，可以在设备上拷贝文件测试了。\n","slug":"raspberry-pi-samba","published":1,"updated":"2019-03-26T13:47:04.883Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0m001ftof9gz62peml","content":"<p>手上有一个树莓派，之前装个<code>openelec</code>看看视频什么的，后来因为一些原因废弃了。本来打算做私有云的，但是树莓派做私有云可能有些力不从心，等安定了后再捣腾私有云吧，到时可能黑群晖，也可能白群晖，也可能其它方案，都还不一定呢。现在先拿来玩耍玩耍做个共享弄个开源<code>ownCloud</code>还是可以的。废话不多说，进入正题。</p>\n<a id=\"more\"></a>\n<h2 id=\"安装系统\"><a class=\"header-anchor\" href=\"#安装系统\">¶</a>安装系统</h2>\n<ol>\n<li>使用<code>SDFormat</code>格掉SD卡。</li>\n<li>使用<code>Win32 Disk Imager</code>将img镜像写入SD卡。这2步都在Win主机上执行，因为快，这也是为什么不推荐使用<code>NOOBS</code>安装的原因，太慢了。</li>\n<li>卸下SD卡，装在我们的树莓派上，其它电源、网线、键鼠、显示器都接上。键鼠和显示器不是必须，但是有时为了方便会接上，而且刚进入系统用界面看IP地址也比较方便。</li>\n<li>开机，点亮。</li>\n<li>简单配置。如果是用<code>NOOBS</code>安装的系统，这步可以跳过。进入系统界面后，打开控制台，运行<code>sudo raspi-config</code>进入配置页面。选择第一个<code>Expand Filesystem</code>，将SD卡里的剩余空间全部扩充上。完成后可能要求重启。</li>\n</ol>\n<h2 id=\"调教系统\"><a class=\"header-anchor\" href=\"#调教系统\">¶</a>调教系统</h2>\n<ol>\n<li>更新源。参考<a href=\"https://lug.ustc.edu.cn/wiki/mirrors/help/raspbian\">科大的帮助页</a>。如果需要更新已有软件，可以使用<code>sudo apt-get upgrade</code>。</li>\n<li>静态IP。网上关于更改<code>/etc/network/interfaces</code>文件的方法我试了，没用（<code>jessie</code>版本开始不能用此方法了），在界面中也没找到网络设置的位置。不过可以使用这种方法： <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/dhcpcd.conf</span><br><span class=\"line\"><span class=\"hljs-comment\"># 在配置文件最后加上</span></span><br><span class=\"line\">interface eth0</span><br><span class=\"line\">static ip_address=192.168.1.200</span><br><span class=\"line\">static routers=192.168.1.1</span><br><span class=\"line\">static domain_name_servers=114.114.114.114</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>改完后记得重启下。<br>\n3. 安装<code>samba</code>。不知道是因为执行过<code>apt-get upgrade</code>的原因还是什么，在安装时会出现依赖冲突，不能安装的情况。最后参考<a href=\"http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10\">http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10</a> 里面介绍的方法解决的。首先执行<br>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install --fix-broken &amp;&amp; sudo apt-get autoremove &amp;&amp; sudo apt-get update &amp;&amp; sudo apt-get install samba</span><br></pre></td></tr></table></figure></p>\n<p>失败，然后卸载。<br>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get remove samba-common libwbclient0 tdb-tools`，卸载完成后重新安装`sudo apt-get install samba samba-common-bin</span><br></pre></td></tr></table></figure></p>\n<ol start=\"4\">\n<li>配置<code>samba</code>。参照<a href=\"http://www.dreamxu.com/raspberrypi-nas/\">http://www.dreamxu.com/raspberrypi-nas/</a> 。先备份配置 <figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>然后修改配置文件<code>sudo vim /etc/samba/smb.conf</code>并删除默认的<code>home</code>共享。<br>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[share]</span><br><span class=\"line\">    comment = Raspberry smb</span><br><span class=\"line\">    path = /home/pi/share</span><br><span class=\"line\">    browseable = yes</span><br><span class=\"line\">    writeable = yes</span><br><span class=\"line\">    create mask = 0664</span><br><span class=\"line\">    directory mask = 0775</span><br></pre></td></tr></table></figure></p>\n<p>为了简单，此处直接使用已有的<code>pi</code>用户。在<code>/home/pi</code>下新建<code>share</code>目录。完成后重启<code>samba</code>服务<code>sudo service samba restart</code>。到此就完成了<code>samba</code>的安装配置，可以在设备上拷贝文件测试了。</p>\n","site":{"data":{}},"excerpt":"<p>手上有一个树莓派，之前装个<code>openelec</code>看看视频什么的，后来因为一些原因废弃了。本来打算做私有云的，但是树莓派做私有云可能有些力不从心，等安定了后再捣腾私有云吧，到时可能黑群晖，也可能白群晖，也可能其它方案，都还不一定呢。现在先拿来玩耍玩耍做个共享弄个开源<code>ownCloud</code>还是可以的。废话不多说，进入正题。</p>","more":"<h2 id=\"安装系统\"><a class=\"header-anchor\" href=\"#安装系统\">¶</a>安装系统</h2>\n<ol>\n<li>使用<code>SDFormat</code>格掉SD卡。</li>\n<li>使用<code>Win32 Disk Imager</code>将img镜像写入SD卡。这2步都在Win主机上执行，因为快，这也是为什么不推荐使用<code>NOOBS</code>安装的原因，太慢了。</li>\n<li>卸下SD卡，装在我们的树莓派上，其它电源、网线、键鼠、显示器都接上。键鼠和显示器不是必须，但是有时为了方便会接上，而且刚进入系统用界面看IP地址也比较方便。</li>\n<li>开机，点亮。</li>\n<li>简单配置。如果是用<code>NOOBS</code>安装的系统，这步可以跳过。进入系统界面后，打开控制台，运行<code>sudo raspi-config</code>进入配置页面。选择第一个<code>Expand Filesystem</code>，将SD卡里的剩余空间全部扩充上。完成后可能要求重启。</li>\n</ol>\n<h2 id=\"调教系统\"><a class=\"header-anchor\" href=\"#调教系统\">¶</a>调教系统</h2>\n<ol>\n<li>更新源。参考<a href=\"https://lug.ustc.edu.cn/wiki/mirrors/help/raspbian\">科大的帮助页</a>。如果需要更新已有软件，可以使用<code>sudo apt-get upgrade</code>。</li>\n<li>静态IP。网上关于更改<code>/etc/network/interfaces</code>文件的方法我试了，没用（<code>jessie</code>版本开始不能用此方法了），在界面中也没找到网络设置的位置。不过可以使用这种方法： <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/dhcpcd.conf</span><br><span class=\"line\"><span class=\"comment\"># 在配置文件最后加上</span></span><br><span class=\"line\">interface eth0</span><br><span class=\"line\">static ip_address=192.168.1.200</span><br><span class=\"line\">static routers=192.168.1.1</span><br><span class=\"line\">static domain_name_servers=114.114.114.114</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>改完后记得重启下。<br>\n3. 安装<code>samba</code>。不知道是因为执行过<code>apt-get upgrade</code>的原因还是什么，在安装时会出现依赖冲突，不能安装的情况。最后参考<a href=\"http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10\">http://askubuntu.com/questions/222658/samba-installation-failed-on-ubuntu-12-10</a> 里面介绍的方法解决的。首先执行<br>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install --fix-broken &amp;&amp; sudo apt-get autoremove &amp;&amp; sudo apt-get update &amp;&amp; sudo apt-get install samba</span><br></pre></td></tr></table></figure></p>\n<p>失败，然后卸载。<br>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get remove samba-common libwbclient0 tdb-tools`，卸载完成后重新安装`sudo apt-get install samba samba-common-bin</span><br></pre></td></tr></table></figure></p>\n<ol start=\"4\">\n<li>配置<code>samba</code>。参照<a href=\"http://www.dreamxu.com/raspberrypi-nas/\">http://www.dreamxu.com/raspberrypi-nas/</a> 。先备份配置 <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>然后修改配置文件<code>sudo vim /etc/samba/smb.conf</code>并删除默认的<code>home</code>共享。<br>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[share]</span><br><span class=\"line\">    comment = Raspberry smb</span><br><span class=\"line\">    path = /home/pi/share</span><br><span class=\"line\">    browseable = yes</span><br><span class=\"line\">    writeable = yes</span><br><span class=\"line\">    create mask = 0664</span><br><span class=\"line\">    directory mask = 0775</span><br></pre></td></tr></table></figure></p>\n<p>为了简单，此处直接使用已有的<code>pi</code>用户。在<code>/home/pi</code>下新建<code>share</code>目录。完成后重启<code>samba</code>服务<code>sudo service samba restart</code>。到此就完成了<code>samba</code>的安装配置，可以在设备上拷贝文件测试了。</p>"},{"title":"前端学习之路","s":"road-to-frontend","date":"2015-08-05T07:06:00.000Z","_content":"以下只是自己总结的一些经验，欢迎大家讨论并提出自己的意见。\n<!-- more -->\n## 1. 道亦有道\n　　学习任何一门语言，都应该遵循它的编程规范，前端也不例外，一致的代码规范为我们后面的学习和维护会减少很多麻烦。这里介绍几个前端规范文档。\n[GOOGLE的前端代码规范](http://www.chaozh.com/google-front-end-style-guide/)\n[编写灵活、稳定、高质量的 HTML 和 CSS 代码的规范。](http://codeguide.bootcss.com/)\n## 2. 历史沉淀\n　　在WEB开发中，有许多问题是需要我们解决的，其中比较让人头疼的就是浏览器规范不一，我们需要一个统一的工具来实现多浏览器的通用，而Jquery就是一个不错的实现。对于新人来说，学习Jquery似乎是一个必经之路，只有走过这条路才能发现更好的更适合使用需求的。文档方面首推[w3school](http://www.w3school.com.cn/) ，这里有很多新人学习的资料，也是很多人成长道路上的第一份学习资料，建议将“HTML教程”和“浏览器脚本”这2个部分学习好，尤其是“JQuery”这部分，还有一个[JQuery的API](http://www.jquery123.com/)。\n　　同样是历史遗留问题，各浏览器的兼容也是一个很大的难题，虽然我们很希望所有的浏览器的表现都一样，所写的代码在各浏览器都运行正常，但是目前的形式并不是我们理想的那样，有时候我们很多代码是为了适应各种浏览器而写的（当然，未来是光明的，未来肯定不会再有这么多问题）。多浏览器的兼容我觉得主要靠经验积累，因为你可能会遇到各种不同的情况，这里提供一些经验参考。\n[知乎上关于浏览器兼容性的讨论](http://www.zhihu.com/question/19736007)\n[前端工程师如何系统地整理和累积兼容性相关的知识？](http://www.zhihu.com/question/20984284)\n　　这里还有一点需要介绍，也是新人必须学习的，那就是调试技巧，调试也是开发过程中最重要的环节。我个人常用的调试工具还是用Chrome的[Developer Tools](http://ued.taobao.org/blog/2012/06/debug-with-chrome-dev-tool/)，如果用FireFox，那么调试工具就是使用FireBug，如果是IE，似乎就是用自带的开发者工具，这些调试工具的使用大致相同，都可以通过`F12`键调出（Mac下不是的），调试代码也是经验的积累，前期掌握调试的步骤就可以了。\n## 3. 时下热门\n　　前端发展到现在已经要进入了一个爆炸式的时期了，要学习和掌握的技能太多了，而这一切都是因为NodeJs的异军突起。不过在学习NodeJ之前，可以先看看一些常见的CSS框架和JS框架，这些框架可以帮助我们更好地布局或者更好的码代码。\n  * [BootStrap](http://v3.bootcss.com/getting-started/) 这个是现在非常火的一个框架，由Twitter开发，让那些即使不太会前端的人也能开发出不错的布局和界面。\n  * [AngularJs](http://www.ituring.com.cn/minibook/303) 同样也是一个很火的JS框架，由Google开发，其数据双向绑定功能非常吸引人，能大量减少开发者的工作量，Gmail就是非常成功的一个转型。\n  * [ReactJs](http://www.ruanyifeng.com/blog/2015/03/react.html) 今年特别火的一个JS框架，由Facebook开发，其背后也是有很多故事，这个东西也是非常新，自己还没有去学习，不做过多介绍。\n  * [RequireJs](http://www.requirejs.cn/)/[SeaJs](http://seajs.org/docs/) 都是模块化开发的工具，让代码的组织性更强，不再杂乱无章。\n  * [NodeJs](http://ourjs.com/detail/529ca5950cb6498814000005) 无疑是当前最火的一个点，从NodeJs后诞生出了很多新的技术，不过NodeJs的学习还是比较快的，因为代码都是js。\n  * [Grunt](http://www.gruntjs.net/getting-started)/[Gulp](http://www.gulpjs.com.cn/) 在NodeJs出来之前很多的自动化工具都是基于Ant的，但是现在有了NodeJs后这2个自动化工具就变得非常火热，这些自动化工具可以一键完成各种任务，包括代码检查、代码压缩和合并等等。\n  * [CoffeeScript](http://coffee-script.org/) 一门编译到 JavaScript 的小巧语言，它尝试用简洁的方式展示 JavaScript 优秀的部分。还有后来发展的[TypeScript](http://www.cnblogs.com/tansm/p/3370615.html)\n  * [Less](http://less.bootcss.com/)/[Sass](http://www.w3cplus.com/sassguide/)/[Stylus](http://www.zhangxinxu.com/jq/stylus/) 这些是css的预编译语言，也是为了更好的书写CSS。\n## 4. 展望未来\n　　因水平有限，此处也不做过多展望，免得误导大家，不过可以知道的是前端的发展速度太快，不跟紧脚步就会赶不上大部队，别人说的东西你就不懂了，这里给出一个[Github里的流行趋势](https://github.com/trending)，在这里可以看到现在有哪些东西比较热门，总的来说学习前端就要保持一个时刻学习的心。\n　　再说说前端演化的发展吧，一个是混合开发（Hybrid App），其中以[Ionic](http://www.ionicframework.com/)和[HBuilder/HTML5+/mui](http://ask.dcloud.net.cn/docs)为代表，还有一个是NodeJs桌面级应用开发。这些都可以作为前端学习道路中的一个分支吧，也会是一个不错的方向。\n\n> 这里有一个别人推荐的网站，我看了觉得还是挺不错的，也是推荐给大家[菜鸟教程](http://www.runoob.com/)。还有一个很有意思的[Web Developer技能树](http://skill.phodal.com/)，像玩游戏一样查看自己的技能结构。\n","source":"_posts/road-to-frontend.md","raw":"---\ntitle: 前端学习之路\ns: road-to-frontend\ndate: 2015-08-05 15:06:00\ntags:\n  - Frontend\n---\n以下只是自己总结的一些经验，欢迎大家讨论并提出自己的意见。\n<!-- more -->\n## 1. 道亦有道\n　　学习任何一门语言，都应该遵循它的编程规范，前端也不例外，一致的代码规范为我们后面的学习和维护会减少很多麻烦。这里介绍几个前端规范文档。\n[GOOGLE的前端代码规范](http://www.chaozh.com/google-front-end-style-guide/)\n[编写灵活、稳定、高质量的 HTML 和 CSS 代码的规范。](http://codeguide.bootcss.com/)\n## 2. 历史沉淀\n　　在WEB开发中，有许多问题是需要我们解决的，其中比较让人头疼的就是浏览器规范不一，我们需要一个统一的工具来实现多浏览器的通用，而Jquery就是一个不错的实现。对于新人来说，学习Jquery似乎是一个必经之路，只有走过这条路才能发现更好的更适合使用需求的。文档方面首推[w3school](http://www.w3school.com.cn/) ，这里有很多新人学习的资料，也是很多人成长道路上的第一份学习资料，建议将“HTML教程”和“浏览器脚本”这2个部分学习好，尤其是“JQuery”这部分，还有一个[JQuery的API](http://www.jquery123.com/)。\n　　同样是历史遗留问题，各浏览器的兼容也是一个很大的难题，虽然我们很希望所有的浏览器的表现都一样，所写的代码在各浏览器都运行正常，但是目前的形式并不是我们理想的那样，有时候我们很多代码是为了适应各种浏览器而写的（当然，未来是光明的，未来肯定不会再有这么多问题）。多浏览器的兼容我觉得主要靠经验积累，因为你可能会遇到各种不同的情况，这里提供一些经验参考。\n[知乎上关于浏览器兼容性的讨论](http://www.zhihu.com/question/19736007)\n[前端工程师如何系统地整理和累积兼容性相关的知识？](http://www.zhihu.com/question/20984284)\n　　这里还有一点需要介绍，也是新人必须学习的，那就是调试技巧，调试也是开发过程中最重要的环节。我个人常用的调试工具还是用Chrome的[Developer Tools](http://ued.taobao.org/blog/2012/06/debug-with-chrome-dev-tool/)，如果用FireFox，那么调试工具就是使用FireBug，如果是IE，似乎就是用自带的开发者工具，这些调试工具的使用大致相同，都可以通过`F12`键调出（Mac下不是的），调试代码也是经验的积累，前期掌握调试的步骤就可以了。\n## 3. 时下热门\n　　前端发展到现在已经要进入了一个爆炸式的时期了，要学习和掌握的技能太多了，而这一切都是因为NodeJs的异军突起。不过在学习NodeJ之前，可以先看看一些常见的CSS框架和JS框架，这些框架可以帮助我们更好地布局或者更好的码代码。\n  * [BootStrap](http://v3.bootcss.com/getting-started/) 这个是现在非常火的一个框架，由Twitter开发，让那些即使不太会前端的人也能开发出不错的布局和界面。\n  * [AngularJs](http://www.ituring.com.cn/minibook/303) 同样也是一个很火的JS框架，由Google开发，其数据双向绑定功能非常吸引人，能大量减少开发者的工作量，Gmail就是非常成功的一个转型。\n  * [ReactJs](http://www.ruanyifeng.com/blog/2015/03/react.html) 今年特别火的一个JS框架，由Facebook开发，其背后也是有很多故事，这个东西也是非常新，自己还没有去学习，不做过多介绍。\n  * [RequireJs](http://www.requirejs.cn/)/[SeaJs](http://seajs.org/docs/) 都是模块化开发的工具，让代码的组织性更强，不再杂乱无章。\n  * [NodeJs](http://ourjs.com/detail/529ca5950cb6498814000005) 无疑是当前最火的一个点，从NodeJs后诞生出了很多新的技术，不过NodeJs的学习还是比较快的，因为代码都是js。\n  * [Grunt](http://www.gruntjs.net/getting-started)/[Gulp](http://www.gulpjs.com.cn/) 在NodeJs出来之前很多的自动化工具都是基于Ant的，但是现在有了NodeJs后这2个自动化工具就变得非常火热，这些自动化工具可以一键完成各种任务，包括代码检查、代码压缩和合并等等。\n  * [CoffeeScript](http://coffee-script.org/) 一门编译到 JavaScript 的小巧语言，它尝试用简洁的方式展示 JavaScript 优秀的部分。还有后来发展的[TypeScript](http://www.cnblogs.com/tansm/p/3370615.html)\n  * [Less](http://less.bootcss.com/)/[Sass](http://www.w3cplus.com/sassguide/)/[Stylus](http://www.zhangxinxu.com/jq/stylus/) 这些是css的预编译语言，也是为了更好的书写CSS。\n## 4. 展望未来\n　　因水平有限，此处也不做过多展望，免得误导大家，不过可以知道的是前端的发展速度太快，不跟紧脚步就会赶不上大部队，别人说的东西你就不懂了，这里给出一个[Github里的流行趋势](https://github.com/trending)，在这里可以看到现在有哪些东西比较热门，总的来说学习前端就要保持一个时刻学习的心。\n　　再说说前端演化的发展吧，一个是混合开发（Hybrid App），其中以[Ionic](http://www.ionicframework.com/)和[HBuilder/HTML5+/mui](http://ask.dcloud.net.cn/docs)为代表，还有一个是NodeJs桌面级应用开发。这些都可以作为前端学习道路中的一个分支吧，也会是一个不错的方向。\n\n> 这里有一个别人推荐的网站，我看了觉得还是挺不错的，也是推荐给大家[菜鸟教程](http://www.runoob.com/)。还有一个很有意思的[Web Developer技能树](http://skill.phodal.com/)，像玩游戏一样查看自己的技能结构。\n","slug":"road-to-frontend","published":1,"updated":"2019-03-26T13:47:04.884Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0n001gtof99b12sq0q","content":"<p>以下只是自己总结的一些经验，欢迎大家讨论并提出自己的意见。</p>\n<a id=\"more\"></a>\n<h2 id=\"1-道亦有道\"><a class=\"header-anchor\" href=\"#1-道亦有道\">¶</a>1. 道亦有道</h2>\n<p>学习任何一门语言，都应该遵循它的编程规范，前端也不例外，一致的代码规范为我们后面的学习和维护会减少很多麻烦。这里介绍几个前端规范文档。<br>\n<a href=\"http://www.chaozh.com/google-front-end-style-guide/\">GOOGLE的前端代码规范</a><br>\n<a href=\"http://codeguide.bootcss.com/\">编写灵活、稳定、高质量的 HTML 和 CSS 代码的规范。</a></p>\n<h2 id=\"2-历史沉淀\"><a class=\"header-anchor\" href=\"#2-历史沉淀\">¶</a>2. 历史沉淀</h2>\n<p>在WEB开发中，有许多问题是需要我们解决的，其中比较让人头疼的就是浏览器规范不一，我们需要一个统一的工具来实现多浏览器的通用，而Jquery就是一个不错的实现。对于新人来说，学习Jquery似乎是一个必经之路，只有走过这条路才能发现更好的更适合使用需求的。文档方面首推<a href=\"http://www.w3school.com.cn/\">w3school</a> ，这里有很多新人学习的资料，也是很多人成长道路上的第一份学习资料，建议将“HTML教程”和“浏览器脚本”这2个部分学习好，尤其是“JQuery”这部分，还有一个<a href=\"http://www.jquery123.com/\">JQuery的API</a>。<br>\n　　同样是历史遗留问题，各浏览器的兼容也是一个很大的难题，虽然我们很希望所有的浏览器的表现都一样，所写的代码在各浏览器都运行正常，但是目前的形式并不是我们理想的那样，有时候我们很多代码是为了适应各种浏览器而写的（当然，未来是光明的，未来肯定不会再有这么多问题）。多浏览器的兼容我觉得主要靠经验积累，因为你可能会遇到各种不同的情况，这里提供一些经验参考。<br>\n<a href=\"http://www.zhihu.com/question/19736007\">知乎上关于浏览器兼容性的讨论</a><br>\n<a href=\"http://www.zhihu.com/question/20984284\">前端工程师如何系统地整理和累积兼容性相关的知识？</a><br>\n　　这里还有一点需要介绍，也是新人必须学习的，那就是调试技巧，调试也是开发过程中最重要的环节。我个人常用的调试工具还是用Chrome的<a href=\"http://ued.taobao.org/blog/2012/06/debug-with-chrome-dev-tool/\">Developer Tools</a>，如果用FireFox，那么调试工具就是使用FireBug，如果是IE，似乎就是用自带的开发者工具，这些调试工具的使用大致相同，都可以通过<code>F12</code>键调出（Mac下不是的），调试代码也是经验的积累，前期掌握调试的步骤就可以了。</p>\n<h2 id=\"3-时下热门\"><a class=\"header-anchor\" href=\"#3-时下热门\">¶</a>3. 时下热门</h2>\n<p>前端发展到现在已经要进入了一个爆炸式的时期了，要学习和掌握的技能太多了，而这一切都是因为NodeJs的异军突起。不过在学习NodeJ之前，可以先看看一些常见的CSS框架和JS框架，这些框架可以帮助我们更好地布局或者更好的码代码。</p>\n<ul>\n<li><a href=\"http://v3.bootcss.com/getting-started/\">BootStrap</a> 这个是现在非常火的一个框架，由Twitter开发，让那些即使不太会前端的人也能开发出不错的布局和界面。</li>\n<li><a href=\"http://www.ituring.com.cn/minibook/303\">AngularJs</a> 同样也是一个很火的JS框架，由Google开发，其数据双向绑定功能非常吸引人，能大量减少开发者的工作量，Gmail就是非常成功的一个转型。</li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2015/03/react.html\">ReactJs</a> 今年特别火的一个JS框架，由Facebook开发，其背后也是有很多故事，这个东西也是非常新，自己还没有去学习，不做过多介绍。</li>\n<li><a href=\"http://www.requirejs.cn/\">RequireJs</a>/<a href=\"http://seajs.org/docs/\">SeaJs</a> 都是模块化开发的工具，让代码的组织性更强，不再杂乱无章。</li>\n<li><a href=\"http://ourjs.com/detail/529ca5950cb6498814000005\">NodeJs</a> 无疑是当前最火的一个点，从NodeJs后诞生出了很多新的技术，不过NodeJs的学习还是比较快的，因为代码都是js。</li>\n<li><a href=\"http://www.gruntjs.net/getting-started\">Grunt</a>/<a href=\"http://www.gulpjs.com.cn/\">Gulp</a> 在NodeJs出来之前很多的自动化工具都是基于Ant的，但是现在有了NodeJs后这2个自动化工具就变得非常火热，这些自动化工具可以一键完成各种任务，包括代码检查、代码压缩和合并等等。</li>\n<li><a href=\"http://coffee-script.org/\">CoffeeScript</a> 一门编译到 JavaScript 的小巧语言，它尝试用简洁的方式展示 JavaScript 优秀的部分。还有后来发展的<a href=\"http://www.cnblogs.com/tansm/p/3370615.html\">TypeScript</a></li>\n<li><a href=\"http://less.bootcss.com/\">Less</a>/<a href=\"http://www.w3cplus.com/sassguide/\">Sass</a>/<a href=\"http://www.zhangxinxu.com/jq/stylus/\">Stylus</a> 这些是css的预编译语言，也是为了更好的书写CSS。</li>\n</ul>\n<h2 id=\"4-展望未来\"><a class=\"header-anchor\" href=\"#4-展望未来\">¶</a>4. 展望未来</h2>\n<p>因水平有限，此处也不做过多展望，免得误导大家，不过可以知道的是前端的发展速度太快，不跟紧脚步就会赶不上大部队，别人说的东西你就不懂了，这里给出一个<a href=\"https://github.com/trending\">Github里的流行趋势</a>，在这里可以看到现在有哪些东西比较热门，总的来说学习前端就要保持一个时刻学习的心。<br>\n　　再说说前端演化的发展吧，一个是混合开发（Hybrid App），其中以<a href=\"http://www.ionicframework.com/\">Ionic</a>和<a href=\"http://ask.dcloud.net.cn/docs\">HBuilder/HTML5+/mui</a>为代表，还有一个是NodeJs桌面级应用开发。这些都可以作为前端学习道路中的一个分支吧，也会是一个不错的方向。</p>\n<blockquote>\n<p>这里有一个别人推荐的网站，我看了觉得还是挺不错的，也是推荐给大家<a href=\"http://www.runoob.com/\">菜鸟教程</a>。还有一个很有意思的<a href=\"http://skill.phodal.com/\">Web Developer技能树</a>，像玩游戏一样查看自己的技能结构。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>以下只是自己总结的一些经验，欢迎大家讨论并提出自己的意见。</p>","more":"<h2 id=\"1-道亦有道\"><a class=\"header-anchor\" href=\"#1-道亦有道\">¶</a>1. 道亦有道</h2>\n<p>学习任何一门语言，都应该遵循它的编程规范，前端也不例外，一致的代码规范为我们后面的学习和维护会减少很多麻烦。这里介绍几个前端规范文档。<br>\n<a href=\"http://www.chaozh.com/google-front-end-style-guide/\">GOOGLE的前端代码规范</a><br>\n<a href=\"http://codeguide.bootcss.com/\">编写灵活、稳定、高质量的 HTML 和 CSS 代码的规范。</a></p>\n<h2 id=\"2-历史沉淀\"><a class=\"header-anchor\" href=\"#2-历史沉淀\">¶</a>2. 历史沉淀</h2>\n<p>在WEB开发中，有许多问题是需要我们解决的，其中比较让人头疼的就是浏览器规范不一，我们需要一个统一的工具来实现多浏览器的通用，而Jquery就是一个不错的实现。对于新人来说，学习Jquery似乎是一个必经之路，只有走过这条路才能发现更好的更适合使用需求的。文档方面首推<a href=\"http://www.w3school.com.cn/\">w3school</a> ，这里有很多新人学习的资料，也是很多人成长道路上的第一份学习资料，建议将“HTML教程”和“浏览器脚本”这2个部分学习好，尤其是“JQuery”这部分，还有一个<a href=\"http://www.jquery123.com/\">JQuery的API</a>。<br>\n　　同样是历史遗留问题，各浏览器的兼容也是一个很大的难题，虽然我们很希望所有的浏览器的表现都一样，所写的代码在各浏览器都运行正常，但是目前的形式并不是我们理想的那样，有时候我们很多代码是为了适应各种浏览器而写的（当然，未来是光明的，未来肯定不会再有这么多问题）。多浏览器的兼容我觉得主要靠经验积累，因为你可能会遇到各种不同的情况，这里提供一些经验参考。<br>\n<a href=\"http://www.zhihu.com/question/19736007\">知乎上关于浏览器兼容性的讨论</a><br>\n<a href=\"http://www.zhihu.com/question/20984284\">前端工程师如何系统地整理和累积兼容性相关的知识？</a><br>\n　　这里还有一点需要介绍，也是新人必须学习的，那就是调试技巧，调试也是开发过程中最重要的环节。我个人常用的调试工具还是用Chrome的<a href=\"http://ued.taobao.org/blog/2012/06/debug-with-chrome-dev-tool/\">Developer Tools</a>，如果用FireFox，那么调试工具就是使用FireBug，如果是IE，似乎就是用自带的开发者工具，这些调试工具的使用大致相同，都可以通过<code>F12</code>键调出（Mac下不是的），调试代码也是经验的积累，前期掌握调试的步骤就可以了。</p>\n<h2 id=\"3-时下热门\"><a class=\"header-anchor\" href=\"#3-时下热门\">¶</a>3. 时下热门</h2>\n<p>前端发展到现在已经要进入了一个爆炸式的时期了，要学习和掌握的技能太多了，而这一切都是因为NodeJs的异军突起。不过在学习NodeJ之前，可以先看看一些常见的CSS框架和JS框架，这些框架可以帮助我们更好地布局或者更好的码代码。</p>\n<ul>\n<li><a href=\"http://v3.bootcss.com/getting-started/\">BootStrap</a> 这个是现在非常火的一个框架，由Twitter开发，让那些即使不太会前端的人也能开发出不错的布局和界面。</li>\n<li><a href=\"http://www.ituring.com.cn/minibook/303\">AngularJs</a> 同样也是一个很火的JS框架，由Google开发，其数据双向绑定功能非常吸引人，能大量减少开发者的工作量，Gmail就是非常成功的一个转型。</li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2015/03/react.html\">ReactJs</a> 今年特别火的一个JS框架，由Facebook开发，其背后也是有很多故事，这个东西也是非常新，自己还没有去学习，不做过多介绍。</li>\n<li><a href=\"http://www.requirejs.cn/\">RequireJs</a>/<a href=\"http://seajs.org/docs/\">SeaJs</a> 都是模块化开发的工具，让代码的组织性更强，不再杂乱无章。</li>\n<li><a href=\"http://ourjs.com/detail/529ca5950cb6498814000005\">NodeJs</a> 无疑是当前最火的一个点，从NodeJs后诞生出了很多新的技术，不过NodeJs的学习还是比较快的，因为代码都是js。</li>\n<li><a href=\"http://www.gruntjs.net/getting-started\">Grunt</a>/<a href=\"http://www.gulpjs.com.cn/\">Gulp</a> 在NodeJs出来之前很多的自动化工具都是基于Ant的，但是现在有了NodeJs后这2个自动化工具就变得非常火热，这些自动化工具可以一键完成各种任务，包括代码检查、代码压缩和合并等等。</li>\n<li><a href=\"http://coffee-script.org/\">CoffeeScript</a> 一门编译到 JavaScript 的小巧语言，它尝试用简洁的方式展示 JavaScript 优秀的部分。还有后来发展的<a href=\"http://www.cnblogs.com/tansm/p/3370615.html\">TypeScript</a></li>\n<li><a href=\"http://less.bootcss.com/\">Less</a>/<a href=\"http://www.w3cplus.com/sassguide/\">Sass</a>/<a href=\"http://www.zhangxinxu.com/jq/stylus/\">Stylus</a> 这些是css的预编译语言，也是为了更好的书写CSS。</li>\n</ul>\n<h2 id=\"4-展望未来\"><a class=\"header-anchor\" href=\"#4-展望未来\">¶</a>4. 展望未来</h2>\n<p>因水平有限，此处也不做过多展望，免得误导大家，不过可以知道的是前端的发展速度太快，不跟紧脚步就会赶不上大部队，别人说的东西你就不懂了，这里给出一个<a href=\"https://github.com/trending\">Github里的流行趋势</a>，在这里可以看到现在有哪些东西比较热门，总的来说学习前端就要保持一个时刻学习的心。<br>\n　　再说说前端演化的发展吧，一个是混合开发（Hybrid App），其中以<a href=\"http://www.ionicframework.com/\">Ionic</a>和<a href=\"http://ask.dcloud.net.cn/docs\">HBuilder/HTML5+/mui</a>为代表，还有一个是NodeJs桌面级应用开发。这些都可以作为前端学习道路中的一个分支吧，也会是一个不错的方向。</p>\n<blockquote>\n<p>这里有一个别人推荐的网站，我看了觉得还是挺不错的，也是推荐给大家<a href=\"http://www.runoob.com/\">菜鸟教程</a>。还有一个很有意思的<a href=\"http://skill.phodal.com/\">Web Developer技能树</a>，像玩游戏一样查看自己的技能结构。</p>\n</blockquote>"},{"title":"一些备忘","s":"some-remark","date":"2015-03-04T06:23:00.000Z","_content":"* 登录到ssh\n```\nssh git@127.0.0.1\n```\n\n* 查看版本和远程url\n```\ngit remote -v\n```\n\n* git迁移  \n1.clone一份或者直接在原本地工程上开始\n2.`git remote set-url origin <url>` url为目标迁移的git地址\n3.`git push origin master` 将本地资源push到远程\n\n* [bing每日背景请求地址](http://cn.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&nc=1361089515117&FORM=HYLH1)\n","source":"_posts/some-remark.md","raw":"---\ntitle: 一些备忘\ns: some-remark\ndate: 2015-03-04 14:23:00\ntags:\n---\n* 登录到ssh\n```\nssh git@127.0.0.1\n```\n\n* 查看版本和远程url\n```\ngit remote -v\n```\n\n* git迁移  \n1.clone一份或者直接在原本地工程上开始\n2.`git remote set-url origin <url>` url为目标迁移的git地址\n3.`git push origin master` 将本地资源push到远程\n\n* [bing每日背景请求地址](http://cn.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&nc=1361089515117&FORM=HYLH1)\n","slug":"some-remark","published":1,"updated":"2016-08-28T08:52:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0o001itof9egiglehy","content":"<ul>\n<li>登录到ssh</li>\n</ul>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh git@127.0.0.1</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看版本和远程url</li>\n</ul>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>git迁移<br>\n1.clone一份或者直接在原本地工程上开始<br>\n2.<code>git remote set-url origin &lt;url&gt;</code> url为目标迁移的git地址<br>\n3.<code>git push origin master</code> 将本地资源push到远程</p>\n</li>\n<li>\n<p><a href=\"http://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;nc=1361089515117&amp;FORM=HYLH1\">bing每日背景请求地址</a></p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>登录到ssh</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh git@127.0.0.1</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看版本和远程url</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>git迁移<br>\n1.clone一份或者直接在原本地工程上开始<br>\n2.<code>git remote set-url origin &lt;url&gt;</code> url为目标迁移的git地址<br>\n3.<code>git push origin master</code> 将本地资源push到远程</p>\n</li>\n<li>\n<p><a href=\"http://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;nc=1361089515117&amp;FORM=HYLH1\">bing每日背景请求地址</a></p>\n</li>\n</ul>\n"},{"title":"服务器安全登录","s":"ssh-via-public-key","date":"2015-12-23T16:12:00.000Z","_content":"搬瓦工的VPS要到期了，以前用着好难受的感觉，所以决定加点钱换个好点的，最后还是买了`Linode`。这里记录一下以一个更安全的方式连接VPS的设置过程。\n<!-- more -->\n## 新建用户\n首先新建用户，不使用`root`用户登录\n```bash\nuseradd -g root erguotou\n```\n设置密码\n```bash\npasswd erguotou\n```\n添加到`root`组（不确定该步骤是否必须）\n```bash\nvi /etc/sudoers\n```\n找到\n```bash\n## Allow root to run any commands anywhere\nroot    ALL=(ALL)     ALL\n```\n在下面添加\n```bash\nerguotou ALL=(ALL)     ALL\n```\n## 使用公私钥方式登录\n首先退出`root`用户，使用新建的用户登录，然后在用户目录下新建`.ssh/authorized_keys`文件。\n```bash\nmkdir ~/.ssh\ntouch ~/.ssh/authorized_keys\nchmod 700 ~/.ssh\n```\n然后复制本机的公钥内容添加到VPS的`authorized_keys`文件中，保存，退出登录，重新登录后就可以不用输入密码了。\n\n## 禁root禁密码登录\n使用`root`用户执行\n```bash\nvi /etc/ssh/sshd_config\n```\n找到`PasswordAuthentication`配置，并改为`no`\n```bash\nPasswordAuthentication no\n```\n找到`PermitRootLogin`配置，并改为`no`\n```bash\nPermitRootLogin no\n```\n最后退出当前用户登录，然后尝试使用`root`登录，再尝试是否可以用密码方式登录。\n","source":"_posts/ssh-via-public-key.md","raw":"---\ntitle: 服务器安全登录\ns: ssh-via-public-key\ndate: 2015-12-24 00:12:00\ntags:\n  - SSH\n---\n搬瓦工的VPS要到期了，以前用着好难受的感觉，所以决定加点钱换个好点的，最后还是买了`Linode`。这里记录一下以一个更安全的方式连接VPS的设置过程。\n<!-- more -->\n## 新建用户\n首先新建用户，不使用`root`用户登录\n```bash\nuseradd -g root erguotou\n```\n设置密码\n```bash\npasswd erguotou\n```\n添加到`root`组（不确定该步骤是否必须）\n```bash\nvi /etc/sudoers\n```\n找到\n```bash\n## Allow root to run any commands anywhere\nroot    ALL=(ALL)     ALL\n```\n在下面添加\n```bash\nerguotou ALL=(ALL)     ALL\n```\n## 使用公私钥方式登录\n首先退出`root`用户，使用新建的用户登录，然后在用户目录下新建`.ssh/authorized_keys`文件。\n```bash\nmkdir ~/.ssh\ntouch ~/.ssh/authorized_keys\nchmod 700 ~/.ssh\n```\n然后复制本机的公钥内容添加到VPS的`authorized_keys`文件中，保存，退出登录，重新登录后就可以不用输入密码了。\n\n## 禁root禁密码登录\n使用`root`用户执行\n```bash\nvi /etc/ssh/sshd_config\n```\n找到`PasswordAuthentication`配置，并改为`no`\n```bash\nPasswordAuthentication no\n```\n找到`PermitRootLogin`配置，并改为`no`\n```bash\nPermitRootLogin no\n```\n最后退出当前用户登录，然后尝试使用`root`登录，再尝试是否可以用密码方式登录。\n","slug":"ssh-via-public-key","published":1,"updated":"2019-03-26T13:47:04.884Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0p001ktof9d9kzcxlw","content":"<p>搬瓦工的VPS要到期了，以前用着好难受的感觉，所以决定加点钱换个好点的，最后还是买了<code>Linode</code>。这里记录一下以一个更安全的方式连接VPS的设置过程。</p>\n<a id=\"more\"></a>\n<h2 id=\"新建用户\"><a class=\"header-anchor\" href=\"#新建用户\">¶</a>新建用户</h2>\n<p>首先新建用户，不使用<code>root</code>用户登录</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -g root erguotou</span><br></pre></td></tr></table></figure>\n<p>设置密码</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">passwd erguotou</span><br></pre></td></tr></table></figure>\n<p>添加到<code>root</code>组（不确定该步骤是否必须）</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sudoers</span><br></pre></td></tr></table></figure>\n<p>找到</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">## Allow root to run any commands anywhere</span></span><br><span class=\"line\">root    ALL=(ALL)     ALL</span><br></pre></td></tr></table></figure>\n<p>在下面添加</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">erguotou ALL=(ALL)     ALL</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用公私钥方式登录\"><a class=\"header-anchor\" href=\"#使用公私钥方式登录\">¶</a>使用公私钥方式登录</h2>\n<p>首先退出<code>root</code>用户，使用新建的用户登录，然后在用户目录下新建<code>.ssh/authorized_keys</code>文件。</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir ~/.ssh</span><br><span class=\"line\">touch ~/.ssh/authorized_keys</span><br><span class=\"line\">chmod 700 ~/.ssh</span><br></pre></td></tr></table></figure>\n<p>然后复制本机的公钥内容添加到VPS的<code>authorized_keys</code>文件中，保存，退出登录，重新登录后就可以不用输入密码了。</p>\n<h2 id=\"禁root禁密码登录\"><a class=\"header-anchor\" href=\"#禁root禁密码登录\">¶</a>禁root禁密码登录</h2>\n<p>使用<code>root</code>用户执行</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>\n<p>找到<code>PasswordAuthentication</code>配置，并改为<code>no</code></p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PasswordAuthentication no</span><br></pre></td></tr></table></figure>\n<p>找到<code>PermitRootLogin</code>配置，并改为<code>no</code></p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PermitRootLogin no</span><br></pre></td></tr></table></figure>\n<p>最后退出当前用户登录，然后尝试使用<code>root</code>登录，再尝试是否可以用密码方式登录。</p>\n","site":{"data":{}},"excerpt":"<p>搬瓦工的VPS要到期了，以前用着好难受的感觉，所以决定加点钱换个好点的，最后还是买了<code>Linode</code>。这里记录一下以一个更安全的方式连接VPS的设置过程。</p>","more":"<h2 id=\"新建用户\"><a class=\"header-anchor\" href=\"#新建用户\">¶</a>新建用户</h2>\n<p>首先新建用户，不使用<code>root</code>用户登录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -g root erguotou</span><br></pre></td></tr></table></figure>\n<p>设置密码</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">passwd erguotou</span><br></pre></td></tr></table></figure>\n<p>添加到<code>root</code>组（不确定该步骤是否必须）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sudoers</span><br></pre></td></tr></table></figure>\n<p>找到</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Allow root to run any commands anywhere</span></span><br><span class=\"line\">root    ALL=(ALL)     ALL</span><br></pre></td></tr></table></figure>\n<p>在下面添加</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">erguotou ALL=(ALL)     ALL</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用公私钥方式登录\"><a class=\"header-anchor\" href=\"#使用公私钥方式登录\">¶</a>使用公私钥方式登录</h2>\n<p>首先退出<code>root</code>用户，使用新建的用户登录，然后在用户目录下新建<code>.ssh/authorized_keys</code>文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir ~/.ssh</span><br><span class=\"line\">touch ~/.ssh/authorized_keys</span><br><span class=\"line\">chmod 700 ~/.ssh</span><br></pre></td></tr></table></figure>\n<p>然后复制本机的公钥内容添加到VPS的<code>authorized_keys</code>文件中，保存，退出登录，重新登录后就可以不用输入密码了。</p>\n<h2 id=\"禁root禁密码登录\"><a class=\"header-anchor\" href=\"#禁root禁密码登录\">¶</a>禁root禁密码登录</h2>\n<p>使用<code>root</code>用户执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>\n<p>找到<code>PasswordAuthentication</code>配置，并改为<code>no</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PasswordAuthentication no</span><br></pre></td></tr></table></figure>\n<p>找到<code>PermitRootLogin</code>配置，并改为<code>no</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PermitRootLogin no</span><br></pre></td></tr></table></figure>\n<p>最后退出当前用户登录，然后尝试使用<code>root</code>登录，再尝试是否可以用密码方式登录。</p>"},{"title":"SVN、GIT数据迁移","s":"svn-git-transfer","date":"2015-01-14T08:45:00.000Z","_content":"## SVN数据迁移\nsvn的管理使用的是Collabnet Subversion Edge。\n\n### 1.安装服务\n在目标机器上安装Collabnet Subversion Edge,简称CSE\n### 2.复制版本库\n将旧服务器上的repository全部复制到新服务器上\n### 3.导入数据\n在新服务器上打开CSE的管理后台[http://localhost:3343/csvn](http://localhost:3343/csvn)， 在“版本库”页面选择“发现版本库”，这样就把之前的版本库都导入进去了\n### 4.复制用户数据\n从原机器中拷贝{安装路径} \\data\\conf下的svn_auth_file文件到新机器\n### 5.导入用户数据\n修改新机器{安装路径}\\data\\csvn-production-hsqldb.script文件。复制原机器中类似\n\n`INSERT INTO USER VALUES(1,2,'admin user','admin@example.com',TRUE,'f52c7457507a292a11bf8d274d720ee4','Super Administrator','admin')`\n\n的语句到新服务器的对应文件。\n### 6.重置用户密码\n### 7.重启CSE服务即可\n<!-- more -->\n\n## GIT数据迁移\nGIT的数据迁移比较简单，GIT是采用mysmgit+copssh搭建的。\n### 1.安装环境\n新机器上搭建GIT环境，并建立每个需要备份的项目的空仓库（好像不新建也是可以的）\n### 2.GIT仓库转移\n选择一份最新版本的项目路径，执行\n\n`git remote set-url origin 资源库地址`\n\n### 3.GIT提交\n直接将当前项目提交即可，这样新的仓库里也是有之前所有的提交记录的\n","source":"_posts/svn-git-transfer.md","raw":"---\ntitle: SVN、GIT数据迁移\ns: svn-git-transfer\ndate: 2015-01-14 16:45:00\ntags:\n  - Git\n---\n## SVN数据迁移\nsvn的管理使用的是Collabnet Subversion Edge。\n\n### 1.安装服务\n在目标机器上安装Collabnet Subversion Edge,简称CSE\n### 2.复制版本库\n将旧服务器上的repository全部复制到新服务器上\n### 3.导入数据\n在新服务器上打开CSE的管理后台[http://localhost:3343/csvn](http://localhost:3343/csvn)， 在“版本库”页面选择“发现版本库”，这样就把之前的版本库都导入进去了\n### 4.复制用户数据\n从原机器中拷贝{安装路径} \\data\\conf下的svn_auth_file文件到新机器\n### 5.导入用户数据\n修改新机器{安装路径}\\data\\csvn-production-hsqldb.script文件。复制原机器中类似\n\n`INSERT INTO USER VALUES(1,2,'admin user','admin@example.com',TRUE,'f52c7457507a292a11bf8d274d720ee4','Super Administrator','admin')`\n\n的语句到新服务器的对应文件。\n### 6.重置用户密码\n### 7.重启CSE服务即可\n<!-- more -->\n\n## GIT数据迁移\nGIT的数据迁移比较简单，GIT是采用mysmgit+copssh搭建的。\n### 1.安装环境\n新机器上搭建GIT环境，并建立每个需要备份的项目的空仓库（好像不新建也是可以的）\n### 2.GIT仓库转移\n选择一份最新版本的项目路径，执行\n\n`git remote set-url origin 资源库地址`\n\n### 3.GIT提交\n直接将当前项目提交即可，这样新的仓库里也是有之前所有的提交记录的\n","slug":"svn-git-transfer","published":1,"updated":"2019-03-26T13:47:04.884Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0q001ntof908mstsh1","content":"<h2 id=\"SVN数据迁移\"><a class=\"header-anchor\" href=\"#SVN数据迁移\">¶</a>SVN数据迁移</h2>\n<p>svn的管理使用的是Collabnet Subversion Edge。</p>\n<h3 id=\"1-安装服务\"><a class=\"header-anchor\" href=\"#1-安装服务\">¶</a>1.安装服务</h3>\n<p>在目标机器上安装Collabnet Subversion Edge,简称CSE</p>\n<h3 id=\"2-复制版本库\"><a class=\"header-anchor\" href=\"#2-复制版本库\">¶</a>2.复制版本库</h3>\n<p>将旧服务器上的repository全部复制到新服务器上</p>\n<h3 id=\"3-导入数据\"><a class=\"header-anchor\" href=\"#3-导入数据\">¶</a>3.导入数据</h3>\n<p>在新服务器上打开CSE的管理后台<a href=\"http://localhost:3343/csvn\">http://localhost:3343/csvn</a>， 在“版本库”页面选择“发现版本库”，这样就把之前的版本库都导入进去了</p>\n<h3 id=\"4-复制用户数据\"><a class=\"header-anchor\" href=\"#4-复制用户数据\">¶</a>4.复制用户数据</h3>\n<p>从原机器中拷贝{安装路径} \\data\\conf下的svn_auth_file文件到新机器</p>\n<h3 id=\"5-导入用户数据\"><a class=\"header-anchor\" href=\"#5-导入用户数据\">¶</a>5.导入用户数据</h3>\n<p>修改新机器{安装路径}\\data\\csvn-production-hsqldb.script文件。复制原机器中类似</p>\n<p><code>INSERT INTO USER VALUES(1,2,'admin user','admin@example.com',TRUE,'f52c7457507a292a11bf8d274d720ee4','Super Administrator','admin')</code></p>\n<p>的语句到新服务器的对应文件。</p>\n<h3 id=\"6-重置用户密码\"><a class=\"header-anchor\" href=\"#6-重置用户密码\">¶</a>6.重置用户密码</h3>\n<h3 id=\"7-重启CSE服务即可\"><a class=\"header-anchor\" href=\"#7-重启CSE服务即可\">¶</a>7.重启CSE服务即可</h3>\n<a id=\"more\"></a>\n<h2 id=\"GIT数据迁移\"><a class=\"header-anchor\" href=\"#GIT数据迁移\">¶</a>GIT数据迁移</h2>\n<p>GIT的数据迁移比较简单，GIT是采用mysmgit+copssh搭建的。</p>\n<h3 id=\"1-安装环境\"><a class=\"header-anchor\" href=\"#1-安装环境\">¶</a>1.安装环境</h3>\n<p>新机器上搭建GIT环境，并建立每个需要备份的项目的空仓库（好像不新建也是可以的）</p>\n<h3 id=\"2-GIT仓库转移\"><a class=\"header-anchor\" href=\"#2-GIT仓库转移\">¶</a>2.GIT仓库转移</h3>\n<p>选择一份最新版本的项目路径，执行</p>\n<p><code>git remote set-url origin 资源库地址</code></p>\n<h3 id=\"3-GIT提交\"><a class=\"header-anchor\" href=\"#3-GIT提交\">¶</a>3.GIT提交</h3>\n<p>直接将当前项目提交即可，这样新的仓库里也是有之前所有的提交记录的</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"SVN数据迁移\"><a class=\"header-anchor\" href=\"#SVN数据迁移\">¶</a>SVN数据迁移</h2>\n<p>svn的管理使用的是Collabnet Subversion Edge。</p>\n<h3 id=\"1-安装服务\"><a class=\"header-anchor\" href=\"#1-安装服务\">¶</a>1.安装服务</h3>\n<p>在目标机器上安装Collabnet Subversion Edge,简称CSE</p>\n<h3 id=\"2-复制版本库\"><a class=\"header-anchor\" href=\"#2-复制版本库\">¶</a>2.复制版本库</h3>\n<p>将旧服务器上的repository全部复制到新服务器上</p>\n<h3 id=\"3-导入数据\"><a class=\"header-anchor\" href=\"#3-导入数据\">¶</a>3.导入数据</h3>\n<p>在新服务器上打开CSE的管理后台<a href=\"http://localhost:3343/csvn\">http://localhost:3343/csvn</a>， 在“版本库”页面选择“发现版本库”，这样就把之前的版本库都导入进去了</p>\n<h3 id=\"4-复制用户数据\"><a class=\"header-anchor\" href=\"#4-复制用户数据\">¶</a>4.复制用户数据</h3>\n<p>从原机器中拷贝{安装路径} \\data\\conf下的svn_auth_file文件到新机器</p>\n<h3 id=\"5-导入用户数据\"><a class=\"header-anchor\" href=\"#5-导入用户数据\">¶</a>5.导入用户数据</h3>\n<p>修改新机器{安装路径}\\data\\csvn-production-hsqldb.script文件。复制原机器中类似</p>\n<p><code>INSERT INTO USER VALUES(1,2,'admin user','admin@example.com',TRUE,'f52c7457507a292a11bf8d274d720ee4','Super Administrator','admin')</code></p>\n<p>的语句到新服务器的对应文件。</p>\n<h3 id=\"6-重置用户密码\"><a class=\"header-anchor\" href=\"#6-重置用户密码\">¶</a>6.重置用户密码</h3>\n<h3 id=\"7-重启CSE服务即可\"><a class=\"header-anchor\" href=\"#7-重启CSE服务即可\">¶</a>7.重启CSE服务即可</h3>","more":"<h2 id=\"GIT数据迁移\"><a class=\"header-anchor\" href=\"#GIT数据迁移\">¶</a>GIT数据迁移</h2>\n<p>GIT的数据迁移比较简单，GIT是采用mysmgit+copssh搭建的。</p>\n<h3 id=\"1-安装环境\"><a class=\"header-anchor\" href=\"#1-安装环境\">¶</a>1.安装环境</h3>\n<p>新机器上搭建GIT环境，并建立每个需要备份的项目的空仓库（好像不新建也是可以的）</p>\n<h3 id=\"2-GIT仓库转移\"><a class=\"header-anchor\" href=\"#2-GIT仓库转移\">¶</a>2.GIT仓库转移</h3>\n<p>选择一份最新版本的项目路径，执行</p>\n<p><code>git remote set-url origin 资源库地址</code></p>\n<h3 id=\"3-GIT提交\"><a class=\"header-anchor\" href=\"#3-GIT提交\">¶</a>3.GIT提交</h3>\n<p>直接将当前项目提交即可，这样新的仓库里也是有之前所有的提交记录的</p>"},{"title":"vsftpd的安装配置","s":"vsftpd-config","date":"2016-02-05T03:58:00.000Z","seo":{"title":"vsftpd虚拟用户配置","description":"在Linux系统上安装vsftpd并配置vsftpd的虚拟用户，该用户需要使用密码登录FTP，但不能登录系统，同时在登录FTP后只显示指定目录，不能切换到其它目录。"},"_content":"> 参考自<a target=\"_blank\" href=\"http://www.cnblogs.com/whoamme/p/3494128.html\">http://www.cnblogs.com/whoamme/p/3494128.html</a>\n\n1. 安装相关工具包\n```bash\nyum -y install pam vsftpd db4 db4-utils\n```\n<!-- more -->\n2. 创建一个不能登录的用户，用作ftp服务的虚拟用户\n```bash\nuseradd -d /home/xxx -s /sbin/nologin vuser_ftp\n```\n`/home/xxx`为用户根目录，`/sbin/nologin`指定用户不能使用shell，该账号不能用于登录系统\n这里使用`vuser_ftp`作为虚拟用户的映射对象，在web服务器中可以使用`httpd`\n这个服务的用户来作为虚拟用的映射。比如`www apapche web`，没大明白~\n3. 创建一个记录ftp虚拟用户的用户名和密码文件，如`login.txt`\n第一行用户名，第二行密码，以此类推\n```bash\nvi /etc/vsftpd/login.txt\nuser1\npwd1\nuser2\npwd2\n```\n4. 使用db_load 命令生成虚拟用户认证文件\n```bash\ndb_load -T -t hash -f /etc/vsftpd/login.txt /etc/vsftpd/vsftpd_login.db\n```\n`vsftpd_login.db`文件是db_load命令生成的虚拟用户认证文件\n5. 备份vsftpd配置文件，再修改配置文件\n```bash\nvi /etc/vsftpd/vsftpd.conf\n\nanonymous_enable=NO\nlocal_enable=YES\nwrite_enable=YES\nlocal_umask=022\ndirmessage_enable=YES\nxferlog_enable=YES\nconnect_from_port_20=YES\nxferlog_file=/var/log/vsftpd.log\nxferlog_std_format=YES\nlisten=YES\nuserlist_enable=YES\ntcp_wrappers=YES\nmax_per_ip=5\nmax_clients=100\n\n#### 下面是关于虚拟用户的配置\n\nguest_enable=YES #打开用户虚拟\nguest_username=vuser_ftp #将所有虚拟用户映射成vuer_ftp这个本地用户\n#此用户是之前新建的用户\npam_service_name=ftp.vu #ftp用户的pam验证方式，默认是vsftpd，必须改掉。\nuser_config_dir=/etc/vsftpd/vsftpd_user_conf #这里放置每个虚拟用户的配置文件\n```\n6. 创建vsftpd.conf中提到的验证文件\n使用`rpm -ql vsftpd`这个命令查找验证模块的例文，找到如下一段\n```text\n/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam\n```\n将其拷贝到vsftpd.conf文件中配置的路径中并改变文件名\n```bash\ncp /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam /etc/pam.d/ftp.vu\n```\n前面配置中的`pam_service_name=ftp.vu中ftp.vu`使用的是相对路径，绝对路径是`/etc/pam.d/ftp.vu`\n\n上面这条命令就是把vsftpd程序自带的关于pam认证的模板文件拷贝到`pam.d`这个服务的工作目录，同时改变文件名为`ftp.vu`。\n`/etc/pam.d/`目录下已经有了一个`vsftpd.pam`文件，现在要做的是让vsftpd虚拟用户的这个功能用到的一个特殊的pam认证。还要修改下`ftp.vu`这个文件\n\n先来看下原文件的内容：\n```bash\nvi /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam\n\nauth required /lib/security/pam_userdb.so db=/etc/vsftpd/login\naccount required /lib/security/pam_userdb.so db=/etc/vsftpd/login\n```\n将两处的`db=/etc/vsftpd/login`修改成`db=/etc/vsftpd/vsftpd_login`，文件都是以.db结尾的，但此处不要填写.db。同时由于我们的系统是64位的，还需要将配置中间的`/lib/`改为`/lib64/`\n```bash\nvi /etc/pam.d/ftp.vu\n\nauth required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login\naccount required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login\n```\n7. 创建`vsftpd.conf`中提到的虚拟用户配置目录`user_config_dir=/etc/vsftpd/vsftpd_user_conf`，以及在这个目录下面创建每个用户的权限配置文件\n创建`/etc/vsftpd/vsftpd_user_conf`目录\n```bash\nmkdir /etc/vsftpd/vsftpd_user_conf\n```\n在`/etc/vsftpd/vsftpd_user_conf`目录下面分别创建之前在`login.txt`虚拟用户名和密码文件中提到的user1 user2 这两个虚拟用户的权限配置文件\n```bash\nvi /etc/vsftpd/vsftpd_user_conf/user1\n\nanon_world_readable_only=no #用户可以浏览和下载文件，不能设为yes，否则无法看到文件\nwrite_enable=yes #用户可以创建文件\nanon_upload_enable=yes #用户可以上传文件\nanon_mkdir_write_enable=yes #用户有创建和删除目录的权限\nanon_other_write_enable=yes #用户具有文件改名和删除文件的权限\nlocal_root=/home/xxx #指定这个虚拟FTP用户的家目录。这里的xxx是你网站的根目录\n```\n之后再创建user2的权限文件（略）\n8. OK！结束！重启vsftpd服务\n```bash\nservice vsftpd restart\n```\n","source":"_posts/vsftpd-config.md","raw":"---\ntitle: vsftpd的安装配置\ns: vsftpd-config\ndate: 2016-02-05 11:58:00\ntags:\n  - vsftpd\nseo:\n  title: vsftpd虚拟用户配置\n  description: 在Linux系统上安装vsftpd并配置vsftpd的虚拟用户，该用户需要使用密码登录FTP，但不能登录系统，同时在登录FTP后只显示指定目录，不能切换到其它目录。\n---\n> 参考自<a target=\"_blank\" href=\"http://www.cnblogs.com/whoamme/p/3494128.html\">http://www.cnblogs.com/whoamme/p/3494128.html</a>\n\n1. 安装相关工具包\n```bash\nyum -y install pam vsftpd db4 db4-utils\n```\n<!-- more -->\n2. 创建一个不能登录的用户，用作ftp服务的虚拟用户\n```bash\nuseradd -d /home/xxx -s /sbin/nologin vuser_ftp\n```\n`/home/xxx`为用户根目录，`/sbin/nologin`指定用户不能使用shell，该账号不能用于登录系统\n这里使用`vuser_ftp`作为虚拟用户的映射对象，在web服务器中可以使用`httpd`\n这个服务的用户来作为虚拟用的映射。比如`www apapche web`，没大明白~\n3. 创建一个记录ftp虚拟用户的用户名和密码文件，如`login.txt`\n第一行用户名，第二行密码，以此类推\n```bash\nvi /etc/vsftpd/login.txt\nuser1\npwd1\nuser2\npwd2\n```\n4. 使用db_load 命令生成虚拟用户认证文件\n```bash\ndb_load -T -t hash -f /etc/vsftpd/login.txt /etc/vsftpd/vsftpd_login.db\n```\n`vsftpd_login.db`文件是db_load命令生成的虚拟用户认证文件\n5. 备份vsftpd配置文件，再修改配置文件\n```bash\nvi /etc/vsftpd/vsftpd.conf\n\nanonymous_enable=NO\nlocal_enable=YES\nwrite_enable=YES\nlocal_umask=022\ndirmessage_enable=YES\nxferlog_enable=YES\nconnect_from_port_20=YES\nxferlog_file=/var/log/vsftpd.log\nxferlog_std_format=YES\nlisten=YES\nuserlist_enable=YES\ntcp_wrappers=YES\nmax_per_ip=5\nmax_clients=100\n\n#### 下面是关于虚拟用户的配置\n\nguest_enable=YES #打开用户虚拟\nguest_username=vuser_ftp #将所有虚拟用户映射成vuer_ftp这个本地用户\n#此用户是之前新建的用户\npam_service_name=ftp.vu #ftp用户的pam验证方式，默认是vsftpd，必须改掉。\nuser_config_dir=/etc/vsftpd/vsftpd_user_conf #这里放置每个虚拟用户的配置文件\n```\n6. 创建vsftpd.conf中提到的验证文件\n使用`rpm -ql vsftpd`这个命令查找验证模块的例文，找到如下一段\n```text\n/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam\n```\n将其拷贝到vsftpd.conf文件中配置的路径中并改变文件名\n```bash\ncp /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam /etc/pam.d/ftp.vu\n```\n前面配置中的`pam_service_name=ftp.vu中ftp.vu`使用的是相对路径，绝对路径是`/etc/pam.d/ftp.vu`\n\n上面这条命令就是把vsftpd程序自带的关于pam认证的模板文件拷贝到`pam.d`这个服务的工作目录，同时改变文件名为`ftp.vu`。\n`/etc/pam.d/`目录下已经有了一个`vsftpd.pam`文件，现在要做的是让vsftpd虚拟用户的这个功能用到的一个特殊的pam认证。还要修改下`ftp.vu`这个文件\n\n先来看下原文件的内容：\n```bash\nvi /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam\n\nauth required /lib/security/pam_userdb.so db=/etc/vsftpd/login\naccount required /lib/security/pam_userdb.so db=/etc/vsftpd/login\n```\n将两处的`db=/etc/vsftpd/login`修改成`db=/etc/vsftpd/vsftpd_login`，文件都是以.db结尾的，但此处不要填写.db。同时由于我们的系统是64位的，还需要将配置中间的`/lib/`改为`/lib64/`\n```bash\nvi /etc/pam.d/ftp.vu\n\nauth required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login\naccount required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login\n```\n7. 创建`vsftpd.conf`中提到的虚拟用户配置目录`user_config_dir=/etc/vsftpd/vsftpd_user_conf`，以及在这个目录下面创建每个用户的权限配置文件\n创建`/etc/vsftpd/vsftpd_user_conf`目录\n```bash\nmkdir /etc/vsftpd/vsftpd_user_conf\n```\n在`/etc/vsftpd/vsftpd_user_conf`目录下面分别创建之前在`login.txt`虚拟用户名和密码文件中提到的user1 user2 这两个虚拟用户的权限配置文件\n```bash\nvi /etc/vsftpd/vsftpd_user_conf/user1\n\nanon_world_readable_only=no #用户可以浏览和下载文件，不能设为yes，否则无法看到文件\nwrite_enable=yes #用户可以创建文件\nanon_upload_enable=yes #用户可以上传文件\nanon_mkdir_write_enable=yes #用户有创建和删除目录的权限\nanon_other_write_enable=yes #用户具有文件改名和删除文件的权限\nlocal_root=/home/xxx #指定这个虚拟FTP用户的家目录。这里的xxx是你网站的根目录\n```\n之后再创建user2的权限文件（略）\n8. OK！结束！重启vsftpd服务\n```bash\nservice vsftpd restart\n```\n","slug":"vsftpd-config","published":1,"updated":"2019-03-26T13:47:04.885Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0q001ptof9222hlw8c","content":"<blockquote>\n<p>参考自<a target=\"_blank\" href=\"http://www.cnblogs.com/whoamme/p/3494128.html\">http://www.cnblogs.com/whoamme/p/3494128.html</a></p>\n</blockquote>\n<ol>\n<li>安装相关工具包</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install pam vsftpd db4 db4-utils</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<ol start=\"2\">\n<li>创建一个不能登录的用户，用作ftp服务的虚拟用户</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -d /home/xxx -s /sbin/nologin vuser_ftp</span><br></pre></td></tr></table></figure>\n<p><code>/home/xxx</code>为用户根目录，<code>/sbin/nologin</code>指定用户不能使用shell，该账号不能用于登录系统<br>\n这里使用<code>vuser_ftp</code>作为虚拟用户的映射对象，在web服务器中可以使用<code>httpd</code><br>\n这个服务的用户来作为虚拟用的映射。比如<code>www apapche web</code>，没大明白~<br>\n3. 创建一个记录ftp虚拟用户的用户名和密码文件，如<code>login.txt</code><br>\n第一行用户名，第二行密码，以此类推</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/vsftpd/login.txt</span><br><span class=\"line\">user1</span><br><span class=\"line\">pwd1</span><br><span class=\"line\">user2</span><br><span class=\"line\">pwd2</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>使用db_load 命令生成虚拟用户认证文件</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db_load -T -t <span class=\"hljs-built_in\">hash</span> -f /etc/vsftpd/login.txt /etc/vsftpd/vsftpd_login.db</span><br></pre></td></tr></table></figure>\n<p><code>vsftpd_login.db</code>文件是db_load命令生成的虚拟用户认证文件<br>\n5. 备份vsftpd配置文件，再修改配置文件</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\"></span><br><span class=\"line\">anonymous_enable=NO</span><br><span class=\"line\">local_enable=YES</span><br><span class=\"line\">write_enable=YES</span><br><span class=\"line\">local_umask=022</span><br><span class=\"line\">dirmessage_enable=YES</span><br><span class=\"line\">xferlog_enable=YES</span><br><span class=\"line\">connect_from_port_20=YES</span><br><span class=\"line\">xferlog_file=/var/<span class=\"hljs-built_in\">log</span>/vsftpd.log</span><br><span class=\"line\">xferlog_std_format=YES</span><br><span class=\"line\">listen=YES</span><br><span class=\"line\">userlist_enable=YES</span><br><span class=\"line\">tcp_wrappers=YES</span><br><span class=\"line\">max_per_ip=5</span><br><span class=\"line\">max_clients=100</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">#### 下面是关于虚拟用户的配置</span></span><br><span class=\"line\"></span><br><span class=\"line\">guest_enable=YES <span class=\"hljs-comment\">#打开用户虚拟</span></span><br><span class=\"line\">guest_username=vuser_ftp <span class=\"hljs-comment\">#将所有虚拟用户映射成vuer_ftp这个本地用户</span></span><br><span class=\"line\"><span class=\"hljs-comment\">#此用户是之前新建的用户</span></span><br><span class=\"line\">pam_service_name=ftp.vu <span class=\"hljs-comment\">#ftp用户的pam验证方式，默认是vsftpd，必须改掉。</span></span><br><span class=\"line\">user_config_dir=/etc/vsftpd/vsftpd_user_conf <span class=\"hljs-comment\">#这里放置每个虚拟用户的配置文件</span></span><br></pre></td></tr></table></figure>\n<ol start=\"6\">\n<li>创建vsftpd.conf中提到的验证文件<br>\n使用<code>rpm -ql vsftpd</code>这个命令查找验证模块的例文，找到如下一段</li>\n</ol>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam</span><br></pre></td></tr></table></figure>\n<p>将其拷贝到vsftpd.conf文件中配置的路径中并改变文件名</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam /etc/pam.d/ftp.vu</span><br></pre></td></tr></table></figure>\n<p>前面配置中的<code>pam_service_name=ftp.vu中ftp.vu</code>使用的是相对路径，绝对路径是<code>/etc/pam.d/ftp.vu</code></p>\n<p>上面这条命令就是把vsftpd程序自带的关于pam认证的模板文件拷贝到<code>pam.d</code>这个服务的工作目录，同时改变文件名为<code>ftp.vu</code>。<br>\n<code>/etc/pam.d/</code>目录下已经有了一个<code>vsftpd.pam</code>文件，现在要做的是让vsftpd虚拟用户的这个功能用到的一个特殊的pam认证。还要修改下<code>ftp.vu</code>这个文件</p>\n<p>先来看下原文件的内容：</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam</span><br><span class=\"line\"></span><br><span class=\"line\">auth required /lib/security/pam_userdb.so db=/etc/vsftpd/login</span><br><span class=\"line\">account required /lib/security/pam_userdb.so db=/etc/vsftpd/login</span><br></pre></td></tr></table></figure>\n<p>将两处的<code>db=/etc/vsftpd/login</code>修改成<code>db=/etc/vsftpd/vsftpd_login</code>，文件都是以.db结尾的，但此处不要填写.db。同时由于我们的系统是64位的，还需要将配置中间的<code>/lib/</code>改为<code>/lib64/</code></p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/pam.d/ftp.vu</span><br><span class=\"line\"></span><br><span class=\"line\">auth required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login</span><br><span class=\"line\">account required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login</span><br></pre></td></tr></table></figure>\n<ol start=\"7\">\n<li>创建<code>vsftpd.conf</code>中提到的虚拟用户配置目录<code>user_config_dir=/etc/vsftpd/vsftpd_user_conf</code>，以及在这个目录下面创建每个用户的权限配置文件<br>\n创建<code>/etc/vsftpd/vsftpd_user_conf</code>目录</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /etc/vsftpd/vsftpd_user_conf</span><br></pre></td></tr></table></figure>\n<p>在<code>/etc/vsftpd/vsftpd_user_conf</code>目录下面分别创建之前在<code>login.txt</code>虚拟用户名和密码文件中提到的user1 user2 这两个虚拟用户的权限配置文件</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/vsftpd/vsftpd_user_conf/user1</span><br><span class=\"line\"></span><br><span class=\"line\">anon_world_readable_only=no <span class=\"hljs-comment\">#用户可以浏览和下载文件，不能设为yes，否则无法看到文件</span></span><br><span class=\"line\">write_enable=yes <span class=\"hljs-comment\">#用户可以创建文件</span></span><br><span class=\"line\">anon_upload_enable=yes <span class=\"hljs-comment\">#用户可以上传文件</span></span><br><span class=\"line\">anon_mkdir_write_enable=yes <span class=\"hljs-comment\">#用户有创建和删除目录的权限</span></span><br><span class=\"line\">anon_other_write_enable=yes <span class=\"hljs-comment\">#用户具有文件改名和删除文件的权限</span></span><br><span class=\"line\">local_root=/home/xxx <span class=\"hljs-comment\">#指定这个虚拟FTP用户的家目录。这里的xxx是你网站的根目录</span></span><br></pre></td></tr></table></figure>\n<p>之后再创建user2的权限文件（略）<br>\n8. OK！结束！重启vsftpd服务</p>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service vsftpd restart</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>参考自<a target=\"_blank\" href=\"http://www.cnblogs.com/whoamme/p/3494128.html\">http://www.cnblogs.com/whoamme/p/3494128.html</a></p>\n</blockquote>\n<ol>\n<li>安装相关工具包</li>\n</ol>\n<figure class=\"highlight bash hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install pam vsftpd db4 db4-utils</span><br></pre></td></tr></table></figure>","more":"<ol start=\"2\">\n<li>创建一个不能登录的用户，用作ftp服务的虚拟用户</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -d /home/xxx -s /sbin/nologin vuser_ftp</span><br></pre></td></tr></table></figure>\n<p><code>/home/xxx</code>为用户根目录，<code>/sbin/nologin</code>指定用户不能使用shell，该账号不能用于登录系统<br>\n这里使用<code>vuser_ftp</code>作为虚拟用户的映射对象，在web服务器中可以使用<code>httpd</code><br>\n这个服务的用户来作为虚拟用的映射。比如<code>www apapche web</code>，没大明白~<br>\n3. 创建一个记录ftp虚拟用户的用户名和密码文件，如<code>login.txt</code><br>\n第一行用户名，第二行密码，以此类推</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/vsftpd/login.txt</span><br><span class=\"line\">user1</span><br><span class=\"line\">pwd1</span><br><span class=\"line\">user2</span><br><span class=\"line\">pwd2</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>使用db_load 命令生成虚拟用户认证文件</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db_load -T -t <span class=\"built_in\">hash</span> -f /etc/vsftpd/login.txt /etc/vsftpd/vsftpd_login.db</span><br></pre></td></tr></table></figure>\n<p><code>vsftpd_login.db</code>文件是db_load命令生成的虚拟用户认证文件<br>\n5. 备份vsftpd配置文件，再修改配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\"></span><br><span class=\"line\">anonymous_enable=NO</span><br><span class=\"line\">local_enable=YES</span><br><span class=\"line\">write_enable=YES</span><br><span class=\"line\">local_umask=022</span><br><span class=\"line\">dirmessage_enable=YES</span><br><span class=\"line\">xferlog_enable=YES</span><br><span class=\"line\">connect_from_port_20=YES</span><br><span class=\"line\">xferlog_file=/var/<span class=\"built_in\">log</span>/vsftpd.log</span><br><span class=\"line\">xferlog_std_format=YES</span><br><span class=\"line\">listen=YES</span><br><span class=\"line\">userlist_enable=YES</span><br><span class=\"line\">tcp_wrappers=YES</span><br><span class=\"line\">max_per_ip=5</span><br><span class=\"line\">max_clients=100</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#### 下面是关于虚拟用户的配置</span></span><br><span class=\"line\"></span><br><span class=\"line\">guest_enable=YES <span class=\"comment\">#打开用户虚拟</span></span><br><span class=\"line\">guest_username=vuser_ftp <span class=\"comment\">#将所有虚拟用户映射成vuer_ftp这个本地用户</span></span><br><span class=\"line\"><span class=\"comment\">#此用户是之前新建的用户</span></span><br><span class=\"line\">pam_service_name=ftp.vu <span class=\"comment\">#ftp用户的pam验证方式，默认是vsftpd，必须改掉。</span></span><br><span class=\"line\">user_config_dir=/etc/vsftpd/vsftpd_user_conf <span class=\"comment\">#这里放置每个虚拟用户的配置文件</span></span><br></pre></td></tr></table></figure>\n<ol start=\"6\">\n<li>创建vsftpd.conf中提到的验证文件<br>\n使用<code>rpm -ql vsftpd</code>这个命令查找验证模块的例文，找到如下一段</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam</span><br></pre></td></tr></table></figure>\n<p>将其拷贝到vsftpd.conf文件中配置的路径中并改变文件名</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam /etc/pam.d/ftp.vu</span><br></pre></td></tr></table></figure>\n<p>前面配置中的<code>pam_service_name=ftp.vu中ftp.vu</code>使用的是相对路径，绝对路径是<code>/etc/pam.d/ftp.vu</code></p>\n<p>上面这条命令就是把vsftpd程序自带的关于pam认证的模板文件拷贝到<code>pam.d</code>这个服务的工作目录，同时改变文件名为<code>ftp.vu</code>。<br>\n<code>/etc/pam.d/</code>目录下已经有了一个<code>vsftpd.pam</code>文件，现在要做的是让vsftpd虚拟用户的这个功能用到的一个特殊的pam认证。还要修改下<code>ftp.vu</code>这个文件</p>\n<p>先来看下原文件的内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/share/doc/vsftpd-2.2.2/EXAMPLE/VIRTUAL_USERS/vsftpd.pam</span><br><span class=\"line\"></span><br><span class=\"line\">auth required /lib/security/pam_userdb.so db=/etc/vsftpd/login</span><br><span class=\"line\">account required /lib/security/pam_userdb.so db=/etc/vsftpd/login</span><br></pre></td></tr></table></figure>\n<p>将两处的<code>db=/etc/vsftpd/login</code>修改成<code>db=/etc/vsftpd/vsftpd_login</code>，文件都是以.db结尾的，但此处不要填写.db。同时由于我们的系统是64位的，还需要将配置中间的<code>/lib/</code>改为<code>/lib64/</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/pam.d/ftp.vu</span><br><span class=\"line\"></span><br><span class=\"line\">auth required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login</span><br><span class=\"line\">account required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login</span><br></pre></td></tr></table></figure>\n<ol start=\"7\">\n<li>创建<code>vsftpd.conf</code>中提到的虚拟用户配置目录<code>user_config_dir=/etc/vsftpd/vsftpd_user_conf</code>，以及在这个目录下面创建每个用户的权限配置文件<br>\n创建<code>/etc/vsftpd/vsftpd_user_conf</code>目录</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /etc/vsftpd/vsftpd_user_conf</span><br></pre></td></tr></table></figure>\n<p>在<code>/etc/vsftpd/vsftpd_user_conf</code>目录下面分别创建之前在<code>login.txt</code>虚拟用户名和密码文件中提到的user1 user2 这两个虚拟用户的权限配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/vsftpd/vsftpd_user_conf/user1</span><br><span class=\"line\"></span><br><span class=\"line\">anon_world_readable_only=no <span class=\"comment\">#用户可以浏览和下载文件，不能设为yes，否则无法看到文件</span></span><br><span class=\"line\">write_enable=yes <span class=\"comment\">#用户可以创建文件</span></span><br><span class=\"line\">anon_upload_enable=yes <span class=\"comment\">#用户可以上传文件</span></span><br><span class=\"line\">anon_mkdir_write_enable=yes <span class=\"comment\">#用户有创建和删除目录的权限</span></span><br><span class=\"line\">anon_other_write_enable=yes <span class=\"comment\">#用户具有文件改名和删除文件的权限</span></span><br><span class=\"line\">local_root=/home/xxx <span class=\"comment\">#指定这个虚拟FTP用户的家目录。这里的xxx是你网站的根目录</span></span><br></pre></td></tr></table></figure>\n<p>之后再创建user2的权限文件（略）<br>\n8. OK！结束！重启vsftpd服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service vsftpd restart</span><br></pre></td></tr></table></figure>"},{"title":"微信小程序开发填坑整理","s":"wechat-mina-note","date":"2020-02-21T05:52:00.000Z","thumbnail":"/images/wechat/mina.png","_content":"\n- `open-data`显示头像，希望加圆角，直接使用`border-radius`不生效，需要再加`overflow:hidden`，猜测为`open-data`下还有子节点，而图片在子节点上，必须在父节点上加`overflow:hidden`来隐藏超出部分\n- `picker`上设置`flex`一类的样式无法直接应用到子节点上，需要在`picker`内部再套一层带样式的`view`，原因同上。例如\n  ```html\n  <picker>\n    <view class=\"flex ai-center\">\n      <view class=\"child1\"></view>\n      <view class=\"child2\"></view>\n    </view>\n  </picker>\n  ```\n","source":"_posts/wechat-mina-note.md","raw":"---\ntitle: 微信小程序开发填坑整理\ns: wechat-mina-note\ndate: 2020-02-21 13:52:00\nthumbnail: /images/wechat/mina.png\ntags:\n  - wechat\n  - 小程序\n---\n\n- `open-data`显示头像，希望加圆角，直接使用`border-radius`不生效，需要再加`overflow:hidden`，猜测为`open-data`下还有子节点，而图片在子节点上，必须在父节点上加`overflow:hidden`来隐藏超出部分\n- `picker`上设置`flex`一类的样式无法直接应用到子节点上，需要在`picker`内部再套一层带样式的`view`，原因同上。例如\n  ```html\n  <picker>\n    <view class=\"flex ai-center\">\n      <view class=\"child1\"></view>\n      <view class=\"child2\"></view>\n    </view>\n  </picker>\n  ```\n","slug":"wechat-mina-note","published":1,"updated":"2020-02-22T16:18:08.968Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox0r001rtof9lhmicqgd","content":"<ul>\n<li><code>open-data</code>显示头像，希望加圆角，直接使用<code>border-radius</code>不生效，需要再加<code>overflow:hidden</code>，猜测为<code>open-data</code>下还有子节点，而图片在子节点上，必须在父节点上加<code>overflow:hidden</code>来隐藏超出部分</li>\n<li><code>picker</code>上设置<code>flex</code>一类的样式无法直接应用到子节点上，需要在<code>picker</code>内部再套一层带样式的<code>view</code>，原因同上。例如<figure class=\"highlight html hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">picker</span>&gt;</span></span><br><span class=\"line\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">view</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"flex ai-center\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">view</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"child1\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">view</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"child2\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">picker</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li><code>open-data</code>显示头像，希望加圆角，直接使用<code>border-radius</code>不生效，需要再加<code>overflow:hidden</code>，猜测为<code>open-data</code>下还有子节点，而图片在子节点上，必须在父节点上加<code>overflow:hidden</code>来隐藏超出部分</li>\n<li><code>picker</code>上设置<code>flex</code>一类的样式无法直接应用到子节点上，需要在<code>picker</code>内部再套一层带样式的<code>view</code>，原因同上。例如<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">picker</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"flex ai-center\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"child1\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"child2\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">picker</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n"},{"title":"记录在开发electron-ssr过程中遇到的问题","s":"develop-electron-ssr","date":"2018-01-22T07:54:00.000Z","thumbnail":"/images/electron/ssr.png","keywords":"electron,shadowsocks,shadowsocksr,electron-ssr,shadowsocksr客户端","_content":"\n首先是项目介绍，其实这个项目就是给`shadowsocksr-python`项目加一个GUI壳，所以它的功能就是为了FQ。[GitHub地址在这](https://github.com/erguotou520/electron-ssr)\n\n其次，本文这里只记录这此在2017年底开始的重构经历，因为之前的代码写得实在比较乱（我一开始只是打算练习用的。。。）。OK，话不多说，下面进入正题。\n\n## 脚手架\n\n我们在开发一个完整的功能的时候往往不是从零开始做（因为那太费时间和经历了，还得自己维护项目框架），这里我是从[electron-vue](https://github.com/SimulatedGREG/electron-vue)项目初始化而来的。为什么用这个框架？跨平台用`electron`，前端开发用`vue`配合`webpack`，所以就选择了这个框架咯。\n<!-- more -->\n\n## 开发前的约定\n\n之前其它分支的代码乱就是因为在开发之前没有做一个好的规划，然后就是哪用到什么就直接写，不方便后期维护和代码阅读。这次在开发之前做了几个简单的约定：\n\n- `ipc`通讯的`channel`要约定清楚，并且用常量定义，详见[https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md](https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md)\n- 主进程代码在`src/main`目录维护，渲染进程代码在`src/renderer`目录维护，两者通用代码在`src/shared`目录维护，第三方库在`src/lib`目录维护\n- 主进程和渲染进程都使用数据驱动开发的方式开发，渲染进程使用`vue`开发，主进程使用`rxjs`开发，2个进程间使用`ipc`进行数据变更通知和更新\n- 主进程和渲染进程代码统一使用ES6语法编写\n\n## 项目目录结构\n\n有了开发约定好就开始撸码，有些代码是从之前的分支中复制过来稍作改变便可，而大部分则是全新编写。`src`目录的大致结构如下：\n\n```text\nsrc\n├─lib\n│ ├─proxy_conf_helper     # mac os上用于设置系统代理模式的helper\n│ └─sysproxy.exe          # windows上用于设置系统代理模式的helper\n├─main                    # main进程\n│ ├─bootstrap.js          # 项目启动，初始化操作\n│ ├─client.js             # shadowsocksr-python命令执行和终止\n│ ├─data.js               # main进程的中央数据文件\n│ ├─index.dev.js          # 开发环境的入口文件\n│ ├─index.js              # 入口文件\n│ ├─ipc.js                # 负责ipc通讯\n│ ├─logger.js             # 日志\n│ ├─pac.js                # 负责pac文件下载和提供pac地址\n│ ├─proxy.js              # 设置系统代理模式\n│ ├─tray-handler.js       # 任务栏操作方法\n│ ├─tray.js               # 任务栏\n│ └─window.js             # 页面窗口\n├─renderer                # renderer进程\n│ ├─assets                # 页面资源\n│ ├─components            # vue组件\n│ ├─qrcode                # 二维码识别\n│ ├─store                 # renderer进程的中央数据\n│ ├─views                 # 页面\n│ ├─ipc.js                # 负责ipc通讯\n│ ├─constants.js          # 常量定义\n│ └─main.js               # 前端入口文件\n└─shared                  # main和renderer共享文件夹\n  ├─config.js             # 应用配置相关\n  ├─env.js                # 应用环境相关\n  ├─events.js             # ipc交互事件定义集合\n  ├─ssr.js                # SSR配置对象\n  └─utils.js              # 工具集\n```\n\n## renderer进程开发技术点\n\n- 页面开发中用到了`vue` `vuex` 和`iview`组件库，其中`iview`稍微做了些修改。\n- `vuex`作为前端数据中心，维护了很多页面数据，页面的修改都是维护`vuex`的`state`。\n- 鉴于页面内容不是特别多就没有使用`vue-router`，而是使用简单的`component`配置`is`属性做页面切换。\n- 整个页面开发中最饶人的是我把扁平的`configs`数组变成了按分组显示的树形结构，导致整个交互变得极其复杂，最后在绕来绕去饶了好几次后还是使用数据驱动开发的思维解决。\n\n## main进程开发技术点\n\n- 由于main进程使用`rxjs`作为数据维护中心，而我又是第一次使用`rxjs`，所以在初期就遇到了不少问题。比如多处文件可能会触发（ipc和tray都会触发）数据变更，应该怎么去编写和改变Observable数据，比如支持多播以及和renderer进程保持同步。最后还是在`data.js`中统一初始化和改变数据（对外暴露可改变数据的方法）并提供多播能力，其它文件在使用时直接`subscribe`关注，在变更时使用`data.js`暴露的入口进行数据变更。这样在开发时数据的维护会更方便，而且可以保持每个文件尽量只关注自己的业务。\n- main进程最复杂的应该是设置系统代理功能。由于每个系统的调用方法不一致，所以要收集所有系统的实现方式，可以参考[https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md](https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md)的收集结果（Linux系统中非gnome桌面如何实现还没有找到方法，如果你知道，欢迎提issue告知）。\n\n  理论知道了只是第一步，实现是第二步。开开心心地用`child_process.exec`执行命令，开发时一切正常，happy。然而到了打包的时候懵逼了，没有可执行文件了。OK，我放到`static`目录下，还是不行，因为这些文件还是在`asar`压缩包里，没法复制和执行。最后在`electron-builder`中找到了`extraFiles`字段，就是用来将文件复制到项目根目录下的（如何找到项目根目录也是个坑，得使用app.getPaht('exe')来实现`）。\n\n  目前还有一个问题也是mac上实现最大的问题。mac上使用`networksetup`设置需要`sudo`权限，而如何实现只弹框输入一次管理员密码就可以一直修改系统代理模式才是最大的难题。一开始使用`networksetup`命令实现时每次切换都需要输入密码，很烦。后来参考`shadowsocks-NG`项目，直接将它生成的`proxy_conf_helper`文件复制到项目里使用，~~但目前在打包后还是会闪退，目前仍在查找实现方案。~~然后使用[sudo-prompt](https://www.npmjs.com/package/sudo-prompt)模块执行`sudo`命令将其拷贝到指定位置并赋权。\n\n  在打包到`0.2.0-beta-1`版本之前一直使用正常，忽然有人跟我说`10.9.5`版本的mac闪退，远程调试后才发现原来`shadowsocks-NG`的`proxy_conf_helper`不支持`10.11`以下版本，尴尬。目前最简单的方法就是检查mac版本，然后低于`10.11`版本的直接屏蔽切换代理的功能，当然有没有更优雅的实现方式还是有待继续思考的。\n- 还有个有意思的问题是在`0.2.0-alpha-4`版本时[提的issue](https://github.com/erguotou520/electron-ssr/issues/61)。后来我重新查看了下NodeJs文档，发现确实用`execFile`更佳，因为它不是在shell中执行，避免了命令被特殊字符（比如`&|\"'`等等）干扰的问题，这个问题倒是也让我学到了些开发经验。\n- 一开始在开发PAC功能时考虑的是这个版本先按简单的来，满足最基本的pac功能即可，而且自己一般都是用chrome插件来选择性的FQ，所以开发完也没太测试。然后打版发布后有用户提BUG说PAC功能用不了，然后自己本地试了下啊，确实用不了（之前蜜汁自信了）。然后找原因啊，还求助了别人啊，愣是没发现哪里的错。一个偶然的情况下重新看到PAC原理才想起来我返回的pac内容里面根本没有指定`socks`地址和端口啊！后来想了想，因为ssr是要用一些特殊字段做标记然后使用运行时的变量来替换特殊字段的（简单的说就是`pac.replace(/__PROXY__/g, 'socks5 127.0.0.1:1080')`），这才明白错在哪，原来真相竟然就是这么简单，害我一开始还在那研究http服务器的问题。\n\n## 其它的坑\n\n- 配置向下兼容。如果再后期维护时添加了新的系统配置项，需要在系统初始化时复制到应用配置对象中并保存。\n- 异常处理。错误文件？端口占用？\n- 在更新订阅服务器时，同时使用`window.fetch`和`electron.net.request`来请求数据，并使用`Promise.race`来选择最快完成的数据。\n- mac系统打包后默认不能复制粘贴，需要添加`Menu`菜单和常见的一些菜单项来修复该问题。\n\n## 最后\n\n如果你喜欢这个项目，欢迎来star。如果你觉得这个项目对你有帮助，[欢迎来打赏](https://github.com/erguotou520/donate)。\n","source":"_posts/develop-electron-ssr.md","raw":"---\ntitle: 记录在开发electron-ssr过程中遇到的问题\ns: develop-electron-ssr\ndate: 2018-01-22 15:54:00\nthumbnail: /images/electron/ssr.png\ntags:\n  - electron-ssr\nkeywords:\n  electron,shadowsocks,shadowsocksr,electron-ssr,shadowsocksr客户端\n---\n\n首先是项目介绍，其实这个项目就是给`shadowsocksr-python`项目加一个GUI壳，所以它的功能就是为了FQ。[GitHub地址在这](https://github.com/erguotou520/electron-ssr)\n\n其次，本文这里只记录这此在2017年底开始的重构经历，因为之前的代码写得实在比较乱（我一开始只是打算练习用的。。。）。OK，话不多说，下面进入正题。\n\n## 脚手架\n\n我们在开发一个完整的功能的时候往往不是从零开始做（因为那太费时间和经历了，还得自己维护项目框架），这里我是从[electron-vue](https://github.com/SimulatedGREG/electron-vue)项目初始化而来的。为什么用这个框架？跨平台用`electron`，前端开发用`vue`配合`webpack`，所以就选择了这个框架咯。\n<!-- more -->\n\n## 开发前的约定\n\n之前其它分支的代码乱就是因为在开发之前没有做一个好的规划，然后就是哪用到什么就直接写，不方便后期维护和代码阅读。这次在开发之前做了几个简单的约定：\n\n- `ipc`通讯的`channel`要约定清楚，并且用常量定义，详见[https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md](https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md)\n- 主进程代码在`src/main`目录维护，渲染进程代码在`src/renderer`目录维护，两者通用代码在`src/shared`目录维护，第三方库在`src/lib`目录维护\n- 主进程和渲染进程都使用数据驱动开发的方式开发，渲染进程使用`vue`开发，主进程使用`rxjs`开发，2个进程间使用`ipc`进行数据变更通知和更新\n- 主进程和渲染进程代码统一使用ES6语法编写\n\n## 项目目录结构\n\n有了开发约定好就开始撸码，有些代码是从之前的分支中复制过来稍作改变便可，而大部分则是全新编写。`src`目录的大致结构如下：\n\n```text\nsrc\n├─lib\n│ ├─proxy_conf_helper     # mac os上用于设置系统代理模式的helper\n│ └─sysproxy.exe          # windows上用于设置系统代理模式的helper\n├─main                    # main进程\n│ ├─bootstrap.js          # 项目启动，初始化操作\n│ ├─client.js             # shadowsocksr-python命令执行和终止\n│ ├─data.js               # main进程的中央数据文件\n│ ├─index.dev.js          # 开发环境的入口文件\n│ ├─index.js              # 入口文件\n│ ├─ipc.js                # 负责ipc通讯\n│ ├─logger.js             # 日志\n│ ├─pac.js                # 负责pac文件下载和提供pac地址\n│ ├─proxy.js              # 设置系统代理模式\n│ ├─tray-handler.js       # 任务栏操作方法\n│ ├─tray.js               # 任务栏\n│ └─window.js             # 页面窗口\n├─renderer                # renderer进程\n│ ├─assets                # 页面资源\n│ ├─components            # vue组件\n│ ├─qrcode                # 二维码识别\n│ ├─store                 # renderer进程的中央数据\n│ ├─views                 # 页面\n│ ├─ipc.js                # 负责ipc通讯\n│ ├─constants.js          # 常量定义\n│ └─main.js               # 前端入口文件\n└─shared                  # main和renderer共享文件夹\n  ├─config.js             # 应用配置相关\n  ├─env.js                # 应用环境相关\n  ├─events.js             # ipc交互事件定义集合\n  ├─ssr.js                # SSR配置对象\n  └─utils.js              # 工具集\n```\n\n## renderer进程开发技术点\n\n- 页面开发中用到了`vue` `vuex` 和`iview`组件库，其中`iview`稍微做了些修改。\n- `vuex`作为前端数据中心，维护了很多页面数据，页面的修改都是维护`vuex`的`state`。\n- 鉴于页面内容不是特别多就没有使用`vue-router`，而是使用简单的`component`配置`is`属性做页面切换。\n- 整个页面开发中最饶人的是我把扁平的`configs`数组变成了按分组显示的树形结构，导致整个交互变得极其复杂，最后在绕来绕去饶了好几次后还是使用数据驱动开发的思维解决。\n\n## main进程开发技术点\n\n- 由于main进程使用`rxjs`作为数据维护中心，而我又是第一次使用`rxjs`，所以在初期就遇到了不少问题。比如多处文件可能会触发（ipc和tray都会触发）数据变更，应该怎么去编写和改变Observable数据，比如支持多播以及和renderer进程保持同步。最后还是在`data.js`中统一初始化和改变数据（对外暴露可改变数据的方法）并提供多播能力，其它文件在使用时直接`subscribe`关注，在变更时使用`data.js`暴露的入口进行数据变更。这样在开发时数据的维护会更方便，而且可以保持每个文件尽量只关注自己的业务。\n- main进程最复杂的应该是设置系统代理功能。由于每个系统的调用方法不一致，所以要收集所有系统的实现方式，可以参考[https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md](https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md)的收集结果（Linux系统中非gnome桌面如何实现还没有找到方法，如果你知道，欢迎提issue告知）。\n\n  理论知道了只是第一步，实现是第二步。开开心心地用`child_process.exec`执行命令，开发时一切正常，happy。然而到了打包的时候懵逼了，没有可执行文件了。OK，我放到`static`目录下，还是不行，因为这些文件还是在`asar`压缩包里，没法复制和执行。最后在`electron-builder`中找到了`extraFiles`字段，就是用来将文件复制到项目根目录下的（如何找到项目根目录也是个坑，得使用app.getPaht('exe')来实现`）。\n\n  目前还有一个问题也是mac上实现最大的问题。mac上使用`networksetup`设置需要`sudo`权限，而如何实现只弹框输入一次管理员密码就可以一直修改系统代理模式才是最大的难题。一开始使用`networksetup`命令实现时每次切换都需要输入密码，很烦。后来参考`shadowsocks-NG`项目，直接将它生成的`proxy_conf_helper`文件复制到项目里使用，~~但目前在打包后还是会闪退，目前仍在查找实现方案。~~然后使用[sudo-prompt](https://www.npmjs.com/package/sudo-prompt)模块执行`sudo`命令将其拷贝到指定位置并赋权。\n\n  在打包到`0.2.0-beta-1`版本之前一直使用正常，忽然有人跟我说`10.9.5`版本的mac闪退，远程调试后才发现原来`shadowsocks-NG`的`proxy_conf_helper`不支持`10.11`以下版本，尴尬。目前最简单的方法就是检查mac版本，然后低于`10.11`版本的直接屏蔽切换代理的功能，当然有没有更优雅的实现方式还是有待继续思考的。\n- 还有个有意思的问题是在`0.2.0-alpha-4`版本时[提的issue](https://github.com/erguotou520/electron-ssr/issues/61)。后来我重新查看了下NodeJs文档，发现确实用`execFile`更佳，因为它不是在shell中执行，避免了命令被特殊字符（比如`&|\"'`等等）干扰的问题，这个问题倒是也让我学到了些开发经验。\n- 一开始在开发PAC功能时考虑的是这个版本先按简单的来，满足最基本的pac功能即可，而且自己一般都是用chrome插件来选择性的FQ，所以开发完也没太测试。然后打版发布后有用户提BUG说PAC功能用不了，然后自己本地试了下啊，确实用不了（之前蜜汁自信了）。然后找原因啊，还求助了别人啊，愣是没发现哪里的错。一个偶然的情况下重新看到PAC原理才想起来我返回的pac内容里面根本没有指定`socks`地址和端口啊！后来想了想，因为ssr是要用一些特殊字段做标记然后使用运行时的变量来替换特殊字段的（简单的说就是`pac.replace(/__PROXY__/g, 'socks5 127.0.0.1:1080')`），这才明白错在哪，原来真相竟然就是这么简单，害我一开始还在那研究http服务器的问题。\n\n## 其它的坑\n\n- 配置向下兼容。如果再后期维护时添加了新的系统配置项，需要在系统初始化时复制到应用配置对象中并保存。\n- 异常处理。错误文件？端口占用？\n- 在更新订阅服务器时，同时使用`window.fetch`和`electron.net.request`来请求数据，并使用`Promise.race`来选择最快完成的数据。\n- mac系统打包后默认不能复制粘贴，需要添加`Menu`菜单和常见的一些菜单项来修复该问题。\n\n## 最后\n\n如果你喜欢这个项目，欢迎来star。如果你觉得这个项目对你有帮助，[欢迎来打赏](https://github.com/erguotou520/donate)。\n","slug":"develop-electron-ssr","published":1,"updated":"2019-03-26T13:47:04.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox1i003ltof972i35azq","content":"<p>首先是项目介绍，其实这个项目就是给<code>shadowsocksr-python</code>项目加一个GUI壳，所以它的功能就是为了FQ。<a href=\"https://github.com/erguotou520/electron-ssr\">GitHub地址在这</a></p>\n<p>其次，本文这里只记录这此在2017年底开始的重构经历，因为之前的代码写得实在比较乱（我一开始只是打算练习用的。。。）。OK，话不多说，下面进入正题。</p>\n<h2 id=\"脚手架\"><a class=\"header-anchor\" href=\"#脚手架\">¶</a>脚手架</h2>\n<p>我们在开发一个完整的功能的时候往往不是从零开始做（因为那太费时间和经历了，还得自己维护项目框架），这里我是从<a href=\"https://github.com/SimulatedGREG/electron-vue\">electron-vue</a>项目初始化而来的。为什么用这个框架？跨平台用<code>electron</code>，前端开发用<code>vue</code>配合<code>webpack</code>，所以就选择了这个框架咯。</p>\n<a id=\"more\"></a>\n<h2 id=\"开发前的约定\"><a class=\"header-anchor\" href=\"#开发前的约定\">¶</a>开发前的约定</h2>\n<p>之前其它分支的代码乱就是因为在开发之前没有做一个好的规划，然后就是哪用到什么就直接写，不方便后期维护和代码阅读。这次在开发之前做了几个简单的约定：</p>\n<ul>\n<li><code>ipc</code>通讯的<code>channel</code>要约定清楚，并且用常量定义，详见<a href=\"https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md\">https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md</a></li>\n<li>主进程代码在<code>src/main</code>目录维护，渲染进程代码在<code>src/renderer</code>目录维护，两者通用代码在<code>src/shared</code>目录维护，第三方库在<code>src/lib</code>目录维护</li>\n<li>主进程和渲染进程都使用数据驱动开发的方式开发，渲染进程使用<code>vue</code>开发，主进程使用<code>rxjs</code>开发，2个进程间使用<code>ipc</code>进行数据变更通知和更新</li>\n<li>主进程和渲染进程代码统一使用ES6语法编写</li>\n</ul>\n<h2 id=\"项目目录结构\"><a class=\"header-anchor\" href=\"#项目目录结构\">¶</a>项目目录结构</h2>\n<p>有了开发约定好就开始撸码，有些代码是从之前的分支中复制过来稍作改变便可，而大部分则是全新编写。<code>src</code>目录的大致结构如下：</p>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src</span><br><span class=\"line\">├─lib</span><br><span class=\"line\">│ ├─proxy_conf_helper     # mac os上用于设置系统代理模式的helper</span><br><span class=\"line\">│ └─sysproxy.exe          # windows上用于设置系统代理模式的helper</span><br><span class=\"line\">├─main                    # main进程</span><br><span class=\"line\">│ ├─bootstrap.js          # 项目启动，初始化操作</span><br><span class=\"line\">│ ├─client.js             # shadowsocksr-python命令执行和终止</span><br><span class=\"line\">│ ├─data.js               # main进程的中央数据文件</span><br><span class=\"line\">│ ├─index.dev.js          # 开发环境的入口文件</span><br><span class=\"line\">│ ├─index.js              # 入口文件</span><br><span class=\"line\">│ ├─ipc.js                # 负责ipc通讯</span><br><span class=\"line\">│ ├─logger.js             # 日志</span><br><span class=\"line\">│ ├─pac.js                # 负责pac文件下载和提供pac地址</span><br><span class=\"line\">│ ├─proxy.js              # 设置系统代理模式</span><br><span class=\"line\">│ ├─tray-handler.js       # 任务栏操作方法</span><br><span class=\"line\">│ ├─tray.js               # 任务栏</span><br><span class=\"line\">│ └─window.js             # 页面窗口</span><br><span class=\"line\">├─renderer                # renderer进程</span><br><span class=\"line\">│ ├─assets                # 页面资源</span><br><span class=\"line\">│ ├─components            # vue组件</span><br><span class=\"line\">│ ├─qrcode                # 二维码识别</span><br><span class=\"line\">│ ├─store                 # renderer进程的中央数据</span><br><span class=\"line\">│ ├─views                 # 页面</span><br><span class=\"line\">│ ├─ipc.js                # 负责ipc通讯</span><br><span class=\"line\">│ ├─constants.js          # 常量定义</span><br><span class=\"line\">│ └─main.js               # 前端入口文件</span><br><span class=\"line\">└─shared                  # main和renderer共享文件夹</span><br><span class=\"line\">  ├─config.js             # 应用配置相关</span><br><span class=\"line\">  ├─env.js                # 应用环境相关</span><br><span class=\"line\">  ├─events.js             # ipc交互事件定义集合</span><br><span class=\"line\">  ├─ssr.js                # SSR配置对象</span><br><span class=\"line\">  └─utils.js              # 工具集</span><br></pre></td></tr></table></figure>\n<h2 id=\"renderer进程开发技术点\"><a class=\"header-anchor\" href=\"#renderer进程开发技术点\">¶</a>renderer进程开发技术点</h2>\n<ul>\n<li>页面开发中用到了<code>vue</code> <code>vuex</code> 和<code>iview</code>组件库，其中<code>iview</code>稍微做了些修改。</li>\n<li><code>vuex</code>作为前端数据中心，维护了很多页面数据，页面的修改都是维护<code>vuex</code>的<code>state</code>。</li>\n<li>鉴于页面内容不是特别多就没有使用<code>vue-router</code>，而是使用简单的<code>component</code>配置<code>is</code>属性做页面切换。</li>\n<li>整个页面开发中最饶人的是我把扁平的<code>configs</code>数组变成了按分组显示的树形结构，导致整个交互变得极其复杂，最后在绕来绕去饶了好几次后还是使用数据驱动开发的思维解决。</li>\n</ul>\n<h2 id=\"main进程开发技术点\"><a class=\"header-anchor\" href=\"#main进程开发技术点\">¶</a>main进程开发技术点</h2>\n<ul>\n<li>\n<p>由于main进程使用<code>rxjs</code>作为数据维护中心，而我又是第一次使用<code>rxjs</code>，所以在初期就遇到了不少问题。比如多处文件可能会触发（ipc和tray都会触发）数据变更，应该怎么去编写和改变Observable数据，比如支持多播以及和renderer进程保持同步。最后还是在<code>data.js</code>中统一初始化和改变数据（对外暴露可改变数据的方法）并提供多播能力，其它文件在使用时直接<code>subscribe</code>关注，在变更时使用<code>data.js</code>暴露的入口进行数据变更。这样在开发时数据的维护会更方便，而且可以保持每个文件尽量只关注自己的业务。</p>\n</li>\n<li>\n<p>main进程最复杂的应该是设置系统代理功能。由于每个系统的调用方法不一致，所以要收集所有系统的实现方式，可以参考<a href=\"https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md\">https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md</a>的收集结果（Linux系统中非gnome桌面如何实现还没有找到方法，如果你知道，欢迎提issue告知）。</p>\n<p>理论知道了只是第一步，实现是第二步。开开心心地用<code>child_process.exec</code>执行命令，开发时一切正常，happy。然而到了打包的时候懵逼了，没有可执行文件了。OK，我放到<code>static</code>目录下，还是不行，因为这些文件还是在<code>asar</code>压缩包里，没法复制和执行。最后在<code>electron-builder</code>中找到了<code>extraFiles</code>字段，就是用来将文件复制到项目根目录下的（如何找到项目根目录也是个坑，得使用app.getPaht(‘exe’)来实现`）。</p>\n<p>目前还有一个问题也是mac上实现最大的问题。mac上使用<code>networksetup</code>设置需要<code>sudo</code>权限，而如何实现只弹框输入一次管理员密码就可以一直修改系统代理模式才是最大的难题。一开始使用<code>networksetup</code>命令实现时每次切换都需要输入密码，很烦。后来参考<code>shadowsocks-NG</code>项目，直接将它生成的<code>proxy_conf_helper</code>文件复制到项目里使用，~~但目前在打包后还是会闪退，目前仍在查找实现方案。~~然后使用<a href=\"https://www.npmjs.com/package/sudo-prompt\">sudo-prompt</a>模块执行<code>sudo</code>命令将其拷贝到指定位置并赋权。</p>\n<p>在打包到<code>0.2.0-beta-1</code>版本之前一直使用正常，忽然有人跟我说<code>10.9.5</code>版本的mac闪退，远程调试后才发现原来<code>shadowsocks-NG</code>的<code>proxy_conf_helper</code>不支持<code>10.11</code>以下版本，尴尬。目前最简单的方法就是检查mac版本，然后低于<code>10.11</code>版本的直接屏蔽切换代理的功能，当然有没有更优雅的实现方式还是有待继续思考的。</p>\n</li>\n<li>\n<p>还有个有意思的问题是在<code>0.2.0-alpha-4</code>版本时<a href=\"https://github.com/erguotou520/electron-ssr/issues/61\">提的issue</a>。后来我重新查看了下NodeJs文档，发现确实用<code>execFile</code>更佳，因为它不是在shell中执行，避免了命令被特殊字符（比如<code>&amp;|&quot;'</code>等等）干扰的问题，这个问题倒是也让我学到了些开发经验。</p>\n</li>\n<li>\n<p>一开始在开发PAC功能时考虑的是这个版本先按简单的来，满足最基本的pac功能即可，而且自己一般都是用chrome插件来选择性的FQ，所以开发完也没太测试。然后打版发布后有用户提BUG说PAC功能用不了，然后自己本地试了下啊，确实用不了（之前蜜汁自信了）。然后找原因啊，还求助了别人啊，愣是没发现哪里的错。一个偶然的情况下重新看到PAC原理才想起来我返回的pac内容里面根本没有指定<code>socks</code>地址和端口啊！后来想了想，因为ssr是要用一些特殊字段做标记然后使用运行时的变量来替换特殊字段的（简单的说就是<code>pac.replace(/__PROXY__/g, 'socks5 127.0.0.1:1080')</code>），这才明白错在哪，原来真相竟然就是这么简单，害我一开始还在那研究http服务器的问题。</p>\n</li>\n</ul>\n<h2 id=\"其它的坑\"><a class=\"header-anchor\" href=\"#其它的坑\">¶</a>其它的坑</h2>\n<ul>\n<li>配置向下兼容。如果再后期维护时添加了新的系统配置项，需要在系统初始化时复制到应用配置对象中并保存。</li>\n<li>异常处理。错误文件？端口占用？</li>\n<li>在更新订阅服务器时，同时使用<code>window.fetch</code>和<code>electron.net.request</code>来请求数据，并使用<code>Promise.race</code>来选择最快完成的数据。</li>\n<li>mac系统打包后默认不能复制粘贴，需要添加<code>Menu</code>菜单和常见的一些菜单项来修复该问题。</li>\n</ul>\n<h2 id=\"最后\"><a class=\"header-anchor\" href=\"#最后\">¶</a>最后</h2>\n<p>如果你喜欢这个项目，欢迎来star。如果你觉得这个项目对你有帮助，<a href=\"https://github.com/erguotou520/donate\">欢迎来打赏</a>。</p>\n","site":{"data":{}},"excerpt":"<p>首先是项目介绍，其实这个项目就是给<code>shadowsocksr-python</code>项目加一个GUI壳，所以它的功能就是为了FQ。<a href=\"https://github.com/erguotou520/electron-ssr\">GitHub地址在这</a></p>\n<p>其次，本文这里只记录这此在2017年底开始的重构经历，因为之前的代码写得实在比较乱（我一开始只是打算练习用的。。。）。OK，话不多说，下面进入正题。</p>\n<h2 id=\"脚手架\"><a class=\"header-anchor\" href=\"#脚手架\">¶</a>脚手架</h2>\n<p>我们在开发一个完整的功能的时候往往不是从零开始做（因为那太费时间和经历了，还得自己维护项目框架），这里我是从<a href=\"https://github.com/SimulatedGREG/electron-vue\">electron-vue</a>项目初始化而来的。为什么用这个框架？跨平台用<code>electron</code>，前端开发用<code>vue</code>配合<code>webpack</code>，所以就选择了这个框架咯。</p>","more":"<h2 id=\"开发前的约定\"><a class=\"header-anchor\" href=\"#开发前的约定\">¶</a>开发前的约定</h2>\n<p>之前其它分支的代码乱就是因为在开发之前没有做一个好的规划，然后就是哪用到什么就直接写，不方便后期维护和代码阅读。这次在开发之前做了几个简单的约定：</p>\n<ul>\n<li><code>ipc</code>通讯的<code>channel</code>要约定清楚，并且用常量定义，详见<a href=\"https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md\">https://github.com/erguotou520/electron-ssr/blob/redesign/docs/EVENT_LIST.md</a></li>\n<li>主进程代码在<code>src/main</code>目录维护，渲染进程代码在<code>src/renderer</code>目录维护，两者通用代码在<code>src/shared</code>目录维护，第三方库在<code>src/lib</code>目录维护</li>\n<li>主进程和渲染进程都使用数据驱动开发的方式开发，渲染进程使用<code>vue</code>开发，主进程使用<code>rxjs</code>开发，2个进程间使用<code>ipc</code>进行数据变更通知和更新</li>\n<li>主进程和渲染进程代码统一使用ES6语法编写</li>\n</ul>\n<h2 id=\"项目目录结构\"><a class=\"header-anchor\" href=\"#项目目录结构\">¶</a>项目目录结构</h2>\n<p>有了开发约定好就开始撸码，有些代码是从之前的分支中复制过来稍作改变便可，而大部分则是全新编写。<code>src</code>目录的大致结构如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src</span><br><span class=\"line\">├─lib</span><br><span class=\"line\">│ ├─proxy_conf_helper     # mac os上用于设置系统代理模式的helper</span><br><span class=\"line\">│ └─sysproxy.exe          # windows上用于设置系统代理模式的helper</span><br><span class=\"line\">├─main                    # main进程</span><br><span class=\"line\">│ ├─bootstrap.js          # 项目启动，初始化操作</span><br><span class=\"line\">│ ├─client.js             # shadowsocksr-python命令执行和终止</span><br><span class=\"line\">│ ├─data.js               # main进程的中央数据文件</span><br><span class=\"line\">│ ├─index.dev.js          # 开发环境的入口文件</span><br><span class=\"line\">│ ├─index.js              # 入口文件</span><br><span class=\"line\">│ ├─ipc.js                # 负责ipc通讯</span><br><span class=\"line\">│ ├─logger.js             # 日志</span><br><span class=\"line\">│ ├─pac.js                # 负责pac文件下载和提供pac地址</span><br><span class=\"line\">│ ├─proxy.js              # 设置系统代理模式</span><br><span class=\"line\">│ ├─tray-handler.js       # 任务栏操作方法</span><br><span class=\"line\">│ ├─tray.js               # 任务栏</span><br><span class=\"line\">│ └─window.js             # 页面窗口</span><br><span class=\"line\">├─renderer                # renderer进程</span><br><span class=\"line\">│ ├─assets                # 页面资源</span><br><span class=\"line\">│ ├─components            # vue组件</span><br><span class=\"line\">│ ├─qrcode                # 二维码识别</span><br><span class=\"line\">│ ├─store                 # renderer进程的中央数据</span><br><span class=\"line\">│ ├─views                 # 页面</span><br><span class=\"line\">│ ├─ipc.js                # 负责ipc通讯</span><br><span class=\"line\">│ ├─constants.js          # 常量定义</span><br><span class=\"line\">│ └─main.js               # 前端入口文件</span><br><span class=\"line\">└─shared                  # main和renderer共享文件夹</span><br><span class=\"line\">  ├─config.js             # 应用配置相关</span><br><span class=\"line\">  ├─env.js                # 应用环境相关</span><br><span class=\"line\">  ├─events.js             # ipc交互事件定义集合</span><br><span class=\"line\">  ├─ssr.js                # SSR配置对象</span><br><span class=\"line\">  └─utils.js              # 工具集</span><br></pre></td></tr></table></figure>\n<h2 id=\"renderer进程开发技术点\"><a class=\"header-anchor\" href=\"#renderer进程开发技术点\">¶</a>renderer进程开发技术点</h2>\n<ul>\n<li>页面开发中用到了<code>vue</code> <code>vuex</code> 和<code>iview</code>组件库，其中<code>iview</code>稍微做了些修改。</li>\n<li><code>vuex</code>作为前端数据中心，维护了很多页面数据，页面的修改都是维护<code>vuex</code>的<code>state</code>。</li>\n<li>鉴于页面内容不是特别多就没有使用<code>vue-router</code>，而是使用简单的<code>component</code>配置<code>is</code>属性做页面切换。</li>\n<li>整个页面开发中最饶人的是我把扁平的<code>configs</code>数组变成了按分组显示的树形结构，导致整个交互变得极其复杂，最后在绕来绕去饶了好几次后还是使用数据驱动开发的思维解决。</li>\n</ul>\n<h2 id=\"main进程开发技术点\"><a class=\"header-anchor\" href=\"#main进程开发技术点\">¶</a>main进程开发技术点</h2>\n<ul>\n<li>\n<p>由于main进程使用<code>rxjs</code>作为数据维护中心，而我又是第一次使用<code>rxjs</code>，所以在初期就遇到了不少问题。比如多处文件可能会触发（ipc和tray都会触发）数据变更，应该怎么去编写和改变Observable数据，比如支持多播以及和renderer进程保持同步。最后还是在<code>data.js</code>中统一初始化和改变数据（对外暴露可改变数据的方法）并提供多播能力，其它文件在使用时直接<code>subscribe</code>关注，在变更时使用<code>data.js</code>暴露的入口进行数据变更。这样在开发时数据的维护会更方便，而且可以保持每个文件尽量只关注自己的业务。</p>\n</li>\n<li>\n<p>main进程最复杂的应该是设置系统代理功能。由于每个系统的调用方法不一致，所以要收集所有系统的实现方式，可以参考<a href=\"https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md\">https://github.com/erguotou520/electron-ssr/blob/redesign/docs/AUTO_PROXY.md</a>的收集结果（Linux系统中非gnome桌面如何实现还没有找到方法，如果你知道，欢迎提issue告知）。</p>\n<p>理论知道了只是第一步，实现是第二步。开开心心地用<code>child_process.exec</code>执行命令，开发时一切正常，happy。然而到了打包的时候懵逼了，没有可执行文件了。OK，我放到<code>static</code>目录下，还是不行，因为这些文件还是在<code>asar</code>压缩包里，没法复制和执行。最后在<code>electron-builder</code>中找到了<code>extraFiles</code>字段，就是用来将文件复制到项目根目录下的（如何找到项目根目录也是个坑，得使用app.getPaht(‘exe’)来实现`）。</p>\n<p>目前还有一个问题也是mac上实现最大的问题。mac上使用<code>networksetup</code>设置需要<code>sudo</code>权限，而如何实现只弹框输入一次管理员密码就可以一直修改系统代理模式才是最大的难题。一开始使用<code>networksetup</code>命令实现时每次切换都需要输入密码，很烦。后来参考<code>shadowsocks-NG</code>项目，直接将它生成的<code>proxy_conf_helper</code>文件复制到项目里使用，~~但目前在打包后还是会闪退，目前仍在查找实现方案。~~然后使用<a href=\"https://www.npmjs.com/package/sudo-prompt\">sudo-prompt</a>模块执行<code>sudo</code>命令将其拷贝到指定位置并赋权。</p>\n<p>在打包到<code>0.2.0-beta-1</code>版本之前一直使用正常，忽然有人跟我说<code>10.9.5</code>版本的mac闪退，远程调试后才发现原来<code>shadowsocks-NG</code>的<code>proxy_conf_helper</code>不支持<code>10.11</code>以下版本，尴尬。目前最简单的方法就是检查mac版本，然后低于<code>10.11</code>版本的直接屏蔽切换代理的功能，当然有没有更优雅的实现方式还是有待继续思考的。</p>\n</li>\n<li>\n<p>还有个有意思的问题是在<code>0.2.0-alpha-4</code>版本时<a href=\"https://github.com/erguotou520/electron-ssr/issues/61\">提的issue</a>。后来我重新查看了下NodeJs文档，发现确实用<code>execFile</code>更佳，因为它不是在shell中执行，避免了命令被特殊字符（比如<code>&amp;|&quot;'</code>等等）干扰的问题，这个问题倒是也让我学到了些开发经验。</p>\n</li>\n<li>\n<p>一开始在开发PAC功能时考虑的是这个版本先按简单的来，满足最基本的pac功能即可，而且自己一般都是用chrome插件来选择性的FQ，所以开发完也没太测试。然后打版发布后有用户提BUG说PAC功能用不了，然后自己本地试了下啊，确实用不了（之前蜜汁自信了）。然后找原因啊，还求助了别人啊，愣是没发现哪里的错。一个偶然的情况下重新看到PAC原理才想起来我返回的pac内容里面根本没有指定<code>socks</code>地址和端口啊！后来想了想，因为ssr是要用一些特殊字段做标记然后使用运行时的变量来替换特殊字段的（简单的说就是<code>pac.replace(/__PROXY__/g, 'socks5 127.0.0.1:1080')</code>），这才明白错在哪，原来真相竟然就是这么简单，害我一开始还在那研究http服务器的问题。</p>\n</li>\n</ul>\n<h2 id=\"其它的坑\"><a class=\"header-anchor\" href=\"#其它的坑\">¶</a>其它的坑</h2>\n<ul>\n<li>配置向下兼容。如果再后期维护时添加了新的系统配置项，需要在系统初始化时复制到应用配置对象中并保存。</li>\n<li>异常处理。错误文件？端口占用？</li>\n<li>在更新订阅服务器时，同时使用<code>window.fetch</code>和<code>electron.net.request</code>来请求数据，并使用<code>Promise.race</code>来选择最快完成的数据。</li>\n<li>mac系统打包后默认不能复制粘贴，需要添加<code>Menu</code>菜单和常见的一些菜单项来修复该问题。</li>\n</ul>\n<h2 id=\"最后\"><a class=\"header-anchor\" href=\"#最后\">¶</a>最后</h2>\n<p>如果你喜欢这个项目，欢迎来star。如果你觉得这个项目对你有帮助，<a href=\"https://github.com/erguotou520/donate\">欢迎来打赏</a>。</p>"},{"title":"Electron应用开发总结","s":"electron-app-summary","date":"2019-02-26T02:30:00.000Z","thumbnail":"/images/electron/logo.png","_content":"这次又是工作总结，不过是关于`Electron`的，之前工作花了差不多10个月做的产品，一直想写个填坑记录的，现在闲下来可以写写了。我们的产品是互联网化的，所以有很多内容也是没做过，一路也是遇到了很多坑。\n\n## 1.0版本\n之前虽然有做过`Electron`的经历，但之前做的功能相对简单，前端一套东西就可以搞完，但这次不行了。第一个版本当时是用`electron-vue`模板生成的，在完成产品基本功能后发行的1.0版本中，我们发现了大量的问题，比如\n\n- 内存占用过大，软件用的时间越长越大，越来越卡。\n- 从主界面打开子页面窗口时会出现很长时间的白屏，用户可能接受不了。\n- 数据库（一开始用的是RxDB）一旦存储大量数据，读取起来就会很卡。\n- 总之给用户的感受就是慢卡白屏。\n\n<!-- more -->\n\n然后就是开始填坑啊，一个一个来。\n- 内存占用大，没办法`Electron`应用本身就比较耗内存，Windows版一上来开4个线程，再加上业务代码用到一些类库，所以内存消耗肯定不小。问题的关键是软件用时越长越卡，这个足足消耗了我几个星期去处理。一开始就发现是因为内存泄露的问题，而我自己也没太接触过内存泄露排查这块（自己之前写的代码印象中就没遇到过泄露，再加上自己对常见的泄露的可能性都做了规避），所以光排查问题就花了很长时间。对照网上提供的一些常见可能性都做了排除，学着如何去排查，感觉那段时间真的学到了不少东西啊。最后在别人的指导下找到问题是出在`RxDB`身上，过程的艰辛就不提了，这是我提的[issue地址](https://github.com/pubkey/rxdb/issues/778)。\n  问题是找到了，但是怎么解决呢？等待`RxDB`修复需要时间，而自己找到的手动`gc()`的方法似乎也不那么奏效，后来没办法，只有和其它一些问题一起重新开发1.1版本。\n- 打开子页面会白屏这是必然的，因为新开一个窗口加载也需要时间，完成`Vue`的初始化、业务初始化也需要一段时间，那么这段时间注定是白屏，即使我可以在一开始加一个动画，但肯定还是会有一段白屏时间。而且由于打开多窗口，所以资源的消耗肯定也会增加，内存消耗也会上去。由于当时子窗口和主窗口用的是一个前端模板，所以要加初始化动画还不是那么简单，所以这个问题也就搁置了，加入到1.1版本中一起修复，而修复的方法就是主功能的页面不再单独打开子窗口，只有部分额外功能才会去新开且子窗口和主窗口使用2个不同的模板，减少子窗口渲染时间。\n- 鉴于之前的开发经验，前端使用文档性数据库是主流，且更符合前端知识栈，但如果文档中有的字段内容特别多，那么读取大量数据比如会占用大量内存造成卡顿的情况。如果要解决这个问题需要使用支持只筛选某些字段的文档性数据库或者使用关系型数据库。和上一条结论一样，在1.1版本中更换数据库。\n\n## 1.1版本\n鉴于之前种种问题，用户抱怨不断，老板跟后催促修改，所以只得重新开发一套，在选型的时候就针对上面的问题重新定义开发栈。\n- 项目结构模板，之前使用`electron-vue`项目生成，但是有些内容相对较老且那时`vue-cli 3`刚好稳定，意识到这以后必然是趋势，所以就决定用它去初始化了。但cli生成的只是前端项目，所以又找到了`vue-cli-plugin-electron-builder`插件去完成剩下的初始化内容。后来想想还挺冒险的，毕竟当时`vue-cli-plugin-electron-builder`还只是`alpha`版本。\n- 前端还是`Vue`一套，后端还是`NodeJs`一套，这个肯定不会改变。\n- 数据库调研了很多，基本上文档性数据库都被pass，而关系型数据库只有`sqlite`可选，其它非嵌入式的数据库也都不考虑了。但我自己对于关系型数据库的查询已经忘得差不多了，可好在我们开发组有后端同学，所以后续的很多查询都是找他们帮忙的。另外关于`sqlite`数据库其实应该做一层加密，`sqlite`本身不支持加密，但有插件可以实现，然后后来因为`懒`还是没做。还有一点，如果使用关系型数据库，那么数据库初始化是在`main`进程做呢还是在`renderer`进程做呢？从业务角度来说最终我肯定是要在`renderer`进程里调用`db`方法的。我一开始是打算在`main`进程做的，这样从逻辑上更符合数据库的定位，然后试过通过`global`暴露给`renderer`进程调用，但是这样在序列化的过程中会破坏`db`原有方法，也考虑过通过`ipc`，但是如此大量的通讯代价肯定也是很高。一开始没考虑在`renderer`进程做的另一个考虑是如果在子窗口初始化那么子窗口如何获取这个db实例呢？不过后来发现自己想多了，数据库可以多连接啊，而且我们的应用基本很少会出现多窗口同时写的问题，怕个啥，`renderer`进程搞起。`sqlite`确定后我们还需要一个`orm`库，我们使用的是`sequelize`，后来发现还有`typeorm`，但我们的项目不是基于`ts`的，所以相对来说也不太适合。但`sequelize`搭配上`webpack`有个坑就是你必须得把它的所有驱动都装上，很坑（测试使用`window.require()`方式引入也不行，也许有更好的方案？）。\n- 关于多窗口问题，和设计师保持沟通，改掉以前的交互模式，尽量在一个窗口完成常用操作，部分少见操作可以以子窗口打开，这样内存的消耗也会有所改善。\n- 其它优化包括按需加载，延时加载等。\n\n## 组件开发\n拿到UI给出的界面，在完成基础架构后就开始准备基础组件开发了，我不喜欢用现成的UI框架，一来`Electron`中使用的是`Chromium`内核渲染，不存在兼容性问题，可以放心地使用各种新特性，二来自己有洁癖，希望组件层级尽量少，很多UI为了实现更复杂的功能，DOM层级一般较多，而DOM多对渲染本身也是有影响的。组件开发大致有3种：\n- 基础组件，即与业务没有关联性，通过`props`和`event`提供各种接口，常见的有按钮、输入框、单选框等表单相关、弹框、警告框、确认框等。这些组件放在`components`或者`ui`目录下，组件统一以`Ui`或者自定义的单词开头，方便识别。\n- 业务组件。一般由基础组件构成，可以使用`vuex`种的数据。比如窗体按钮（由基础窗体按钮和业务关来）、个人信息组件（由头像和用户名等信息组成）、用户详情信息（由弹框和一些交互按钮组成）等。这些组件放在`modules`或者`widgets`目录下，组件统一由`M`或者`W`开头。\n- 页面组件，即单个UI页面，可以拆分成多个小组件，最后合并成一个大组件。这些组件放在`views`或者`pages`目录下，子组件放在对应业务的子目录下，组件统一由`V`或者`P`开头。\n严格来说组件开发完都要写测试用例，但我们没时间和精力弄这个，只能在开发的过程种测试功能。组件尽量使用原生标签，尽量减少DOM层级，`props`可以多开放些，方便后续业务需要。\n除了组件完，其它常有的`directives`、`filters`、`utils`也可以在初期就加上，有时间的可以把这些通用的单独出来放到npm里方便以后继续使用。\n\n## 业务开发\n在我们完成组件开发后，页面实现起来就很快了，就像拼乐高玩具一样。当时我开发1.1版本时APP端已经在做新功能了，而我除了要把以前的功能都实现了，还要赶上他们的进度把新功能也给做上，这确实给了我很大压力。不过好在我们这种开发模式相对原生来说会快上很多，花了大概1个半月的时间完成了1.0版本的大部分内容，再花差不多1个月多一点的时间赶上了他们，后续的业务开发相比原生来说就轻松些。这得益于前端混合开发的便利性以及`Vue`组件化开发的快速性。\n\n## 原生模块\n我想很多人被拦截在`Electron`之外的一个原因是各种报错，我想装个`sqlite3`存下数据，结果各种错误，按网上找的各种教程和方法都没用。问题还是出在原生模块上，像`sqlite3`这种模块是需要在本地进行编译的，它们依赖当前的系统环境，而大多数人在编译这块就过不去了。\n\n我的方法比较简单，首先得安装各个系统必备的编译工具，比如windows需要安装[windows-build-tools](https://www.npmjs.com/package/windows-build-tools)。直接跳过文档中说的`electron-rebuild`而是使用`electron-builder`在`postinstall`中执行`electron-builder install-app-deps`，然后你的命令行最好是FQ的，可以直接访问谷歌的那种，后面就正常安装原生模块就可以了，也不需要设置什么`npmrc`。\n\n原生模块多了每次安装新依赖都需要重新build一遍（也许是我设置问题，可以跳过？）也挺麻烦的，所以有些功能能用js去做的都会用js去实现。\n\n## 主题系统\n我们的应用支持主题切换，在前端更换主题应该是个常见的需求，但这次我想做点不同的，既然我都是`Chromium`了，那就试下css的新特性`:root`吧。把我们需要和主题关联的颜色、字体、文字大小等都放到`:root`中，然后在使用的地方直接写成`prop: var(--someVariable)`即可。这么做的好处一来原生支持，二来可以统一变量，重复利用，甚至以后可以用`cssnext`的特性去做颜色值计算等。\n\n随着业务的增多，新的页面也越来越多，需要增加的颜色值也越来越多，因而我们的主题文件中定义的`:root`里的变量也越来越多，到后来发现新增一个主题需要更改大量的颜色，而且还要调到各种页面各种业务状态下去看页面颜色是否正常。当时就想，这也不是个事啊，这以后要是加主题还不得累死我啊，能不能搞个工具，然后直接让设计师去调色，调好之后直接生成主题包文件呢？当然可以，说做就做，搞个子窗口，显示当前主题中的各种变量，显示它们的颜色并可以手动修改或者选择关联某个变量，并且要实现子窗口修改主窗口实时预览的效果。再加上可以设置主题图片，主题名，主题预览图等信息就OK拉，最后页面大致长这样：\n![](/images/others/custom-theme-tool.png)\n\n因为主题中要设置的变量特别多，而且每次调整可能都要看下效果，所以设计师让我加了中途保存，下次打开自动应用的功能防止做了一半丢了。加了一个变量搜索，因为实在太多了。\n\n### 不足的点及可优化的方向\n- 变量仍然很多，有些特殊业务还需要特定条件才能显示，而这种页面调试起来就很麻烦了，理想的方法应该是可以模拟各种环境直接查看某些页面或者输出页面渲染图到文件。\n- 子窗口的实时预览有点麻烦，需要在主窗口变量变动时通知所有的子窗口也去改变，而且自定义主题这个子窗口还不能受影响，否则整个调色过程会很难受，目前还没有做这块。\n- 自定义主题应该以插件的形式导入到应用中，这样真实用户就没有该模块而且不会打包到项目中去，现在只是单纯的通过`if (process.env.NODE_ENV !== 'production') {}`来做区分。\n\n## 自动更新\n\n## 其它\n### 数据存储\n### 非npm得第三方库\n### 本地备份\n### 在线判断\n### 快捷键\n### api签名\n### 本地字体\n### webview获取信息\n### 数据库升级\n### 埋点统计\n### worker线程\n### 数据格式转换\n### 数据同步\n### 自定义窗体\n### bug跟踪\n### 证书签名\n\n## 现有问题\n### 数据统计\n### 内容丢失\n","source":"_posts/electron-app-summary.md","raw":"---\ntitle: Electron应用开发总结\ns: electron-app-summary\ndate: 2019-02-26 10:30:00\nthumbnail: /images/electron/logo.png\ntags:\n  - electron\n  - summary\n---\n这次又是工作总结，不过是关于`Electron`的，之前工作花了差不多10个月做的产品，一直想写个填坑记录的，现在闲下来可以写写了。我们的产品是互联网化的，所以有很多内容也是没做过，一路也是遇到了很多坑。\n\n## 1.0版本\n之前虽然有做过`Electron`的经历，但之前做的功能相对简单，前端一套东西就可以搞完，但这次不行了。第一个版本当时是用`electron-vue`模板生成的，在完成产品基本功能后发行的1.0版本中，我们发现了大量的问题，比如\n\n- 内存占用过大，软件用的时间越长越大，越来越卡。\n- 从主界面打开子页面窗口时会出现很长时间的白屏，用户可能接受不了。\n- 数据库（一开始用的是RxDB）一旦存储大量数据，读取起来就会很卡。\n- 总之给用户的感受就是慢卡白屏。\n\n<!-- more -->\n\n然后就是开始填坑啊，一个一个来。\n- 内存占用大，没办法`Electron`应用本身就比较耗内存，Windows版一上来开4个线程，再加上业务代码用到一些类库，所以内存消耗肯定不小。问题的关键是软件用时越长越卡，这个足足消耗了我几个星期去处理。一开始就发现是因为内存泄露的问题，而我自己也没太接触过内存泄露排查这块（自己之前写的代码印象中就没遇到过泄露，再加上自己对常见的泄露的可能性都做了规避），所以光排查问题就花了很长时间。对照网上提供的一些常见可能性都做了排除，学着如何去排查，感觉那段时间真的学到了不少东西啊。最后在别人的指导下找到问题是出在`RxDB`身上，过程的艰辛就不提了，这是我提的[issue地址](https://github.com/pubkey/rxdb/issues/778)。\n  问题是找到了，但是怎么解决呢？等待`RxDB`修复需要时间，而自己找到的手动`gc()`的方法似乎也不那么奏效，后来没办法，只有和其它一些问题一起重新开发1.1版本。\n- 打开子页面会白屏这是必然的，因为新开一个窗口加载也需要时间，完成`Vue`的初始化、业务初始化也需要一段时间，那么这段时间注定是白屏，即使我可以在一开始加一个动画，但肯定还是会有一段白屏时间。而且由于打开多窗口，所以资源的消耗肯定也会增加，内存消耗也会上去。由于当时子窗口和主窗口用的是一个前端模板，所以要加初始化动画还不是那么简单，所以这个问题也就搁置了，加入到1.1版本中一起修复，而修复的方法就是主功能的页面不再单独打开子窗口，只有部分额外功能才会去新开且子窗口和主窗口使用2个不同的模板，减少子窗口渲染时间。\n- 鉴于之前的开发经验，前端使用文档性数据库是主流，且更符合前端知识栈，但如果文档中有的字段内容特别多，那么读取大量数据比如会占用大量内存造成卡顿的情况。如果要解决这个问题需要使用支持只筛选某些字段的文档性数据库或者使用关系型数据库。和上一条结论一样，在1.1版本中更换数据库。\n\n## 1.1版本\n鉴于之前种种问题，用户抱怨不断，老板跟后催促修改，所以只得重新开发一套，在选型的时候就针对上面的问题重新定义开发栈。\n- 项目结构模板，之前使用`electron-vue`项目生成，但是有些内容相对较老且那时`vue-cli 3`刚好稳定，意识到这以后必然是趋势，所以就决定用它去初始化了。但cli生成的只是前端项目，所以又找到了`vue-cli-plugin-electron-builder`插件去完成剩下的初始化内容。后来想想还挺冒险的，毕竟当时`vue-cli-plugin-electron-builder`还只是`alpha`版本。\n- 前端还是`Vue`一套，后端还是`NodeJs`一套，这个肯定不会改变。\n- 数据库调研了很多，基本上文档性数据库都被pass，而关系型数据库只有`sqlite`可选，其它非嵌入式的数据库也都不考虑了。但我自己对于关系型数据库的查询已经忘得差不多了，可好在我们开发组有后端同学，所以后续的很多查询都是找他们帮忙的。另外关于`sqlite`数据库其实应该做一层加密，`sqlite`本身不支持加密，但有插件可以实现，然后后来因为`懒`还是没做。还有一点，如果使用关系型数据库，那么数据库初始化是在`main`进程做呢还是在`renderer`进程做呢？从业务角度来说最终我肯定是要在`renderer`进程里调用`db`方法的。我一开始是打算在`main`进程做的，这样从逻辑上更符合数据库的定位，然后试过通过`global`暴露给`renderer`进程调用，但是这样在序列化的过程中会破坏`db`原有方法，也考虑过通过`ipc`，但是如此大量的通讯代价肯定也是很高。一开始没考虑在`renderer`进程做的另一个考虑是如果在子窗口初始化那么子窗口如何获取这个db实例呢？不过后来发现自己想多了，数据库可以多连接啊，而且我们的应用基本很少会出现多窗口同时写的问题，怕个啥，`renderer`进程搞起。`sqlite`确定后我们还需要一个`orm`库，我们使用的是`sequelize`，后来发现还有`typeorm`，但我们的项目不是基于`ts`的，所以相对来说也不太适合。但`sequelize`搭配上`webpack`有个坑就是你必须得把它的所有驱动都装上，很坑（测试使用`window.require()`方式引入也不行，也许有更好的方案？）。\n- 关于多窗口问题，和设计师保持沟通，改掉以前的交互模式，尽量在一个窗口完成常用操作，部分少见操作可以以子窗口打开，这样内存的消耗也会有所改善。\n- 其它优化包括按需加载，延时加载等。\n\n## 组件开发\n拿到UI给出的界面，在完成基础架构后就开始准备基础组件开发了，我不喜欢用现成的UI框架，一来`Electron`中使用的是`Chromium`内核渲染，不存在兼容性问题，可以放心地使用各种新特性，二来自己有洁癖，希望组件层级尽量少，很多UI为了实现更复杂的功能，DOM层级一般较多，而DOM多对渲染本身也是有影响的。组件开发大致有3种：\n- 基础组件，即与业务没有关联性，通过`props`和`event`提供各种接口，常见的有按钮、输入框、单选框等表单相关、弹框、警告框、确认框等。这些组件放在`components`或者`ui`目录下，组件统一以`Ui`或者自定义的单词开头，方便识别。\n- 业务组件。一般由基础组件构成，可以使用`vuex`种的数据。比如窗体按钮（由基础窗体按钮和业务关来）、个人信息组件（由头像和用户名等信息组成）、用户详情信息（由弹框和一些交互按钮组成）等。这些组件放在`modules`或者`widgets`目录下，组件统一由`M`或者`W`开头。\n- 页面组件，即单个UI页面，可以拆分成多个小组件，最后合并成一个大组件。这些组件放在`views`或者`pages`目录下，子组件放在对应业务的子目录下，组件统一由`V`或者`P`开头。\n严格来说组件开发完都要写测试用例，但我们没时间和精力弄这个，只能在开发的过程种测试功能。组件尽量使用原生标签，尽量减少DOM层级，`props`可以多开放些，方便后续业务需要。\n除了组件完，其它常有的`directives`、`filters`、`utils`也可以在初期就加上，有时间的可以把这些通用的单独出来放到npm里方便以后继续使用。\n\n## 业务开发\n在我们完成组件开发后，页面实现起来就很快了，就像拼乐高玩具一样。当时我开发1.1版本时APP端已经在做新功能了，而我除了要把以前的功能都实现了，还要赶上他们的进度把新功能也给做上，这确实给了我很大压力。不过好在我们这种开发模式相对原生来说会快上很多，花了大概1个半月的时间完成了1.0版本的大部分内容，再花差不多1个月多一点的时间赶上了他们，后续的业务开发相比原生来说就轻松些。这得益于前端混合开发的便利性以及`Vue`组件化开发的快速性。\n\n## 原生模块\n我想很多人被拦截在`Electron`之外的一个原因是各种报错，我想装个`sqlite3`存下数据，结果各种错误，按网上找的各种教程和方法都没用。问题还是出在原生模块上，像`sqlite3`这种模块是需要在本地进行编译的，它们依赖当前的系统环境，而大多数人在编译这块就过不去了。\n\n我的方法比较简单，首先得安装各个系统必备的编译工具，比如windows需要安装[windows-build-tools](https://www.npmjs.com/package/windows-build-tools)。直接跳过文档中说的`electron-rebuild`而是使用`electron-builder`在`postinstall`中执行`electron-builder install-app-deps`，然后你的命令行最好是FQ的，可以直接访问谷歌的那种，后面就正常安装原生模块就可以了，也不需要设置什么`npmrc`。\n\n原生模块多了每次安装新依赖都需要重新build一遍（也许是我设置问题，可以跳过？）也挺麻烦的，所以有些功能能用js去做的都会用js去实现。\n\n## 主题系统\n我们的应用支持主题切换，在前端更换主题应该是个常见的需求，但这次我想做点不同的，既然我都是`Chromium`了，那就试下css的新特性`:root`吧。把我们需要和主题关联的颜色、字体、文字大小等都放到`:root`中，然后在使用的地方直接写成`prop: var(--someVariable)`即可。这么做的好处一来原生支持，二来可以统一变量，重复利用，甚至以后可以用`cssnext`的特性去做颜色值计算等。\n\n随着业务的增多，新的页面也越来越多，需要增加的颜色值也越来越多，因而我们的主题文件中定义的`:root`里的变量也越来越多，到后来发现新增一个主题需要更改大量的颜色，而且还要调到各种页面各种业务状态下去看页面颜色是否正常。当时就想，这也不是个事啊，这以后要是加主题还不得累死我啊，能不能搞个工具，然后直接让设计师去调色，调好之后直接生成主题包文件呢？当然可以，说做就做，搞个子窗口，显示当前主题中的各种变量，显示它们的颜色并可以手动修改或者选择关联某个变量，并且要实现子窗口修改主窗口实时预览的效果。再加上可以设置主题图片，主题名，主题预览图等信息就OK拉，最后页面大致长这样：\n![](/images/others/custom-theme-tool.png)\n\n因为主题中要设置的变量特别多，而且每次调整可能都要看下效果，所以设计师让我加了中途保存，下次打开自动应用的功能防止做了一半丢了。加了一个变量搜索，因为实在太多了。\n\n### 不足的点及可优化的方向\n- 变量仍然很多，有些特殊业务还需要特定条件才能显示，而这种页面调试起来就很麻烦了，理想的方法应该是可以模拟各种环境直接查看某些页面或者输出页面渲染图到文件。\n- 子窗口的实时预览有点麻烦，需要在主窗口变量变动时通知所有的子窗口也去改变，而且自定义主题这个子窗口还不能受影响，否则整个调色过程会很难受，目前还没有做这块。\n- 自定义主题应该以插件的形式导入到应用中，这样真实用户就没有该模块而且不会打包到项目中去，现在只是单纯的通过`if (process.env.NODE_ENV !== 'production') {}`来做区分。\n\n## 自动更新\n\n## 其它\n### 数据存储\n### 非npm得第三方库\n### 本地备份\n### 在线判断\n### 快捷键\n### api签名\n### 本地字体\n### webview获取信息\n### 数据库升级\n### 埋点统计\n### worker线程\n### 数据格式转换\n### 数据同步\n### 自定义窗体\n### bug跟踪\n### 证书签名\n\n## 现有问题\n### 数据统计\n### 内容丢失\n","slug":"electron-app-summary","published":1,"updated":"2019-03-26T13:47:04.876Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox1l003mtof9xx2hdhz8","content":"<p>这次又是工作总结，不过是关于<code>Electron</code>的，之前工作花了差不多10个月做的产品，一直想写个填坑记录的，现在闲下来可以写写了。我们的产品是互联网化的，所以有很多内容也是没做过，一路也是遇到了很多坑。</p>\n<h2 id=\"1-0版本\"><a class=\"header-anchor\" href=\"#1-0版本\">¶</a>1.0版本</h2>\n<p>之前虽然有做过<code>Electron</code>的经历，但之前做的功能相对简单，前端一套东西就可以搞完，但这次不行了。第一个版本当时是用<code>electron-vue</code>模板生成的，在完成产品基本功能后发行的1.0版本中，我们发现了大量的问题，比如</p>\n<ul>\n<li>内存占用过大，软件用的时间越长越大，越来越卡。</li>\n<li>从主界面打开子页面窗口时会出现很长时间的白屏，用户可能接受不了。</li>\n<li>数据库（一开始用的是RxDB）一旦存储大量数据，读取起来就会很卡。</li>\n<li>总之给用户的感受就是慢卡白屏。</li>\n</ul>\n<a id=\"more\"></a>\n<p>然后就是开始填坑啊，一个一个来。</p>\n<ul>\n<li>内存占用大，没办法<code>Electron</code>应用本身就比较耗内存，Windows版一上来开4个线程，再加上业务代码用到一些类库，所以内存消耗肯定不小。问题的关键是软件用时越长越卡，这个足足消耗了我几个星期去处理。一开始就发现是因为内存泄露的问题，而我自己也没太接触过内存泄露排查这块（自己之前写的代码印象中就没遇到过泄露，再加上自己对常见的泄露的可能性都做了规避），所以光排查问题就花了很长时间。对照网上提供的一些常见可能性都做了排除，学着如何去排查，感觉那段时间真的学到了不少东西啊。最后在别人的指导下找到问题是出在<code>RxDB</code>身上，过程的艰辛就不提了，这是我提的<a href=\"https://github.com/pubkey/rxdb/issues/778\">issue地址</a>。<br>\n问题是找到了，但是怎么解决呢？等待<code>RxDB</code>修复需要时间，而自己找到的手动<code>gc()</code>的方法似乎也不那么奏效，后来没办法，只有和其它一些问题一起重新开发1.1版本。</li>\n<li>打开子页面会白屏这是必然的，因为新开一个窗口加载也需要时间，完成<code>Vue</code>的初始化、业务初始化也需要一段时间，那么这段时间注定是白屏，即使我可以在一开始加一个动画，但肯定还是会有一段白屏时间。而且由于打开多窗口，所以资源的消耗肯定也会增加，内存消耗也会上去。由于当时子窗口和主窗口用的是一个前端模板，所以要加初始化动画还不是那么简单，所以这个问题也就搁置了，加入到1.1版本中一起修复，而修复的方法就是主功能的页面不再单独打开子窗口，只有部分额外功能才会去新开且子窗口和主窗口使用2个不同的模板，减少子窗口渲染时间。</li>\n<li>鉴于之前的开发经验，前端使用文档性数据库是主流，且更符合前端知识栈，但如果文档中有的字段内容特别多，那么读取大量数据比如会占用大量内存造成卡顿的情况。如果要解决这个问题需要使用支持只筛选某些字段的文档性数据库或者使用关系型数据库。和上一条结论一样，在1.1版本中更换数据库。</li>\n</ul>\n<h2 id=\"1-1版本\"><a class=\"header-anchor\" href=\"#1-1版本\">¶</a>1.1版本</h2>\n<p>鉴于之前种种问题，用户抱怨不断，老板跟后催促修改，所以只得重新开发一套，在选型的时候就针对上面的问题重新定义开发栈。</p>\n<ul>\n<li>项目结构模板，之前使用<code>electron-vue</code>项目生成，但是有些内容相对较老且那时<code>vue-cli 3</code>刚好稳定，意识到这以后必然是趋势，所以就决定用它去初始化了。但cli生成的只是前端项目，所以又找到了<code>vue-cli-plugin-electron-builder</code>插件去完成剩下的初始化内容。后来想想还挺冒险的，毕竟当时<code>vue-cli-plugin-electron-builder</code>还只是<code>alpha</code>版本。</li>\n<li>前端还是<code>Vue</code>一套，后端还是<code>NodeJs</code>一套，这个肯定不会改变。</li>\n<li>数据库调研了很多，基本上文档性数据库都被pass，而关系型数据库只有<code>sqlite</code>可选，其它非嵌入式的数据库也都不考虑了。但我自己对于关系型数据库的查询已经忘得差不多了，可好在我们开发组有后端同学，所以后续的很多查询都是找他们帮忙的。另外关于<code>sqlite</code>数据库其实应该做一层加密，<code>sqlite</code>本身不支持加密，但有插件可以实现，然后后来因为<code>懒</code>还是没做。还有一点，如果使用关系型数据库，那么数据库初始化是在<code>main</code>进程做呢还是在<code>renderer</code>进程做呢？从业务角度来说最终我肯定是要在<code>renderer</code>进程里调用<code>db</code>方法的。我一开始是打算在<code>main</code>进程做的，这样从逻辑上更符合数据库的定位，然后试过通过<code>global</code>暴露给<code>renderer</code>进程调用，但是这样在序列化的过程中会破坏<code>db</code>原有方法，也考虑过通过<code>ipc</code>，但是如此大量的通讯代价肯定也是很高。一开始没考虑在<code>renderer</code>进程做的另一个考虑是如果在子窗口初始化那么子窗口如何获取这个db实例呢？不过后来发现自己想多了，数据库可以多连接啊，而且我们的应用基本很少会出现多窗口同时写的问题，怕个啥，<code>renderer</code>进程搞起。<code>sqlite</code>确定后我们还需要一个<code>orm</code>库，我们使用的是<code>sequelize</code>，后来发现还有<code>typeorm</code>，但我们的项目不是基于<code>ts</code>的，所以相对来说也不太适合。但<code>sequelize</code>搭配上<code>webpack</code>有个坑就是你必须得把它的所有驱动都装上，很坑（测试使用<code>window.require()</code>方式引入也不行，也许有更好的方案？）。</li>\n<li>关于多窗口问题，和设计师保持沟通，改掉以前的交互模式，尽量在一个窗口完成常用操作，部分少见操作可以以子窗口打开，这样内存的消耗也会有所改善。</li>\n<li>其它优化包括按需加载，延时加载等。</li>\n</ul>\n<h2 id=\"组件开发\"><a class=\"header-anchor\" href=\"#组件开发\">¶</a>组件开发</h2>\n<p>拿到UI给出的界面，在完成基础架构后就开始准备基础组件开发了，我不喜欢用现成的UI框架，一来<code>Electron</code>中使用的是<code>Chromium</code>内核渲染，不存在兼容性问题，可以放心地使用各种新特性，二来自己有洁癖，希望组件层级尽量少，很多UI为了实现更复杂的功能，DOM层级一般较多，而DOM多对渲染本身也是有影响的。组件开发大致有3种：</p>\n<ul>\n<li>基础组件，即与业务没有关联性，通过<code>props</code>和<code>event</code>提供各种接口，常见的有按钮、输入框、单选框等表单相关、弹框、警告框、确认框等。这些组件放在<code>components</code>或者<code>ui</code>目录下，组件统一以<code>Ui</code>或者自定义的单词开头，方便识别。</li>\n<li>业务组件。一般由基础组件构成，可以使用<code>vuex</code>种的数据。比如窗体按钮（由基础窗体按钮和业务关来）、个人信息组件（由头像和用户名等信息组成）、用户详情信息（由弹框和一些交互按钮组成）等。这些组件放在<code>modules</code>或者<code>widgets</code>目录下，组件统一由<code>M</code>或者<code>W</code>开头。</li>\n<li>页面组件，即单个UI页面，可以拆分成多个小组件，最后合并成一个大组件。这些组件放在<code>views</code>或者<code>pages</code>目录下，子组件放在对应业务的子目录下，组件统一由<code>V</code>或者<code>P</code>开头。<br>\n严格来说组件开发完都要写测试用例，但我们没时间和精力弄这个，只能在开发的过程种测试功能。组件尽量使用原生标签，尽量减少DOM层级，<code>props</code>可以多开放些，方便后续业务需要。<br>\n除了组件完，其它常有的<code>directives</code>、<code>filters</code>、<code>utils</code>也可以在初期就加上，有时间的可以把这些通用的单独出来放到npm里方便以后继续使用。</li>\n</ul>\n<h2 id=\"业务开发\"><a class=\"header-anchor\" href=\"#业务开发\">¶</a>业务开发</h2>\n<p>在我们完成组件开发后，页面实现起来就很快了，就像拼乐高玩具一样。当时我开发1.1版本时APP端已经在做新功能了，而我除了要把以前的功能都实现了，还要赶上他们的进度把新功能也给做上，这确实给了我很大压力。不过好在我们这种开发模式相对原生来说会快上很多，花了大概1个半月的时间完成了1.0版本的大部分内容，再花差不多1个月多一点的时间赶上了他们，后续的业务开发相比原生来说就轻松些。这得益于前端混合开发的便利性以及<code>Vue</code>组件化开发的快速性。</p>\n<h2 id=\"原生模块\"><a class=\"header-anchor\" href=\"#原生模块\">¶</a>原生模块</h2>\n<p>我想很多人被拦截在<code>Electron</code>之外的一个原因是各种报错，我想装个<code>sqlite3</code>存下数据，结果各种错误，按网上找的各种教程和方法都没用。问题还是出在原生模块上，像<code>sqlite3</code>这种模块是需要在本地进行编译的，它们依赖当前的系统环境，而大多数人在编译这块就过不去了。</p>\n<p>我的方法比较简单，首先得安装各个系统必备的编译工具，比如windows需要安装<a href=\"https://www.npmjs.com/package/windows-build-tools\">windows-build-tools</a>。直接跳过文档中说的<code>electron-rebuild</code>而是使用<code>electron-builder</code>在<code>postinstall</code>中执行<code>electron-builder install-app-deps</code>，然后你的命令行最好是FQ的，可以直接访问谷歌的那种，后面就正常安装原生模块就可以了，也不需要设置什么<code>npmrc</code>。</p>\n<p>原生模块多了每次安装新依赖都需要重新build一遍（也许是我设置问题，可以跳过？）也挺麻烦的，所以有些功能能用js去做的都会用js去实现。</p>\n<h2 id=\"主题系统\"><a class=\"header-anchor\" href=\"#主题系统\">¶</a>主题系统</h2>\n<p>我们的应用支持主题切换，在前端更换主题应该是个常见的需求，但这次我想做点不同的，既然我都是<code>Chromium</code>了，那就试下css的新特性<code>:root</code>吧。把我们需要和主题关联的颜色、字体、文字大小等都放到<code>:root</code>中，然后在使用的地方直接写成<code>prop: var(--someVariable)</code>即可。这么做的好处一来原生支持，二来可以统一变量，重复利用，甚至以后可以用<code>cssnext</code>的特性去做颜色值计算等。</p>\n<p>随着业务的增多，新的页面也越来越多，需要增加的颜色值也越来越多，因而我们的主题文件中定义的<code>:root</code>里的变量也越来越多，到后来发现新增一个主题需要更改大量的颜色，而且还要调到各种页面各种业务状态下去看页面颜色是否正常。当时就想，这也不是个事啊，这以后要是加主题还不得累死我啊，能不能搞个工具，然后直接让设计师去调色，调好之后直接生成主题包文件呢？当然可以，说做就做，搞个子窗口，显示当前主题中的各种变量，显示它们的颜色并可以手动修改或者选择关联某个变量，并且要实现子窗口修改主窗口实时预览的效果。再加上可以设置主题图片，主题名，主题预览图等信息就OK拉，最后页面大致长这样：<br>\n<img src=\"/images/others/custom-theme-tool.png\" alt></p>\n<p>因为主题中要设置的变量特别多，而且每次调整可能都要看下效果，所以设计师让我加了中途保存，下次打开自动应用的功能防止做了一半丢了。加了一个变量搜索，因为实在太多了。</p>\n<h3 id=\"不足的点及可优化的方向\"><a class=\"header-anchor\" href=\"#不足的点及可优化的方向\">¶</a>不足的点及可优化的方向</h3>\n<ul>\n<li>变量仍然很多，有些特殊业务还需要特定条件才能显示，而这种页面调试起来就很麻烦了，理想的方法应该是可以模拟各种环境直接查看某些页面或者输出页面渲染图到文件。</li>\n<li>子窗口的实时预览有点麻烦，需要在主窗口变量变动时通知所有的子窗口也去改变，而且自定义主题这个子窗口还不能受影响，否则整个调色过程会很难受，目前还没有做这块。</li>\n<li>自定义主题应该以插件的形式导入到应用中，这样真实用户就没有该模块而且不会打包到项目中去，现在只是单纯的通过<code>if (process.env.NODE_ENV !== 'production') {}</code>来做区分。</li>\n</ul>\n<h2 id=\"自动更新\"><a class=\"header-anchor\" href=\"#自动更新\">¶</a>自动更新</h2>\n<h2 id=\"其它\"><a class=\"header-anchor\" href=\"#其它\">¶</a>其它</h2>\n<h3 id=\"数据存储\"><a class=\"header-anchor\" href=\"#数据存储\">¶</a>数据存储</h3>\n<h3 id=\"非npm得第三方库\"><a class=\"header-anchor\" href=\"#非npm得第三方库\">¶</a>非npm得第三方库</h3>\n<h3 id=\"本地备份\"><a class=\"header-anchor\" href=\"#本地备份\">¶</a>本地备份</h3>\n<h3 id=\"在线判断\"><a class=\"header-anchor\" href=\"#在线判断\">¶</a>在线判断</h3>\n<h3 id=\"快捷键\"><a class=\"header-anchor\" href=\"#快捷键\">¶</a>快捷键</h3>\n<h3 id=\"api签名\"><a class=\"header-anchor\" href=\"#api签名\">¶</a>api签名</h3>\n<h3 id=\"本地字体\"><a class=\"header-anchor\" href=\"#本地字体\">¶</a>本地字体</h3>\n<h3 id=\"webview获取信息\"><a class=\"header-anchor\" href=\"#webview获取信息\">¶</a>webview获取信息</h3>\n<h3 id=\"数据库升级\"><a class=\"header-anchor\" href=\"#数据库升级\">¶</a>数据库升级</h3>\n<h3 id=\"埋点统计\"><a class=\"header-anchor\" href=\"#埋点统计\">¶</a>埋点统计</h3>\n<h3 id=\"worker线程\"><a class=\"header-anchor\" href=\"#worker线程\">¶</a>worker线程</h3>\n<h3 id=\"数据格式转换\"><a class=\"header-anchor\" href=\"#数据格式转换\">¶</a>数据格式转换</h3>\n<h3 id=\"数据同步\"><a class=\"header-anchor\" href=\"#数据同步\">¶</a>数据同步</h3>\n<h3 id=\"自定义窗体\"><a class=\"header-anchor\" href=\"#自定义窗体\">¶</a>自定义窗体</h3>\n<h3 id=\"bug跟踪\"><a class=\"header-anchor\" href=\"#bug跟踪\">¶</a>bug跟踪</h3>\n<h3 id=\"证书签名\"><a class=\"header-anchor\" href=\"#证书签名\">¶</a>证书签名</h3>\n<h2 id=\"现有问题\"><a class=\"header-anchor\" href=\"#现有问题\">¶</a>现有问题</h2>\n<h3 id=\"数据统计\"><a class=\"header-anchor\" href=\"#数据统计\">¶</a>数据统计</h3>\n<h3 id=\"内容丢失\"><a class=\"header-anchor\" href=\"#内容丢失\">¶</a>内容丢失</h3>\n","site":{"data":{}},"excerpt":"<p>这次又是工作总结，不过是关于<code>Electron</code>的，之前工作花了差不多10个月做的产品，一直想写个填坑记录的，现在闲下来可以写写了。我们的产品是互联网化的，所以有很多内容也是没做过，一路也是遇到了很多坑。</p>\n<h2 id=\"1-0版本\"><a class=\"header-anchor\" href=\"#1-0版本\">¶</a>1.0版本</h2>\n<p>之前虽然有做过<code>Electron</code>的经历，但之前做的功能相对简单，前端一套东西就可以搞完，但这次不行了。第一个版本当时是用<code>electron-vue</code>模板生成的，在完成产品基本功能后发行的1.0版本中，我们发现了大量的问题，比如</p>\n<ul>\n<li>内存占用过大，软件用的时间越长越大，越来越卡。</li>\n<li>从主界面打开子页面窗口时会出现很长时间的白屏，用户可能接受不了。</li>\n<li>数据库（一开始用的是RxDB）一旦存储大量数据，读取起来就会很卡。</li>\n<li>总之给用户的感受就是慢卡白屏。</li>\n</ul>","more":"<p>然后就是开始填坑啊，一个一个来。</p>\n<ul>\n<li>内存占用大，没办法<code>Electron</code>应用本身就比较耗内存，Windows版一上来开4个线程，再加上业务代码用到一些类库，所以内存消耗肯定不小。问题的关键是软件用时越长越卡，这个足足消耗了我几个星期去处理。一开始就发现是因为内存泄露的问题，而我自己也没太接触过内存泄露排查这块（自己之前写的代码印象中就没遇到过泄露，再加上自己对常见的泄露的可能性都做了规避），所以光排查问题就花了很长时间。对照网上提供的一些常见可能性都做了排除，学着如何去排查，感觉那段时间真的学到了不少东西啊。最后在别人的指导下找到问题是出在<code>RxDB</code>身上，过程的艰辛就不提了，这是我提的<a href=\"https://github.com/pubkey/rxdb/issues/778\">issue地址</a>。<br>\n问题是找到了，但是怎么解决呢？等待<code>RxDB</code>修复需要时间，而自己找到的手动<code>gc()</code>的方法似乎也不那么奏效，后来没办法，只有和其它一些问题一起重新开发1.1版本。</li>\n<li>打开子页面会白屏这是必然的，因为新开一个窗口加载也需要时间，完成<code>Vue</code>的初始化、业务初始化也需要一段时间，那么这段时间注定是白屏，即使我可以在一开始加一个动画，但肯定还是会有一段白屏时间。而且由于打开多窗口，所以资源的消耗肯定也会增加，内存消耗也会上去。由于当时子窗口和主窗口用的是一个前端模板，所以要加初始化动画还不是那么简单，所以这个问题也就搁置了，加入到1.1版本中一起修复，而修复的方法就是主功能的页面不再单独打开子窗口，只有部分额外功能才会去新开且子窗口和主窗口使用2个不同的模板，减少子窗口渲染时间。</li>\n<li>鉴于之前的开发经验，前端使用文档性数据库是主流，且更符合前端知识栈，但如果文档中有的字段内容特别多，那么读取大量数据比如会占用大量内存造成卡顿的情况。如果要解决这个问题需要使用支持只筛选某些字段的文档性数据库或者使用关系型数据库。和上一条结论一样，在1.1版本中更换数据库。</li>\n</ul>\n<h2 id=\"1-1版本\"><a class=\"header-anchor\" href=\"#1-1版本\">¶</a>1.1版本</h2>\n<p>鉴于之前种种问题，用户抱怨不断，老板跟后催促修改，所以只得重新开发一套，在选型的时候就针对上面的问题重新定义开发栈。</p>\n<ul>\n<li>项目结构模板，之前使用<code>electron-vue</code>项目生成，但是有些内容相对较老且那时<code>vue-cli 3</code>刚好稳定，意识到这以后必然是趋势，所以就决定用它去初始化了。但cli生成的只是前端项目，所以又找到了<code>vue-cli-plugin-electron-builder</code>插件去完成剩下的初始化内容。后来想想还挺冒险的，毕竟当时<code>vue-cli-plugin-electron-builder</code>还只是<code>alpha</code>版本。</li>\n<li>前端还是<code>Vue</code>一套，后端还是<code>NodeJs</code>一套，这个肯定不会改变。</li>\n<li>数据库调研了很多，基本上文档性数据库都被pass，而关系型数据库只有<code>sqlite</code>可选，其它非嵌入式的数据库也都不考虑了。但我自己对于关系型数据库的查询已经忘得差不多了，可好在我们开发组有后端同学，所以后续的很多查询都是找他们帮忙的。另外关于<code>sqlite</code>数据库其实应该做一层加密，<code>sqlite</code>本身不支持加密，但有插件可以实现，然后后来因为<code>懒</code>还是没做。还有一点，如果使用关系型数据库，那么数据库初始化是在<code>main</code>进程做呢还是在<code>renderer</code>进程做呢？从业务角度来说最终我肯定是要在<code>renderer</code>进程里调用<code>db</code>方法的。我一开始是打算在<code>main</code>进程做的，这样从逻辑上更符合数据库的定位，然后试过通过<code>global</code>暴露给<code>renderer</code>进程调用，但是这样在序列化的过程中会破坏<code>db</code>原有方法，也考虑过通过<code>ipc</code>，但是如此大量的通讯代价肯定也是很高。一开始没考虑在<code>renderer</code>进程做的另一个考虑是如果在子窗口初始化那么子窗口如何获取这个db实例呢？不过后来发现自己想多了，数据库可以多连接啊，而且我们的应用基本很少会出现多窗口同时写的问题，怕个啥，<code>renderer</code>进程搞起。<code>sqlite</code>确定后我们还需要一个<code>orm</code>库，我们使用的是<code>sequelize</code>，后来发现还有<code>typeorm</code>，但我们的项目不是基于<code>ts</code>的，所以相对来说也不太适合。但<code>sequelize</code>搭配上<code>webpack</code>有个坑就是你必须得把它的所有驱动都装上，很坑（测试使用<code>window.require()</code>方式引入也不行，也许有更好的方案？）。</li>\n<li>关于多窗口问题，和设计师保持沟通，改掉以前的交互模式，尽量在一个窗口完成常用操作，部分少见操作可以以子窗口打开，这样内存的消耗也会有所改善。</li>\n<li>其它优化包括按需加载，延时加载等。</li>\n</ul>\n<h2 id=\"组件开发\"><a class=\"header-anchor\" href=\"#组件开发\">¶</a>组件开发</h2>\n<p>拿到UI给出的界面，在完成基础架构后就开始准备基础组件开发了，我不喜欢用现成的UI框架，一来<code>Electron</code>中使用的是<code>Chromium</code>内核渲染，不存在兼容性问题，可以放心地使用各种新特性，二来自己有洁癖，希望组件层级尽量少，很多UI为了实现更复杂的功能，DOM层级一般较多，而DOM多对渲染本身也是有影响的。组件开发大致有3种：</p>\n<ul>\n<li>基础组件，即与业务没有关联性，通过<code>props</code>和<code>event</code>提供各种接口，常见的有按钮、输入框、单选框等表单相关、弹框、警告框、确认框等。这些组件放在<code>components</code>或者<code>ui</code>目录下，组件统一以<code>Ui</code>或者自定义的单词开头，方便识别。</li>\n<li>业务组件。一般由基础组件构成，可以使用<code>vuex</code>种的数据。比如窗体按钮（由基础窗体按钮和业务关来）、个人信息组件（由头像和用户名等信息组成）、用户详情信息（由弹框和一些交互按钮组成）等。这些组件放在<code>modules</code>或者<code>widgets</code>目录下，组件统一由<code>M</code>或者<code>W</code>开头。</li>\n<li>页面组件，即单个UI页面，可以拆分成多个小组件，最后合并成一个大组件。这些组件放在<code>views</code>或者<code>pages</code>目录下，子组件放在对应业务的子目录下，组件统一由<code>V</code>或者<code>P</code>开头。<br>\n严格来说组件开发完都要写测试用例，但我们没时间和精力弄这个，只能在开发的过程种测试功能。组件尽量使用原生标签，尽量减少DOM层级，<code>props</code>可以多开放些，方便后续业务需要。<br>\n除了组件完，其它常有的<code>directives</code>、<code>filters</code>、<code>utils</code>也可以在初期就加上，有时间的可以把这些通用的单独出来放到npm里方便以后继续使用。</li>\n</ul>\n<h2 id=\"业务开发\"><a class=\"header-anchor\" href=\"#业务开发\">¶</a>业务开发</h2>\n<p>在我们完成组件开发后，页面实现起来就很快了，就像拼乐高玩具一样。当时我开发1.1版本时APP端已经在做新功能了，而我除了要把以前的功能都实现了，还要赶上他们的进度把新功能也给做上，这确实给了我很大压力。不过好在我们这种开发模式相对原生来说会快上很多，花了大概1个半月的时间完成了1.0版本的大部分内容，再花差不多1个月多一点的时间赶上了他们，后续的业务开发相比原生来说就轻松些。这得益于前端混合开发的便利性以及<code>Vue</code>组件化开发的快速性。</p>\n<h2 id=\"原生模块\"><a class=\"header-anchor\" href=\"#原生模块\">¶</a>原生模块</h2>\n<p>我想很多人被拦截在<code>Electron</code>之外的一个原因是各种报错，我想装个<code>sqlite3</code>存下数据，结果各种错误，按网上找的各种教程和方法都没用。问题还是出在原生模块上，像<code>sqlite3</code>这种模块是需要在本地进行编译的，它们依赖当前的系统环境，而大多数人在编译这块就过不去了。</p>\n<p>我的方法比较简单，首先得安装各个系统必备的编译工具，比如windows需要安装<a href=\"https://www.npmjs.com/package/windows-build-tools\">windows-build-tools</a>。直接跳过文档中说的<code>electron-rebuild</code>而是使用<code>electron-builder</code>在<code>postinstall</code>中执行<code>electron-builder install-app-deps</code>，然后你的命令行最好是FQ的，可以直接访问谷歌的那种，后面就正常安装原生模块就可以了，也不需要设置什么<code>npmrc</code>。</p>\n<p>原生模块多了每次安装新依赖都需要重新build一遍（也许是我设置问题，可以跳过？）也挺麻烦的，所以有些功能能用js去做的都会用js去实现。</p>\n<h2 id=\"主题系统\"><a class=\"header-anchor\" href=\"#主题系统\">¶</a>主题系统</h2>\n<p>我们的应用支持主题切换，在前端更换主题应该是个常见的需求，但这次我想做点不同的，既然我都是<code>Chromium</code>了，那就试下css的新特性<code>:root</code>吧。把我们需要和主题关联的颜色、字体、文字大小等都放到<code>:root</code>中，然后在使用的地方直接写成<code>prop: var(--someVariable)</code>即可。这么做的好处一来原生支持，二来可以统一变量，重复利用，甚至以后可以用<code>cssnext</code>的特性去做颜色值计算等。</p>\n<p>随着业务的增多，新的页面也越来越多，需要增加的颜色值也越来越多，因而我们的主题文件中定义的<code>:root</code>里的变量也越来越多，到后来发现新增一个主题需要更改大量的颜色，而且还要调到各种页面各种业务状态下去看页面颜色是否正常。当时就想，这也不是个事啊，这以后要是加主题还不得累死我啊，能不能搞个工具，然后直接让设计师去调色，调好之后直接生成主题包文件呢？当然可以，说做就做，搞个子窗口，显示当前主题中的各种变量，显示它们的颜色并可以手动修改或者选择关联某个变量，并且要实现子窗口修改主窗口实时预览的效果。再加上可以设置主题图片，主题名，主题预览图等信息就OK拉，最后页面大致长这样：<br>\n<img src=\"/images/others/custom-theme-tool.png\" alt=\"\"></p>\n<p>因为主题中要设置的变量特别多，而且每次调整可能都要看下效果，所以设计师让我加了中途保存，下次打开自动应用的功能防止做了一半丢了。加了一个变量搜索，因为实在太多了。</p>\n<h3 id=\"不足的点及可优化的方向\"><a class=\"header-anchor\" href=\"#不足的点及可优化的方向\">¶</a>不足的点及可优化的方向</h3>\n<ul>\n<li>变量仍然很多，有些特殊业务还需要特定条件才能显示，而这种页面调试起来就很麻烦了，理想的方法应该是可以模拟各种环境直接查看某些页面或者输出页面渲染图到文件。</li>\n<li>子窗口的实时预览有点麻烦，需要在主窗口变量变动时通知所有的子窗口也去改变，而且自定义主题这个子窗口还不能受影响，否则整个调色过程会很难受，目前还没有做这块。</li>\n<li>自定义主题应该以插件的形式导入到应用中，这样真实用户就没有该模块而且不会打包到项目中去，现在只是单纯的通过<code>if (process.env.NODE_ENV !== 'production') {}</code>来做区分。</li>\n</ul>\n<h2 id=\"自动更新\"><a class=\"header-anchor\" href=\"#自动更新\">¶</a>自动更新</h2>\n<h2 id=\"其它\"><a class=\"header-anchor\" href=\"#其它\">¶</a>其它</h2>\n<h3 id=\"数据存储\"><a class=\"header-anchor\" href=\"#数据存储\">¶</a>数据存储</h3>\n<h3 id=\"非npm得第三方库\"><a class=\"header-anchor\" href=\"#非npm得第三方库\">¶</a>非npm得第三方库</h3>\n<h3 id=\"本地备份\"><a class=\"header-anchor\" href=\"#本地备份\">¶</a>本地备份</h3>\n<h3 id=\"在线判断\"><a class=\"header-anchor\" href=\"#在线判断\">¶</a>在线判断</h3>\n<h3 id=\"快捷键\"><a class=\"header-anchor\" href=\"#快捷键\">¶</a>快捷键</h3>\n<h3 id=\"api签名\"><a class=\"header-anchor\" href=\"#api签名\">¶</a>api签名</h3>\n<h3 id=\"本地字体\"><a class=\"header-anchor\" href=\"#本地字体\">¶</a>本地字体</h3>\n<h3 id=\"webview获取信息\"><a class=\"header-anchor\" href=\"#webview获取信息\">¶</a>webview获取信息</h3>\n<h3 id=\"数据库升级\"><a class=\"header-anchor\" href=\"#数据库升级\">¶</a>数据库升级</h3>\n<h3 id=\"埋点统计\"><a class=\"header-anchor\" href=\"#埋点统计\">¶</a>埋点统计</h3>\n<h3 id=\"worker线程\"><a class=\"header-anchor\" href=\"#worker线程\">¶</a>worker线程</h3>\n<h3 id=\"数据格式转换\"><a class=\"header-anchor\" href=\"#数据格式转换\">¶</a>数据格式转换</h3>\n<h3 id=\"数据同步\"><a class=\"header-anchor\" href=\"#数据同步\">¶</a>数据同步</h3>\n<h3 id=\"自定义窗体\"><a class=\"header-anchor\" href=\"#自定义窗体\">¶</a>自定义窗体</h3>\n<h3 id=\"bug跟踪\"><a class=\"header-anchor\" href=\"#bug跟踪\">¶</a>bug跟踪</h3>\n<h3 id=\"证书签名\"><a class=\"header-anchor\" href=\"#证书签名\">¶</a>证书签名</h3>\n<h2 id=\"现有问题\"><a class=\"header-anchor\" href=\"#现有问题\">¶</a>现有问题</h2>\n<h3 id=\"数据统计\"><a class=\"header-anchor\" href=\"#数据统计\">¶</a>数据统计</h3>\n<h3 id=\"内容丢失\"><a class=\"header-anchor\" href=\"#内容丢失\">¶</a>内容丢失</h3>"},{"title":"Ghost开发之API","s":"ghost-api","date":"2015-03-18T11:49:00.000Z","_content":"# Ghost API 接口\n当前版本为0.5.8，后续更新的API不在其中。 本文写作时用的是英文版，下面所有涉及`language`为`en_US`的对应的中文版为`zh_CN`。\n下面所有的链接都是以`http://your.blog.site:port`开头，请注意。\n你可以使用Chrome的Postman工具进行调试\n![](/images/ghost/postman.png)\n<!-- more -->\n## 登录认证\nPOST `/ghost/api/v0.1/authentication/token`\nACCEPT json\nDATA\n```js\n{\n  grant_type:password\n  username:your.email@email.com(请替换为你的邮箱)\n  password:your_password(请替换为你的登录密码)\n  client_id:ghost-admin\n}\n```\nRESULT\n```js\n{\n  access_token: 'xxx',\n  expires_in: 3600,\n  refresh_token: 'xxx',\n  token_type: \"Bearer\"\n}\n注意保存返回的结果\n```\n如果登录错误，会返回错误结果\n```js\n{\n  status: 404\n  errors[0]: {message: 'xxx', type: 'xxxError'}\n}\n```\n错误主要分为不存在的邮箱、错误的密码、密码输入错误次数过多几种\n注意：以下所有请求涉及用户权限的，都需要在HTTP请求的头中加入`access_token`的信息，请求格式为\n```\nRequest Headers中添加\nAuthorization: Bearer your_access_token\n```\n如果验证信息过期，会提示错误，如果没有加Authorization的头信息也会返回类似的错误信息\n## 获取登录者信息\nGET `/ghost/api/v0.1/users/me/?status=all&include=roles`\nACCEPT json\nAuthorization 见上说明\nRESULT\n```js\n{\n\taccessibility: null\n\tbio: null\n\tcover: null\n\tcreated_at: \"2015-02-08T12:11:34.683Z\"\n\tcreated_by: 1\n\temail: \"your.email@email.com\"\n\tid: 1\n\timage: null\n\tlanguage: \"en_US\"\n\tlast_login: \"2015-03-18T08:55:30.330Z\"\n\tlocation: null\n\tmeta_description: null\n\tmeta_title: null\n\tname: \"你的名字\"\n\troles: [{id: 4, uuid: \"9227adb4-a836-4f6c-ba41-7d5dd307968a\", name: \"Owner\", description: \"Blog Owner\",…}]\n\tslug: \"your-slug\"\n\tstatus: \"active\"\n\tupdated_at: \"2015-03-18T08:55:30.331Z\"\n\tupdated_by: 1\n\tuuid: \"xxxx-uuid\"\n\twebsite: null\n}\n```\n每个字段对应的意思从单词应该可以看出来，具体不做说明，注意保存返回结果\n\n下面列出的所有api路径都是由`/ghost/api/v0.1`开头，在调用时请自行追加\n## 配置相关\n系统级的配置信息的json格式\n```json\n{\n    \"key\": \"fileStorage\",\n    \"value\": true\n}\n```\n* GET /configuration 获取博客配置信息\n* GET /configuration/:key 根据指定ID获取配置信息\n\n## 文章相关\n新增文章的业务流程应该是(2,3步骤在Ghost中是监测输入间隔，然后发送请求)\n1. 获取标签等信息`/tags/?limit=all`\n2. 输入title后调用`/slugs/post/:inputed-title`会返回一个新的slug\n3. 输入正文时保存`/posts/?include=tags`，其中发送的数据格式为\n```js\n{\n    posts: [\n        {\n            title: 'xxx',\n            slug: 'xxx', // 上一步获取到的slug\n            markdown: 'xxx', // 输入的markdown内容\n            image: 'xxx', // 文章的封面\n            featured: false, // 是否推荐\n            page: false, //是否单独页\n            status: \"draft\", // 状态为草稿或者发布published\n            language: \"en_US\", // 语言\n            meta_title: null, // 设置里面的meta信息，下同\n            meta_description: null,\n            author: \"1\", // 作者id\n            published_by: null, // 发布者\n            tags:[ // 标签数组\n                {\n                    description: null\n                    hidden: false\n                    image: null\n                    meta_description: null\n                    meta_title: null\n                    name: \"tag1\"\n                    post_count: null\n                    slug: null // 这个是新增的tag，没有uuid和slug\n                    uuid: null\n                }\n            ]\n        }\n    ]\n}\n```\n此请求返回的数据里面有一个id，保存id，下次在保存文章时的地址就是`/posts/:id?include=tags`\n\n文章的json结构体如下\n```js\n{\n  slug: \"welcome-to-ghost\", // 类似文章的链接\n  status: \"published\", // 文章的状态 草稿 已发布等\n  id: 1, // 文章ID\n  uuid: \"xxxx-xxxx\", // 文章的UUID\n  title: \"Welcome to Ghost\", // 文章标题\n  markdown: xxx // 文章的markdown内容\n  html: xxx // 文章的html内容\n  image: null, // 图片\n  featured: false, // 推荐\n  page: false, // 单独页\n  language: \"en_US\", // 语言\n  meta_title: null, // meta里面的title\n  meta_description: null, // meta里面的description，下面的很好理解，不做解释\n  created_at: \"2015-02-08T12:11:20.645Z\",\n  created_by: 1,\n  updated_at: \"2015-02-08T12:11:20.645Z\",\n  updated_by: 1,\n  published_at: \"2015-02-08T12:11:20.684Z\",\n  published_by: 1,\n  author: 1,\n  url: \"/welcome-to-ghost/\"\n}\n```\n* GET /posts 获取所有文章，返回的数据里面还包含分页信息\n* POST /posts 新增文章\n* GET /posts/:id 根据ID获取文章\n* GET /posts/slug/:slug 根据文章链接获取文章\n* PUT /posts/:id 编辑文章\n* DEL /posts/:id 根据ID删除文章\n\n## 设置相关\n博客的设置数据的json格式\n```js\n{\n    \"settings\": [\n        {\n            \"id\": 5,\n            \"uuid\": \"xxxx-xxxx\",\n            \"key\": \"title\",\n            \"value\": \"My blog\",\n            \"type\": \"blog\",\n            \"created_at\": \"2015-02-08T12:11:35.040Z\",\n            \"created_by\": 1,\n            \"updated_at\": \"2015-03-18T09:47:42.464Z\",\n            \"updated_by\": 1\n        },\n        ...\n        {\n            \"key\": \"availableThemes\", // 可用的主题\n            \"value\": [\n                {\n                    \"name\": \"casper\",\n                    \"package\": {\n                        \"name\": \"Casper\",\n                        \"version\": \"1.1.5\"\n                    },\n                    \"active\": true\n                }\n            ],\n            \"type\": \"theme\"\n        },\n        {\n            \"key\": \"availableApps\", // 可用的app，当前版本暂时还不支持app的调用？\n            \"value\": [],\n            \"type\": \"app\"\n        }\n    ],\n    \"meta\": {}\n}\n```\n* GET /settings 获取所有设置\n* GET /settings/:key 根据指定key获取设置\n* PUT /settings 修改设置\n\n## 用户相关\n用户数据的json格式\n```js\n{\n    email: \"your.email@email.com\",\n    id: 1,\n    uuid: \"xxxx-xxxx\",\n    name: \"你的名字\",\n    slug: \"exxx\", // slug，个人信息页面链接为http://your.blog.site/author/:slug\n    image: null, // 头像\n    cover: null, // 封面\n    bio: null, // 简介\n    website: null,\n    location: null,\n    accessibility: null, // 这是虾米？\n    status: \"active\",\n    language: \"en_US\",\n    meta_title: null,\n    meta_description: null,\n    last_login: \"2015-03-18T10:11:18.753Z\",\n    created_at: \"2015-02-08T12:11:34.683Z\",\n    created_by: 1,\n    updated_at: \"2015-03-18T10:11:18.753Z\",\n    updated_by: 1\n}\n```\n* GET /users 获取所有用户\n* GET /users/:id 根据指定Id获取用户\n* GET /users/slug/:slug 根据用户的slug获取用户\n* GET /users/email/:email 根据邮箱获取用户\n* PUT /users/password 修改用户登录密码\n* PUT /users/owner 修改用户的所有者(不懂，没测试过)\n* PUT /users/:id 根据用户id来修改用户信息\n* POST /users 添加用户\n* del /users/:id 删除用户\n\n## 标签相关\n标签数据的json格式\n```js\n{\n    \"id\": 1,\n    \"uuid\": \"xxxx-xxxx\",\n    \"name\": \"Getting Started\",\n    \"slug\": \"getting-started\",\n    \"description\": null,\n    \"image\": null,\n    \"hidden\": false,\n    \"meta_title\": null,\n    \"meta_description\": null,\n    \"created_at\": \"2015-02-08T12:11:20.685Z\",\n    \"created_by\": 1,\n    \"updated_at\": \"2015-02-08T12:11:20.685Z\",\n    \"updated_by\": 1,\n    \"parent\": null\n}\n```\n* GET /tags 获取所有表情\n* GET /tags/:id 根据Id获取标签\n* POST /tags 添加标签\n* PUT /tags/:id 根据ID修改标签\n* del /tags/:id 根据ID删除标签\n\n## 角色相关\n角色数据的json格式\n```json\n{\n    \"id\": 1,\n    \"uuid\": \"1b925c9f-92f2-45b3-9828-9244adbaaddc\",\n    \"name\": \"Administrator\",\n    \"description\": \"Administrators\",\n    \"created_at\": \"2015-02-08T12:11:20.687Z\",\n    \"created_by\": 1,\n    \"updated_at\": \"2015-02-08T12:11:20.687Z\",\n    \"updated_by\": 1\n}\n```\n* GET /roles/ 获取所有的角色\n\n## Slugs\n* GET /slugs/:type/:name 未研究，不做解释\n\n## 主题\n主题数据的json格式\n```json\n{\n    \"uuid\": \"casper\",\n    \"name\": \"Casper\",\n    \"version\": \"1.1.5\",\n    \"active\": true\n}\n```\n* GET /themes 获取所有主题\n* PUT /themes/:name 修改当前的主题\n\n## 通知相关\n通知信息的json结构\n```js\n{\n    notifications: [\n        {\n\t        dismissible： true,\n\t        location: 'bottom',\n            type': 'info', // 错误等级'error', 'success', 'warn' and 'info'\n\t        message: 'message'\n\t    }\n    ]\n}\n```\n* GET /notifications\n* POST /notifications\n* del /notifications/:id\n\n## DB数据库\n能获得数据里的各种数据，建议不要直接操作，使用其它方法单独操作\n* GET /db\n* POST /db\n* del /db\n\n## 邮件\n未测试\n* POST /mail 发送邮件\n* POST /mail/test 发送测试邮件\n\n## 用户认证\n未测试。。\n* POST /authentication/passwordreset\n* PUT /authentication/passwordreset\n* POST /authentication/invitation\n* GET /authentication/invitation\n* POST /authentication/setup\n* GET /authentication/setup\n* POST /authentication/token\n* POST /authentication/revoke\n\n## 上传文件\n* POST /uploads\n  uploadimage file数据，上传时的图片文件\n","source":"_posts/ghost-api.md","raw":"---\ntitle: Ghost开发之API\ns: ghost-api\ndate: 2015-03-18 19:49:00\ntags:\n  - Ghost\n  - Api\n---\n# Ghost API 接口\n当前版本为0.5.8，后续更新的API不在其中。 本文写作时用的是英文版，下面所有涉及`language`为`en_US`的对应的中文版为`zh_CN`。\n下面所有的链接都是以`http://your.blog.site:port`开头，请注意。\n你可以使用Chrome的Postman工具进行调试\n![](/images/ghost/postman.png)\n<!-- more -->\n## 登录认证\nPOST `/ghost/api/v0.1/authentication/token`\nACCEPT json\nDATA\n```js\n{\n  grant_type:password\n  username:your.email@email.com(请替换为你的邮箱)\n  password:your_password(请替换为你的登录密码)\n  client_id:ghost-admin\n}\n```\nRESULT\n```js\n{\n  access_token: 'xxx',\n  expires_in: 3600,\n  refresh_token: 'xxx',\n  token_type: \"Bearer\"\n}\n注意保存返回的结果\n```\n如果登录错误，会返回错误结果\n```js\n{\n  status: 404\n  errors[0]: {message: 'xxx', type: 'xxxError'}\n}\n```\n错误主要分为不存在的邮箱、错误的密码、密码输入错误次数过多几种\n注意：以下所有请求涉及用户权限的，都需要在HTTP请求的头中加入`access_token`的信息，请求格式为\n```\nRequest Headers中添加\nAuthorization: Bearer your_access_token\n```\n如果验证信息过期，会提示错误，如果没有加Authorization的头信息也会返回类似的错误信息\n## 获取登录者信息\nGET `/ghost/api/v0.1/users/me/?status=all&include=roles`\nACCEPT json\nAuthorization 见上说明\nRESULT\n```js\n{\n\taccessibility: null\n\tbio: null\n\tcover: null\n\tcreated_at: \"2015-02-08T12:11:34.683Z\"\n\tcreated_by: 1\n\temail: \"your.email@email.com\"\n\tid: 1\n\timage: null\n\tlanguage: \"en_US\"\n\tlast_login: \"2015-03-18T08:55:30.330Z\"\n\tlocation: null\n\tmeta_description: null\n\tmeta_title: null\n\tname: \"你的名字\"\n\troles: [{id: 4, uuid: \"9227adb4-a836-4f6c-ba41-7d5dd307968a\", name: \"Owner\", description: \"Blog Owner\",…}]\n\tslug: \"your-slug\"\n\tstatus: \"active\"\n\tupdated_at: \"2015-03-18T08:55:30.331Z\"\n\tupdated_by: 1\n\tuuid: \"xxxx-uuid\"\n\twebsite: null\n}\n```\n每个字段对应的意思从单词应该可以看出来，具体不做说明，注意保存返回结果\n\n下面列出的所有api路径都是由`/ghost/api/v0.1`开头，在调用时请自行追加\n## 配置相关\n系统级的配置信息的json格式\n```json\n{\n    \"key\": \"fileStorage\",\n    \"value\": true\n}\n```\n* GET /configuration 获取博客配置信息\n* GET /configuration/:key 根据指定ID获取配置信息\n\n## 文章相关\n新增文章的业务流程应该是(2,3步骤在Ghost中是监测输入间隔，然后发送请求)\n1. 获取标签等信息`/tags/?limit=all`\n2. 输入title后调用`/slugs/post/:inputed-title`会返回一个新的slug\n3. 输入正文时保存`/posts/?include=tags`，其中发送的数据格式为\n```js\n{\n    posts: [\n        {\n            title: 'xxx',\n            slug: 'xxx', // 上一步获取到的slug\n            markdown: 'xxx', // 输入的markdown内容\n            image: 'xxx', // 文章的封面\n            featured: false, // 是否推荐\n            page: false, //是否单独页\n            status: \"draft\", // 状态为草稿或者发布published\n            language: \"en_US\", // 语言\n            meta_title: null, // 设置里面的meta信息，下同\n            meta_description: null,\n            author: \"1\", // 作者id\n            published_by: null, // 发布者\n            tags:[ // 标签数组\n                {\n                    description: null\n                    hidden: false\n                    image: null\n                    meta_description: null\n                    meta_title: null\n                    name: \"tag1\"\n                    post_count: null\n                    slug: null // 这个是新增的tag，没有uuid和slug\n                    uuid: null\n                }\n            ]\n        }\n    ]\n}\n```\n此请求返回的数据里面有一个id，保存id，下次在保存文章时的地址就是`/posts/:id?include=tags`\n\n文章的json结构体如下\n```js\n{\n  slug: \"welcome-to-ghost\", // 类似文章的链接\n  status: \"published\", // 文章的状态 草稿 已发布等\n  id: 1, // 文章ID\n  uuid: \"xxxx-xxxx\", // 文章的UUID\n  title: \"Welcome to Ghost\", // 文章标题\n  markdown: xxx // 文章的markdown内容\n  html: xxx // 文章的html内容\n  image: null, // 图片\n  featured: false, // 推荐\n  page: false, // 单独页\n  language: \"en_US\", // 语言\n  meta_title: null, // meta里面的title\n  meta_description: null, // meta里面的description，下面的很好理解，不做解释\n  created_at: \"2015-02-08T12:11:20.645Z\",\n  created_by: 1,\n  updated_at: \"2015-02-08T12:11:20.645Z\",\n  updated_by: 1,\n  published_at: \"2015-02-08T12:11:20.684Z\",\n  published_by: 1,\n  author: 1,\n  url: \"/welcome-to-ghost/\"\n}\n```\n* GET /posts 获取所有文章，返回的数据里面还包含分页信息\n* POST /posts 新增文章\n* GET /posts/:id 根据ID获取文章\n* GET /posts/slug/:slug 根据文章链接获取文章\n* PUT /posts/:id 编辑文章\n* DEL /posts/:id 根据ID删除文章\n\n## 设置相关\n博客的设置数据的json格式\n```js\n{\n    \"settings\": [\n        {\n            \"id\": 5,\n            \"uuid\": \"xxxx-xxxx\",\n            \"key\": \"title\",\n            \"value\": \"My blog\",\n            \"type\": \"blog\",\n            \"created_at\": \"2015-02-08T12:11:35.040Z\",\n            \"created_by\": 1,\n            \"updated_at\": \"2015-03-18T09:47:42.464Z\",\n            \"updated_by\": 1\n        },\n        ...\n        {\n            \"key\": \"availableThemes\", // 可用的主题\n            \"value\": [\n                {\n                    \"name\": \"casper\",\n                    \"package\": {\n                        \"name\": \"Casper\",\n                        \"version\": \"1.1.5\"\n                    },\n                    \"active\": true\n                }\n            ],\n            \"type\": \"theme\"\n        },\n        {\n            \"key\": \"availableApps\", // 可用的app，当前版本暂时还不支持app的调用？\n            \"value\": [],\n            \"type\": \"app\"\n        }\n    ],\n    \"meta\": {}\n}\n```\n* GET /settings 获取所有设置\n* GET /settings/:key 根据指定key获取设置\n* PUT /settings 修改设置\n\n## 用户相关\n用户数据的json格式\n```js\n{\n    email: \"your.email@email.com\",\n    id: 1,\n    uuid: \"xxxx-xxxx\",\n    name: \"你的名字\",\n    slug: \"exxx\", // slug，个人信息页面链接为http://your.blog.site/author/:slug\n    image: null, // 头像\n    cover: null, // 封面\n    bio: null, // 简介\n    website: null,\n    location: null,\n    accessibility: null, // 这是虾米？\n    status: \"active\",\n    language: \"en_US\",\n    meta_title: null,\n    meta_description: null,\n    last_login: \"2015-03-18T10:11:18.753Z\",\n    created_at: \"2015-02-08T12:11:34.683Z\",\n    created_by: 1,\n    updated_at: \"2015-03-18T10:11:18.753Z\",\n    updated_by: 1\n}\n```\n* GET /users 获取所有用户\n* GET /users/:id 根据指定Id获取用户\n* GET /users/slug/:slug 根据用户的slug获取用户\n* GET /users/email/:email 根据邮箱获取用户\n* PUT /users/password 修改用户登录密码\n* PUT /users/owner 修改用户的所有者(不懂，没测试过)\n* PUT /users/:id 根据用户id来修改用户信息\n* POST /users 添加用户\n* del /users/:id 删除用户\n\n## 标签相关\n标签数据的json格式\n```js\n{\n    \"id\": 1,\n    \"uuid\": \"xxxx-xxxx\",\n    \"name\": \"Getting Started\",\n    \"slug\": \"getting-started\",\n    \"description\": null,\n    \"image\": null,\n    \"hidden\": false,\n    \"meta_title\": null,\n    \"meta_description\": null,\n    \"created_at\": \"2015-02-08T12:11:20.685Z\",\n    \"created_by\": 1,\n    \"updated_at\": \"2015-02-08T12:11:20.685Z\",\n    \"updated_by\": 1,\n    \"parent\": null\n}\n```\n* GET /tags 获取所有表情\n* GET /tags/:id 根据Id获取标签\n* POST /tags 添加标签\n* PUT /tags/:id 根据ID修改标签\n* del /tags/:id 根据ID删除标签\n\n## 角色相关\n角色数据的json格式\n```json\n{\n    \"id\": 1,\n    \"uuid\": \"1b925c9f-92f2-45b3-9828-9244adbaaddc\",\n    \"name\": \"Administrator\",\n    \"description\": \"Administrators\",\n    \"created_at\": \"2015-02-08T12:11:20.687Z\",\n    \"created_by\": 1,\n    \"updated_at\": \"2015-02-08T12:11:20.687Z\",\n    \"updated_by\": 1\n}\n```\n* GET /roles/ 获取所有的角色\n\n## Slugs\n* GET /slugs/:type/:name 未研究，不做解释\n\n## 主题\n主题数据的json格式\n```json\n{\n    \"uuid\": \"casper\",\n    \"name\": \"Casper\",\n    \"version\": \"1.1.5\",\n    \"active\": true\n}\n```\n* GET /themes 获取所有主题\n* PUT /themes/:name 修改当前的主题\n\n## 通知相关\n通知信息的json结构\n```js\n{\n    notifications: [\n        {\n\t        dismissible： true,\n\t        location: 'bottom',\n            type': 'info', // 错误等级'error', 'success', 'warn' and 'info'\n\t        message: 'message'\n\t    }\n    ]\n}\n```\n* GET /notifications\n* POST /notifications\n* del /notifications/:id\n\n## DB数据库\n能获得数据里的各种数据，建议不要直接操作，使用其它方法单独操作\n* GET /db\n* POST /db\n* del /db\n\n## 邮件\n未测试\n* POST /mail 发送邮件\n* POST /mail/test 发送测试邮件\n\n## 用户认证\n未测试。。\n* POST /authentication/passwordreset\n* PUT /authentication/passwordreset\n* POST /authentication/invitation\n* GET /authentication/invitation\n* POST /authentication/setup\n* GET /authentication/setup\n* POST /authentication/token\n* POST /authentication/revoke\n\n## 上传文件\n* POST /uploads\n  uploadimage file数据，上传时的图片文件\n","slug":"ghost-api","published":1,"updated":"2019-03-26T13:47:04.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox1q003otof99mr8b9d1","content":"<h1>Ghost API 接口</h1>\n<p>当前版本为0.5.8，后续更新的API不在其中。 本文写作时用的是英文版，下面所有涉及<code>language</code>为<code>en_US</code>的对应的中文版为<code>zh_CN</code>。<br>\n下面所有的链接都是以<code>http://your.blog.site:port</code>开头，请注意。<br>\n你可以使用Chrome的Postman工具进行调试<br>\n<img src=\"/images/ghost/postman.png\" alt></p>\n<a id=\"more\"></a>\n<h2 id=\"登录认证\"><a class=\"header-anchor\" href=\"#登录认证\">¶</a>登录认证</h2>\n<p>POST <code>/ghost/api/v0.1/authentication/token</code><br>\nACCEPT json<br>\nDATA</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  grant_type:password</span><br><span class=\"line\">  username:your.email@email.com(请替换为你的邮箱)</span><br><span class=\"line\">  password:your_password(请替换为你的登录密码)</span><br><span class=\"line\">  client_id:ghost-admin</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RESULT</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  access_token: <span class=\"hljs-string\">'xxx'</span>,</span><br><span class=\"line\">  expires_in: <span class=\"hljs-number\">3600</span>,</span><br><span class=\"line\">  refresh_token: <span class=\"hljs-string\">'xxx'</span>,</span><br><span class=\"line\">  token_type: <span class=\"hljs-string\">\"Bearer\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">注意保存返回的结果</span><br></pre></td></tr></table></figure>\n<p>如果登录错误，会返回错误结果</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  status: <span class=\"hljs-number\">404</span></span><br><span class=\"line\">  errors[<span class=\"hljs-number\">0</span>]: &#123;<span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">'xxx'</span>, <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">'xxxError'</span>&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>错误主要分为不存在的邮箱、错误的密码、密码输入错误次数过多几种<br>\n注意：以下所有请求涉及用户权限的，都需要在HTTP请求的头中加入<code>access_token</code>的信息，请求格式为</p>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Request Headers中添加</span><br><span class=\"line\">Authorization: Bearer your_access_token</span><br></pre></td></tr></table></figure>\n<p>如果验证信息过期，会提示错误，如果没有加Authorization的头信息也会返回类似的错误信息</p>\n<h2 id=\"获取登录者信息\"><a class=\"header-anchor\" href=\"#获取登录者信息\">¶</a>获取登录者信息</h2>\n<p>GET <code>/ghost/api/v0.1/users/me/?status=all&amp;include=roles</code><br>\nACCEPT json<br>\nAuthorization 见上说明<br>\nRESULT</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\taccessibility: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">\tbio: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">\tcover: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">\tcreated_at: <span class=\"hljs-string\">\"2015-02-08T12:11:34.683Z\"</span></span><br><span class=\"line\">\tcreated_by: <span class=\"hljs-number\">1</span></span><br><span class=\"line\">\temail: <span class=\"hljs-string\">\"your.email@email.com\"</span></span><br><span class=\"line\">\tid: <span class=\"hljs-number\">1</span></span><br><span class=\"line\">\timage: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">\tlanguage: <span class=\"hljs-string\">\"en_US\"</span></span><br><span class=\"line\">\tlast_login: <span class=\"hljs-string\">\"2015-03-18T08:55:30.330Z\"</span></span><br><span class=\"line\">\tlocation: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">\tmeta_description: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">\tmeta_title: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">\tname: <span class=\"hljs-string\">\"你的名字\"</span></span><br><span class=\"line\">\troles: [&#123;<span class=\"hljs-attr\">id</span>: <span class=\"hljs-number\">4</span>, <span class=\"hljs-attr\">uuid</span>: <span class=\"hljs-string\">\"9227adb4-a836-4f6c-ba41-7d5dd307968a\"</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">\"Owner\"</span>, <span class=\"hljs-attr\">description</span>: <span class=\"hljs-string\">\"Blog Owner\"</span>,…&#125;]</span><br><span class=\"line\">\tslug: <span class=\"hljs-string\">\"your-slug\"</span></span><br><span class=\"line\">\tstatus: <span class=\"hljs-string\">\"active\"</span></span><br><span class=\"line\">\tupdated_at: <span class=\"hljs-string\">\"2015-03-18T08:55:30.331Z\"</span></span><br><span class=\"line\">\tupdated_by: <span class=\"hljs-number\">1</span></span><br><span class=\"line\">\tuuid: <span class=\"hljs-string\">\"xxxx-uuid\"</span></span><br><span class=\"line\">\twebsite: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每个字段对应的意思从单词应该可以看出来，具体不做说明，注意保存返回结果</p>\n<p>下面列出的所有api路径都是由<code>/ghost/api/v0.1</code>开头，在调用时请自行追加</p>\n<h2 id=\"配置相关\"><a class=\"header-anchor\" href=\"#配置相关\">¶</a>配置相关</h2>\n<p>系统级的配置信息的json格式</p>\n<figure class=\"highlight json hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"key\"</span>: <span class=\"hljs-string\">\"fileStorage\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"value\"</span>: <span class=\"hljs-literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /configuration 获取博客配置信息</li>\n<li>GET /configuration/:key 根据指定ID获取配置信息</li>\n</ul>\n<h2 id=\"文章相关\"><a class=\"header-anchor\" href=\"#文章相关\">¶</a>文章相关</h2>\n<p>新增文章的业务流程应该是(2,3步骤在Ghost中是监测输入间隔，然后发送请求)</p>\n<ol>\n<li>获取标签等信息<code>/tags/?limit=all</code></li>\n<li>输入title后调用<code>/slugs/post/:inputed-title</code>会返回一个新的slug</li>\n<li>输入正文时保存<code>/posts/?include=tags</code>，其中发送的数据格式为</li>\n</ol>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    posts: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            title: <span class=\"hljs-string\">'xxx'</span>,</span><br><span class=\"line\">            slug: <span class=\"hljs-string\">'xxx'</span>, <span class=\"hljs-comment\">// 上一步获取到的slug</span></span><br><span class=\"line\">            markdown: <span class=\"hljs-string\">'xxx'</span>, <span class=\"hljs-comment\">// 输入的markdown内容</span></span><br><span class=\"line\">            image: <span class=\"hljs-string\">'xxx'</span>, <span class=\"hljs-comment\">// 文章的封面</span></span><br><span class=\"line\">            featured: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-comment\">// 是否推荐</span></span><br><span class=\"line\">            page: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-comment\">//是否单独页</span></span><br><span class=\"line\">            status: <span class=\"hljs-string\">\"draft\"</span>, <span class=\"hljs-comment\">// 状态为草稿或者发布published</span></span><br><span class=\"line\">            language: <span class=\"hljs-string\">\"en_US\"</span>, <span class=\"hljs-comment\">// 语言</span></span><br><span class=\"line\">            meta_title: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// 设置里面的meta信息，下同</span></span><br><span class=\"line\">            meta_description: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">            author: <span class=\"hljs-string\">\"1\"</span>, <span class=\"hljs-comment\">// 作者id</span></span><br><span class=\"line\">            published_by: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// 发布者</span></span><br><span class=\"line\">            tags:[ <span class=\"hljs-comment\">// 标签数组</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    description: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">                    hidden: <span class=\"hljs-literal\">false</span></span><br><span class=\"line\">                    image: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">                    meta_description: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">                    meta_title: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">                    name: <span class=\"hljs-string\">\"tag1\"</span></span><br><span class=\"line\">                    post_count: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">                    slug: <span class=\"hljs-literal\">null</span> <span class=\"hljs-comment\">// 这个是新增的tag，没有uuid和slug</span></span><br><span class=\"line\">                    uuid: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此请求返回的数据里面有一个id，保存id，下次在保存文章时的地址就是<code>/posts/:id?include=tags</code></p>\n<p>文章的json结构体如下</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  slug: <span class=\"hljs-string\">\"welcome-to-ghost\"</span>, <span class=\"hljs-comment\">// 类似文章的链接</span></span><br><span class=\"line\">  status: <span class=\"hljs-string\">\"published\"</span>, <span class=\"hljs-comment\">// 文章的状态 草稿 已发布等</span></span><br><span class=\"line\">  id: <span class=\"hljs-number\">1</span>, <span class=\"hljs-comment\">// 文章ID</span></span><br><span class=\"line\">  uuid: <span class=\"hljs-string\">\"xxxx-xxxx\"</span>, <span class=\"hljs-comment\">// 文章的UUID</span></span><br><span class=\"line\">  title: <span class=\"hljs-string\">\"Welcome to Ghost\"</span>, <span class=\"hljs-comment\">// 文章标题</span></span><br><span class=\"line\">  markdown: xxx <span class=\"hljs-comment\">// 文章的markdown内容</span></span><br><span class=\"line\">  html: xxx <span class=\"hljs-comment\">// 文章的html内容</span></span><br><span class=\"line\">  image: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// 图片</span></span><br><span class=\"line\">  featured: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-comment\">// 推荐</span></span><br><span class=\"line\">  page: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-comment\">// 单独页</span></span><br><span class=\"line\">  language: <span class=\"hljs-string\">\"en_US\"</span>, <span class=\"hljs-comment\">// 语言</span></span><br><span class=\"line\">  meta_title: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// meta里面的title</span></span><br><span class=\"line\">  meta_description: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// meta里面的description，下面的很好理解，不做解释</span></span><br><span class=\"line\">  created_at: <span class=\"hljs-string\">\"2015-02-08T12:11:20.645Z\"</span>,</span><br><span class=\"line\">  created_by: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">  updated_at: <span class=\"hljs-string\">\"2015-02-08T12:11:20.645Z\"</span>,</span><br><span class=\"line\">  updated_by: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">  published_at: <span class=\"hljs-string\">\"2015-02-08T12:11:20.684Z\"</span>,</span><br><span class=\"line\">  published_by: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">  author: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">  url: <span class=\"hljs-string\">\"/welcome-to-ghost/\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /posts 获取所有文章，返回的数据里面还包含分页信息</li>\n<li>POST /posts 新增文章</li>\n<li>GET /posts/:id 根据ID获取文章</li>\n<li>GET /posts/slug/:slug 根据文章链接获取文章</li>\n<li>PUT /posts/:id 编辑文章</li>\n<li>DEL /posts/:id 根据ID删除文章</li>\n</ul>\n<h2 id=\"设置相关\"><a class=\"header-anchor\" href=\"#设置相关\">¶</a>设置相关</h2>\n<p>博客的设置数据的json格式</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"hljs-string\">\"settings\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"hljs-string\">\"id\"</span>: <span class=\"hljs-number\">5</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"uuid\"</span>: <span class=\"hljs-string\">\"xxxx-xxxx\"</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"key\"</span>: <span class=\"hljs-string\">\"title\"</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"value\"</span>: <span class=\"hljs-string\">\"My blog\"</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"type\"</span>: <span class=\"hljs-string\">\"blog\"</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"created_at\"</span>: <span class=\"hljs-string\">\"2015-02-08T12:11:35.040Z\"</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"created_by\"</span>: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"updated_at\"</span>: <span class=\"hljs-string\">\"2015-03-18T09:47:42.464Z\"</span>,</span><br><span class=\"line\">            <span class=\"hljs-string\">\"updated_by\"</span>: <span class=\"hljs-number\">1</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"hljs-string\">\"key\"</span>: <span class=\"hljs-string\">\"availableThemes\"</span>, <span class=\"hljs-comment\">// 可用的主题</span></span><br><span class=\"line\">            <span class=\"hljs-string\">\"value\"</span>: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"casper\"</span>,</span><br><span class=\"line\">                    <span class=\"hljs-string\">\"package\"</span>: &#123;</span><br><span class=\"line\">                        <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"Casper\"</span>,</span><br><span class=\"line\">                        <span class=\"hljs-string\">\"version\"</span>: <span class=\"hljs-string\">\"1.1.5\"</span></span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    <span class=\"hljs-string\">\"active\"</span>: <span class=\"hljs-literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"hljs-string\">\"type\"</span>: <span class=\"hljs-string\">\"theme\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"hljs-string\">\"key\"</span>: <span class=\"hljs-string\">\"availableApps\"</span>, <span class=\"hljs-comment\">// 可用的app，当前版本暂时还不支持app的调用？</span></span><br><span class=\"line\">            <span class=\"hljs-string\">\"value\"</span>: [],</span><br><span class=\"line\">            <span class=\"hljs-string\">\"type\"</span>: <span class=\"hljs-string\">\"app\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"hljs-string\">\"meta\"</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /settings 获取所有设置</li>\n<li>GET /settings/:key 根据指定key获取设置</li>\n<li>PUT /settings 修改设置</li>\n</ul>\n<h2 id=\"用户相关\"><a class=\"header-anchor\" href=\"#用户相关\">¶</a>用户相关</h2>\n<p>用户数据的json格式</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    email: <span class=\"hljs-string\">\"your.email@email.com\"</span>,</span><br><span class=\"line\">    id: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">    uuid: <span class=\"hljs-string\">\"xxxx-xxxx\"</span>,</span><br><span class=\"line\">    name: <span class=\"hljs-string\">\"你的名字\"</span>,</span><br><span class=\"line\">    slug: <span class=\"hljs-string\">\"exxx\"</span>, <span class=\"hljs-comment\">// slug，个人信息页面链接为http://your.blog.site/author/:slug</span></span><br><span class=\"line\">    image: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// 头像</span></span><br><span class=\"line\">    cover: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// 封面</span></span><br><span class=\"line\">    bio: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// 简介</span></span><br><span class=\"line\">    website: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    location: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    accessibility: <span class=\"hljs-literal\">null</span>, <span class=\"hljs-comment\">// 这是虾米？</span></span><br><span class=\"line\">    status: <span class=\"hljs-string\">\"active\"</span>,</span><br><span class=\"line\">    language: <span class=\"hljs-string\">\"en_US\"</span>,</span><br><span class=\"line\">    meta_title: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    meta_description: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    last_login: <span class=\"hljs-string\">\"2015-03-18T10:11:18.753Z\"</span>,</span><br><span class=\"line\">    created_at: <span class=\"hljs-string\">\"2015-02-08T12:11:34.683Z\"</span>,</span><br><span class=\"line\">    created_by: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">    updated_at: <span class=\"hljs-string\">\"2015-03-18T10:11:18.753Z\"</span>,</span><br><span class=\"line\">    updated_by: <span class=\"hljs-number\">1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /users 获取所有用户</li>\n<li>GET /users/:id 根据指定Id获取用户</li>\n<li>GET /users/slug/:slug 根据用户的slug获取用户</li>\n<li>GET /users/email/:email 根据邮箱获取用户</li>\n<li>PUT /users/password 修改用户登录密码</li>\n<li>PUT /users/owner 修改用户的所有者(不懂，没测试过)</li>\n<li>PUT /users/:id 根据用户id来修改用户信息</li>\n<li>POST /users 添加用户</li>\n<li>del /users/:id 删除用户</li>\n</ul>\n<h2 id=\"标签相关\"><a class=\"header-anchor\" href=\"#标签相关\">¶</a>标签相关</h2>\n<p>标签数据的json格式</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"hljs-string\">\"id\"</span>: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"uuid\"</span>: <span class=\"hljs-string\">\"xxxx-xxxx\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"Getting Started\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"slug\"</span>: <span class=\"hljs-string\">\"getting-started\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"description\"</span>: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"image\"</span>: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"hidden\"</span>: <span class=\"hljs-literal\">false</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"meta_title\"</span>: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"meta_description\"</span>: <span class=\"hljs-literal\">null</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"created_at\"</span>: <span class=\"hljs-string\">\"2015-02-08T12:11:20.685Z\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"created_by\"</span>: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"updated_at\"</span>: <span class=\"hljs-string\">\"2015-02-08T12:11:20.685Z\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"updated_by\"</span>: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">    <span class=\"hljs-string\">\"parent\"</span>: <span class=\"hljs-literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /tags 获取所有表情</li>\n<li>GET /tags/:id 根据Id获取标签</li>\n<li>POST /tags 添加标签</li>\n<li>PUT /tags/:id 根据ID修改标签</li>\n<li>del /tags/:id 根据ID删除标签</li>\n</ul>\n<h2 id=\"角色相关\"><a class=\"header-anchor\" href=\"#角色相关\">¶</a>角色相关</h2>\n<p>角色数据的json格式</p>\n<figure class=\"highlight json hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"id\"</span>: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"uuid\"</span>: <span class=\"hljs-string\">\"1b925c9f-92f2-45b3-9828-9244adbaaddc\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"Administrator\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"description\"</span>: <span class=\"hljs-string\">\"Administrators\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"created_at\"</span>: <span class=\"hljs-string\">\"2015-02-08T12:11:20.687Z\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"created_by\"</span>: <span class=\"hljs-number\">1</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"updated_at\"</span>: <span class=\"hljs-string\">\"2015-02-08T12:11:20.687Z\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"updated_by\"</span>: <span class=\"hljs-number\">1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /roles/ 获取所有的角色</li>\n</ul>\n<h2 id=\"Slugs\"><a class=\"header-anchor\" href=\"#Slugs\">¶</a>Slugs</h2>\n<ul>\n<li>GET /slugs/:type/:name 未研究，不做解释</li>\n</ul>\n<h2 id=\"主题\"><a class=\"header-anchor\" href=\"#主题\">¶</a>主题</h2>\n<p>主题数据的json格式</p>\n<figure class=\"highlight json hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"uuid\"</span>: <span class=\"hljs-string\">\"casper\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"Casper\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"version\"</span>: <span class=\"hljs-string\">\"1.1.5\"</span>,</span><br><span class=\"line\">    <span class=\"hljs-attr\">\"active\"</span>: <span class=\"hljs-literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /themes 获取所有主题</li>\n<li>PUT /themes/:name 修改当前的主题</li>\n</ul>\n<h2 id=\"通知相关\"><a class=\"header-anchor\" href=\"#通知相关\">¶</a>通知相关</h2>\n<p>通知信息的json结构</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    notifications: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">\t        dismissible： <span class=\"hljs-literal\">true</span>,</span><br><span class=\"line\">\t        location: <span class=\"hljs-string\">'bottom'</span>,</span><br><span class=\"line\">            type<span class=\"hljs-string\">': '</span>info<span class=\"hljs-string\">', // 错误等级'</span>error<span class=\"hljs-string\">', '</span>success<span class=\"hljs-string\">', '</span>warn<span class=\"hljs-string\">' and '</span>info<span class=\"hljs-string\">'</span></span><br><span class=\"line\"><span class=\"hljs-string\">\t        message: '</span>message<span class=\"hljs-string\">'</span></span><br><span class=\"line\"><span class=\"hljs-string\">\t    &#125;</span></span><br><span class=\"line\"><span class=\"hljs-string\">    ]</span></span><br><span class=\"line\"><span class=\"hljs-string\">&#125;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /notifications</li>\n<li>POST /notifications</li>\n<li>del /notifications/:id</li>\n</ul>\n<h2 id=\"DB数据库\"><a class=\"header-anchor\" href=\"#DB数据库\">¶</a>DB数据库</h2>\n<p>能获得数据里的各种数据，建议不要直接操作，使用其它方法单独操作</p>\n<ul>\n<li>GET /db</li>\n<li>POST /db</li>\n<li>del /db</li>\n</ul>\n<h2 id=\"邮件\"><a class=\"header-anchor\" href=\"#邮件\">¶</a>邮件</h2>\n<p>未测试</p>\n<ul>\n<li>POST /mail 发送邮件</li>\n<li>POST /mail/test 发送测试邮件</li>\n</ul>\n<h2 id=\"用户认证\"><a class=\"header-anchor\" href=\"#用户认证\">¶</a>用户认证</h2>\n<p>未测试。。</p>\n<ul>\n<li>POST /authentication/passwordreset</li>\n<li>PUT /authentication/passwordreset</li>\n<li>POST /authentication/invitation</li>\n<li>GET /authentication/invitation</li>\n<li>POST /authentication/setup</li>\n<li>GET /authentication/setup</li>\n<li>POST /authentication/token</li>\n<li>POST /authentication/revoke</li>\n</ul>\n<h2 id=\"上传文件\"><a class=\"header-anchor\" href=\"#上传文件\">¶</a>上传文件</h2>\n<ul>\n<li>POST /uploads<br>\nuploadimage file数据，上传时的图片文件</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1>Ghost API 接口</h1>\n<p>当前版本为0.5.8，后续更新的API不在其中。 本文写作时用的是英文版，下面所有涉及<code>language</code>为<code>en_US</code>的对应的中文版为<code>zh_CN</code>。<br>\n下面所有的链接都是以<code>http://your.blog.site:port</code>开头，请注意。<br>\n你可以使用Chrome的Postman工具进行调试<br>\n<img src=\"/images/ghost/postman.png\" alt></p>","more":"<h2 id=\"登录认证\"><a class=\"header-anchor\" href=\"#登录认证\">¶</a>登录认证</h2>\n<p>POST <code>/ghost/api/v0.1/authentication/token</code><br>\nACCEPT json<br>\nDATA</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  grant_type:password</span><br><span class=\"line\">  username:your.email@email.com(请替换为你的邮箱)</span><br><span class=\"line\">  password:your_password(请替换为你的登录密码)</span><br><span class=\"line\">  client_id:ghost-admin</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RESULT</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  access_token: <span class=\"string\">'xxx'</span>,</span><br><span class=\"line\">  expires_in: <span class=\"number\">3600</span>,</span><br><span class=\"line\">  refresh_token: <span class=\"string\">'xxx'</span>,</span><br><span class=\"line\">  token_type: <span class=\"string\">\"Bearer\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">注意保存返回的结果</span><br></pre></td></tr></table></figure>\n<p>如果登录错误，会返回错误结果</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  status: <span class=\"number\">404</span></span><br><span class=\"line\">  errors[<span class=\"number\">0</span>]: &#123;<span class=\"attr\">message</span>: <span class=\"string\">'xxx'</span>, <span class=\"attr\">type</span>: <span class=\"string\">'xxxError'</span>&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>错误主要分为不存在的邮箱、错误的密码、密码输入错误次数过多几种<br>\n注意：以下所有请求涉及用户权限的，都需要在HTTP请求的头中加入<code>access_token</code>的信息，请求格式为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Request Headers中添加</span><br><span class=\"line\">Authorization: Bearer your_access_token</span><br></pre></td></tr></table></figure>\n<p>如果验证信息过期，会提示错误，如果没有加Authorization的头信息也会返回类似的错误信息</p>\n<h2 id=\"获取登录者信息\"><a class=\"header-anchor\" href=\"#获取登录者信息\">¶</a>获取登录者信息</h2>\n<p>GET <code>/ghost/api/v0.1/users/me/?status=all&amp;include=roles</code><br>\nACCEPT json<br>\nAuthorization 见上说明<br>\nRESULT</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\taccessibility: <span class=\"literal\">null</span></span><br><span class=\"line\">\tbio: <span class=\"literal\">null</span></span><br><span class=\"line\">\tcover: <span class=\"literal\">null</span></span><br><span class=\"line\">\tcreated_at: <span class=\"string\">\"2015-02-08T12:11:34.683Z\"</span></span><br><span class=\"line\">\tcreated_by: <span class=\"number\">1</span></span><br><span class=\"line\">\temail: <span class=\"string\">\"your.email@email.com\"</span></span><br><span class=\"line\">\tid: <span class=\"number\">1</span></span><br><span class=\"line\">\timage: <span class=\"literal\">null</span></span><br><span class=\"line\">\tlanguage: <span class=\"string\">\"en_US\"</span></span><br><span class=\"line\">\tlast_login: <span class=\"string\">\"2015-03-18T08:55:30.330Z\"</span></span><br><span class=\"line\">\tlocation: <span class=\"literal\">null</span></span><br><span class=\"line\">\tmeta_description: <span class=\"literal\">null</span></span><br><span class=\"line\">\tmeta_title: <span class=\"literal\">null</span></span><br><span class=\"line\">\tname: <span class=\"string\">\"你的名字\"</span></span><br><span class=\"line\">\troles: [&#123;<span class=\"attr\">id</span>: <span class=\"number\">4</span>, <span class=\"attr\">uuid</span>: <span class=\"string\">\"9227adb4-a836-4f6c-ba41-7d5dd307968a\"</span>, <span class=\"attr\">name</span>: <span class=\"string\">\"Owner\"</span>, <span class=\"attr\">description</span>: <span class=\"string\">\"Blog Owner\"</span>,…&#125;]</span><br><span class=\"line\">\tslug: <span class=\"string\">\"your-slug\"</span></span><br><span class=\"line\">\tstatus: <span class=\"string\">\"active\"</span></span><br><span class=\"line\">\tupdated_at: <span class=\"string\">\"2015-03-18T08:55:30.331Z\"</span></span><br><span class=\"line\">\tupdated_by: <span class=\"number\">1</span></span><br><span class=\"line\">\tuuid: <span class=\"string\">\"xxxx-uuid\"</span></span><br><span class=\"line\">\twebsite: <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每个字段对应的意思从单词应该可以看出来，具体不做说明，注意保存返回结果</p>\n<p>下面列出的所有api路径都是由<code>/ghost/api/v0.1</code>开头，在调用时请自行追加</p>\n<h2 id=\"配置相关\"><a class=\"header-anchor\" href=\"#配置相关\">¶</a>配置相关</h2>\n<p>系统级的配置信息的json格式</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"key\"</span>: <span class=\"string\">\"fileStorage\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"value\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /configuration 获取博客配置信息</li>\n<li>GET /configuration/:key 根据指定ID获取配置信息</li>\n</ul>\n<h2 id=\"文章相关\"><a class=\"header-anchor\" href=\"#文章相关\">¶</a>文章相关</h2>\n<p>新增文章的业务流程应该是(2,3步骤在Ghost中是监测输入间隔，然后发送请求)</p>\n<ol>\n<li>获取标签等信息<code>/tags/?limit=all</code></li>\n<li>输入title后调用<code>/slugs/post/:inputed-title</code>会返回一个新的slug</li>\n<li>输入正文时保存<code>/posts/?include=tags</code>，其中发送的数据格式为</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    posts: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            title: <span class=\"string\">'xxx'</span>,</span><br><span class=\"line\">            slug: <span class=\"string\">'xxx'</span>, <span class=\"comment\">// 上一步获取到的slug</span></span><br><span class=\"line\">            markdown: <span class=\"string\">'xxx'</span>, <span class=\"comment\">// 输入的markdown内容</span></span><br><span class=\"line\">            image: <span class=\"string\">'xxx'</span>, <span class=\"comment\">// 文章的封面</span></span><br><span class=\"line\">            featured: <span class=\"literal\">false</span>, <span class=\"comment\">// 是否推荐</span></span><br><span class=\"line\">            page: <span class=\"literal\">false</span>, <span class=\"comment\">//是否单独页</span></span><br><span class=\"line\">            status: <span class=\"string\">\"draft\"</span>, <span class=\"comment\">// 状态为草稿或者发布published</span></span><br><span class=\"line\">            language: <span class=\"string\">\"en_US\"</span>, <span class=\"comment\">// 语言</span></span><br><span class=\"line\">            meta_title: <span class=\"literal\">null</span>, <span class=\"comment\">// 设置里面的meta信息，下同</span></span><br><span class=\"line\">            meta_description: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            author: <span class=\"string\">\"1\"</span>, <span class=\"comment\">// 作者id</span></span><br><span class=\"line\">            published_by: <span class=\"literal\">null</span>, <span class=\"comment\">// 发布者</span></span><br><span class=\"line\">            tags:[ <span class=\"comment\">// 标签数组</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    description: <span class=\"literal\">null</span></span><br><span class=\"line\">                    hidden: <span class=\"literal\">false</span></span><br><span class=\"line\">                    image: <span class=\"literal\">null</span></span><br><span class=\"line\">                    meta_description: <span class=\"literal\">null</span></span><br><span class=\"line\">                    meta_title: <span class=\"literal\">null</span></span><br><span class=\"line\">                    name: <span class=\"string\">\"tag1\"</span></span><br><span class=\"line\">                    post_count: <span class=\"literal\">null</span></span><br><span class=\"line\">                    slug: <span class=\"literal\">null</span> <span class=\"comment\">// 这个是新增的tag，没有uuid和slug</span></span><br><span class=\"line\">                    uuid: <span class=\"literal\">null</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此请求返回的数据里面有一个id，保存id，下次在保存文章时的地址就是<code>/posts/:id?include=tags</code></p>\n<p>文章的json结构体如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  slug: <span class=\"string\">\"welcome-to-ghost\"</span>, <span class=\"comment\">// 类似文章的链接</span></span><br><span class=\"line\">  status: <span class=\"string\">\"published\"</span>, <span class=\"comment\">// 文章的状态 草稿 已发布等</span></span><br><span class=\"line\">  id: <span class=\"number\">1</span>, <span class=\"comment\">// 文章ID</span></span><br><span class=\"line\">  uuid: <span class=\"string\">\"xxxx-xxxx\"</span>, <span class=\"comment\">// 文章的UUID</span></span><br><span class=\"line\">  title: <span class=\"string\">\"Welcome to Ghost\"</span>, <span class=\"comment\">// 文章标题</span></span><br><span class=\"line\">  markdown: xxx <span class=\"comment\">// 文章的markdown内容</span></span><br><span class=\"line\">  html: xxx <span class=\"comment\">// 文章的html内容</span></span><br><span class=\"line\">  image: <span class=\"literal\">null</span>, <span class=\"comment\">// 图片</span></span><br><span class=\"line\">  featured: <span class=\"literal\">false</span>, <span class=\"comment\">// 推荐</span></span><br><span class=\"line\">  page: <span class=\"literal\">false</span>, <span class=\"comment\">// 单独页</span></span><br><span class=\"line\">  language: <span class=\"string\">\"en_US\"</span>, <span class=\"comment\">// 语言</span></span><br><span class=\"line\">  meta_title: <span class=\"literal\">null</span>, <span class=\"comment\">// meta里面的title</span></span><br><span class=\"line\">  meta_description: <span class=\"literal\">null</span>, <span class=\"comment\">// meta里面的description，下面的很好理解，不做解释</span></span><br><span class=\"line\">  created_at: <span class=\"string\">\"2015-02-08T12:11:20.645Z\"</span>,</span><br><span class=\"line\">  created_by: <span class=\"number\">1</span>,</span><br><span class=\"line\">  updated_at: <span class=\"string\">\"2015-02-08T12:11:20.645Z\"</span>,</span><br><span class=\"line\">  updated_by: <span class=\"number\">1</span>,</span><br><span class=\"line\">  published_at: <span class=\"string\">\"2015-02-08T12:11:20.684Z\"</span>,</span><br><span class=\"line\">  published_by: <span class=\"number\">1</span>,</span><br><span class=\"line\">  author: <span class=\"number\">1</span>,</span><br><span class=\"line\">  url: <span class=\"string\">\"/welcome-to-ghost/\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /posts 获取所有文章，返回的数据里面还包含分页信息</li>\n<li>POST /posts 新增文章</li>\n<li>GET /posts/:id 根据ID获取文章</li>\n<li>GET /posts/slug/:slug 根据文章链接获取文章</li>\n<li>PUT /posts/:id 编辑文章</li>\n<li>DEL /posts/:id 根据ID删除文章</li>\n</ul>\n<h2 id=\"设置相关\"><a class=\"header-anchor\" href=\"#设置相关\">¶</a>设置相关</h2>\n<p>博客的设置数据的json格式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"settings\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"id\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">            <span class=\"string\">\"uuid\"</span>: <span class=\"string\">\"xxxx-xxxx\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"key\"</span>: <span class=\"string\">\"title\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"value\"</span>: <span class=\"string\">\"My blog\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"type\"</span>: <span class=\"string\">\"blog\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"created_at\"</span>: <span class=\"string\">\"2015-02-08T12:11:35.040Z\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"created_by\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">            <span class=\"string\">\"updated_at\"</span>: <span class=\"string\">\"2015-03-18T09:47:42.464Z\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"updated_by\"</span>: <span class=\"number\">1</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"key\"</span>: <span class=\"string\">\"availableThemes\"</span>, <span class=\"comment\">// 可用的主题</span></span><br><span class=\"line\">            <span class=\"string\">\"value\"</span>: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"name\"</span>: <span class=\"string\">\"casper\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"package\"</span>: &#123;</span><br><span class=\"line\">                        <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Casper\"</span>,</span><br><span class=\"line\">                        <span class=\"string\">\"version\"</span>: <span class=\"string\">\"1.1.5\"</span></span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    <span class=\"string\">\"active\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">\"type\"</span>: <span class=\"string\">\"theme\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"key\"</span>: <span class=\"string\">\"availableApps\"</span>, <span class=\"comment\">// 可用的app，当前版本暂时还不支持app的调用？</span></span><br><span class=\"line\">            <span class=\"string\">\"value\"</span>: [],</span><br><span class=\"line\">            <span class=\"string\">\"type\"</span>: <span class=\"string\">\"app\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">\"meta\"</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /settings 获取所有设置</li>\n<li>GET /settings/:key 根据指定key获取设置</li>\n<li>PUT /settings 修改设置</li>\n</ul>\n<h2 id=\"用户相关\"><a class=\"header-anchor\" href=\"#用户相关\">¶</a>用户相关</h2>\n<p>用户数据的json格式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    email: <span class=\"string\">\"your.email@email.com\"</span>,</span><br><span class=\"line\">    id: <span class=\"number\">1</span>,</span><br><span class=\"line\">    uuid: <span class=\"string\">\"xxxx-xxxx\"</span>,</span><br><span class=\"line\">    name: <span class=\"string\">\"你的名字\"</span>,</span><br><span class=\"line\">    slug: <span class=\"string\">\"exxx\"</span>, <span class=\"comment\">// slug，个人信息页面链接为http://your.blog.site/author/:slug</span></span><br><span class=\"line\">    image: <span class=\"literal\">null</span>, <span class=\"comment\">// 头像</span></span><br><span class=\"line\">    cover: <span class=\"literal\">null</span>, <span class=\"comment\">// 封面</span></span><br><span class=\"line\">    bio: <span class=\"literal\">null</span>, <span class=\"comment\">// 简介</span></span><br><span class=\"line\">    website: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    location: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    accessibility: <span class=\"literal\">null</span>, <span class=\"comment\">// 这是虾米？</span></span><br><span class=\"line\">    status: <span class=\"string\">\"active\"</span>,</span><br><span class=\"line\">    language: <span class=\"string\">\"en_US\"</span>,</span><br><span class=\"line\">    meta_title: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    meta_description: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    last_login: <span class=\"string\">\"2015-03-18T10:11:18.753Z\"</span>,</span><br><span class=\"line\">    created_at: <span class=\"string\">\"2015-02-08T12:11:34.683Z\"</span>,</span><br><span class=\"line\">    created_by: <span class=\"number\">1</span>,</span><br><span class=\"line\">    updated_at: <span class=\"string\">\"2015-03-18T10:11:18.753Z\"</span>,</span><br><span class=\"line\">    updated_by: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /users 获取所有用户</li>\n<li>GET /users/:id 根据指定Id获取用户</li>\n<li>GET /users/slug/:slug 根据用户的slug获取用户</li>\n<li>GET /users/email/:email 根据邮箱获取用户</li>\n<li>PUT /users/password 修改用户登录密码</li>\n<li>PUT /users/owner 修改用户的所有者(不懂，没测试过)</li>\n<li>PUT /users/:id 根据用户id来修改用户信息</li>\n<li>POST /users 添加用户</li>\n<li>del /users/:id 删除用户</li>\n</ul>\n<h2 id=\"标签相关\"><a class=\"header-anchor\" href=\"#标签相关\">¶</a>标签相关</h2>\n<p>标签数据的json格式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"uuid\"</span>: <span class=\"string\">\"xxxx-xxxx\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Getting Started\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"slug\"</span>: <span class=\"string\">\"getting-started\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"description\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"string\">\"image\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"string\">\"hidden\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"string\">\"meta_title\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"string\">\"meta_description\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"string\">\"created_at\"</span>: <span class=\"string\">\"2015-02-08T12:11:20.685Z\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"created_by\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"updated_at\"</span>: <span class=\"string\">\"2015-02-08T12:11:20.685Z\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"updated_by\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"parent\"</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /tags 获取所有表情</li>\n<li>GET /tags/:id 根据Id获取标签</li>\n<li>POST /tags 添加标签</li>\n<li>PUT /tags/:id 根据ID修改标签</li>\n<li>del /tags/:id 根据ID删除标签</li>\n</ul>\n<h2 id=\"角色相关\"><a class=\"header-anchor\" href=\"#角色相关\">¶</a>角色相关</h2>\n<p>角色数据的json格式</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"id\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"uuid\"</span>: <span class=\"string\">\"1b925c9f-92f2-45b3-9828-9244adbaaddc\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Administrator\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Administrators\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"created_at\"</span>: <span class=\"string\">\"2015-02-08T12:11:20.687Z\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"created_by\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"updated_at\"</span>: <span class=\"string\">\"2015-02-08T12:11:20.687Z\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"updated_by\"</span>: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /roles/ 获取所有的角色</li>\n</ul>\n<h2 id=\"Slugs\"><a class=\"header-anchor\" href=\"#Slugs\">¶</a>Slugs</h2>\n<ul>\n<li>GET /slugs/:type/:name 未研究，不做解释</li>\n</ul>\n<h2 id=\"主题\"><a class=\"header-anchor\" href=\"#主题\">¶</a>主题</h2>\n<p>主题数据的json格式</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"uuid\"</span>: <span class=\"string\">\"casper\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Casper\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.1.5\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"active\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /themes 获取所有主题</li>\n<li>PUT /themes/:name 修改当前的主题</li>\n</ul>\n<h2 id=\"通知相关\"><a class=\"header-anchor\" href=\"#通知相关\">¶</a>通知相关</h2>\n<p>通知信息的json结构</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    notifications: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">\t        dismissible： <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t        location: <span class=\"string\">'bottom'</span>,</span><br><span class=\"line\">            type<span class=\"string\">': '</span>info<span class=\"string\">', // 错误等级'</span>error<span class=\"string\">', '</span>success<span class=\"string\">', '</span>warn<span class=\"string\">' and '</span>info<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">\t        message: '</span>message<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">\t    &#125;</span></span><br><span class=\"line\"><span class=\"string\">    ]</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>GET /notifications</li>\n<li>POST /notifications</li>\n<li>del /notifications/:id</li>\n</ul>\n<h2 id=\"DB数据库\"><a class=\"header-anchor\" href=\"#DB数据库\">¶</a>DB数据库</h2>\n<p>能获得数据里的各种数据，建议不要直接操作，使用其它方法单独操作</p>\n<ul>\n<li>GET /db</li>\n<li>POST /db</li>\n<li>del /db</li>\n</ul>\n<h2 id=\"邮件\"><a class=\"header-anchor\" href=\"#邮件\">¶</a>邮件</h2>\n<p>未测试</p>\n<ul>\n<li>POST /mail 发送邮件</li>\n<li>POST /mail/test 发送测试邮件</li>\n</ul>\n<h2 id=\"用户认证\"><a class=\"header-anchor\" href=\"#用户认证\">¶</a>用户认证</h2>\n<p>未测试。。</p>\n<ul>\n<li>POST /authentication/passwordreset</li>\n<li>PUT /authentication/passwordreset</li>\n<li>POST /authentication/invitation</li>\n<li>GET /authentication/invitation</li>\n<li>POST /authentication/setup</li>\n<li>GET /authentication/setup</li>\n<li>POST /authentication/token</li>\n<li>POST /authentication/revoke</li>\n</ul>\n<h2 id=\"上传文件\"><a class=\"header-anchor\" href=\"#上传文件\">¶</a>上传文件</h2>\n<ul>\n<li>POST /uploads<br>\nuploadimage file数据，上传时的图片文件</li>\n</ul>"},{"title":"群友博文大合集","s":"ghost-list","date":"2015-01-16T06:06:00.000Z","seo":{"title":"GHOST博客集合","description":"这里罗列了我收集的GHOST博客的集合，这些博主都是来自QQ群277327792，如果你也想使用GHOST博客，欢迎加入我们。"},"_content":"<script>\n(function() {\n\tvar bloggers = [\n      {\n        \"name\": \"hellojammy\",\n        \"avater\": \"http://\"+\"hello1010.com/content/images/2015/01/0-1.jpg\",\n        \"tags\": [\"移动开发\", \"Web前端开发\", \"微信公众号开发\", \"ASP.NET\", \"软件架构设计\"],\n        \"site\": \"http://\"+\"hello1010.com/\"\n      }, {\n        \"name\": \"二锅头\",\n        \"avater\": \"http://\"+\"blog.erguotou.me/content/images/2015/01/baili.png\",\n        \"tags\": [\"WEB前端\", \"杂记\"],\n        \"site\": \"http://\"+\"blog.erguotou.me/\"\n      },{\n        \"name\": \"WINDISCO\",\n        \"avater\": \"http://\"+\"windisco.qiniudn.com/avatar_03.jpg\",\n        \"tags\": [\"iOS开发\", \"算法\", \"游戏\"],\n        \"site\": \"http://\"+\"windisco.com/\"\n      },{\n        \"name\": \"iFriskit Pro\",\n        \"avater\": \"http://\"+\"friskit-blog.qiniudn.com/b/32/aa62b93378a96475bc81927f19cfa.png\",\n        \"tags\": [\"算法\", \"机器学习与深度学习\", \"各种开发etc\"],\n        \"site\": \"http://\"+\"friskit.me/\"\n      },{\n        \"name\": \"蒋佳李\",\n        \"avater\": \"http://\"+\"www.9ute.com/content/images/2015/01/jiangjiali.png\",\n        \"tags\": [\"音乐创作\", \"录音制作\", \"技术\"],\n        \"site\": \"http://\"+\"www.9ute.com/\"\n      },{\n        \"name\": \"神楽坂立华\",\n        \"avater\": \"http://\"+\"www.moecloud.org/content/images/2015/06/images-1.jpg\",\n        \"tags\": [\"平面设计\", \"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.moecloud.org/\"\n      },{\n        \"name\": \"anly_zhang\",\n        \"avater\": \"http://\"+\"www.anlyblog.org/content/images/touxiang.jpg\",\n        \"tags\": [\"oracle\", \"数据库\", \"dba\"],\n        \"site\": \"http://\"+\"www.anlyblog.org/\"\n      },\n      /**{\n        \"name\": \"萌萌兔\",\n        \"avater\": \"http://\"+\"blog.cuterabbit.cn/content/images/2015/01/color.png\",\n        \"tags\": [\"儿童智能\", \"定位手表\"],\n        \"site\": \"http://\"+\"blog.cuterabbit.cn/\"\n      }, */\n      {\n        \"name\": \"duwei\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"web前端\"],\n        \"site\": \"http://\"+\"www.blog123.cc/\"\n      },{\n        \"name\": \"Mido\",\n        \"avater\": \"http://\"+\"i.imoe.moe/images/avatar.jpg\",\n        \"tags\": [\"程序\", \"前端\"],\n        \"site\": \"http://\"+\"imoe.moe/\"\n      },{\n        \"name\": \"Patrick\",\n        \"avater\": \"http://\"+\"dev2patrick.com/content/images/2015/07/head-2.png\",\n        \"tags\": [\"Android\", \"iOS\", \"开发\"],\n        \"site\": \"http://\"+\"dev2patrick.com/\"\n      },{\n        \"name\": \"Cho\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.znotes.info/\"\n      },{\n        \"name\": \"乐道\",\n        \"avater\": \"http://\"+\"hujunr.com/content/images/2015/02/logo.png\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"hujunr.com/\"\n      },{\n        \"name\": \"伯翎飞云\",\n        \"avater\": \"http://\"+\"jpiq.com/content/images/2015/03/8.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"jpiq.com/\"\n      },{\n        \"name\": \"君赏原创\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"paintcode\",\"ios开发\"],\n        \"site\": \"http://\"+\"www.uiapple.com/\"\n      },{\n        \"name\": \"歪歪羊\",\n        \"avater\": \"http://\"+\"www.yysheep.com/content/images/2015/03/QQ--20150308193614.png\",\n        \"tags\": [\"Java相关\",\"互联网金融\"],\n        \"site\": \"http://\"+\"www.yysheep.com/\"\n      },{\n        \"name\": \"颜值颇低\",\n        \"avater\": \"http://\"+\"weblib.duapp.com/myicon.png\",\n        \"tags\": [\"WEB研究\"],\n        \"site\": \"http://\"+\"webnn.cn/\"\n      },{\n        \"name\": \"诺步网\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"drupal\",\"前端\",\"PhoneGap\",\"微信开发\"],\n        \"site\": \"http://\"+\"nuobu.net/\"\n      },{\n        \"name\": \"谭勇\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"charstale.coding.io/\"\n      },{\n        \"name\": \"言肆\",\n        \"avater\": \"https://\"+\"suki.im/content/images/2015/06/momo1.png\",\n        \"tags\": [\"WEB开发\", \"Android\", \"服务器运维\"],\n        \"site\": \"https://\"+\"suki.im/\"\n      },{\n        \"name\": \"Cheney\",\n        \"avater\": \"http://\"+\"www.yangchengyu.net/content/images/2015/04/---1.jpg\",\n        \"tags\": [\"iOS开发\", \"Python开发\"],\n        \"site\": \"http://\"+\"www.yangchengyu.net/\"\n      }/*,{\n        \"name\": \"pican\",\n        \"avater\": \"http://\"+\"www.ipican.com/content/images/2015/05/default-1.jpeg\",\n        \"tags\": [\"iOS开发\",\"PHP开发\",\"摄影\"],\n        \"site\": \"http://\"+\"www.ipican.com/\"\n      },{\n        \"name\": \"绿叶\",\n        \"avater\": \"http://\"+\"www.lv-ye.com/content/images/2015/05/tx.png\",\n        \"tags\": [\"WEB开发\",\"程序\"],\n        \"site\": \"http://\"+\"www.lv-ye.com/\"\n      }*/,{\n        \"name\": \"董卓瑶\",\n        \"avater\": \"http://\"+\"dongzhuoyao.com/content/images/2015/07/avatar.jpg\",\n        \"tags\": [\"php框架源码分析\", \"分布式\", \"大数据\"],\n        \"site\": \"http://\"+\"dongzhuoyao.com/\"\n      },{\n        \"name\": \"MengBo' Li Blog\",\n        \"avater\": \"http://\"+\"imdst.com/content/images/2015/05/3.jpg\",\n        \"tags\": [\"Linux\", \"unix\", \"mysql\", \"python/shell\", \"运维技术分享\"],\n        \"site\": \"http://\"+\"imdst.com/\"\n      },{\n        \"name\": \"Dream\",\n        \"avater\": \"http://\"+\"q.qlogo.cn/qqapp/100229475/099CEF1841F448A7701E3908AE046B40/100\",\n        \"tags\": [\"运维\", \"专注自动化\"],\n        \"site\": \"http://\"+\"www.thedream.pub/\"\n      },{\n        \"name\": \"漫步禅意\",\n        \"avater\": \"http://\"+\"ds.cdncache.org/avatar-50/527/99892.jpg\",\n        \"tags\": [\"架构设计\",\"产品经理\", \"程序员\"],\n        \"site\": \"http://\"+\"cocojog.com/\"\n      },{\n        \"name\": \"Starriv\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"前端\", \"后端\"],\n        \"site\": \"http://\"+\"www.starriv.com\"\n      },{\n        \"name\": \"石古子\",\n        \"avater\": \"http://\"+\"blog.cytbond.cn/content/images/2015/07/QQ--20150706143009-1.jpg\",\n        \"tags\": [\"技术分享\", \"Linux\"],\n        \"site\": \"http://\"+\"blog.cytbond.cn/\"\n      },{\n        \"name\": \"云卷(juàn)云书\",\n        \"avater\": \"http://\"+\"kingyf.com/content/images/2015/08/63879-1.png\",\n        \"tags\": [\"信息安全\", \"Web服务\", \"团队管理\", \"前端技术\", \"Java开发\"],\n        \"site\": \"http://\"+\"kingyf.com/\"\n      }\n\t];\n    var tempStr = '<div class=\"blogger\"><img src=\"\"><h5></h5><tag></tag><a href=\"\" target=\"_blank\"></a></div>';\n    var t1 = setInterval(function(){\n        if (typeof jQuery !== \"undefined\") {\n        \tclearInterval(t1);\n            var js = document.createElement('script');\n            js.type= 'text/javascript';\n            js.src= \"http://\"+\"cdn.bootcss.com/jquery.isotope/2.0.0/isotope.pkgd.min.js\";\n            document.getElementsByTagName('body')[0].appendChild(js);\n            js.onload = function(){    \n                $(function() {\n                    var $container = $('#bloggers');\n                    $container.isotope({\n                        itemSelector: '.blogger',\n                        masonry: {\n                         isFitWidth :true\n                        }\n                    });\n                    for (var i = 0; i < bloggers.length; i++) {\n                        var $t = $(tempStr);\n                        $t.children('img').attr('src', bloggers[i].avater).next('h5').text(bloggers[i].name).next('tag').text(bloggers[i].tags.join(',')).next('a').attr('href', bloggers[i].site).html(bloggers[i].site);\n                        $container.isotope('insert', $t);\n                    }\n                });\n            }\n        }\n    }, 500);\n})();\n</script>\n<style>\n\t.post-template .post-header {\n    \ttext-align: center;\n    }\n\t.post-template .post {\n    \tmax-width: none;\n\t\twidth: 96%;\n\t\tmargin: 0 2%;\n    }\n    #bloggers {\n    \tmargin: 0 auto;\n    }\n\t.blogger {\n    \tposition: relative;\n        margin: 10px 8px;\n        width: 280px;\n        box-shadow: 0 0 1px 1px #ccc;\n        display: block;\n        padding: 8px;\n        box-sizing: border-box;\n        float: left;\n    }\n    .blogger:hover {\n    \tbox-shadow: 0 0 1px 1px #f60;\n    }\n    .blogger img {\n    \tposition: absolute;\n        left: 8px;\n        top: 8px;\n        padding: 0;\n    \tborder-radius: 50%;\n        width: 40px !important;\n        height: 40px !important;\n        margin: 0 !important;\n        cursor: pointer;\n        transition: all .5s;\n\t\t-moz-transition: all .5s;\n\t\t-webkit-transition: all .5s;\n\t\t-o-transition: all .5s;\n    }\n    .blogger img:hover {\n    \ttransform: rotate(360deg);\n\t\t-ms-transform: rotate(360deg);\n\t\t-webkit-transform: rotate(360deg);\n\t\t-o-transform: rotate(360deg);\n\t\t-moz-transform: rotate(360deg);\n    }\n    .blogger h5 {\n    \tdisplay: inline-block;\n        margin: 0;\n        border-left: 50px solid transparent;\n        height: 40px;\n        line-height: 40px;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        width: 100%;\n        box-sizing: border-box;\n    }\n\t.blogger tag, .blogger a {\n    \tdisplay: block;\n        margin: 1%;\n        font-size: 14px;\n        line-height: 18px;\n        text-overflow: ellipsis;\n        width: 98%;\n        overflow: hidden;\n        white-space: nowrap;\n        vertical-align: top;\n    }\n    .blogger a {\n    \tdisplay: inline-block;\n    }\n    .blogger tag:before {\n    \tcontent: '';\n    \tdisplay: inline-block;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpCNjQ0NjhERDIwMjA2ODExOTJCMEZCMzY4MDgyNUUyOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFQkVFQzVCQjlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFQkVFQzVCQTlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M0IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkVFNjBDQzc2OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkVFNjBDQzc3OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+C7ncDwAAAuhJREFUeNqEVF1I01EUv/8P/24N2dTNteWmmKKgNGzzwTS2SR8M6SGD6D36eOmhpyQjeuzdh6CX9hBhFL0EWyMLH4oWDkFouo3BYuLcHBuT4dz3+h1hNm3mhcO999xzfud3zrn3iiqVivX09Ewxxi7XarUc+zt47LlUKuWNxWIe7GvsP0PMZrOnxsbGOvr7+08XCoUsdNz+gShWZTKZYWNjw+RyuWShUOgj1JXjgLjx8fEP1WpVgmOBGNTZQJceHh5eHRwcPL+5udnp8XheBwKB9zgrNwVyOp15zK0AYSQ8z+8f5PN5trS09B37hZGRkdFEIqFbXFxc8Pv9b3FcOAokTE9Pz1YqFQkOa4IguHd2dlrBTo011c4YiUS0qNEnrGU6nc5aKpVatre3gwhaOgTkcDjmcrmcuLKyctfr9T5fX1//DacZKhMZ9Pb26qPR6Bmk54aeU6vVFwEiJzCkf8CML5fL+93w+XxXUFQbUnLs7e2J0DMUn4EBm5iYMEmSdG95edmvVCp/WSyW62az+Q6yUB4wstvtc4ggGY1G08DAwDUUeFKhULQQEFJmNCMy6+7u1sbj8bPhcNjd19eXa29vt0LfsbW1tUYlFaxW6yMoWjEEjUajQGSh7lwXAiQBmCadTg+hex6DwZDp6uqygZUmmUwGBNDOwPECDOUEUGfSTAhUr9d37O7ungsGg19Q/BhqNiWXy0uCzWbzoQ5rALAjxbZGJkelnqpWq1WijiYw+wqwBMBTlBoZhQD2E0aTAOs8CYwagDK0oRlDuBovcGk/iw1X4RsMbhaLxVe4Q6PshEFgYKNDF4uZTCYrHrrmHLcKVjcQ9SXWl04Cg908OvyD0uWbnEeQwi3Qfgd2rN6ARoG+CnkK28f0XOhZiccES0Fug34KRvfBrpFFDrpZyPyhb6TpS4YjDLOYHwAsgfkJXV40IoP1Q9TQ+c9/1AyEXj51B45lyDNIGEdXIW8QwE2/RCNLGn8EGAA/Gu2TQqEmWgAAAABJRU5ErkJggg%3D%3D);\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n    }\n    .blogger a:before {\n    \tcontent: '';\n        display: inline-block;\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n    }\n</style>\n<div id=\"bloggers\"></div>\n\n\n<div style=\"clear:both;\"></div>\n","source":"_posts/ghost-list.md","raw":"---\ntitle: 群友博文大合集\ns: ghost-list\ndate: 2015-01-16 14:06:00\ntags:\n  - Ghost\nseo:\n  title: GHOST博客集合\n  description: 这里罗列了我收集的GHOST博客的集合，这些博主都是来自QQ群277327792，如果你也想使用GHOST博客，欢迎加入我们。\n---\n<script>\n(function() {\n\tvar bloggers = [\n      {\n        \"name\": \"hellojammy\",\n        \"avater\": \"http://\"+\"hello1010.com/content/images/2015/01/0-1.jpg\",\n        \"tags\": [\"移动开发\", \"Web前端开发\", \"微信公众号开发\", \"ASP.NET\", \"软件架构设计\"],\n        \"site\": \"http://\"+\"hello1010.com/\"\n      }, {\n        \"name\": \"二锅头\",\n        \"avater\": \"http://\"+\"blog.erguotou.me/content/images/2015/01/baili.png\",\n        \"tags\": [\"WEB前端\", \"杂记\"],\n        \"site\": \"http://\"+\"blog.erguotou.me/\"\n      },{\n        \"name\": \"WINDISCO\",\n        \"avater\": \"http://\"+\"windisco.qiniudn.com/avatar_03.jpg\",\n        \"tags\": [\"iOS开发\", \"算法\", \"游戏\"],\n        \"site\": \"http://\"+\"windisco.com/\"\n      },{\n        \"name\": \"iFriskit Pro\",\n        \"avater\": \"http://\"+\"friskit-blog.qiniudn.com/b/32/aa62b93378a96475bc81927f19cfa.png\",\n        \"tags\": [\"算法\", \"机器学习与深度学习\", \"各种开发etc\"],\n        \"site\": \"http://\"+\"friskit.me/\"\n      },{\n        \"name\": \"蒋佳李\",\n        \"avater\": \"http://\"+\"www.9ute.com/content/images/2015/01/jiangjiali.png\",\n        \"tags\": [\"音乐创作\", \"录音制作\", \"技术\"],\n        \"site\": \"http://\"+\"www.9ute.com/\"\n      },{\n        \"name\": \"神楽坂立华\",\n        \"avater\": \"http://\"+\"www.moecloud.org/content/images/2015/06/images-1.jpg\",\n        \"tags\": [\"平面设计\", \"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.moecloud.org/\"\n      },{\n        \"name\": \"anly_zhang\",\n        \"avater\": \"http://\"+\"www.anlyblog.org/content/images/touxiang.jpg\",\n        \"tags\": [\"oracle\", \"数据库\", \"dba\"],\n        \"site\": \"http://\"+\"www.anlyblog.org/\"\n      },\n      /**{\n        \"name\": \"萌萌兔\",\n        \"avater\": \"http://\"+\"blog.cuterabbit.cn/content/images/2015/01/color.png\",\n        \"tags\": [\"儿童智能\", \"定位手表\"],\n        \"site\": \"http://\"+\"blog.cuterabbit.cn/\"\n      }, */\n      {\n        \"name\": \"duwei\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"web前端\"],\n        \"site\": \"http://\"+\"www.blog123.cc/\"\n      },{\n        \"name\": \"Mido\",\n        \"avater\": \"http://\"+\"i.imoe.moe/images/avatar.jpg\",\n        \"tags\": [\"程序\", \"前端\"],\n        \"site\": \"http://\"+\"imoe.moe/\"\n      },{\n        \"name\": \"Patrick\",\n        \"avater\": \"http://\"+\"dev2patrick.com/content/images/2015/07/head-2.png\",\n        \"tags\": [\"Android\", \"iOS\", \"开发\"],\n        \"site\": \"http://\"+\"dev2patrick.com/\"\n      },{\n        \"name\": \"Cho\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.znotes.info/\"\n      },{\n        \"name\": \"乐道\",\n        \"avater\": \"http://\"+\"hujunr.com/content/images/2015/02/logo.png\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"hujunr.com/\"\n      },{\n        \"name\": \"伯翎飞云\",\n        \"avater\": \"http://\"+\"jpiq.com/content/images/2015/03/8.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"jpiq.com/\"\n      },{\n        \"name\": \"君赏原创\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"paintcode\",\"ios开发\"],\n        \"site\": \"http://\"+\"www.uiapple.com/\"\n      },{\n        \"name\": \"歪歪羊\",\n        \"avater\": \"http://\"+\"www.yysheep.com/content/images/2015/03/QQ--20150308193614.png\",\n        \"tags\": [\"Java相关\",\"互联网金融\"],\n        \"site\": \"http://\"+\"www.yysheep.com/\"\n      },{\n        \"name\": \"颜值颇低\",\n        \"avater\": \"http://\"+\"weblib.duapp.com/myicon.png\",\n        \"tags\": [\"WEB研究\"],\n        \"site\": \"http://\"+\"webnn.cn/\"\n      },{\n        \"name\": \"诺步网\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"drupal\",\"前端\",\"PhoneGap\",\"微信开发\"],\n        \"site\": \"http://\"+\"nuobu.net/\"\n      },{\n        \"name\": \"谭勇\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"charstale.coding.io/\"\n      },{\n        \"name\": \"言肆\",\n        \"avater\": \"https://\"+\"suki.im/content/images/2015/06/momo1.png\",\n        \"tags\": [\"WEB开发\", \"Android\", \"服务器运维\"],\n        \"site\": \"https://\"+\"suki.im/\"\n      },{\n        \"name\": \"Cheney\",\n        \"avater\": \"http://\"+\"www.yangchengyu.net/content/images/2015/04/---1.jpg\",\n        \"tags\": [\"iOS开发\", \"Python开发\"],\n        \"site\": \"http://\"+\"www.yangchengyu.net/\"\n      }/*,{\n        \"name\": \"pican\",\n        \"avater\": \"http://\"+\"www.ipican.com/content/images/2015/05/default-1.jpeg\",\n        \"tags\": [\"iOS开发\",\"PHP开发\",\"摄影\"],\n        \"site\": \"http://\"+\"www.ipican.com/\"\n      },{\n        \"name\": \"绿叶\",\n        \"avater\": \"http://\"+\"www.lv-ye.com/content/images/2015/05/tx.png\",\n        \"tags\": [\"WEB开发\",\"程序\"],\n        \"site\": \"http://\"+\"www.lv-ye.com/\"\n      }*/,{\n        \"name\": \"董卓瑶\",\n        \"avater\": \"http://\"+\"dongzhuoyao.com/content/images/2015/07/avatar.jpg\",\n        \"tags\": [\"php框架源码分析\", \"分布式\", \"大数据\"],\n        \"site\": \"http://\"+\"dongzhuoyao.com/\"\n      },{\n        \"name\": \"MengBo' Li Blog\",\n        \"avater\": \"http://\"+\"imdst.com/content/images/2015/05/3.jpg\",\n        \"tags\": [\"Linux\", \"unix\", \"mysql\", \"python/shell\", \"运维技术分享\"],\n        \"site\": \"http://\"+\"imdst.com/\"\n      },{\n        \"name\": \"Dream\",\n        \"avater\": \"http://\"+\"q.qlogo.cn/qqapp/100229475/099CEF1841F448A7701E3908AE046B40/100\",\n        \"tags\": [\"运维\", \"专注自动化\"],\n        \"site\": \"http://\"+\"www.thedream.pub/\"\n      },{\n        \"name\": \"漫步禅意\",\n        \"avater\": \"http://\"+\"ds.cdncache.org/avatar-50/527/99892.jpg\",\n        \"tags\": [\"架构设计\",\"产品经理\", \"程序员\"],\n        \"site\": \"http://\"+\"cocojog.com/\"\n      },{\n        \"name\": \"Starriv\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"前端\", \"后端\"],\n        \"site\": \"http://\"+\"www.starriv.com\"\n      },{\n        \"name\": \"石古子\",\n        \"avater\": \"http://\"+\"blog.cytbond.cn/content/images/2015/07/QQ--20150706143009-1.jpg\",\n        \"tags\": [\"技术分享\", \"Linux\"],\n        \"site\": \"http://\"+\"blog.cytbond.cn/\"\n      },{\n        \"name\": \"云卷(juàn)云书\",\n        \"avater\": \"http://\"+\"kingyf.com/content/images/2015/08/63879-1.png\",\n        \"tags\": [\"信息安全\", \"Web服务\", \"团队管理\", \"前端技术\", \"Java开发\"],\n        \"site\": \"http://\"+\"kingyf.com/\"\n      }\n\t];\n    var tempStr = '<div class=\"blogger\"><img src=\"\"><h5></h5><tag></tag><a href=\"\" target=\"_blank\"></a></div>';\n    var t1 = setInterval(function(){\n        if (typeof jQuery !== \"undefined\") {\n        \tclearInterval(t1);\n            var js = document.createElement('script');\n            js.type= 'text/javascript';\n            js.src= \"http://\"+\"cdn.bootcss.com/jquery.isotope/2.0.0/isotope.pkgd.min.js\";\n            document.getElementsByTagName('body')[0].appendChild(js);\n            js.onload = function(){    \n                $(function() {\n                    var $container = $('#bloggers');\n                    $container.isotope({\n                        itemSelector: '.blogger',\n                        masonry: {\n                         isFitWidth :true\n                        }\n                    });\n                    for (var i = 0; i < bloggers.length; i++) {\n                        var $t = $(tempStr);\n                        $t.children('img').attr('src', bloggers[i].avater).next('h5').text(bloggers[i].name).next('tag').text(bloggers[i].tags.join(',')).next('a').attr('href', bloggers[i].site).html(bloggers[i].site);\n                        $container.isotope('insert', $t);\n                    }\n                });\n            }\n        }\n    }, 500);\n})();\n</script>\n<style>\n\t.post-template .post-header {\n    \ttext-align: center;\n    }\n\t.post-template .post {\n    \tmax-width: none;\n\t\twidth: 96%;\n\t\tmargin: 0 2%;\n    }\n    #bloggers {\n    \tmargin: 0 auto;\n    }\n\t.blogger {\n    \tposition: relative;\n        margin: 10px 8px;\n        width: 280px;\n        box-shadow: 0 0 1px 1px #ccc;\n        display: block;\n        padding: 8px;\n        box-sizing: border-box;\n        float: left;\n    }\n    .blogger:hover {\n    \tbox-shadow: 0 0 1px 1px #f60;\n    }\n    .blogger img {\n    \tposition: absolute;\n        left: 8px;\n        top: 8px;\n        padding: 0;\n    \tborder-radius: 50%;\n        width: 40px !important;\n        height: 40px !important;\n        margin: 0 !important;\n        cursor: pointer;\n        transition: all .5s;\n\t\t-moz-transition: all .5s;\n\t\t-webkit-transition: all .5s;\n\t\t-o-transition: all .5s;\n    }\n    .blogger img:hover {\n    \ttransform: rotate(360deg);\n\t\t-ms-transform: rotate(360deg);\n\t\t-webkit-transform: rotate(360deg);\n\t\t-o-transform: rotate(360deg);\n\t\t-moz-transform: rotate(360deg);\n    }\n    .blogger h5 {\n    \tdisplay: inline-block;\n        margin: 0;\n        border-left: 50px solid transparent;\n        height: 40px;\n        line-height: 40px;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        width: 100%;\n        box-sizing: border-box;\n    }\n\t.blogger tag, .blogger a {\n    \tdisplay: block;\n        margin: 1%;\n        font-size: 14px;\n        line-height: 18px;\n        text-overflow: ellipsis;\n        width: 98%;\n        overflow: hidden;\n        white-space: nowrap;\n        vertical-align: top;\n    }\n    .blogger a {\n    \tdisplay: inline-block;\n    }\n    .blogger tag:before {\n    \tcontent: '';\n    \tdisplay: inline-block;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpCNjQ0NjhERDIwMjA2ODExOTJCMEZCMzY4MDgyNUUyOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFQkVFQzVCQjlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFQkVFQzVCQTlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M0IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkVFNjBDQzc2OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkVFNjBDQzc3OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+C7ncDwAAAuhJREFUeNqEVF1I01EUv/8P/24N2dTNteWmmKKgNGzzwTS2SR8M6SGD6D36eOmhpyQjeuzdh6CX9hBhFL0EWyMLH4oWDkFouo3BYuLcHBuT4dz3+h1hNm3mhcO999xzfud3zrn3iiqVivX09Ewxxi7XarUc+zt47LlUKuWNxWIe7GvsP0PMZrOnxsbGOvr7+08XCoUsdNz+gShWZTKZYWNjw+RyuWShUOgj1JXjgLjx8fEP1WpVgmOBGNTZQJceHh5eHRwcPL+5udnp8XheBwKB9zgrNwVyOp15zK0AYSQ8z+8f5PN5trS09B37hZGRkdFEIqFbXFxc8Pv9b3FcOAokTE9Pz1YqFQkOa4IguHd2dlrBTo011c4YiUS0qNEnrGU6nc5aKpVatre3gwhaOgTkcDjmcrmcuLKyctfr9T5fX1//DacZKhMZ9Pb26qPR6Bmk54aeU6vVFwEiJzCkf8CML5fL+93w+XxXUFQbUnLs7e2J0DMUn4EBm5iYMEmSdG95edmvVCp/WSyW62az+Q6yUB4wstvtc4ggGY1G08DAwDUUeFKhULQQEFJmNCMy6+7u1sbj8bPhcNjd19eXa29vt0LfsbW1tUYlFaxW6yMoWjEEjUajQGSh7lwXAiQBmCadTg+hex6DwZDp6uqygZUmmUwGBNDOwPECDOUEUGfSTAhUr9d37O7ungsGg19Q/BhqNiWXy0uCzWbzoQ5rALAjxbZGJkelnqpWq1WijiYw+wqwBMBTlBoZhQD2E0aTAOs8CYwagDK0oRlDuBovcGk/iw1X4RsMbhaLxVe4Q6PshEFgYKNDF4uZTCYrHrrmHLcKVjcQ9SXWl04Cg908OvyD0uWbnEeQwi3Qfgd2rN6ARoG+CnkK28f0XOhZiccES0Fug34KRvfBrpFFDrpZyPyhb6TpS4YjDLOYHwAsgfkJXV40IoP1Q9TQ+c9/1AyEXj51B45lyDNIGEdXIW8QwE2/RCNLGn8EGAA/Gu2TQqEmWgAAAABJRU5ErkJggg%3D%3D);\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n    }\n    .blogger a:before {\n    \tcontent: '';\n        display: inline-block;\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n    }\n</style>\n<div id=\"bloggers\"></div>\n\n\n<div style=\"clear:both;\"></div>\n","slug":"ghost-list","published":1,"updated":"2016-08-28T08:52:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox1u003ptof9s1oasgru","content":"<script>\n(function() {\n\tvar bloggers = [\n      {\n        \"name\": \"hellojammy\",\n        \"avater\": \"http://\"+\"hello1010.com/content/images/2015/01/0-1.jpg\",\n        \"tags\": [\"移动开发\", \"Web前端开发\", \"微信公众号开发\", \"ASP.NET\", \"软件架构设计\"],\n        \"site\": \"http://\"+\"hello1010.com/\"\n      }, {\n        \"name\": \"二锅头\",\n        \"avater\": \"http://\"+\"blog.erguotou.me/content/images/2015/01/baili.png\",\n        \"tags\": [\"WEB前端\", \"杂记\"],\n        \"site\": \"http://\"+\"blog.erguotou.me/\"\n      },{\n        \"name\": \"WINDISCO\",\n        \"avater\": \"http://\"+\"windisco.qiniudn.com/avatar_03.jpg\",\n        \"tags\": [\"iOS开发\", \"算法\", \"游戏\"],\n        \"site\": \"http://\"+\"windisco.com/\"\n      },{\n        \"name\": \"iFriskit Pro\",\n        \"avater\": \"http://\"+\"friskit-blog.qiniudn.com/b/32/aa62b93378a96475bc81927f19cfa.png\",\n        \"tags\": [\"算法\", \"机器学习与深度学习\", \"各种开发etc\"],\n        \"site\": \"http://\"+\"friskit.me/\"\n      },{\n        \"name\": \"蒋佳李\",\n        \"avater\": \"http://\"+\"www.9ute.com/content/images/2015/01/jiangjiali.png\",\n        \"tags\": [\"音乐创作\", \"录音制作\", \"技术\"],\n        \"site\": \"http://\"+\"www.9ute.com/\"\n      },{\n        \"name\": \"神楽坂立华\",\n        \"avater\": \"http://\"+\"www.moecloud.org/content/images/2015/06/images-1.jpg\",\n        \"tags\": [\"平面设计\", \"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.moecloud.org/\"\n      },{\n        \"name\": \"anly_zhang\",\n        \"avater\": \"http://\"+\"www.anlyblog.org/content/images/touxiang.jpg\",\n        \"tags\": [\"oracle\", \"数据库\", \"dba\"],\n        \"site\": \"http://\"+\"www.anlyblog.org/\"\n      },\n      /**{\n        \"name\": \"萌萌兔\",\n        \"avater\": \"http://\"+\"blog.cuterabbit.cn/content/images/2015/01/color.png\",\n        \"tags\": [\"儿童智能\", \"定位手表\"],\n        \"site\": \"http://\"+\"blog.cuterabbit.cn/\"\n      }, */\n      {\n        \"name\": \"duwei\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"web前端\"],\n        \"site\": \"http://\"+\"www.blog123.cc/\"\n      },{\n        \"name\": \"Mido\",\n        \"avater\": \"http://\"+\"i.imoe.moe/images/avatar.jpg\",\n        \"tags\": [\"程序\", \"前端\"],\n        \"site\": \"http://\"+\"imoe.moe/\"\n      },{\n        \"name\": \"Patrick\",\n        \"avater\": \"http://\"+\"dev2patrick.com/content/images/2015/07/head-2.png\",\n        \"tags\": [\"Android\", \"iOS\", \"开发\"],\n        \"site\": \"http://\"+\"dev2patrick.com/\"\n      },{\n        \"name\": \"Cho\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.znotes.info/\"\n      },{\n        \"name\": \"乐道\",\n        \"avater\": \"http://\"+\"hujunr.com/content/images/2015/02/logo.png\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"hujunr.com/\"\n      },{\n        \"name\": \"伯翎飞云\",\n        \"avater\": \"http://\"+\"jpiq.com/content/images/2015/03/8.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"jpiq.com/\"\n      },{\n        \"name\": \"君赏原创\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"paintcode\",\"ios开发\"],\n        \"site\": \"http://\"+\"www.uiapple.com/\"\n      },{\n        \"name\": \"歪歪羊\",\n        \"avater\": \"http://\"+\"www.yysheep.com/content/images/2015/03/QQ--20150308193614.png\",\n        \"tags\": [\"Java相关\",\"互联网金融\"],\n        \"site\": \"http://\"+\"www.yysheep.com/\"\n      },{\n        \"name\": \"颜值颇低\",\n        \"avater\": \"http://\"+\"weblib.duapp.com/myicon.png\",\n        \"tags\": [\"WEB研究\"],\n        \"site\": \"http://\"+\"webnn.cn/\"\n      },{\n        \"name\": \"诺步网\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"drupal\",\"前端\",\"PhoneGap\",\"微信开发\"],\n        \"site\": \"http://\"+\"nuobu.net/\"\n      },{\n        \"name\": \"谭勇\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"charstale.coding.io/\"\n      },{\n        \"name\": \"言肆\",\n        \"avater\": \"https://\"+\"suki.im/content/images/2015/06/momo1.png\",\n        \"tags\": [\"WEB开发\", \"Android\", \"服务器运维\"],\n        \"site\": \"https://\"+\"suki.im/\"\n      },{\n        \"name\": \"Cheney\",\n        \"avater\": \"http://\"+\"www.yangchengyu.net/content/images/2015/04/---1.jpg\",\n        \"tags\": [\"iOS开发\", \"Python开发\"],\n        \"site\": \"http://\"+\"www.yangchengyu.net/\"\n      }/*,{\n        \"name\": \"pican\",\n        \"avater\": \"http://\"+\"www.ipican.com/content/images/2015/05/default-1.jpeg\",\n        \"tags\": [\"iOS开发\",\"PHP开发\",\"摄影\"],\n        \"site\": \"http://\"+\"www.ipican.com/\"\n      },{\n        \"name\": \"绿叶\",\n        \"avater\": \"http://\"+\"www.lv-ye.com/content/images/2015/05/tx.png\",\n        \"tags\": [\"WEB开发\",\"程序\"],\n        \"site\": \"http://\"+\"www.lv-ye.com/\"\n      }*/,{\n        \"name\": \"董卓瑶\",\n        \"avater\": \"http://\"+\"dongzhuoyao.com/content/images/2015/07/avatar.jpg\",\n        \"tags\": [\"php框架源码分析\", \"分布式\", \"大数据\"],\n        \"site\": \"http://\"+\"dongzhuoyao.com/\"\n      },{\n        \"name\": \"MengBo' Li Blog\",\n        \"avater\": \"http://\"+\"imdst.com/content/images/2015/05/3.jpg\",\n        \"tags\": [\"Linux\", \"unix\", \"mysql\", \"python/shell\", \"运维技术分享\"],\n        \"site\": \"http://\"+\"imdst.com/\"\n      },{\n        \"name\": \"Dream\",\n        \"avater\": \"http://\"+\"q.qlogo.cn/qqapp/100229475/099CEF1841F448A7701E3908AE046B40/100\",\n        \"tags\": [\"运维\", \"专注自动化\"],\n        \"site\": \"http://\"+\"www.thedream.pub/\"\n      },{\n        \"name\": \"漫步禅意\",\n        \"avater\": \"http://\"+\"ds.cdncache.org/avatar-50/527/99892.jpg\",\n        \"tags\": [\"架构设计\",\"产品经理\", \"程序员\"],\n        \"site\": \"http://\"+\"cocojog.com/\"\n      },{\n        \"name\": \"Starriv\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"前端\", \"后端\"],\n        \"site\": \"http://\"+\"www.starriv.com\"\n      },{\n        \"name\": \"石古子\",\n        \"avater\": \"http://\"+\"blog.cytbond.cn/content/images/2015/07/QQ--20150706143009-1.jpg\",\n        \"tags\": [\"技术分享\", \"Linux\"],\n        \"site\": \"http://\"+\"blog.cytbond.cn/\"\n      },{\n        \"name\": \"云卷(juàn)云书\",\n        \"avater\": \"http://\"+\"kingyf.com/content/images/2015/08/63879-1.png\",\n        \"tags\": [\"信息安全\", \"Web服务\", \"团队管理\", \"前端技术\", \"Java开发\"],\n        \"site\": \"http://\"+\"kingyf.com/\"\n      }\n\t];\n    var tempStr = '<div class=\"blogger\"><img src=\"\"><h5></h5><tag></tag><a href=\"\" target=\"_blank\"></a></div>';\n    var t1 = setInterval(function(){\n        if (typeof jQuery !== \"undefined\") {\n        \tclearInterval(t1);\n            var js = document.createElement('script');\n            js.type= 'text/javascript';\n            js.src= \"http://\"+\"cdn.bootcss.com/jquery.isotope/2.0.0/isotope.pkgd.min.js\";\n            document.getElementsByTagName('body')[0].appendChild(js);\n            js.onload = function(){    \n                $(function() {\n                    var $container = $('#bloggers');\n                    $container.isotope({\n                        itemSelector: '.blogger',\n                        masonry: {\n                         isFitWidth :true\n                        }\n                    });\n                    for (var i = 0; i < bloggers.length; i++) {\n                        var $t = $(tempStr);\n                        $t.children('img').attr('src', bloggers[i].avater).next('h5').text(bloggers[i].name).next('tag').text(bloggers[i].tags.join(',')).next('a').attr('href', bloggers[i].site).html(bloggers[i].site);\n                        $container.isotope('insert', $t);\n                    }\n                });\n            }\n        }\n    }, 500);\n})();\n</script>\n<style>\n\t.post-template .post-header {\n    \ttext-align: center;\n    }\n\t.post-template .post {\n    \tmax-width: none;\n\t\twidth: 96%;\n\t\tmargin: 0 2%;\n    }\n    #bloggers {\n    \tmargin: 0 auto;\n    }\n\t.blogger {\n    \tposition: relative;\n        margin: 10px 8px;\n        width: 280px;\n        box-shadow: 0 0 1px 1px #ccc;\n        display: block;\n        padding: 8px;\n        box-sizing: border-box;\n        float: left;\n    }\n    .blogger:hover {\n    \tbox-shadow: 0 0 1px 1px #f60;\n    }\n    .blogger img {\n    \tposition: absolute;\n        left: 8px;\n        top: 8px;\n        padding: 0;\n    \tborder-radius: 50%;\n        width: 40px !important;\n        height: 40px !important;\n        margin: 0 !important;\n        cursor: pointer;\n        transition: all .5s;\n\t\t-moz-transition: all .5s;\n\t\t-webkit-transition: all .5s;\n\t\t-o-transition: all .5s;\n    }\n    .blogger img:hover {\n    \ttransform: rotate(360deg);\n\t\t-ms-transform: rotate(360deg);\n\t\t-webkit-transform: rotate(360deg);\n\t\t-o-transform: rotate(360deg);\n\t\t-moz-transform: rotate(360deg);\n    }\n    .blogger h5 {\n    \tdisplay: inline-block;\n        margin: 0;\n        border-left: 50px solid transparent;\n        height: 40px;\n        line-height: 40px;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        width: 100%;\n        box-sizing: border-box;\n    }\n\t.blogger tag, .blogger a {\n    \tdisplay: block;\n        margin: 1%;\n        font-size: 14px;\n        line-height: 18px;\n        text-overflow: ellipsis;\n        width: 98%;\n        overflow: hidden;\n        white-space: nowrap;\n        vertical-align: top;\n    }\n    .blogger a {\n    \tdisplay: inline-block;\n    }\n    .blogger tag:before {\n    \tcontent: '';\n    \tdisplay: inline-block;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpCNjQ0NjhERDIwMjA2ODExOTJCMEZCMzY4MDgyNUUyOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFQkVFQzVCQjlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFQkVFQzVCQTlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M0IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkVFNjBDQzc2OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkVFNjBDQzc3OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+C7ncDwAAAuhJREFUeNqEVF1I01EUv/8P/24N2dTNteWmmKKgNGzzwTS2SR8M6SGD6D36eOmhpyQjeuzdh6CX9hBhFL0EWyMLH4oWDkFouo3BYuLcHBuT4dz3+h1hNm3mhcO999xzfud3zrn3iiqVivX09Ewxxi7XarUc+zt47LlUKuWNxWIe7GvsP0PMZrOnxsbGOvr7+08XCoUsdNz+gShWZTKZYWNjw+RyuWShUOgj1JXjgLjx8fEP1WpVgmOBGNTZQJceHh5eHRwcPL+5udnp8XheBwKB9zgrNwVyOp15zK0AYSQ8z+8f5PN5trS09B37hZGRkdFEIqFbXFxc8Pv9b3FcOAokTE9Pz1YqFQkOa4IguHd2dlrBTo011c4YiUS0qNEnrGU6nc5aKpVatre3gwhaOgTkcDjmcrmcuLKyctfr9T5fX1//DacZKhMZ9Pb26qPR6Bmk54aeU6vVFwEiJzCkf8CML5fL+93w+XxXUFQbUnLs7e2J0DMUn4EBm5iYMEmSdG95edmvVCp/WSyW62az+Q6yUB4wstvtc4ggGY1G08DAwDUUeFKhULQQEFJmNCMy6+7u1sbj8bPhcNjd19eXa29vt0LfsbW1tUYlFaxW6yMoWjEEjUajQGSh7lwXAiQBmCadTg+hex6DwZDp6uqygZUmmUwGBNDOwPECDOUEUGfSTAhUr9d37O7ungsGg19Q/BhqNiWXy0uCzWbzoQ5rALAjxbZGJkelnqpWq1WijiYw+wqwBMBTlBoZhQD2E0aTAOs8CYwagDK0oRlDuBovcGk/iw1X4RsMbhaLxVe4Q6PshEFgYKNDF4uZTCYrHrrmHLcKVjcQ9SXWl04Cg908OvyD0uWbnEeQwi3Qfgd2rN6ARoG+CnkK28f0XOhZiccES0Fug34KRvfBrpFFDrpZyPyhb6TpS4YjDLOYHwAsgfkJXV40IoP1Q9TQ+c9/1AyEXj51B45lyDNIGEdXIW8QwE2/RCNLGn8EGAA/Gu2TQqEmWgAAAABJRU5ErkJggg%3D%3D);\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n    }\n    .blogger a:before {\n    \tcontent: '';\n        display: inline-block;\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n    }\n</style>\n<div id=\"bloggers\"></div>\n<div style=\"clear:both;\"></div>\n","site":{"data":{}},"excerpt":"","more":"<script>\n(function() {\n\tvar bloggers = [\n      {\n        \"name\": \"hellojammy\",\n        \"avater\": \"http://\"+\"hello1010.com/content/images/2015/01/0-1.jpg\",\n        \"tags\": [\"移动开发\", \"Web前端开发\", \"微信公众号开发\", \"ASP.NET\", \"软件架构设计\"],\n        \"site\": \"http://\"+\"hello1010.com/\"\n      }, {\n        \"name\": \"二锅头\",\n        \"avater\": \"http://\"+\"blog.erguotou.me/content/images/2015/01/baili.png\",\n        \"tags\": [\"WEB前端\", \"杂记\"],\n        \"site\": \"http://\"+\"blog.erguotou.me/\"\n      },{\n        \"name\": \"WINDISCO\",\n        \"avater\": \"http://\"+\"windisco.qiniudn.com/avatar_03.jpg\",\n        \"tags\": [\"iOS开发\", \"算法\", \"游戏\"],\n        \"site\": \"http://\"+\"windisco.com/\"\n      },{\n        \"name\": \"iFriskit Pro\",\n        \"avater\": \"http://\"+\"friskit-blog.qiniudn.com/b/32/aa62b93378a96475bc81927f19cfa.png\",\n        \"tags\": [\"算法\", \"机器学习与深度学习\", \"各种开发etc\"],\n        \"site\": \"http://\"+\"friskit.me/\"\n      },{\n        \"name\": \"蒋佳李\",\n        \"avater\": \"http://\"+\"www.9ute.com/content/images/2015/01/jiangjiali.png\",\n        \"tags\": [\"音乐创作\", \"录音制作\", \"技术\"],\n        \"site\": \"http://\"+\"www.9ute.com/\"\n      },{\n        \"name\": \"神楽坂立华\",\n        \"avater\": \"http://\"+\"www.moecloud.org/content/images/2015/06/images-1.jpg\",\n        \"tags\": [\"平面设计\", \"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.moecloud.org/\"\n      },{\n        \"name\": \"anly_zhang\",\n        \"avater\": \"http://\"+\"www.anlyblog.org/content/images/touxiang.jpg\",\n        \"tags\": [\"oracle\", \"数据库\", \"dba\"],\n        \"site\": \"http://\"+\"www.anlyblog.org/\"\n      },\n      /**{\n        \"name\": \"萌萌兔\",\n        \"avater\": \"http://\"+\"blog.cuterabbit.cn/content/images/2015/01/color.png\",\n        \"tags\": [\"儿童智能\", \"定位手表\"],\n        \"site\": \"http://\"+\"blog.cuterabbit.cn/\"\n      }, */\n      {\n        \"name\": \"duwei\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"web前端\"],\n        \"site\": \"http://\"+\"www.blog123.cc/\"\n      },{\n        \"name\": \"Mido\",\n        \"avater\": \"http://\"+\"i.imoe.moe/images/avatar.jpg\",\n        \"tags\": [\"程序\", \"前端\"],\n        \"site\": \"http://\"+\"imoe.moe/\"\n      },{\n        \"name\": \"Patrick\",\n        \"avater\": \"http://\"+\"dev2patrick.com/content/images/2015/07/head-2.png\",\n        \"tags\": [\"Android\", \"iOS\", \"开发\"],\n        \"site\": \"http://\"+\"dev2patrick.com/\"\n      },{\n        \"name\": \"Cho\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"DIY\", \"电子爱好者\"],\n        \"site\": \"http://\"+\"www.znotes.info/\"\n      },{\n        \"name\": \"乐道\",\n        \"avater\": \"http://\"+\"hujunr.com/content/images/2015/02/logo.png\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"hujunr.com/\"\n      },{\n        \"name\": \"伯翎飞云\",\n        \"avater\": \"http://\"+\"jpiq.com/content/images/2015/03/8.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"jpiq.com/\"\n      },{\n        \"name\": \"君赏原创\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"paintcode\",\"ios开发\"],\n        \"site\": \"http://\"+\"www.uiapple.com/\"\n      },{\n        \"name\": \"歪歪羊\",\n        \"avater\": \"http://\"+\"www.yysheep.com/content/images/2015/03/QQ--20150308193614.png\",\n        \"tags\": [\"Java相关\",\"互联网金融\"],\n        \"site\": \"http://\"+\"www.yysheep.com/\"\n      },{\n        \"name\": \"颜值颇低\",\n        \"avater\": \"http://\"+\"weblib.duapp.com/myicon.png\",\n        \"tags\": [\"WEB研究\"],\n        \"site\": \"http://\"+\"webnn.cn/\"\n      },{\n        \"name\": \"诺步网\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"drupal\",\"前端\",\"PhoneGap\",\"微信开发\"],\n        \"site\": \"http://\"+\"nuobu.net/\"\n      },{\n        \"name\": \"谭勇\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"杂文\"],\n        \"site\": \"http://\"+\"charstale.coding.io/\"\n      },{\n        \"name\": \"言肆\",\n        \"avater\": \"https://\"+\"suki.im/content/images/2015/06/momo1.png\",\n        \"tags\": [\"WEB开发\", \"Android\", \"服务器运维\"],\n        \"site\": \"https://\"+\"suki.im/\"\n      },{\n        \"name\": \"Cheney\",\n        \"avater\": \"http://\"+\"www.yangchengyu.net/content/images/2015/04/---1.jpg\",\n        \"tags\": [\"iOS开发\", \"Python开发\"],\n        \"site\": \"http://\"+\"www.yangchengyu.net/\"\n      }/*,{\n        \"name\": \"pican\",\n        \"avater\": \"http://\"+\"www.ipican.com/content/images/2015/05/default-1.jpeg\",\n        \"tags\": [\"iOS开发\",\"PHP开发\",\"摄影\"],\n        \"site\": \"http://\"+\"www.ipican.com/\"\n      },{\n        \"name\": \"绿叶\",\n        \"avater\": \"http://\"+\"www.lv-ye.com/content/images/2015/05/tx.png\",\n        \"tags\": [\"WEB开发\",\"程序\"],\n        \"site\": \"http://\"+\"www.lv-ye.com/\"\n      }*/,{\n        \"name\": \"董卓瑶\",\n        \"avater\": \"http://\"+\"dongzhuoyao.com/content/images/2015/07/avatar.jpg\",\n        \"tags\": [\"php框架源码分析\", \"分布式\", \"大数据\"],\n        \"site\": \"http://\"+\"dongzhuoyao.com/\"\n      },{\n        \"name\": \"MengBo' Li Blog\",\n        \"avater\": \"http://\"+\"imdst.com/content/images/2015/05/3.jpg\",\n        \"tags\": [\"Linux\", \"unix\", \"mysql\", \"python/shell\", \"运维技术分享\"],\n        \"site\": \"http://\"+\"imdst.com/\"\n      },{\n        \"name\": \"Dream\",\n        \"avater\": \"http://\"+\"q.qlogo.cn/qqapp/100229475/099CEF1841F448A7701E3908AE046B40/100\",\n        \"tags\": [\"运维\", \"专注自动化\"],\n        \"site\": \"http://\"+\"www.thedream.pub/\"\n      },{\n        \"name\": \"漫步禅意\",\n        \"avater\": \"http://\"+\"ds.cdncache.org/avatar-50/527/99892.jpg\",\n        \"tags\": [\"架构设计\",\"产品经理\", \"程序员\"],\n        \"site\": \"http://\"+\"cocojog.com/\"\n      },{\n        \"name\": \"Starriv\",\n        \"avater\": \"http://\"+\"mimg.127.net/p/js6/lib/img/noface.gif\",\n        \"tags\": [\"前端\", \"后端\"],\n        \"site\": \"http://\"+\"www.starriv.com\"\n      },{\n        \"name\": \"石古子\",\n        \"avater\": \"http://\"+\"blog.cytbond.cn/content/images/2015/07/QQ--20150706143009-1.jpg\",\n        \"tags\": [\"技术分享\", \"Linux\"],\n        \"site\": \"http://\"+\"blog.cytbond.cn/\"\n      },{\n        \"name\": \"云卷(juàn)云书\",\n        \"avater\": \"http://\"+\"kingyf.com/content/images/2015/08/63879-1.png\",\n        \"tags\": [\"信息安全\", \"Web服务\", \"团队管理\", \"前端技术\", \"Java开发\"],\n        \"site\": \"http://\"+\"kingyf.com/\"\n      }\n\t];\n    var tempStr = '<div class=\"blogger\"><img src=\"\"><h5></h5><tag></tag><a href=\"\" target=\"_blank\"></a></div>';\n    var t1 = setInterval(function(){\n        if (typeof jQuery !== \"undefined\") {\n        \tclearInterval(t1);\n            var js = document.createElement('script');\n            js.type= 'text/javascript';\n            js.src= \"http://\"+\"cdn.bootcss.com/jquery.isotope/2.0.0/isotope.pkgd.min.js\";\n            document.getElementsByTagName('body')[0].appendChild(js);\n            js.onload = function(){    \n                $(function() {\n                    var $container = $('#bloggers');\n                    $container.isotope({\n                        itemSelector: '.blogger',\n                        masonry: {\n                         isFitWidth :true\n                        }\n                    });\n                    for (var i = 0; i < bloggers.length; i++) {\n                        var $t = $(tempStr);\n                        $t.children('img').attr('src', bloggers[i].avater).next('h5').text(bloggers[i].name).next('tag').text(bloggers[i].tags.join(',')).next('a').attr('href', bloggers[i].site).html(bloggers[i].site);\n                        $container.isotope('insert', $t);\n                    }\n                });\n            }\n        }\n    }, 500);\n})();\n</script>\n<style>\n\t.post-template .post-header {\n    \ttext-align: center;\n    }\n\t.post-template .post {\n    \tmax-width: none;\n\t\twidth: 96%;\n\t\tmargin: 0 2%;\n    }\n    #bloggers {\n    \tmargin: 0 auto;\n    }\n\t.blogger {\n    \tposition: relative;\n        margin: 10px 8px;\n        width: 280px;\n        box-shadow: 0 0 1px 1px #ccc;\n        display: block;\n        padding: 8px;\n        box-sizing: border-box;\n        float: left;\n    }\n    .blogger:hover {\n    \tbox-shadow: 0 0 1px 1px #f60;\n    }\n    .blogger img {\n    \tposition: absolute;\n        left: 8px;\n        top: 8px;\n        padding: 0;\n    \tborder-radius: 50%;\n        width: 40px !important;\n        height: 40px !important;\n        margin: 0 !important;\n        cursor: pointer;\n        transition: all .5s;\n\t\t-moz-transition: all .5s;\n\t\t-webkit-transition: all .5s;\n\t\t-o-transition: all .5s;\n    }\n    .blogger img:hover {\n    \ttransform: rotate(360deg);\n\t\t-ms-transform: rotate(360deg);\n\t\t-webkit-transform: rotate(360deg);\n\t\t-o-transform: rotate(360deg);\n\t\t-moz-transform: rotate(360deg);\n    }\n    .blogger h5 {\n    \tdisplay: inline-block;\n        margin: 0;\n        border-left: 50px solid transparent;\n        height: 40px;\n        line-height: 40px;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        width: 100%;\n        box-sizing: border-box;\n    }\n\t.blogger tag, .blogger a {\n    \tdisplay: block;\n        margin: 1%;\n        font-size: 14px;\n        line-height: 18px;\n        text-overflow: ellipsis;\n        width: 98%;\n        overflow: hidden;\n        white-space: nowrap;\n        vertical-align: top;\n    }\n    .blogger a {\n    \tdisplay: inline-block;\n    }\n    .blogger tag:before {\n    \tcontent: '';\n    \tdisplay: inline-block;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpCNjQ0NjhERDIwMjA2ODExOTJCMEZCMzY4MDgyNUUyOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFQkVFQzVCQjlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFQkVFQzVCQTlENEQxMUU0QUZFRkIyOUNDQjQxQjIyNiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M0IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkVFNjBDQzc2OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkVFNjBDQzc3OUQ0QTExRTRCQUQxQkM4ODMzOUY5RkRBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+C7ncDwAAAuhJREFUeNqEVF1I01EUv/8P/24N2dTNteWmmKKgNGzzwTS2SR8M6SGD6D36eOmhpyQjeuzdh6CX9hBhFL0EWyMLH4oWDkFouo3BYuLcHBuT4dz3+h1hNm3mhcO999xzfud3zrn3iiqVivX09Ewxxi7XarUc+zt47LlUKuWNxWIe7GvsP0PMZrOnxsbGOvr7+08XCoUsdNz+gShWZTKZYWNjw+RyuWShUOgj1JXjgLjx8fEP1WpVgmOBGNTZQJceHh5eHRwcPL+5udnp8XheBwKB9zgrNwVyOp15zK0AYSQ8z+8f5PN5trS09B37hZGRkdFEIqFbXFxc8Pv9b3FcOAokTE9Pz1YqFQkOa4IguHd2dlrBTo011c4YiUS0qNEnrGU6nc5aKpVatre3gwhaOgTkcDjmcrmcuLKyctfr9T5fX1//DacZKhMZ9Pb26qPR6Bmk54aeU6vVFwEiJzCkf8CML5fL+93w+XxXUFQbUnLs7e2J0DMUn4EBm5iYMEmSdG95edmvVCp/WSyW62az+Q6yUB4wstvtc4ggGY1G08DAwDUUeFKhULQQEFJmNCMy6+7u1sbj8bPhcNjd19eXa29vt0LfsbW1tUYlFaxW6yMoWjEEjUajQGSh7lwXAiQBmCadTg+hex6DwZDp6uqygZUmmUwGBNDOwPECDOUEUGfSTAhUr9d37O7ungsGg19Q/BhqNiWXy0uCzWbzoQ5rALAjxbZGJkelnqpWq1WijiYw+wqwBMBTlBoZhQD2E0aTAOs8CYwagDK0oRlDuBovcGk/iw1X4RsMbhaLxVe4Q6PshEFgYKNDF4uZTCYrHrrmHLcKVjcQ9SXWl04Cg908OvyD0uWbnEeQwi3Qfgd2rN6ARoG+CnkK28f0XOhZiccES0Fug34KRvfBrpFFDrpZyPyhb6TpS4YjDLOYHwAsgfkJXV40IoP1Q9TQ+c9/1AyEXj51B45lyDNIGEdXIW8QwE2/RCNLGn8EGAA/Gu2TQqEmWgAAAABJRU5ErkJggg%3D%3D);\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n    }\n    .blogger a:before {\n    \tcontent: '';\n        display: inline-block;\n        width: 18px;\n        height: 18px;\n        background-size: 100% 100%;\n        margin-right: 8px;\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZFMzkzMDREOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZFMzkzMDRFOUQ0RTExRTRCMEE5OEU4MUE4Q0QxNTZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkUzOTMwNEI5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkUzOTMwNEM5RDRFMTFFNEIwQTk4RTgxQThDRDE1NkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5OMX2LAAABV0lEQVR42pTSzStEURjH8Tneig1FNBvKTmoWSko0ChsLL4kslK1ssLDx0pSYnYVShplZs/E2YsEGf4PssPCy8Q8gub6nnlun23XnmVuf7p157v2d85xzTKz0awm9+MUP9j3Pu6ooIaASO/jGHN7RjZQxpkYbYgfMIR1Sa8VZmTIkgzcsB4u09cTtWRM0JWGpiHeqNUFd2JXnOMbcIuszyq1WE1SOTzTgAO43SSxiTbPQ/RjCCYYDIXdIsE4xE/LhNDpk5GPc4xCXOJcZDmDSHgNCHvwdcVvIynNW2olLO2n5vSEDvGICH8FZVCGPdee/epxiAT3/9W3bsvxZ7WHTqbfgRtakGUfFguw05/GFFadu12gbBRnI0+zKBRoj6rPY0rRWiAhJSotNmiC7xZ0h7/ThFu1R7bhBg7hGm1Mfl5BEsXXxg/wDOYIZvMhRqMMqHjVB9voTYADxfGp9UkgPWgAAAABJRU5ErkJggg%3D%3D);\n    }\n</style>\n<div id=\"bloggers\"></div>\n<div style=\"clear:both;\"></div>\n"},{"title":"利用Traefik搭建超简单的DevOps平台","s":"traefik-devops","date":"2020-02-16T06:38:00.000Z","thumbnail":"/images/devops/traefik-devops.jpg","_content":"\n又是好久没有写博客了，忽然有点自己不知道继续往哪个方向发展，一会搞搞Flutter，一会又玩玩Docker，有时又想做些框架沉淀，很多东西都没深入做下去。正好之前搞的DevOps平台最近需要做些扩展，就花点时间把这次经验记录下来方便以后查看:joy:。\n\n## 首先，做什么？为什么做？\n还是DevOps，还是为了简化开发，还是低端机器，所以选择的方案依然是Gogs+drone。但是这次的方案有别于之前的Dokku，而是使用`traefik`作为网关服务器并且提供自动设置HTTPS的功能。先看下什么是`traefik`：\n<!-- more -->\n\n> Traefik 是一个边缘路由器，这意味着它是您平台的大门，它拦截并路由每个传入的请求:\n> ![Traefik示意图](https://traefik.tech/docs/assets/img/traefik-concepts-1.png)\n>\n> 它管理所有逻辑和每个规则确定哪些服务处理哪些请求（基于路径，主机，headers，等等......）。\n>\n\n`traefik`支持服务自动发现，当我们在Docker上使用`traefik`时，只需给Docker容器指定Label，就可以让`traefik`自动发现它们，自动完成端口映射、域名绑定、HTTPS证书管理等:thinking:。\n\n所以基于`traefik`的部署方案可以让我们省去很多配置工作（比如Nginx的配置，Let's Encrypt的证书申请和更新，负载均衡等），当然也留给了我们很多坑...:worried:\n\n## 其次，准备阶段\n一个1核2G2M的云服务器，ssh登录上，安装docker，安装docker-compose，这些官网都有教程，很简单，掠过。\n\n然后我们先提前做好域名映射，如果你使`用traefik`的`dnsChallenge`方式可以跳过，`traefik`会利用api自动为你做好域名映射（应该是吧，反正我没用过，我更喜欢自己把控:thinking:）：\n```\ntraefik.erguotou.me -> ip\nwhoami.erguotou.me -> ip\ngogs.erguotou.me -> ip\ndrone.erguotou.me -> ip\nregistry.erguotou.me -> ip\nregistry-ui.erguotou.me -> ip\n```\n\n然后我们新建`.env`文件，并填入下面内容\n\n```text\n# 顶级域名，此处替换成自己的\nSERVER_DOMAIN=erguotou.me\n\n# Time Zone\nTIME_ZONE=Asia/Shanghai\n\n# ACME，此处替换成自己的\nACME_EMAIL=xxx\n\n# Drone，此处替换成自己的\nDRONE_SECRET=xxx\nDRONE_ADMIN=xxx\n\n# basicauth用户密码\n# 使用 echo $(htpasswd -nb user password) 生成用户密钥\n# 如果直接在yml中使用需要改为 echo $(htpasswd -nb user password) | sed -e s/\\\\$/\\\\$\\\\$/g\nTRAEFIK_AUTH_USER=xxx\nREGISTRY_AUTH_USER=xxx\nREGISTRY_UI_AUTH_USER=xxx\n```\n\n接着新建一个`docker-compose.yml`文件，并填入下面内容\n```yaml\n# 目前最新版本，可以支持更多特性，虽然我可能也没用上啥特性\nversion: \"3.7\"\nservices:\n  traefik:\n    # The official docker image\n    image: traefik:latest\n    container_name: traefik\n    # Enables the web UI and tells Traefik to listen to docker\n    command:\n      # 提供web查看页面\n      - \"--api.insecure=true\"\n      # 使用docker provider\n      - \"--providers.docker=true\"\n      # 取消暴露所有的容器，由我们自己把控\n      - \"--providers.docker.exposedbydefault=false\"\n      # 定义websecure\n      - \"--entryPoints.websecure.address=:443\"\n      # 使用tlschallenge方式进行https证书管理，当前也可以使用httpChallenge或者dnsChallenge\n      - \"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"\n      # - \"--certificatesResolvers.mytlschallenge.acme.httpchallenge.entryPoint=web\"\n      # 指定Let's Encrypt证书获取所使用的邮箱地址\n      - \"--certificatesResolvers.mytlschallenge.acme.email=${ACME_EMAIL}\"\n      # acme.json文件存储位置（容器内），方便后续暴露出来\n      - \"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"\n    ports:\n      - \"443:443\"\n      # The Web UI (enabled by --api.insecure=true)\n      - \"8080:8080\"\n    volumes:\n      - \"./acme:/etc/acme\"\n      # So that Traefik can listen to the Docker events\n      - \"/var/run/docker.sock:/var/run/docker.sock:ro\"\n    environment:\n      - TZ=${TIME_ZONE}\n\n  # 先启用一个官方示例的容器\n  whoami:\n    image: containous/whoami\n    container_name: simple-service\n    labels:\n      - \"traefik.enable=true\"\n      # 告诉traefik映射80端口\n      - \"traefik.http.services.whoami.loadbalancer.server.port=80\"\n      - \"traefik.http.routers.whoami.rule=Host(`whoami.${SERVER_DOMAIN}`)\"\n      # 告诉traefik入口方式使用https\n      - \"traefik.http.routers.whoami.entrypoints=websecure\"\n      - \"traefik.http.routers.whoami.tls.certresolver=mytlschallenge\"\n```\n\n最后运行`docker-compose up`运行，我们看到`http://traefik.erguotou.me:8080/dashboard/`和`https://whoami.erguotou.me/`都可以正常访问，并且在traefik的Dashboard里可以看到成功纳管了一个Router。\n![traefik面板](/images/devops/traefik-only-whoami.png)\n![whoami启动完成](/images/devops/whoami.png)\n\n## 再次，尝试与填坑\n初步测试成功后我们开始搭建我们的DevOps平台，我们在原来的`docker-compose.yml`文件中追加以下内容\n\n```yml\nversion: \"3.7\"\n\nservices:\n  # ...原来的内容，下面是新增的\n  # gogs\n  gogs:\n    container_name: gogs\n    image: gogs/gogs\n    restart: always\n    hostname: gogs\n    ports:\n      - \"10022:22\"\n    volumes:\n      - ./devops/gogs:/data\n    environment:\n      - TZ=${TIME_ZONE}\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.services.gogs.loadbalancer.server.port=3000\"\n      - \"traefik.http.routers.gogs.rule=Host(`gogs.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.gogs.entrypoints=websecure\"\n      - \"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"\n  # drone 服务端\n  drone-server:\n    container_name: drone-server\n    image: drone/drone\n    restart: always\n    hostname: drone-server\n    volumes:\n      - ./devops/drone-server:/var/lib/drone/\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_GOGS_SERVER=https://gogs.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_SERVER_PROTO=https\n      # 设置管理员\n      - DRONE_USER_CREATE=username:${DRONE_ADMIN},admin:true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.drone-server.rule=Host(`drone.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.drone-server.entrypoints=websecure\"\n      - \"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"\n  # drone agent\n  drone-agent:\n    container_name: drone-agent\n    image: drone/agent\n    restart: always\n    hostname: drone-agent\n    depends_on:\n      # 让server先起\n      - drone-server\n    # deploy:\n      # mode: replicated\n      # replicas: 6\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_RPC_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_PROTO=https\n      # 一台机器最多同时跑2个任务\n      - DRONE_RUNNER_CAPACITY=2\n      # - DRONE_RUNNER_NAME=${HOSTNAME}\n    labels:\n      # agent不需要对外暴露\n      - \"traefik.enable=false\"\n  # docker registry\n  registry:\n    container_name: registry\n    image: registry\n    restart: always\n    hostname: registry\n    volumes:\n      - ./devops/registry:/var/lib/registry\n    environment:\n      - TZ=${TIME_ZONE}\n      - REGISTRY_STORAGE_DELETE_ENABLED=true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.registry.rule=Host(`registry.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry.entrypoints=websecure\"\n      - \"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry.middlewares=registry-auth@docker\"\n       - \"traefik.http.middlewares.registry-auth.basicauth.users=${REGISTRY_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"\n  # docker registry 可视化web页面\n  registry-ui:\n    container_name: registry-ui\n    image: quiq/docker-registry-ui\n    #image: jc21/registry-ui\n    #image: konradkleine/docker-registry-frontend:v2\n    restart: always\n    hostname: registry-ui\n    depends_on:\n      - registry\n    environment:\n      - TZ=${TIME_ZONE}\n    # 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功\n    expose:\n      - 8000\n    volumes:\n      - ./devops/registry-ui.yml:/opt/config.yml:ro\n    labels:\n      - \"traefik.enable=true\"\n      # 添加一个basic auth\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.users=${REGISTRY_UI_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"\n      - \"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"\n      - \"traefik.http.routers.registry-ui.rule=Host(`registry-ui.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry-ui.entrypoints=websecure\"\n      - \"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"\n```\n对于`registry-ui`镜像的选择，原来用的是`konradkleine/docker-registry-frontend:v2`，后来也试过`jc21/registry-ui`，但是容器体积都比较大，最后换了go语言的`quiq/docker-registry-ui`（每种镜像的配置稍有差异）要知道在小内存服务器上，Golang一条线才是正道:joy:。\n\n除此之外我们给`registry`和`registry-ui`加了一个`traefik`提供的`baisicauth`中间件，帮助我们添加一层安全认证，只有指定的用户可以查看，方便:+1:！同时配置中提到的`registry-ui.yml`文件的内容如下（去掉了很多注释，具体可以看容器的文档说明）：\n\n```yaml\nlisten_addr: 0.0.0.0:8000\nbase_path: /\n\nregistry_url: https://registry.erguotou.me\nverify_tls: true\n# 更换成自己的\nregistry_username: user\nregistry_password: pass\nevent_database_driver: sqlite3\nevent_database_location: data/registry_events.db\nevent_deletion_enabled: False\ncache_refresh_interval: 10\nanyone_can_delete: false\nadmins: []\ndebug: false\npurge_tags_keep_days: 90\npurge_tags_keep_count: 2\npurge_tags_schedule: ''\n```\n\n我们开始启动服务`docker-compose up`，然后打开`gogs.erguotou.me`开始配置gogs，同时`drone`,`registry`,`registry-ui`服务也都起好了。\n![初步启动完成](/images/devops/traefik-devops1.png)\n等等，不是说好多坑么？Emmmmm~ 我这都是坑填完了得出的配置，`traefik`文档也不知道看了多少次，配置试了多少次。:sweat_smile:\n\n一切看起来那么的美好:smirk:\n\n## 接着，深入与实践\n虽然服务都启动了，但还有些可以优化的点，并且我们还要验证下整个DevOps流程是否可以跑通，尤其是drone的agent我们还没有验证呢。在这之前我们先将配置文件分离下，按功能将`docker-compose.yml`中的service分开到多个文件中分别启动。\n\n### 服务拆分\n1. 删除初始版本中的`whoami`服务\n\n2. 在`devops`目录新增`docker-compose.yml`文件，将后续添加的services剪切到yml文件中（yml文件中services和version根节点也要复制）\n\n3. 修改`devops/docker-compose.yml`中`volumns`中映射路径\n\n4. 分别启动`docker-compose up -d`和`docker-compose -f ./devops/docker-compose.yml up -d`\n\n这里关于`.env`文件我做了一些测试，发现在`traefik`同级创建的`.env`文件在`devops`目录中不做任何操作可以直接访问到里面的环境变量，之前还一直以为需要手动指定呢。\n\n~~另外上面的环境变量其实是不对了，原来的`.env`文件是当前目录下的，但是现在目录结构变了，所以那些环境变量就取不到了。\n其实[有很多方法可以实现环境变量共享](https://stackoverflow.com/questions/36283908/re-using-environmental-variables-in-docker-compose-yml)，本来打算用`extends env_file`实现的，结果compose 3版本后不支持了，那就采用每个service指定`env_file`的方案吧（虽然有点麻烦），修改完重新启动。~~\n\n访问不了？先看下`traefik`的路由表，发现有接入，但就是访问不了。无意间在查看`registry-ui`的启动日志时发现错误，说`registry.erguotou.me`访问不了。这是为什么呢？又是一番搜索排查尝试，最终发现当`devops services`和`traefik service`不在同一个文件时，我们需要让它们加入同一个网络，这样子`traefik`才可以完成自动代理。于是我们开始给`traefik`服务关联网络，给`devops`里的各种服务也绑定同样的网络。同时需要添加新的label`traefik.docker.network=traefik_webgateway`。改完重启，一切OK（最终配置可查看下文）。\n\n### 给Traefik增加安全性\n现在我们的`traefik`开启了8080的Dashboard，意味着别人也能看到我们的内容，所以在生产环境下我们需要关闭`traefik`的`api`服务，或者至少我们需要给`api`加一层认证。\n\n关闭的话直接在`traefik`的`service`中把`--api.insecure=true`改为`--api=false`即可。\n\n如果想看Dashboard又想安全性可以用上面说到的`basic auth`套一层，\n\n### 验证DevOps流程\n这里我们以一个简单的vue项目做测试看下如何实现`devops`自动化。\n\n1. 在gogs上新建一个临时项目`/tmp/vue-demo`\n\n2. 在本地使用`Vue cli`创建一个demo项目，并上传到git服务。此时不会触发任何后续操作\n\n3. 添加`.drone.yml`，推送到仓库，yml文件内容大致如下\n  ```yml\n  ---\n  kind: pipeline\n  name: default\n\n  trigger:\n    event:\n      - tag\n\n  steps:\n    - name: build\n      image: plugins/docker\n      settings:\n        dockerfile: docker/Dockerfile\n        registry: registry.erguotou.me\n        repo: registry.erguotou.me/tmp/vue-demo\n        username:\n          from_secret: REGISTRY_USER\n        password:\n          from_secret: REGISTRY_PASSWORD\n        tags:\n          - latest\n          - ${DRONE_TAG}\n        auto_tag: true\n        force_tag: true\n    - name: deploy\n      image: appleboy/drone-ssh\n      settings:\n        host: vue-demo.erguotou.me\n        username:\n          from_secret: SSH_USER\n        ssh_key:\n          from_secret: SSH_KEY\n        script:\n          # 在机器上执行一次login操作，以后就不用了\n          # - docker login registry.erguotou.me --username ${REGISTRY_USER} --password ${REGISTRY_PASSWORD}\n          - docker pull registry.erguotou.me/tmp/vue-demo:${DRONE_TAG}\n          - docker-compose -f apps/vue-demo/docker-compose.yml stop\n          - docker-compose -f apps/vue-demo/docker-compose.yml rm -f\n          - docker-compose -f apps/vue-demo/docker-compose.yml up -d\n    - name: send-wechat\n      image: yakumioto/drone-serverchan\n      settings:\n        key:\n          from_secret: SERVERCHAN_KEY\n        text: \"部署结果\"\n        # 目前该插件支持能力稍微不足，后期可以考虑自己开发下\n        desp: \"部署完成，[点击前往查看](https://vue-demo.erguotou.me)\"\n  ```\n\n4. 查看drone上的构建结果，查看registry是否推送成功，查看项目是否部署成功\n，最后结果可以成功，[点击地址查看](https://vue-demo.erguotou.me)。\n![DevOps流程全部走完](/images/devops/traefik-drone-devops.png)\n\n### 最终配置\n最终`docker-compose.yml`文件内容如下：\n\n```yml\nversion: \"3.7\"\n\nservices:\n  traefik:\n    image: traefik:latest\n    container_name: traefik\n    command:\n      - \"--api=true\"\n      - \"--api.dashboard=true\"\n      - \"--providers.docker=true\"\n      # 默认加入此网络，也许关联networks之后可以不设置？反正不关联networks其它的都映射不成功\n      - \"--providers.docker.network=traefik_webgateway\"\n      - \"--providers.docker.exposedbydefault=false\"\n      - \"--entryPoints.websecure.address=:443\"\n      - \"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"\n      - \"--certificatesResolvers.mytlschallenge.acme.email=${ACME_EMAIL}\"\n      - \"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.api.rule=Host(`traefik.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.api.service=api@internal\"\n      - \"traefik.http.services.api.loadbalancer.server.port=8080\"\n      - \"traefik.http.routers.api.entrypoints=websecure\"\n      - \"traefik.http.routers.api.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.api.middlewares=auth\"\n      - \"traefik.http.middlewares.auth.basicauth.users=${TRAEFIK_AUTH_USER}\"\n    networks:\n      - traefik_webgateway\n    ports:\n      - \"443:443\"\n    volumes:\n      - \"./acme:/etc/acme\"\n      - \"/var/run/docker.sock:/var/run/docker.sock:ro\"\n    environment:\n      - TZ=${TIME_ZONE}\nnetworks:\n  traefik_webgateway:\n    name: traefik_webgateway\n    driver: bridge\n```\n\n`devops/docker-compose.yml`文件内容如下：\n\n```yml\nversion: \"3.7\"\n\nservices:\n  # gogs\n  gogs:\n    container_name: gogs\n    image: gogs/gogs\n    restart: always\n    hostname: gogs\n    networks:\n      - traefik\n    ports:\n      - \"10022:22\"\n    volumes:\n      - ./gogs:/data\n    environment:\n      - TZ=${TIME_ZONE}\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.services.gogs.loadbalancer.server.port=3000\"\n      - \"traefik.http.routers.gogs.rule=Host(`gogs.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.gogs.entrypoints=websecure\"\n      - \"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"\n  # drone 服务端\n  drone-server:\n    container_name: drone-server\n    image: drone/drone\n    restart: always\n    hostname: drone-server\n    networks:\n      - traefik\n    volumes:\n      - ./drone-server:/var/lib/drone/\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_GOGS_SERVER=https://gogs.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_SERVER_PROTO=https\n      # 设置管理员\n      - DRONE_USER_CREATE=username:${DRONE_ADMIN},admin:true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.drone-server.rule=Host(`drone.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.drone-server.entrypoints=websecure\"\n      - \"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"\n  # drone agent\n  drone-agent:\n    container_name: drone-agent\n    image: drone/agent\n    restart: always\n    hostname: drone-agent\n    depends_on:\n      # 让server先起\n      - drone-server\n    # deploy:\n      # mode: replicated\n      # replicas: 6\n    networks:\n      - traefik\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_RPC_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_PROTO=https\n      # 一台机器最多同时跑2个任务\n      - DRONE_RUNNER_CAPACITY=2\n      # - DRONE_RUNNER_NAME=${HOSTNAME}\n    labels:\n      # agent不需要对外暴露\n      - \"traefik.enable=false\"\n  # docker registry\n  registry:\n    container_name: registry\n    image: registry\n    restart: always\n    hostname: registry\n    networks:\n      - traefik\n    volumes:\n      - ./registry:/var/lib/registry\n    environment:\n      - TZ=${TIME_ZONE}\n      - REGISTRY_STORAGE_DELETE_ENABLED=true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.registry.rule=Host(`registry.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry.entrypoints=websecure\"\n      - \"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry.middlewares=registry-auth@docker\"\n      - \"traefik.http.middlewares.registry-auth.basicauth.users=${REGISTRY_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"\n  # docker registry 可视化web页面\n  registry-ui:\n    container_name: registry-ui\n    image: quiq/docker-registry-ui\n    restart: always\n    hostname: registry-ui\n    networks:\n      - traefik\n    depends_on:\n      - registry\n    environment:\n      - TZ=${TIME_ZONE}\n    # 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功\n    expose:\n      - 8000\n    volumes:\n      - ./registry-ui.yml:/opt/config.yml:ro\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"\n      - \"traefik.http.routers.registry-ui.rule=Host(`registry-ui.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry-ui.entrypoints=websecure\"\n      - \"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.users=${REGISTRY_UI_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"\n\nnetworks:\n  traefik:\n    external:\n      name: traefik_webgateway\n```\n\n`traefik`的Dashboard效果如下：\n![Traefik Dashboard](/images/devops/traefik-devops-final.png)\n\n## 最后，总结\n通过这么多天的不断学习和尝试，基本上填完了`traefik`作为网关路由器的坑，也让我学习了`traefik`的各种配置，最终组建了自己的`DevOps`平台。最终流程走通后心情非常舒畅，感觉完成了天大的事:joy:。\n\n我们可以浅尝辄止，也可以深坑直入。这是自己的选择，也许也决定了自己的高度。\n\n分享此文，给可能需要的人。\n","source":"_posts/traefik-devops.md","raw":"---\ntitle: 利用Traefik搭建超简单的DevOps平台\ns: traefik-devops\ndate: 2020-02-16 14:38:00\nthumbnail: /images/devops/traefik-devops.jpg\ntags:\n  - traefik\n  - devops\n  - gogs\n  - drone\n  - registry\n---\n\n又是好久没有写博客了，忽然有点自己不知道继续往哪个方向发展，一会搞搞Flutter，一会又玩玩Docker，有时又想做些框架沉淀，很多东西都没深入做下去。正好之前搞的DevOps平台最近需要做些扩展，就花点时间把这次经验记录下来方便以后查看:joy:。\n\n## 首先，做什么？为什么做？\n还是DevOps，还是为了简化开发，还是低端机器，所以选择的方案依然是Gogs+drone。但是这次的方案有别于之前的Dokku，而是使用`traefik`作为网关服务器并且提供自动设置HTTPS的功能。先看下什么是`traefik`：\n<!-- more -->\n\n> Traefik 是一个边缘路由器，这意味着它是您平台的大门，它拦截并路由每个传入的请求:\n> ![Traefik示意图](https://traefik.tech/docs/assets/img/traefik-concepts-1.png)\n>\n> 它管理所有逻辑和每个规则确定哪些服务处理哪些请求（基于路径，主机，headers，等等......）。\n>\n\n`traefik`支持服务自动发现，当我们在Docker上使用`traefik`时，只需给Docker容器指定Label，就可以让`traefik`自动发现它们，自动完成端口映射、域名绑定、HTTPS证书管理等:thinking:。\n\n所以基于`traefik`的部署方案可以让我们省去很多配置工作（比如Nginx的配置，Let's Encrypt的证书申请和更新，负载均衡等），当然也留给了我们很多坑...:worried:\n\n## 其次，准备阶段\n一个1核2G2M的云服务器，ssh登录上，安装docker，安装docker-compose，这些官网都有教程，很简单，掠过。\n\n然后我们先提前做好域名映射，如果你使`用traefik`的`dnsChallenge`方式可以跳过，`traefik`会利用api自动为你做好域名映射（应该是吧，反正我没用过，我更喜欢自己把控:thinking:）：\n```\ntraefik.erguotou.me -> ip\nwhoami.erguotou.me -> ip\ngogs.erguotou.me -> ip\ndrone.erguotou.me -> ip\nregistry.erguotou.me -> ip\nregistry-ui.erguotou.me -> ip\n```\n\n然后我们新建`.env`文件，并填入下面内容\n\n```text\n# 顶级域名，此处替换成自己的\nSERVER_DOMAIN=erguotou.me\n\n# Time Zone\nTIME_ZONE=Asia/Shanghai\n\n# ACME，此处替换成自己的\nACME_EMAIL=xxx\n\n# Drone，此处替换成自己的\nDRONE_SECRET=xxx\nDRONE_ADMIN=xxx\n\n# basicauth用户密码\n# 使用 echo $(htpasswd -nb user password) 生成用户密钥\n# 如果直接在yml中使用需要改为 echo $(htpasswd -nb user password) | sed -e s/\\\\$/\\\\$\\\\$/g\nTRAEFIK_AUTH_USER=xxx\nREGISTRY_AUTH_USER=xxx\nREGISTRY_UI_AUTH_USER=xxx\n```\n\n接着新建一个`docker-compose.yml`文件，并填入下面内容\n```yaml\n# 目前最新版本，可以支持更多特性，虽然我可能也没用上啥特性\nversion: \"3.7\"\nservices:\n  traefik:\n    # The official docker image\n    image: traefik:latest\n    container_name: traefik\n    # Enables the web UI and tells Traefik to listen to docker\n    command:\n      # 提供web查看页面\n      - \"--api.insecure=true\"\n      # 使用docker provider\n      - \"--providers.docker=true\"\n      # 取消暴露所有的容器，由我们自己把控\n      - \"--providers.docker.exposedbydefault=false\"\n      # 定义websecure\n      - \"--entryPoints.websecure.address=:443\"\n      # 使用tlschallenge方式进行https证书管理，当前也可以使用httpChallenge或者dnsChallenge\n      - \"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"\n      # - \"--certificatesResolvers.mytlschallenge.acme.httpchallenge.entryPoint=web\"\n      # 指定Let's Encrypt证书获取所使用的邮箱地址\n      - \"--certificatesResolvers.mytlschallenge.acme.email=${ACME_EMAIL}\"\n      # acme.json文件存储位置（容器内），方便后续暴露出来\n      - \"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"\n    ports:\n      - \"443:443\"\n      # The Web UI (enabled by --api.insecure=true)\n      - \"8080:8080\"\n    volumes:\n      - \"./acme:/etc/acme\"\n      # So that Traefik can listen to the Docker events\n      - \"/var/run/docker.sock:/var/run/docker.sock:ro\"\n    environment:\n      - TZ=${TIME_ZONE}\n\n  # 先启用一个官方示例的容器\n  whoami:\n    image: containous/whoami\n    container_name: simple-service\n    labels:\n      - \"traefik.enable=true\"\n      # 告诉traefik映射80端口\n      - \"traefik.http.services.whoami.loadbalancer.server.port=80\"\n      - \"traefik.http.routers.whoami.rule=Host(`whoami.${SERVER_DOMAIN}`)\"\n      # 告诉traefik入口方式使用https\n      - \"traefik.http.routers.whoami.entrypoints=websecure\"\n      - \"traefik.http.routers.whoami.tls.certresolver=mytlschallenge\"\n```\n\n最后运行`docker-compose up`运行，我们看到`http://traefik.erguotou.me:8080/dashboard/`和`https://whoami.erguotou.me/`都可以正常访问，并且在traefik的Dashboard里可以看到成功纳管了一个Router。\n![traefik面板](/images/devops/traefik-only-whoami.png)\n![whoami启动完成](/images/devops/whoami.png)\n\n## 再次，尝试与填坑\n初步测试成功后我们开始搭建我们的DevOps平台，我们在原来的`docker-compose.yml`文件中追加以下内容\n\n```yml\nversion: \"3.7\"\n\nservices:\n  # ...原来的内容，下面是新增的\n  # gogs\n  gogs:\n    container_name: gogs\n    image: gogs/gogs\n    restart: always\n    hostname: gogs\n    ports:\n      - \"10022:22\"\n    volumes:\n      - ./devops/gogs:/data\n    environment:\n      - TZ=${TIME_ZONE}\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.services.gogs.loadbalancer.server.port=3000\"\n      - \"traefik.http.routers.gogs.rule=Host(`gogs.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.gogs.entrypoints=websecure\"\n      - \"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"\n  # drone 服务端\n  drone-server:\n    container_name: drone-server\n    image: drone/drone\n    restart: always\n    hostname: drone-server\n    volumes:\n      - ./devops/drone-server:/var/lib/drone/\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_GOGS_SERVER=https://gogs.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_SERVER_PROTO=https\n      # 设置管理员\n      - DRONE_USER_CREATE=username:${DRONE_ADMIN},admin:true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.drone-server.rule=Host(`drone.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.drone-server.entrypoints=websecure\"\n      - \"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"\n  # drone agent\n  drone-agent:\n    container_name: drone-agent\n    image: drone/agent\n    restart: always\n    hostname: drone-agent\n    depends_on:\n      # 让server先起\n      - drone-server\n    # deploy:\n      # mode: replicated\n      # replicas: 6\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_RPC_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_PROTO=https\n      # 一台机器最多同时跑2个任务\n      - DRONE_RUNNER_CAPACITY=2\n      # - DRONE_RUNNER_NAME=${HOSTNAME}\n    labels:\n      # agent不需要对外暴露\n      - \"traefik.enable=false\"\n  # docker registry\n  registry:\n    container_name: registry\n    image: registry\n    restart: always\n    hostname: registry\n    volumes:\n      - ./devops/registry:/var/lib/registry\n    environment:\n      - TZ=${TIME_ZONE}\n      - REGISTRY_STORAGE_DELETE_ENABLED=true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.registry.rule=Host(`registry.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry.entrypoints=websecure\"\n      - \"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry.middlewares=registry-auth@docker\"\n       - \"traefik.http.middlewares.registry-auth.basicauth.users=${REGISTRY_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"\n  # docker registry 可视化web页面\n  registry-ui:\n    container_name: registry-ui\n    image: quiq/docker-registry-ui\n    #image: jc21/registry-ui\n    #image: konradkleine/docker-registry-frontend:v2\n    restart: always\n    hostname: registry-ui\n    depends_on:\n      - registry\n    environment:\n      - TZ=${TIME_ZONE}\n    # 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功\n    expose:\n      - 8000\n    volumes:\n      - ./devops/registry-ui.yml:/opt/config.yml:ro\n    labels:\n      - \"traefik.enable=true\"\n      # 添加一个basic auth\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.users=${REGISTRY_UI_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"\n      - \"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"\n      - \"traefik.http.routers.registry-ui.rule=Host(`registry-ui.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry-ui.entrypoints=websecure\"\n      - \"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"\n```\n对于`registry-ui`镜像的选择，原来用的是`konradkleine/docker-registry-frontend:v2`，后来也试过`jc21/registry-ui`，但是容器体积都比较大，最后换了go语言的`quiq/docker-registry-ui`（每种镜像的配置稍有差异）要知道在小内存服务器上，Golang一条线才是正道:joy:。\n\n除此之外我们给`registry`和`registry-ui`加了一个`traefik`提供的`baisicauth`中间件，帮助我们添加一层安全认证，只有指定的用户可以查看，方便:+1:！同时配置中提到的`registry-ui.yml`文件的内容如下（去掉了很多注释，具体可以看容器的文档说明）：\n\n```yaml\nlisten_addr: 0.0.0.0:8000\nbase_path: /\n\nregistry_url: https://registry.erguotou.me\nverify_tls: true\n# 更换成自己的\nregistry_username: user\nregistry_password: pass\nevent_database_driver: sqlite3\nevent_database_location: data/registry_events.db\nevent_deletion_enabled: False\ncache_refresh_interval: 10\nanyone_can_delete: false\nadmins: []\ndebug: false\npurge_tags_keep_days: 90\npurge_tags_keep_count: 2\npurge_tags_schedule: ''\n```\n\n我们开始启动服务`docker-compose up`，然后打开`gogs.erguotou.me`开始配置gogs，同时`drone`,`registry`,`registry-ui`服务也都起好了。\n![初步启动完成](/images/devops/traefik-devops1.png)\n等等，不是说好多坑么？Emmmmm~ 我这都是坑填完了得出的配置，`traefik`文档也不知道看了多少次，配置试了多少次。:sweat_smile:\n\n一切看起来那么的美好:smirk:\n\n## 接着，深入与实践\n虽然服务都启动了，但还有些可以优化的点，并且我们还要验证下整个DevOps流程是否可以跑通，尤其是drone的agent我们还没有验证呢。在这之前我们先将配置文件分离下，按功能将`docker-compose.yml`中的service分开到多个文件中分别启动。\n\n### 服务拆分\n1. 删除初始版本中的`whoami`服务\n\n2. 在`devops`目录新增`docker-compose.yml`文件，将后续添加的services剪切到yml文件中（yml文件中services和version根节点也要复制）\n\n3. 修改`devops/docker-compose.yml`中`volumns`中映射路径\n\n4. 分别启动`docker-compose up -d`和`docker-compose -f ./devops/docker-compose.yml up -d`\n\n这里关于`.env`文件我做了一些测试，发现在`traefik`同级创建的`.env`文件在`devops`目录中不做任何操作可以直接访问到里面的环境变量，之前还一直以为需要手动指定呢。\n\n~~另外上面的环境变量其实是不对了，原来的`.env`文件是当前目录下的，但是现在目录结构变了，所以那些环境变量就取不到了。\n其实[有很多方法可以实现环境变量共享](https://stackoverflow.com/questions/36283908/re-using-environmental-variables-in-docker-compose-yml)，本来打算用`extends env_file`实现的，结果compose 3版本后不支持了，那就采用每个service指定`env_file`的方案吧（虽然有点麻烦），修改完重新启动。~~\n\n访问不了？先看下`traefik`的路由表，发现有接入，但就是访问不了。无意间在查看`registry-ui`的启动日志时发现错误，说`registry.erguotou.me`访问不了。这是为什么呢？又是一番搜索排查尝试，最终发现当`devops services`和`traefik service`不在同一个文件时，我们需要让它们加入同一个网络，这样子`traefik`才可以完成自动代理。于是我们开始给`traefik`服务关联网络，给`devops`里的各种服务也绑定同样的网络。同时需要添加新的label`traefik.docker.network=traefik_webgateway`。改完重启，一切OK（最终配置可查看下文）。\n\n### 给Traefik增加安全性\n现在我们的`traefik`开启了8080的Dashboard，意味着别人也能看到我们的内容，所以在生产环境下我们需要关闭`traefik`的`api`服务，或者至少我们需要给`api`加一层认证。\n\n关闭的话直接在`traefik`的`service`中把`--api.insecure=true`改为`--api=false`即可。\n\n如果想看Dashboard又想安全性可以用上面说到的`basic auth`套一层，\n\n### 验证DevOps流程\n这里我们以一个简单的vue项目做测试看下如何实现`devops`自动化。\n\n1. 在gogs上新建一个临时项目`/tmp/vue-demo`\n\n2. 在本地使用`Vue cli`创建一个demo项目，并上传到git服务。此时不会触发任何后续操作\n\n3. 添加`.drone.yml`，推送到仓库，yml文件内容大致如下\n  ```yml\n  ---\n  kind: pipeline\n  name: default\n\n  trigger:\n    event:\n      - tag\n\n  steps:\n    - name: build\n      image: plugins/docker\n      settings:\n        dockerfile: docker/Dockerfile\n        registry: registry.erguotou.me\n        repo: registry.erguotou.me/tmp/vue-demo\n        username:\n          from_secret: REGISTRY_USER\n        password:\n          from_secret: REGISTRY_PASSWORD\n        tags:\n          - latest\n          - ${DRONE_TAG}\n        auto_tag: true\n        force_tag: true\n    - name: deploy\n      image: appleboy/drone-ssh\n      settings:\n        host: vue-demo.erguotou.me\n        username:\n          from_secret: SSH_USER\n        ssh_key:\n          from_secret: SSH_KEY\n        script:\n          # 在机器上执行一次login操作，以后就不用了\n          # - docker login registry.erguotou.me --username ${REGISTRY_USER} --password ${REGISTRY_PASSWORD}\n          - docker pull registry.erguotou.me/tmp/vue-demo:${DRONE_TAG}\n          - docker-compose -f apps/vue-demo/docker-compose.yml stop\n          - docker-compose -f apps/vue-demo/docker-compose.yml rm -f\n          - docker-compose -f apps/vue-demo/docker-compose.yml up -d\n    - name: send-wechat\n      image: yakumioto/drone-serverchan\n      settings:\n        key:\n          from_secret: SERVERCHAN_KEY\n        text: \"部署结果\"\n        # 目前该插件支持能力稍微不足，后期可以考虑自己开发下\n        desp: \"部署完成，[点击前往查看](https://vue-demo.erguotou.me)\"\n  ```\n\n4. 查看drone上的构建结果，查看registry是否推送成功，查看项目是否部署成功\n，最后结果可以成功，[点击地址查看](https://vue-demo.erguotou.me)。\n![DevOps流程全部走完](/images/devops/traefik-drone-devops.png)\n\n### 最终配置\n最终`docker-compose.yml`文件内容如下：\n\n```yml\nversion: \"3.7\"\n\nservices:\n  traefik:\n    image: traefik:latest\n    container_name: traefik\n    command:\n      - \"--api=true\"\n      - \"--api.dashboard=true\"\n      - \"--providers.docker=true\"\n      # 默认加入此网络，也许关联networks之后可以不设置？反正不关联networks其它的都映射不成功\n      - \"--providers.docker.network=traefik_webgateway\"\n      - \"--providers.docker.exposedbydefault=false\"\n      - \"--entryPoints.websecure.address=:443\"\n      - \"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"\n      - \"--certificatesResolvers.mytlschallenge.acme.email=${ACME_EMAIL}\"\n      - \"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.api.rule=Host(`traefik.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.api.service=api@internal\"\n      - \"traefik.http.services.api.loadbalancer.server.port=8080\"\n      - \"traefik.http.routers.api.entrypoints=websecure\"\n      - \"traefik.http.routers.api.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.api.middlewares=auth\"\n      - \"traefik.http.middlewares.auth.basicauth.users=${TRAEFIK_AUTH_USER}\"\n    networks:\n      - traefik_webgateway\n    ports:\n      - \"443:443\"\n    volumes:\n      - \"./acme:/etc/acme\"\n      - \"/var/run/docker.sock:/var/run/docker.sock:ro\"\n    environment:\n      - TZ=${TIME_ZONE}\nnetworks:\n  traefik_webgateway:\n    name: traefik_webgateway\n    driver: bridge\n```\n\n`devops/docker-compose.yml`文件内容如下：\n\n```yml\nversion: \"3.7\"\n\nservices:\n  # gogs\n  gogs:\n    container_name: gogs\n    image: gogs/gogs\n    restart: always\n    hostname: gogs\n    networks:\n      - traefik\n    ports:\n      - \"10022:22\"\n    volumes:\n      - ./gogs:/data\n    environment:\n      - TZ=${TIME_ZONE}\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.services.gogs.loadbalancer.server.port=3000\"\n      - \"traefik.http.routers.gogs.rule=Host(`gogs.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.gogs.entrypoints=websecure\"\n      - \"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"\n  # drone 服务端\n  drone-server:\n    container_name: drone-server\n    image: drone/drone\n    restart: always\n    hostname: drone-server\n    networks:\n      - traefik\n    volumes:\n      - ./drone-server:/var/lib/drone/\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_GOGS_SERVER=https://gogs.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_SERVER_PROTO=https\n      # 设置管理员\n      - DRONE_USER_CREATE=username:${DRONE_ADMIN},admin:true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.drone-server.rule=Host(`drone.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.drone-server.entrypoints=websecure\"\n      - \"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"\n  # drone agent\n  drone-agent:\n    container_name: drone-agent\n    image: drone/agent\n    restart: always\n    hostname: drone-agent\n    depends_on:\n      # 让server先起\n      - drone-server\n    # deploy:\n      # mode: replicated\n      # replicas: 6\n    networks:\n      - traefik\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - TZ=${TIME_ZONE}\n      - DRONE_RPC_HOST=drone.${SERVER_DOMAIN}\n      - DRONE_RPC_SECRET=${DRONE_SECRET}\n      - DRONE_SERVER_PROTO=https\n      # 一台机器最多同时跑2个任务\n      - DRONE_RUNNER_CAPACITY=2\n      # - DRONE_RUNNER_NAME=${HOSTNAME}\n    labels:\n      # agent不需要对外暴露\n      - \"traefik.enable=false\"\n  # docker registry\n  registry:\n    container_name: registry\n    image: registry\n    restart: always\n    hostname: registry\n    networks:\n      - traefik\n    volumes:\n      - ./registry:/var/lib/registry\n    environment:\n      - TZ=${TIME_ZONE}\n      - REGISTRY_STORAGE_DELETE_ENABLED=true\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.registry.rule=Host(`registry.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry.entrypoints=websecure\"\n      - \"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry.middlewares=registry-auth@docker\"\n      - \"traefik.http.middlewares.registry-auth.basicauth.users=${REGISTRY_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"\n  # docker registry 可视化web页面\n  registry-ui:\n    container_name: registry-ui\n    image: quiq/docker-registry-ui\n    restart: always\n    hostname: registry-ui\n    networks:\n      - traefik\n    depends_on:\n      - registry\n    environment:\n      - TZ=${TIME_ZONE}\n    # 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功\n    expose:\n      - 8000\n    volumes:\n      - ./registry-ui.yml:/opt/config.yml:ro\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"\n      - \"traefik.http.routers.registry-ui.rule=Host(`registry-ui.${SERVER_DOMAIN}`)\"\n      - \"traefik.http.routers.registry-ui.entrypoints=websecure\"\n      - \"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"\n      - \"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.users=${REGISTRY_UI_AUTH_USER}\"\n      - \"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"\n\nnetworks:\n  traefik:\n    external:\n      name: traefik_webgateway\n```\n\n`traefik`的Dashboard效果如下：\n![Traefik Dashboard](/images/devops/traefik-devops-final.png)\n\n## 最后，总结\n通过这么多天的不断学习和尝试，基本上填完了`traefik`作为网关路由器的坑，也让我学习了`traefik`的各种配置，最终组建了自己的`DevOps`平台。最终流程走通后心情非常舒畅，感觉完成了天大的事:joy:。\n\n我们可以浅尝辄止，也可以深坑直入。这是自己的选择，也许也决定了自己的高度。\n\n分享此文，给可能需要的人。\n","slug":"traefik-devops","published":1,"updated":"2020-02-17T16:54:23.058Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck6xuox23003ztof9xy4isxqo","content":"<p>又是好久没有写博客了，忽然有点自己不知道继续往哪个方向发展，一会搞搞Flutter，一会又玩玩Docker，有时又想做些框架沉淀，很多东西都没深入做下去。正好之前搞的DevOps平台最近需要做些扩展，就花点时间把这次经验记录下来方便以后查看😂。</p>\n<h2 id=\"首先，做什么？为什么做？\"><a class=\"header-anchor\" href=\"#首先，做什么？为什么做？\">¶</a>首先，做什么？为什么做？</h2>\n<p>还是DevOps，还是为了简化开发，还是低端机器，所以选择的方案依然是Gogs+drone。但是这次的方案有别于之前的Dokku，而是使用<code>traefik</code>作为网关服务器并且提供自动设置HTTPS的功能。先看下什么是<code>traefik</code>：</p>\n<a id=\"more\"></a>\n<blockquote>\n<p>Traefik 是一个边缘路由器，这意味着它是您平台的大门，它拦截并路由每个传入的请求:<br>\n<img src=\"https://traefik.tech/docs/assets/img/traefik-concepts-1.png\" alt=\"Traefik示意图\"></p>\n<p>它管理所有逻辑和每个规则确定哪些服务处理哪些请求（基于路径，主机，headers，等等…）。</p>\n</blockquote>\n<p><code>traefik</code>支持服务自动发现，当我们在Docker上使用<code>traefik</code>时，只需给Docker容器指定Label，就可以让<code>traefik</code>自动发现它们，自动完成端口映射、域名绑定、HTTPS证书管理等🤔。</p>\n<p>所以基于<code>traefik</code>的部署方案可以让我们省去很多配置工作（比如Nginx的配置，Let’s Encrypt的证书申请和更新，负载均衡等），当然也留给了我们很多坑…😟</p>\n<h2 id=\"其次，准备阶段\"><a class=\"header-anchor\" href=\"#其次，准备阶段\">¶</a>其次，准备阶段</h2>\n<p>一个1核2G2M的云服务器，ssh登录上，安装docker，安装docker-compose，这些官网都有教程，很简单，掠过。</p>\n<p>然后我们先提前做好域名映射，如果你使<code>用traefik</code>的<code>dnsChallenge</code>方式可以跳过，<code>traefik</code>会利用api自动为你做好域名映射（应该是吧，反正我没用过，我更喜欢自己把控🤔）：</p>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traefik.erguotou.me -&gt; ip</span><br><span class=\"line\">whoami.erguotou.me -&gt; ip</span><br><span class=\"line\">gogs.erguotou.me -&gt; ip</span><br><span class=\"line\">drone.erguotou.me -&gt; ip</span><br><span class=\"line\">registry.erguotou.me -&gt; ip</span><br><span class=\"line\">registry-ui.erguotou.me -&gt; ip</span><br></pre></td></tr></table></figure>\n<p>然后我们新建<code>.env</code>文件，并填入下面内容</p>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 顶级域名，此处替换成自己的</span><br><span class=\"line\">SERVER_DOMAIN=erguotou.me</span><br><span class=\"line\"></span><br><span class=\"line\"># Time Zone</span><br><span class=\"line\">TIME_ZONE=Asia/Shanghai</span><br><span class=\"line\"></span><br><span class=\"line\"># ACME，此处替换成自己的</span><br><span class=\"line\">ACME_EMAIL=xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># Drone，此处替换成自己的</span><br><span class=\"line\">DRONE_SECRET=xxx</span><br><span class=\"line\">DRONE_ADMIN=xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># basicauth用户密码</span><br><span class=\"line\"># 使用 echo $(htpasswd -nb user password) 生成用户密钥</span><br><span class=\"line\"># 如果直接在yml中使用需要改为 echo $(htpasswd -nb user password) | sed -e s/\\\\$/\\\\$\\\\$/g</span><br><span class=\"line\">TRAEFIK_AUTH_USER=xxx</span><br><span class=\"line\">REGISTRY_AUTH_USER=xxx</span><br><span class=\"line\">REGISTRY_UI_AUTH_USER=xxx</span><br></pre></td></tr></table></figure>\n<p>接着新建一个<code>docker-compose.yml</code>文件，并填入下面内容</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\"># 目前最新版本，可以支持更多特性，虽然我可能也没用上啥特性</span></span><br><span class=\"line\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">\"3.7\"</span></span><br><span class=\"line\"><span class=\"hljs-attr\">services:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">traefik:</span></span><br><span class=\"line\">    <span class=\"hljs-comment\"># The official docker image</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">traefik:latest</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">traefik</span></span><br><span class=\"line\">    <span class=\"hljs-comment\"># Enables the web UI and tells Traefik to listen to docker</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">command:</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 提供web查看页面</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--api.insecure=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 使用docker provider</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--providers.docker=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 取消暴露所有的容器，由我们自己把控</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--providers.docker.exposedbydefault=false\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 定义websecure</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--entryPoints.websecure.address=:443\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 使用tlschallenge方式进行https证书管理，当前也可以使用httpChallenge或者dnsChallenge</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># - \"--certificatesResolvers.mytlschallenge.acme.httpchallenge.entryPoint=web\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 指定Let's Encrypt证书获取所使用的邮箱地址</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--certificatesResolvers.mytlschallenge.acme.email=$&#123;ACME_EMAIL&#125;\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># acme.json文件存储位置（容器内），方便后续暴露出来</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">ports:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"443:443\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># The Web UI (enabled by --api.insecure=true)</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"8080:8080\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"./acme:/etc/acme\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># So that Traefik can listen to the Docker events</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"/var/run/docker.sock:/var/run/docker.sock:ro\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-comment\"># 先启用一个官方示例的容器</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">whoami:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">containous/whoami</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">simple-service</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 告诉traefik映射80端口</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.services.whoami.loadbalancer.server.port=80\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.whoami.rule=Host(`whoami.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 告诉traefik入口方式使用https</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.whoami.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.whoami.tls.certresolver=mytlschallenge\"</span></span><br></pre></td></tr></table></figure>\n<p>最后运行<code>docker-compose up</code>运行，我们看到<code>http://traefik.erguotou.me:8080/dashboard/</code>和<code>https://whoami.erguotou.me/</code>都可以正常访问，并且在traefik的Dashboard里可以看到成功纳管了一个Router。<br>\n<img src=\"/images/devops/traefik-only-whoami.png\" alt=\"traefik面板\"><br>\n<img src=\"/images/devops/whoami.png\" alt=\"whoami启动完成\"></p>\n<h2 id=\"再次，尝试与填坑\"><a class=\"header-anchor\" href=\"#再次，尝试与填坑\">¶</a>再次，尝试与填坑</h2>\n<p>初步测试成功后我们开始搭建我们的DevOps平台，我们在原来的<code>docker-compose.yml</code>文件中追加以下内容</p>\n<figure class=\"highlight yml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">\"3.7\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">services:</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># ...原来的内容，下面是新增的</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># gogs</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">gogs:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">gogs</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">gogs/gogs</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">gogs</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">ports:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"10022:22\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./devops/gogs:/data</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.services.gogs.loadbalancer.server.port=3000\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.gogs.rule=Host(`gogs.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.gogs.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># drone 服务端</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">drone-server:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">drone-server</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">drone/drone</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">drone-server</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./devops/drone-server:/var/lib/drone/</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_GOGS_SERVER=https://gogs.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_SERVER_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 设置管理员</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_USER_CREATE=username:$&#123;DRONE_ADMIN&#125;,admin:true</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.drone-server.rule=Host(`drone.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.drone-server.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># drone agent</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">drone-agent:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">drone/agent</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 让server先起</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">drone-server</span></span><br><span class=\"line\">    <span class=\"hljs-comment\"># deploy:</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># mode: replicated</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># replicas: 6</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RPC_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 一台机器最多同时跑2个任务</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RUNNER_CAPACITY=2</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># - DRONE_RUNNER_NAME=$&#123;HOSTNAME&#125;</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># agent不需要对外暴露</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=false\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># docker registry</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">registry:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./devops/registry:/var/lib/registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REGISTRY_STORAGE_DELETE_ENABLED=true</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.rule=Host(`registry.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.middlewares=registry-auth@docker\"</span></span><br><span class=\"line\">       <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-auth.basicauth.users=$&#123;REGISTRY_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># docker registry 可视化web页面</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">registry-ui:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">quiq/docker-registry-ui</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">#image: jc21/registry-ui</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">#image: konradkleine/docker-registry-frontend:v2</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"hljs-comment\"># 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">expose:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">8000</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./devops/registry-ui.yml:/opt/config.yml:ro</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 添加一个basic auth</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.users=$&#123;REGISTRY_UI_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.rule=Host(`registry-ui.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"</span></span><br></pre></td></tr></table></figure>\n<p>对于<code>registry-ui</code>镜像的选择，原来用的是<code>konradkleine/docker-registry-frontend:v2</code>，后来也试过<code>jc21/registry-ui</code>，但是容器体积都比较大，最后换了go语言的<code>quiq/docker-registry-ui</code>（每种镜像的配置稍有差异）要知道在小内存服务器上，Golang一条线才是正道😂。</p>\n<p>除此之外我们给<code>registry</code>和<code>registry-ui</code>加了一个<code>traefik</code>提供的<code>baisicauth</code>中间件，帮助我们添加一层安全认证，只有指定的用户可以查看，方便👍！同时配置中提到的<code>registry-ui.yml</code>文件的内容如下（去掉了很多注释，具体可以看容器的文档说明）：</p>\n<figure class=\"highlight yaml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">listen_addr:</span> <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-string\">:8000</span></span><br><span class=\"line\"><span class=\"hljs-attr\">base_path:</span> <span class=\"hljs-string\">/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">registry_url:</span> <span class=\"hljs-string\">https://registry.erguotou.me</span></span><br><span class=\"line\"><span class=\"hljs-attr\">verify_tls:</span> <span class=\"hljs-literal\">true</span></span><br><span class=\"line\"><span class=\"hljs-comment\"># 更换成自己的</span></span><br><span class=\"line\"><span class=\"hljs-attr\">registry_username:</span> <span class=\"hljs-string\">user</span></span><br><span class=\"line\"><span class=\"hljs-attr\">registry_password:</span> <span class=\"hljs-string\">pass</span></span><br><span class=\"line\"><span class=\"hljs-attr\">event_database_driver:</span> <span class=\"hljs-string\">sqlite3</span></span><br><span class=\"line\"><span class=\"hljs-attr\">event_database_location:</span> <span class=\"hljs-string\">data/registry_events.db</span></span><br><span class=\"line\"><span class=\"hljs-attr\">event_deletion_enabled:</span> <span class=\"hljs-literal\">False</span></span><br><span class=\"line\"><span class=\"hljs-attr\">cache_refresh_interval:</span> <span class=\"hljs-number\">10</span></span><br><span class=\"line\"><span class=\"hljs-attr\">anyone_can_delete:</span> <span class=\"hljs-literal\">false</span></span><br><span class=\"line\"><span class=\"hljs-attr\">admins:</span> <span class=\"hljs-string\">[]</span></span><br><span class=\"line\"><span class=\"hljs-attr\">debug:</span> <span class=\"hljs-literal\">false</span></span><br><span class=\"line\"><span class=\"hljs-attr\">purge_tags_keep_days:</span> <span class=\"hljs-number\">90</span></span><br><span class=\"line\"><span class=\"hljs-attr\">purge_tags_keep_count:</span> <span class=\"hljs-number\">2</span></span><br><span class=\"line\"><span class=\"hljs-attr\">purge_tags_schedule:</span> <span class=\"hljs-string\">''</span></span><br></pre></td></tr></table></figure>\n<p>我们开始启动服务<code>docker-compose up</code>，然后打开<code>gogs.erguotou.me</code>开始配置gogs，同时<code>drone</code>,<code>registry</code>,<code>registry-ui</code>服务也都起好了。<br>\n<img src=\"/images/devops/traefik-devops1.png\" alt=\"初步启动完成\"><br>\n等等，不是说好多坑么？Emmmmm~ 我这都是坑填完了得出的配置，<code>traefik</code>文档也不知道看了多少次，配置试了多少次。😅</p>\n<p>一切看起来那么的美好😏</p>\n<h2 id=\"接着，深入与实践\"><a class=\"header-anchor\" href=\"#接着，深入与实践\">¶</a>接着，深入与实践</h2>\n<p>虽然服务都启动了，但还有些可以优化的点，并且我们还要验证下整个DevOps流程是否可以跑通，尤其是drone的agent我们还没有验证呢。在这之前我们先将配置文件分离下，按功能将<code>docker-compose.yml</code>中的service分开到多个文件中分别启动。</p>\n<h3 id=\"服务拆分\"><a class=\"header-anchor\" href=\"#服务拆分\">¶</a>服务拆分</h3>\n<ol>\n<li>\n<p>删除初始版本中的<code>whoami</code>服务</p>\n</li>\n<li>\n<p>在<code>devops</code>目录新增<code>docker-compose.yml</code>文件，将后续添加的services剪切到yml文件中（yml文件中services和version根节点也要复制）</p>\n</li>\n<li>\n<p>修改<code>devops/docker-compose.yml</code>中<code>volumns</code>中映射路径</p>\n</li>\n<li>\n<p>分别启动<code>docker-compose up -d</code>和<code>docker-compose -f ./devops/docker-compose.yml up -d</code></p>\n</li>\n</ol>\n<p>这里关于<code>.env</code>文件我做了一些测试，发现在<code>traefik</code>同级创建的<code>.env</code>文件在<code>devops</code>目录中不做任何操作可以直接访问到里面的环境变量，之前还一直以为需要手动指定呢。</p>\n<p><s>另外上面的环境变量其实是不对了，原来的<code>.env</code>文件是当前目录下的，但是现在目录结构变了，所以那些环境变量就取不到了。<br>\n其实<a href=\"https://stackoverflow.com/questions/36283908/re-using-environmental-variables-in-docker-compose-yml\">有很多方法可以实现环境变量共享</a>，本来打算用<code>extends env_file</code>实现的，结果compose 3版本后不支持了，那就采用每个service指定<code>env_file</code>的方案吧（虽然有点麻烦），修改完重新启动。</s></p>\n<p>访问不了？先看下<code>traefik</code>的路由表，发现有接入，但就是访问不了。无意间在查看<code>registry-ui</code>的启动日志时发现错误，说<code>registry.erguotou.me</code>访问不了。这是为什么呢？又是一番搜索排查尝试，最终发现当<code>devops services</code>和<code>traefik service</code>不在同一个文件时，我们需要让它们加入同一个网络，这样子<code>traefik</code>才可以完成自动代理。于是我们开始给<code>traefik</code>服务关联网络，给<code>devops</code>里的各种服务也绑定同样的网络。同时需要添加新的label<code>traefik.docker.network=traefik_webgateway</code>。改完重启，一切OK（最终配置可查看下文）。</p>\n<h3 id=\"给Traefik增加安全性\"><a class=\"header-anchor\" href=\"#给Traefik增加安全性\">¶</a>给Traefik增加安全性</h3>\n<p>现在我们的<code>traefik</code>开启了8080的Dashboard，意味着别人也能看到我们的内容，所以在生产环境下我们需要关闭<code>traefik</code>的<code>api</code>服务，或者至少我们需要给<code>api</code>加一层认证。</p>\n<p>关闭的话直接在<code>traefik</code>的<code>service</code>中把<code>--api.insecure=true</code>改为<code>--api=false</code>即可。</p>\n<p>如果想看Dashboard又想安全性可以用上面说到的<code>basic auth</code>套一层，</p>\n<h3 id=\"验证DevOps流程\"><a class=\"header-anchor\" href=\"#验证DevOps流程\">¶</a>验证DevOps流程</h3>\n<p>这里我们以一个简单的vue项目做测试看下如何实现<code>devops</code>自动化。</p>\n<ol>\n<li>\n<p>在gogs上新建一个临时项目<code>/tmp/vue-demo</code></p>\n</li>\n<li>\n<p>在本地使用<code>Vue cli</code>创建一个demo项目，并上传到git服务。此时不会触发任何后续操作</p>\n</li>\n<li>\n<p>添加<code>.drone.yml</code>，推送到仓库，yml文件内容大致如下</p>\n</li>\n</ol>\n  <figure class=\"highlight yml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">---</span></span><br><span class=\"line\"><span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">pipeline</span></span><br><span class=\"line\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">default</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">trigger:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">event:</span></span><br><span class=\"line\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">tag</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">steps:</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">build</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">plugins/docker</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">settings:</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">dockerfile:</span> <span class=\"hljs-string\">docker/Dockerfile</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">registry:</span> <span class=\"hljs-string\">registry.erguotou.me</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">repo:</span> <span class=\"hljs-string\">registry.erguotou.me/tmp/vue-demo</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">username:</span></span><br><span class=\"line\">        <span class=\"hljs-attr\">from_secret:</span> <span class=\"hljs-string\">REGISTRY_USER</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">password:</span></span><br><span class=\"line\">        <span class=\"hljs-attr\">from_secret:</span> <span class=\"hljs-string\">REGISTRY_PASSWORD</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">tags:</span></span><br><span class=\"line\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">latest</span></span><br><span class=\"line\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">$&#123;DRONE_TAG&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">auto_tag:</span> <span class=\"hljs-literal\">true</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">force_tag:</span> <span class=\"hljs-literal\">true</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">deploy</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">appleboy/drone-ssh</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">settings:</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">vue-demo.erguotou.me</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">username:</span></span><br><span class=\"line\">        <span class=\"hljs-attr\">from_secret:</span> <span class=\"hljs-string\">SSH_USER</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">ssh_key:</span></span><br><span class=\"line\">        <span class=\"hljs-attr\">from_secret:</span> <span class=\"hljs-string\">SSH_KEY</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">script:</span></span><br><span class=\"line\">        <span class=\"hljs-comment\"># 在机器上执行一次login操作，以后就不用了</span></span><br><span class=\"line\">        <span class=\"hljs-comment\"># - docker login registry.erguotou.me --username $&#123;REGISTRY_USER&#125; --password $&#123;REGISTRY_PASSWORD&#125;</span></span><br><span class=\"line\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">docker</span> <span class=\"hljs-string\">pull</span> <span class=\"hljs-string\">registry.erguotou.me/tmp/vue-demo:$&#123;DRONE_TAG&#125;</span></span><br><span class=\"line\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">docker-compose</span> <span class=\"hljs-string\">-f</span> <span class=\"hljs-string\">apps/vue-demo/docker-compose.yml</span> <span class=\"hljs-string\">stop</span></span><br><span class=\"line\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">docker-compose</span> <span class=\"hljs-string\">-f</span> <span class=\"hljs-string\">apps/vue-demo/docker-compose.yml</span> <span class=\"hljs-string\">rm</span> <span class=\"hljs-string\">-f</span></span><br><span class=\"line\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">docker-compose</span> <span class=\"hljs-string\">-f</span> <span class=\"hljs-string\">apps/vue-demo/docker-compose.yml</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">-d</span></span><br><span class=\"line\">  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">send-wechat</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">yakumioto/drone-serverchan</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">settings:</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">key:</span></span><br><span class=\"line\">        <span class=\"hljs-attr\">from_secret:</span> <span class=\"hljs-string\">SERVERCHAN_KEY</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">text:</span> <span class=\"hljs-string\">\"部署结果\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 目前该插件支持能力稍微不足，后期可以考虑自己开发下</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">desp:</span> <span class=\"hljs-string\">\"部署完成，[点击前往查看](https://vue-demo.erguotou.me)\"</span></span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>查看drone上的构建结果，查看registry是否推送成功，查看项目是否部署成功<br>\n，最后结果可以成功，<a href=\"https://vue-demo.erguotou.me\">点击地址查看</a>。<br>\n<img src=\"/images/devops/traefik-drone-devops.png\" alt=\"DevOps流程全部走完\"></li>\n</ol>\n<h3 id=\"最终配置\"><a class=\"header-anchor\" href=\"#最终配置\">¶</a>最终配置</h3>\n<p>最终<code>docker-compose.yml</code>文件内容如下：</p>\n<figure class=\"highlight yml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">\"3.7\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">services:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">traefik:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">traefik:latest</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">traefik</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">command:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--api=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--api.dashboard=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--providers.docker=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 默认加入此网络，也许关联networks之后可以不设置？反正不关联networks其它的都映射不成功</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--providers.docker.network=traefik_webgateway\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--providers.docker.exposedbydefault=false\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--entryPoints.websecure.address=:443\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--certificatesResolvers.mytlschallenge.acme.email=$&#123;ACME_EMAIL&#125;\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.api.rule=Host(`traefik.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.api.service=api@internal\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.services.api.loadbalancer.server.port=8080\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.api.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.api.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.api.middlewares=auth\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.auth.basicauth.users=$&#123;TRAEFIK_AUTH_USER&#125;\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik_webgateway</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">ports:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"443:443\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"./acme:/etc/acme\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"/var/run/docker.sock:/var/run/docker.sock:ro\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\"><span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">traefik_webgateway:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">traefik_webgateway</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">driver:</span> <span class=\"hljs-string\">bridge</span></span><br></pre></td></tr></table></figure>\n<p><code>devops/docker-compose.yml</code>文件内容如下：</p>\n<figure class=\"highlight yml hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">\"3.7\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">services:</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># gogs</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">gogs:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">gogs</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">gogs/gogs</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">gogs</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">ports:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"10022:22\"</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./gogs:/data</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.services.gogs.loadbalancer.server.port=3000\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.gogs.rule=Host(`gogs.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.gogs.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># drone 服务端</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">drone-server:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">drone-server</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">drone/drone</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">drone-server</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./drone-server:/var/lib/drone/</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_GOGS_SERVER=https://gogs.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_SERVER_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 设置管理员</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_USER_CREATE=username:$&#123;DRONE_ADMIN&#125;,admin:true</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.drone-server.rule=Host(`drone.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.drone-server.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># drone agent</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">drone-agent:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">drone/agent</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 让server先起</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">drone-server</span></span><br><span class=\"line\">    <span class=\"hljs-comment\"># deploy:</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># mode: replicated</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># replicas: 6</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RPC_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># 一台机器最多同时跑2个任务</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DRONE_RUNNER_CAPACITY=2</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># - DRONE_RUNNER_NAME=$&#123;HOSTNAME&#125;</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-comment\"># agent不需要对外暴露</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=false\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># docker registry</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">registry:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./registry:/var/lib/registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REGISTRY_STORAGE_DELETE_ENABLED=true</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.rule=Host(`registry.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry.middlewares=registry-auth@docker\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-auth.basicauth.users=$&#123;REGISTRY_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\">  <span class=\"hljs-comment\"># docker registry 可视化web页面</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">registry-ui:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">quiq/docker-registry-ui</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">registry</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">environment:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"hljs-comment\"># 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">expose:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">8000</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./registry-ui.yml:/opt/config.yml:ro</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">labels:</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.rule=Host(`registry-ui.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.users=$&#123;REGISTRY_UI_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-attr\">networks:</span></span><br><span class=\"line\">  <span class=\"hljs-attr\">traefik:</span></span><br><span class=\"line\">    <span class=\"hljs-attr\">external:</span></span><br><span class=\"line\">      <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">traefik_webgateway</span></span><br></pre></td></tr></table></figure>\n<p><code>traefik</code>的Dashboard效果如下：<br>\n<img src=\"/images/devops/traefik-devops-final.png\" alt=\"Traefik Dashboard\"></p>\n<h2 id=\"最后，总结\"><a class=\"header-anchor\" href=\"#最后，总结\">¶</a>最后，总结</h2>\n<p>通过这么多天的不断学习和尝试，基本上填完了<code>traefik</code>作为网关路由器的坑，也让我学习了<code>traefik</code>的各种配置，最终组建了自己的<code>DevOps</code>平台。最终流程走通后心情非常舒畅，感觉完成了天大的事😂。</p>\n<p>我们可以浅尝辄止，也可以深坑直入。这是自己的选择，也许也决定了自己的高度。</p>\n<p>分享此文，给可能需要的人。</p>\n","site":{"data":{}},"excerpt":"<p>又是好久没有写博客了，忽然有点自己不知道继续往哪个方向发展，一会搞搞Flutter，一会又玩玩Docker，有时又想做些框架沉淀，很多东西都没深入做下去。正好之前搞的DevOps平台最近需要做些扩展，就花点时间把这次经验记录下来方便以后查看😂。</p>\n<h2 id=\"首先，做什么？为什么做？\"><a class=\"header-anchor\" href=\"#首先，做什么？为什么做？\">¶</a>首先，做什么？为什么做？</h2>\n<p>还是DevOps，还是为了简化开发，还是低端机器，所以选择的方案依然是Gogs+drone。但是这次的方案有别于之前的Dokku，而是使用<code>traefik</code>作为网关服务器并且提供自动设置HTTPS的功能。先看下什么是<code>traefik</code>：</p>","more":"<blockquote>\n<p>Traefik 是一个边缘路由器，这意味着它是您平台的大门，它拦截并路由每个传入的请求:<br>\n<img src=\"https://traefik.tech/docs/assets/img/traefik-concepts-1.png\" alt=\"Traefik示意图\"></p>\n<p>它管理所有逻辑和每个规则确定哪些服务处理哪些请求（基于路径，主机，headers，等等…）。</p>\n</blockquote>\n<p><code>traefik</code>支持服务自动发现，当我们在Docker上使用<code>traefik</code>时，只需给Docker容器指定Label，就可以让<code>traefik</code>自动发现它们，自动完成端口映射、域名绑定、HTTPS证书管理等🤔。</p>\n<p>所以基于<code>traefik</code>的部署方案可以让我们省去很多配置工作（比如Nginx的配置，Let’s Encrypt的证书申请和更新，负载均衡等），当然也留给了我们很多坑…😟</p>\n<h2 id=\"其次，准备阶段\"><a class=\"header-anchor\" href=\"#其次，准备阶段\">¶</a>其次，准备阶段</h2>\n<p>一个1核2G2M的云服务器，ssh登录上，安装docker，安装docker-compose，这些官网都有教程，很简单，掠过。</p>\n<p>然后我们先提前做好域名映射，如果你使<code>用traefik</code>的<code>dnsChallenge</code>方式可以跳过，<code>traefik</code>会利用api自动为你做好域名映射（应该是吧，反正我没用过，我更喜欢自己把控🤔）：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traefik.erguotou.me -&gt; ip</span><br><span class=\"line\">whoami.erguotou.me -&gt; ip</span><br><span class=\"line\">gogs.erguotou.me -&gt; ip</span><br><span class=\"line\">drone.erguotou.me -&gt; ip</span><br><span class=\"line\">registry.erguotou.me -&gt; ip</span><br><span class=\"line\">registry-ui.erguotou.me -&gt; ip</span><br></pre></td></tr></table></figure>\n<p>然后我们新建<code>.env</code>文件，并填入下面内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 顶级域名，此处替换成自己的</span><br><span class=\"line\">SERVER_DOMAIN=erguotou.me</span><br><span class=\"line\"></span><br><span class=\"line\"># Time Zone</span><br><span class=\"line\">TIME_ZONE=Asia/Shanghai</span><br><span class=\"line\"></span><br><span class=\"line\"># ACME，此处替换成自己的</span><br><span class=\"line\">ACME_EMAIL=xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># Drone，此处替换成自己的</span><br><span class=\"line\">DRONE_SECRET=xxx</span><br><span class=\"line\">DRONE_ADMIN=xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># basicauth用户密码</span><br><span class=\"line\"># 使用 echo $(htpasswd -nb user password) 生成用户密钥</span><br><span class=\"line\"># 如果直接在yml中使用需要改为 echo $(htpasswd -nb user password) | sed -e s/\\\\$/\\\\$\\\\$/g</span><br><span class=\"line\">TRAEFIK_AUTH_USER=xxx</span><br><span class=\"line\">REGISTRY_AUTH_USER=xxx</span><br><span class=\"line\">REGISTRY_UI_AUTH_USER=xxx</span><br></pre></td></tr></table></figure>\n<p>接着新建一个<code>docker-compose.yml</code>文件，并填入下面内容</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 目前最新版本，可以支持更多特性，虽然我可能也没用上啥特性</span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">\"3.7\"</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">traefik:</span></span><br><span class=\"line\">    <span class=\"comment\"># The official docker image</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">traefik:latest</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">traefik</span></span><br><span class=\"line\">    <span class=\"comment\"># Enables the web UI and tells Traefik to listen to docker</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span></span><br><span class=\"line\">      <span class=\"comment\"># 提供web查看页面</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--api.insecure=true\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 使用docker provider</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--providers.docker=true\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 取消暴露所有的容器，由我们自己把控</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--providers.docker.exposedbydefault=false\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 定义websecure</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--entryPoints.websecure.address=:443\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 使用tlschallenge方式进行https证书管理，当前也可以使用httpChallenge或者dnsChallenge</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"</span></span><br><span class=\"line\">      <span class=\"comment\"># - \"--certificatesResolvers.mytlschallenge.acme.httpchallenge.entryPoint=web\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 指定Let's Encrypt证书获取所使用的邮箱地址</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--certificatesResolvers.mytlschallenge.acme.email=$&#123;ACME_EMAIL&#125;\"</span></span><br><span class=\"line\">      <span class=\"comment\"># acme.json文件存储位置（容器内），方便后续暴露出来</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"443:443\"</span></span><br><span class=\"line\">      <span class=\"comment\"># The Web UI (enabled by --api.insecure=true)</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"8080:8080\"</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"./acme:/etc/acme\"</span></span><br><span class=\"line\">      <span class=\"comment\"># So that Traefik can listen to the Docker events</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"/var/run/docker.sock:/var/run/docker.sock:ro\"</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 先启用一个官方示例的容器</span></span><br><span class=\"line\">  <span class=\"attr\">whoami:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">containous/whoami</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">simple-service</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 告诉traefik映射80端口</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.services.whoami.loadbalancer.server.port=80\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.whoami.rule=Host(`whoami.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 告诉traefik入口方式使用https</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.whoami.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.whoami.tls.certresolver=mytlschallenge\"</span></span><br></pre></td></tr></table></figure>\n<p>最后运行<code>docker-compose up</code>运行，我们看到<code>http://traefik.erguotou.me:8080/dashboard/</code>和<code>https://whoami.erguotou.me/</code>都可以正常访问，并且在traefik的Dashboard里可以看到成功纳管了一个Router。<br>\n<img src=\"/images/devops/traefik-only-whoami.png\" alt=\"traefik面板\"><br>\n<img src=\"/images/devops/whoami.png\" alt=\"whoami启动完成\"></p>\n<h2 id=\"再次，尝试与填坑\"><a class=\"header-anchor\" href=\"#再次，尝试与填坑\">¶</a>再次，尝试与填坑</h2>\n<p>初步测试成功后我们开始搭建我们的DevOps平台，我们在原来的<code>docker-compose.yml</code>文件中追加以下内容</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">\"3.7\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"comment\"># ...原来的内容，下面是新增的</span></span><br><span class=\"line\">  <span class=\"comment\"># gogs</span></span><br><span class=\"line\">  <span class=\"attr\">gogs:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">gogs</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">gogs/gogs</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">gogs</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"10022:22\"</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./devops/gogs:/data</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.services.gogs.loadbalancer.server.port=3000\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.gogs.rule=Host(`gogs.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.gogs.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"comment\"># drone 服务端</span></span><br><span class=\"line\">  <span class=\"attr\">drone-server:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">drone-server</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">drone/drone</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">drone-server</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./devops/drone-server:/var/lib/drone/</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_GOGS_SERVER=https://gogs.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_SERVER_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"comment\"># 设置管理员</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_USER_CREATE=username:$&#123;DRONE_ADMIN&#125;,admin:true</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.drone-server.rule=Host(`drone.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.drone-server.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"comment\"># drone agent</span></span><br><span class=\"line\">  <span class=\"attr\">drone-agent:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">drone/agent</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"comment\"># 让server先起</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">drone-server</span></span><br><span class=\"line\">    <span class=\"comment\"># deploy:</span></span><br><span class=\"line\">      <span class=\"comment\"># mode: replicated</span></span><br><span class=\"line\">      <span class=\"comment\"># replicas: 6</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RPC_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"comment\"># 一台机器最多同时跑2个任务</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RUNNER_CAPACITY=2</span></span><br><span class=\"line\">      <span class=\"comment\"># - DRONE_RUNNER_NAME=$&#123;HOSTNAME&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"comment\"># agent不需要对外暴露</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=false\"</span></span><br><span class=\"line\">  <span class=\"comment\"># docker registry</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./devops/registry:/var/lib/registry</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">REGISTRY_STORAGE_DELETE_ENABLED=true</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.rule=Host(`registry.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.middlewares=registry-auth@docker\"</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-auth.basicauth.users=$&#123;REGISTRY_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\">  <span class=\"comment\"># docker registry 可视化web页面</span></span><br><span class=\"line\">  <span class=\"attr\">registry-ui:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quiq/docker-registry-ui</span></span><br><span class=\"line\">    <span class=\"comment\">#image: jc21/registry-ui</span></span><br><span class=\"line\">    <span class=\"comment\">#image: konradkleine/docker-registry-frontend:v2</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8000</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./devops/registry-ui.yml:/opt/config.yml:ro</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 添加一个basic auth</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.users=$&#123;REGISTRY_UI_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.rule=Host(`registry-ui.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"</span></span><br></pre></td></tr></table></figure>\n<p>对于<code>registry-ui</code>镜像的选择，原来用的是<code>konradkleine/docker-registry-frontend:v2</code>，后来也试过<code>jc21/registry-ui</code>，但是容器体积都比较大，最后换了go语言的<code>quiq/docker-registry-ui</code>（每种镜像的配置稍有差异）要知道在小内存服务器上，Golang一条线才是正道😂。</p>\n<p>除此之外我们给<code>registry</code>和<code>registry-ui</code>加了一个<code>traefik</code>提供的<code>baisicauth</code>中间件，帮助我们添加一层安全认证，只有指定的用户可以查看，方便👍！同时配置中提到的<code>registry-ui.yml</code>文件的内容如下（去掉了很多注释，具体可以看容器的文档说明）：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">listen_addr:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"string\">:8000</span></span><br><span class=\"line\"><span class=\"attr\">base_path:</span> <span class=\"string\">/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">registry_url:</span> <span class=\"string\">https://registry.erguotou.me</span></span><br><span class=\"line\"><span class=\"attr\">verify_tls:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># 更换成自己的</span></span><br><span class=\"line\"><span class=\"attr\">registry_username:</span> <span class=\"string\">user</span></span><br><span class=\"line\"><span class=\"attr\">registry_password:</span> <span class=\"string\">pass</span></span><br><span class=\"line\"><span class=\"attr\">event_database_driver:</span> <span class=\"string\">sqlite3</span></span><br><span class=\"line\"><span class=\"attr\">event_database_location:</span> <span class=\"string\">data/registry_events.db</span></span><br><span class=\"line\"><span class=\"attr\">event_deletion_enabled:</span> <span class=\"literal\">False</span></span><br><span class=\"line\"><span class=\"attr\">cache_refresh_interval:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"attr\">anyone_can_delete:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">admins:</span> <span class=\"string\">[]</span></span><br><span class=\"line\"><span class=\"attr\">debug:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">purge_tags_keep_days:</span> <span class=\"number\">90</span></span><br><span class=\"line\"><span class=\"attr\">purge_tags_keep_count:</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">purge_tags_schedule:</span> <span class=\"string\">''</span></span><br></pre></td></tr></table></figure>\n<p>我们开始启动服务<code>docker-compose up</code>，然后打开<code>gogs.erguotou.me</code>开始配置gogs，同时<code>drone</code>,<code>registry</code>,<code>registry-ui</code>服务也都起好了。<br>\n<img src=\"/images/devops/traefik-devops1.png\" alt=\"初步启动完成\"><br>\n等等，不是说好多坑么？Emmmmm~ 我这都是坑填完了得出的配置，<code>traefik</code>文档也不知道看了多少次，配置试了多少次。😅</p>\n<p>一切看起来那么的美好😏</p>\n<h2 id=\"接着，深入与实践\"><a class=\"header-anchor\" href=\"#接着，深入与实践\">¶</a>接着，深入与实践</h2>\n<p>虽然服务都启动了，但还有些可以优化的点，并且我们还要验证下整个DevOps流程是否可以跑通，尤其是drone的agent我们还没有验证呢。在这之前我们先将配置文件分离下，按功能将<code>docker-compose.yml</code>中的service分开到多个文件中分别启动。</p>\n<h3 id=\"服务拆分\"><a class=\"header-anchor\" href=\"#服务拆分\">¶</a>服务拆分</h3>\n<ol>\n<li>\n<p>删除初始版本中的<code>whoami</code>服务</p>\n</li>\n<li>\n<p>在<code>devops</code>目录新增<code>docker-compose.yml</code>文件，将后续添加的services剪切到yml文件中（yml文件中services和version根节点也要复制）</p>\n</li>\n<li>\n<p>修改<code>devops/docker-compose.yml</code>中<code>volumns</code>中映射路径</p>\n</li>\n<li>\n<p>分别启动<code>docker-compose up -d</code>和<code>docker-compose -f ./devops/docker-compose.yml up -d</code></p>\n</li>\n</ol>\n<p>这里关于<code>.env</code>文件我做了一些测试，发现在<code>traefik</code>同级创建的<code>.env</code>文件在<code>devops</code>目录中不做任何操作可以直接访问到里面的环境变量，之前还一直以为需要手动指定呢。</p>\n<p><s>另外上面的环境变量其实是不对了，原来的<code>.env</code>文件是当前目录下的，但是现在目录结构变了，所以那些环境变量就取不到了。<br>\n其实<a href=\"https://stackoverflow.com/questions/36283908/re-using-environmental-variables-in-docker-compose-yml\">有很多方法可以实现环境变量共享</a>，本来打算用<code>extends env_file</code>实现的，结果compose 3版本后不支持了，那就采用每个service指定<code>env_file</code>的方案吧（虽然有点麻烦），修改完重新启动。</s></p>\n<p>访问不了？先看下<code>traefik</code>的路由表，发现有接入，但就是访问不了。无意间在查看<code>registry-ui</code>的启动日志时发现错误，说<code>registry.erguotou.me</code>访问不了。这是为什么呢？又是一番搜索排查尝试，最终发现当<code>devops services</code>和<code>traefik service</code>不在同一个文件时，我们需要让它们加入同一个网络，这样子<code>traefik</code>才可以完成自动代理。于是我们开始给<code>traefik</code>服务关联网络，给<code>devops</code>里的各种服务也绑定同样的网络。同时需要添加新的label<code>traefik.docker.network=traefik_webgateway</code>。改完重启，一切OK（最终配置可查看下文）。</p>\n<h3 id=\"给Traefik增加安全性\"><a class=\"header-anchor\" href=\"#给Traefik增加安全性\">¶</a>给Traefik增加安全性</h3>\n<p>现在我们的<code>traefik</code>开启了8080的Dashboard，意味着别人也能看到我们的内容，所以在生产环境下我们需要关闭<code>traefik</code>的<code>api</code>服务，或者至少我们需要给<code>api</code>加一层认证。</p>\n<p>关闭的话直接在<code>traefik</code>的<code>service</code>中把<code>--api.insecure=true</code>改为<code>--api=false</code>即可。</p>\n<p>如果想看Dashboard又想安全性可以用上面说到的<code>basic auth</code>套一层，</p>\n<h3 id=\"验证DevOps流程\"><a class=\"header-anchor\" href=\"#验证DevOps流程\">¶</a>验证DevOps流程</h3>\n<p>这里我们以一个简单的vue项目做测试看下如何实现<code>devops</code>自动化。</p>\n<ol>\n<li>\n<p>在gogs上新建一个临时项目<code>/tmp/vue-demo</code></p>\n</li>\n<li>\n<p>在本地使用<code>Vue cli</code>创建一个demo项目，并上传到git服务。此时不会触发任何后续操作</p>\n</li>\n<li>\n<p>添加<code>.drone.yml</code>，推送到仓库，yml文件内容大致如下</p>\n</li>\n</ol>\n  <figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">pipeline</span></span><br><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">default</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">trigger:</span></span><br><span class=\"line\">  <span class=\"attr\">event:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">tag</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">steps:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">build</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">plugins/docker</span></span><br><span class=\"line\">    <span class=\"attr\">settings:</span></span><br><span class=\"line\">      <span class=\"attr\">dockerfile:</span> <span class=\"string\">docker/Dockerfile</span></span><br><span class=\"line\">      <span class=\"attr\">registry:</span> <span class=\"string\">registry.erguotou.me</span></span><br><span class=\"line\">      <span class=\"attr\">repo:</span> <span class=\"string\">registry.erguotou.me/tmp/vue-demo</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span></span><br><span class=\"line\">        <span class=\"attr\">from_secret:</span> <span class=\"string\">REGISTRY_USER</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span></span><br><span class=\"line\">        <span class=\"attr\">from_secret:</span> <span class=\"string\">REGISTRY_PASSWORD</span></span><br><span class=\"line\">      <span class=\"attr\">tags:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">latest</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DRONE_TAG&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">auto_tag:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">force_tag:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">deploy</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">appleboy/drone-ssh</span></span><br><span class=\"line\">    <span class=\"attr\">settings:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"string\">vue-demo.erguotou.me</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span></span><br><span class=\"line\">        <span class=\"attr\">from_secret:</span> <span class=\"string\">SSH_USER</span></span><br><span class=\"line\">      <span class=\"attr\">ssh_key:</span></span><br><span class=\"line\">        <span class=\"attr\">from_secret:</span> <span class=\"string\">SSH_KEY</span></span><br><span class=\"line\">      <span class=\"attr\">script:</span></span><br><span class=\"line\">        <span class=\"comment\"># 在机器上执行一次login操作，以后就不用了</span></span><br><span class=\"line\">        <span class=\"comment\"># - docker login registry.erguotou.me --username $&#123;REGISTRY_USER&#125; --password $&#123;REGISTRY_PASSWORD&#125;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">docker</span> <span class=\"string\">pull</span> <span class=\"string\">registry.erguotou.me/tmp/vue-demo:$&#123;DRONE_TAG&#125;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">docker-compose</span> <span class=\"string\">-f</span> <span class=\"string\">apps/vue-demo/docker-compose.yml</span> <span class=\"string\">stop</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">docker-compose</span> <span class=\"string\">-f</span> <span class=\"string\">apps/vue-demo/docker-compose.yml</span> <span class=\"string\">rm</span> <span class=\"string\">-f</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">docker-compose</span> <span class=\"string\">-f</span> <span class=\"string\">apps/vue-demo/docker-compose.yml</span> <span class=\"string\">up</span> <span class=\"string\">-d</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">send-wechat</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">yakumioto/drone-serverchan</span></span><br><span class=\"line\">    <span class=\"attr\">settings:</span></span><br><span class=\"line\">      <span class=\"attr\">key:</span></span><br><span class=\"line\">        <span class=\"attr\">from_secret:</span> <span class=\"string\">SERVERCHAN_KEY</span></span><br><span class=\"line\">      <span class=\"attr\">text:</span> <span class=\"string\">\"部署结果\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 目前该插件支持能力稍微不足，后期可以考虑自己开发下</span></span><br><span class=\"line\">      <span class=\"attr\">desp:</span> <span class=\"string\">\"部署完成，[点击前往查看](https://vue-demo.erguotou.me)\"</span></span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>查看drone上的构建结果，查看registry是否推送成功，查看项目是否部署成功<br>\n，最后结果可以成功，<a href=\"https://vue-demo.erguotou.me\">点击地址查看</a>。<br>\n<img src=\"/images/devops/traefik-drone-devops.png\" alt=\"DevOps流程全部走完\"></li>\n</ol>\n<h3 id=\"最终配置\"><a class=\"header-anchor\" href=\"#最终配置\">¶</a>最终配置</h3>\n<p>最终<code>docker-compose.yml</code>文件内容如下：</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">\"3.7\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">traefik:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">traefik:latest</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">traefik</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--api=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--api.dashboard=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--providers.docker=true\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 默认加入此网络，也许关联networks之后可以不设置？反正不关联networks其它的都映射不成功</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--providers.docker.network=traefik_webgateway\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--providers.docker.exposedbydefault=false\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--entryPoints.websecure.address=:443\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--certificatesresolvers.mytlschallenge.acme.tlschallenge=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--certificatesResolvers.mytlschallenge.acme.email=$&#123;ACME_EMAIL&#125;\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"--certificatesResolvers.mytlschallenge.acme.storage=/etc/acme/acme.json\"</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.api.rule=Host(`traefik.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.api.service=api@internal\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.services.api.loadbalancer.server.port=8080\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.api.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.api.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.api.middlewares=auth\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.auth.basicauth.users=$&#123;TRAEFIK_AUTH_USER&#125;\"</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">traefik_webgateway</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"443:443\"</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"./acme:/etc/acme\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"/var/run/docker.sock:/var/run/docker.sock:ro\"</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">traefik_webgateway:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">traefik_webgateway</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n<p><code>devops/docker-compose.yml</code>文件内容如下：</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">\"3.7\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"comment\"># gogs</span></span><br><span class=\"line\">  <span class=\"attr\">gogs:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">gogs</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">gogs/gogs</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">gogs</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">traefik</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"10022:22\"</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./gogs:/data</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.services.gogs.loadbalancer.server.port=3000\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.gogs.rule=Host(`gogs.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.gogs.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.gogs.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"comment\"># drone 服务端</span></span><br><span class=\"line\">  <span class=\"attr\">drone-server:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">drone-server</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">drone/drone</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">drone-server</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">traefik</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./drone-server:/var/lib/drone/</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_GOGS_SERVER=https://gogs.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_SERVER_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"comment\"># 设置管理员</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_USER_CREATE=username:$&#123;DRONE_ADMIN&#125;,admin:true</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.drone-server.rule=Host(`drone.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.drone-server.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.drone-server.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">  <span class=\"comment\"># drone agent</span></span><br><span class=\"line\">  <span class=\"attr\">drone-agent:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">drone/agent</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">drone-agent</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"comment\"># 让server先起</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">drone-server</span></span><br><span class=\"line\">    <span class=\"comment\"># deploy:</span></span><br><span class=\"line\">      <span class=\"comment\"># mode: replicated</span></span><br><span class=\"line\">      <span class=\"comment\"># replicas: 6</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">traefik</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RPC_HOST=drone.$&#123;SERVER_DOMAIN&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RPC_SECRET=$&#123;DRONE_SECRET&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_SERVER_PROTO=https</span></span><br><span class=\"line\">      <span class=\"comment\"># 一台机器最多同时跑2个任务</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">DRONE_RUNNER_CAPACITY=2</span></span><br><span class=\"line\">      <span class=\"comment\"># - DRONE_RUNNER_NAME=$&#123;HOSTNAME&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"comment\"># agent不需要对外暴露</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=false\"</span></span><br><span class=\"line\">  <span class=\"comment\"># docker registry</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">traefik</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./registry:/var/lib/registry</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">REGISTRY_STORAGE_DELETE_ENABLED=true</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.rule=Host(`registry.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry.middlewares=registry-auth@docker\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-auth.basicauth.users=$&#123;REGISTRY_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\">  <span class=\"comment\"># docker registry 可视化web页面</span></span><br><span class=\"line\">  <span class=\"attr\">registry-ui:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quiq/docker-registry-ui</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">registry-ui</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">traefik</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=$&#123;TIME_ZONE&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># 此处有个大坑，对于Dockerfile中没有暴露端口的，需要自己手动指定下暴露的端口，这样traefik才能检测到要映射哪个端口，否则不成功</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8000</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./registry-ui.yml:/opt/config.yml:ro</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.enable=true\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.services.registry-ui.loadbalancer.server.port=8000\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.rule=Host(`registry-ui.$&#123;SERVER_DOMAIN&#125;`)\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.entrypoints=websecure\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.tls.certresolver=mytlschallenge\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.routers.registry-ui.middlewares=registry-ui-auth@docker\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.users=$&#123;REGISTRY_UI_AUTH_USER&#125;\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"traefik.http.middlewares.registry-ui-auth.basicauth.removeheader=true\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">traefik:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">traefik_webgateway</span></span><br></pre></td></tr></table></figure>\n<p><code>traefik</code>的Dashboard效果如下：<br>\n<img src=\"/images/devops/traefik-devops-final.png\" alt=\"Traefik Dashboard\"></p>\n<h2 id=\"最后，总结\"><a class=\"header-anchor\" href=\"#最后，总结\">¶</a>最后，总结</h2>\n<p>通过这么多天的不断学习和尝试，基本上填完了<code>traefik</code>作为网关路由器的坑，也让我学习了<code>traefik</code>的各种配置，最终组建了自己的<code>DevOps</code>平台。最终流程走通后心情非常舒畅，感觉完成了天大的事😂。</p>\n<p>我们可以浅尝辄止，也可以深坑直入。这是自己的选择，也许也决定了自己的高度。</p>\n<p>分享此文，给可能需要的人。</p>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"ck6xuowzq0002tof9wuorbmgc","tag_id":"ck6xuowzv0006tof9veaaofws","_id":"ck6xuox05000ftof97vs9fj91"},{"post_id":"ck6xuowzq0002tof9wuorbmgc","tag_id":"ck6xuox02000atof9i7dd5t1h","_id":"ck6xuox05000htof9ss7z3j7m"},{"post_id":"ck6xuowzt0004tof9jfuhebpy","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox06000ktof9ycsbck9b"},{"post_id":"ck6xuox07000ltof91d05jwbh","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox08000otof9c6eiw0xn"},{"post_id":"ck6xuox08000ptof9ekdhruv0","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox0c000stof96f3h8uvq"},{"post_id":"ck6xuowzy0007tof95edg86gi","tag_id":"ck6xuox06000itof9vld9knmu","_id":"ck6xuox0d000utof91g61qmpo"},{"post_id":"ck6xuowzy0007tof95edg86gi","tag_id":"ck6xuox07000mtof9qorvtz7n","_id":"ck6xuox0e000xtof9wf6uze26"},{"post_id":"ck6xuox000008tof9wvse6cx7","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox0f000ztof98kg481b9"},{"post_id":"ck6xuox010009tof9mwgu91q0","tag_id":"ck6xuox0e000wtof924h1z959","_id":"ck6xuox0k0019tof9c0qm8zpm"},{"post_id":"ck6xuox010009tof9mwgu91q0","tag_id":"ck6xuox0g0011tof9thp1tw8g","_id":"ck6xuox0l001btof9ag1gmhdd"},{"post_id":"ck6xuox010009tof9mwgu91q0","tag_id":"ck6xuox0i0014tof9kkk3z5zz","_id":"ck6xuox0m001etof9sv2m6gaf"},{"post_id":"ck6xuox02000btof9yvl8ztrx","tag_id":"ck6xuox0j0017tof9qisu0ywb","_id":"ck6xuox0o001jtof9nsvasgsc"},{"post_id":"ck6xuox02000btof9yvl8ztrx","tag_id":"ck6xuox0m001dtof9pjt2rbs4","_id":"ck6xuox0p001ltof9p3nv82t8"},{"post_id":"ck6xuox03000ctof9ubouq55y","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox0q001otof9cf3o2xl6"},{"post_id":"ck6xuox04000etof9r3pub83l","tag_id":"ck6xuox0p001mtof9pmd1pt2l","_id":"ck6xuox0s001stof99yjhni4l"},{"post_id":"ck6xuox05000gtof98x2vpolt","tag_id":"ck6xuox0r001qtof9xf9phtuy","_id":"ck6xuox0s001utof9xc2q8d4n"},{"post_id":"ck6xuox06000jtof9w1ij9s7j","tag_id":"ck6xuox0s001ttof9732bsja0","_id":"ck6xuox0u0020tof9elgypuwr"},{"post_id":"ck6xuox06000jtof9w1ij9s7j","tag_id":"ck6xuox0t001vtof970w8uy6z","_id":"ck6xuox0u0021tof9l1i8ut42"},{"post_id":"ck6xuox06000jtof9w1ij9s7j","tag_id":"ck6xuox0t001wtof94rxngj8u","_id":"ck6xuox0u0023tof9zrxzkm8r"},{"post_id":"ck6xuox06000jtof9w1ij9s7j","tag_id":"ck6xuox0t001xtof9qrbmcmca","_id":"ck6xuox0u0024tof9m52qyzyo"},{"post_id":"ck6xuox06000jtof9w1ij9s7j","tag_id":"ck6xuox0t001ytof91t3zl75n","_id":"ck6xuox0u0026tof9rvsueblk"},{"post_id":"ck6xuox08000ntof9aovtdklx","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox0v0027tof9wi7anrx5"},{"post_id":"ck6xuox08000ntof9aovtdklx","tag_id":"ck6xuox0t001ztof9lo0kg2c1","_id":"ck6xuox0v0029tof92spf5m8l"},{"post_id":"ck6xuox0a000qtof92wv27htb","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox0v002atof98vnznuk5"},{"post_id":"ck6xuox0a000qtof92wv27htb","tag_id":"ck6xuox0u0022tof94073wvha","_id":"ck6xuox0v002btof9jcz9d1p5"},{"post_id":"ck6xuox0c000ttof9p5pv4113","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox0v002dtof9ymda7whv"},{"post_id":"ck6xuox0c000ttof9p5pv4113","tag_id":"ck6xuox0u0025tof95ttgoa9w","_id":"ck6xuox0v002etof9giqqf27e"},{"post_id":"ck6xuox0d000vtof92vn5w6a3","tag_id":"ck6xuox0v0028tof9j0mc1tjt","_id":"ck6xuox0w002gtof99b0rljdg"},{"post_id":"ck6xuox0e000ytof9bm3ysr9y","tag_id":"ck6xuox0v002ctof9t19kgek6","_id":"ck6xuox0x002ktof9we4n93wo"},{"post_id":"ck6xuox0e000ytof9bm3ysr9y","tag_id":"ck6xuox0v002ftof991n5ilbk","_id":"ck6xuox0x002ltof9hz3aa0by"},{"post_id":"ck6xuox0e000ytof9bm3ysr9y","tag_id":"ck6xuox0w002htof9c1ss1doj","_id":"ck6xuox0x002ntof9o64tcatk"},{"post_id":"ck6xuox0e000ytof9bm3ysr9y","tag_id":"ck6xuox0w002itof9387kmtmt","_id":"ck6xuox0x002otof9pswakmoe"},{"post_id":"ck6xuox0f0010tof9ohfkg1fo","tag_id":"ck6xuox0v0028tof9j0mc1tjt","_id":"ck6xuox0x002qtof97zgln7fx"},{"post_id":"ck6xuox0g0012tof9t7k946zr","tag_id":"ck6xuox0x002mtof92zp9wba8","_id":"ck6xuox0y002stof9mm2jwx7q"},{"post_id":"ck6xuox0g0012tof9t7k946zr","tag_id":"ck6xuox0x002ptof98jbbfpba","_id":"ck6xuox0y002ttof9eke97jrj"},{"post_id":"ck6xuox0h0013tof9zxsywa65","tag_id":"ck6xuox0x002rtof9xpwgqu79","_id":"ck6xuox0y002vtof9p20i6iba"},{"post_id":"ck6xuox0i0015tof9yax21ynh","tag_id":"ck6xuox0y002utof97gi8iv8j","_id":"ck6xuox0y002xtof939acyrb5"},{"post_id":"ck6xuox0k001atof9hn1cie2y","tag_id":"ck6xuox0y002wtof9axbk991e","_id":"ck6xuox0z002ztof91o5e3k3n"},{"post_id":"ck6xuox0l001ctof9d98pj4xn","tag_id":"ck6xuox0z002ytof9uuhxulcm","_id":"ck6xuox100034tof9o6nnfm8y"},{"post_id":"ck6xuox0l001ctof9d98pj4xn","tag_id":"ck6xuox0z0030tof9q4ixz80o","_id":"ck6xuox100035tof93lkptyrg"},{"post_id":"ck6xuox0l001ctof9d98pj4xn","tag_id":"ck6xuox0z0031tof9x2g6xx4n","_id":"ck6xuox100037tof99pg3cwhu"},{"post_id":"ck6xuox0l001ctof9d98pj4xn","tag_id":"ck6xuox0z0032tof9mgh3w4ty","_id":"ck6xuox100038tof96ojkdytl"},{"post_id":"ck6xuox0m001ftof9gz62peml","tag_id":"ck6xuox0u0025tof95ttgoa9w","_id":"ck6xuox11003atof9yfsapeus"},{"post_id":"ck6xuox0n001gtof99b12sq0q","tag_id":"ck6xuox100036tof9bfosbjyn","_id":"ck6xuox11003btof9v2n2memd"},{"post_id":"ck6xuox0p001ktof9d9kzcxlw","tag_id":"ck6xuox110039tof933p2x31i","_id":"ck6xuox11003dtof9m7egvajr"},{"post_id":"ck6xuox0q001ntof908mstsh1","tag_id":"ck6xuox0v0028tof9j0mc1tjt","_id":"ck6xuox12003ftof9op31rh39"},{"post_id":"ck6xuox0q001ptof9222hlw8c","tag_id":"ck6xuox12003etof9ilvqk8y3","_id":"ck6xuox12003htof99wxb1d6m"},{"post_id":"ck6xuox0r001rtof9lhmicqgd","tag_id":"ck6xuox12003gtof9uphprovu","_id":"ck6xuox13003jtof9me9pggys"},{"post_id":"ck6xuox0r001rtof9lhmicqgd","tag_id":"ck6xuox12003itof9z3zc747n","_id":"ck6xuox13003ktof9n2s5pzx7"},{"post_id":"ck6xuox1u003ptof9s1oasgru","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox1y003rtof92hk2jnye"},{"post_id":"ck6xuox1i003ltof972i35azq","tag_id":"ck6xuox1q003ntof9t09lm17n","_id":"ck6xuox1y003stof9uq6mqbyw"},{"post_id":"ck6xuox1l003mtof9xx2hdhz8","tag_id":"ck6xuox1x003qtof9z3c2w1mb","_id":"ck6xuox20003vtof9in9rqwb5"},{"post_id":"ck6xuox1l003mtof9xx2hdhz8","tag_id":"ck6xuox1z003ttof9yu9yhgmb","_id":"ck6xuox20003wtof9x75r40r0"},{"post_id":"ck6xuox1q003otof99mr8b9d1","tag_id":"ck6xuox04000dtof9fnldq6b5","_id":"ck6xuox20003xtof98n0f3f81"},{"post_id":"ck6xuox1q003otof99mr8b9d1","tag_id":"ck6xuox1z003utof93vqt0ilw","_id":"ck6xuox20003ytof936de1gde"},{"post_id":"ck6xuox23003ztof9xy4isxqo","tag_id":"ck6xuox240040tof9g0u7915o","_id":"ck6xuox250043tof9wen8aoo3"},{"post_id":"ck6xuox23003ztof9xy4isxqo","tag_id":"ck6xuox240041tof9mcbvwjx8","_id":"ck6xuox250044tof9e39q9k11"},{"post_id":"ck6xuox23003ztof9xy4isxqo","tag_id":"ck6xuox0t001vtof970w8uy6z","_id":"ck6xuox250045tof9lvid8sxe"},{"post_id":"ck6xuox23003ztof9xy4isxqo","tag_id":"ck6xuox0t001wtof94rxngj8u","_id":"ck6xuox250046tof9aqj33z6j"},{"post_id":"ck6xuox23003ztof9xy4isxqo","tag_id":"ck6xuox240042tof9o3q5zll4","_id":"ck6xuox250047tof9unkld97q"}],"Tag":[{"name":"Atom","_id":"ck6xuowzv0006tof9veaaofws"},{"name":"Atom-plugin","_id":"ck6xuox02000atof9i7dd5t1h"},{"name":"Ghost","_id":"ck6xuox04000dtof9fnldq6b5"},{"name":"os","_id":"ck6xuox06000itof9vld9knmu"},{"name":"mac","_id":"ck6xuox07000mtof9qorvtz7n"},{"name":"ci","_id":"ck6xuox0e000wtof924h1z959"},{"name":"travis ci","_id":"ck6xuox0g0011tof9thp1tw8g"},{"name":"gitlab ci","_id":"ck6xuox0i0014tof9kkk3z5zz"},{"name":"openssh","_id":"ck6xuox0j0017tof9qisu0ywb"},{"name":"centos","_id":"ck6xuox0m001dtof9pjt2rbs4"},{"name":"Cookie","_id":"ck6xuox0p001mtof9pmd1pt2l"},{"name":"Debug","_id":"ck6xuox0r001qtof9xf9phtuy"},{"name":"dokku","_id":"ck6xuox0s001ttof9732bsja0"},{"name":"gogs","_id":"ck6xuox0t001vtof970w8uy6z"},{"name":"drone","_id":"ck6xuox0t001wtof94rxngj8u"},{"name":"CI","_id":"ck6xuox0t001xtof9qrbmcmca"},{"name":"CD","_id":"ck6xuox0t001ytof91t3zl75n"},{"name":"Vps","_id":"ck6xuox0t001ztof9lo0kg2c1"},{"name":"Swiftype","_id":"ck6xuox0u0022tof94073wvha"},{"name":"Raspberry","_id":"ck6xuox0u0025tof95ttgoa9w"},{"name":"Git","_id":"ck6xuox0v0028tof9j0mc1tjt"},{"name":"Hexo","_id":"ck6xuox0v002ctof9t19kgek6"},{"name":"TravisCI","_id":"ck6xuox0v002ftof991n5ilbk"},{"name":"Firebase","_id":"ck6xuox0w002htof9c1ss1doj"},{"name":"Github","_id":"ck6xuox0w002itof9387kmtmt"},{"name":"windows","_id":"ck6xuox0x002mtof92zp9wba8"},{"name":"前端开发环境","_id":"ck6xuox0x002ptof98jbbfpba"},{"name":"NodeJs","_id":"ck6xuox0x002rtof9xpwgqu79"},{"name":"Nginx","_id":"ck6xuox0y002utof97gi8iv8j"},{"name":"Fonts","_id":"ck6xuox0y002wtof9axbk991e"},{"name":"rancher","_id":"ck6xuox0z002ytof9uuhxulcm"},{"name":"rancher os","_id":"ck6xuox0z0030tof9q4ixz80o"},{"name":"kubernetes","_id":"ck6xuox0z0031tof9x2g6xx4n"},{"name":"k8s","_id":"ck6xuox0z0032tof9mgh3w4ty"},{"name":"Frontend","_id":"ck6xuox100036tof9bfosbjyn"},{"name":"SSH","_id":"ck6xuox110039tof933p2x31i"},{"name":"vsftpd","_id":"ck6xuox12003etof9ilvqk8y3"},{"name":"wechat","_id":"ck6xuox12003gtof9uphprovu"},{"name":"小程序","_id":"ck6xuox12003itof9z3zc747n"},{"name":"electron-ssr","_id":"ck6xuox1q003ntof9t09lm17n"},{"name":"electron","_id":"ck6xuox1x003qtof9z3c2w1mb"},{"name":"summary","_id":"ck6xuox1z003ttof9yu9yhgmb"},{"name":"Api","_id":"ck6xuox1z003utof93vqt0ilw"},{"name":"traefik","_id":"ck6xuox240040tof9g0u7915o"},{"name":"devops","_id":"ck6xuox240041tof9mcbvwjx8"},{"name":"registry","_id":"ck6xuox240042tof9o3q5zll4"}]}}